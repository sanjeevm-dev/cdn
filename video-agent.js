(function(){"use strict";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(V){return V&&V.__esModule&&Object.prototype.hasOwnProperty.call(V,"default")?V.default:V}var jsxRuntime={exports:{}},reactJsxRuntime_production={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var V=Symbol.for("react.transitional.element"),U=Symbol.for("react.fragment");function j(B,z,H){var G=null;if(H!==void 0&&(G=""+H),z.key!==void 0&&(G=""+z.key),"key"in z){H={};for(var $ in z)$!=="key"&&(H[$]=z[$])}else H=z;return z=H.ref,{$$typeof:V,type:B,key:G,ref:z!==void 0?z:null,props:H}}return reactJsxRuntime_production.Fragment=U,reactJsxRuntime_production.jsx=j,reactJsxRuntime_production.jsxs=j,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,function(V){function U(be,Re){var Be=be.length;be.push(Re);e:for(;0<Be;){var We=Be-1>>>1,pe=be[We];if(0<z(pe,Re))be[We]=Re,be[Be]=pe,Be=We;else break e}}function j(be){return be.length===0?null:be[0]}function B(be){if(be.length===0)return null;var Re=be[0],Be=be.pop();if(Be!==Re){be[0]=Be;e:for(var We=0,pe=be.length,we=pe>>>1;We<we;){var je=2*(We+1)-1,Ue=be[je],Ge=je+1,He=be[Ge];if(0>z(Ue,Be))Ge<pe&&0>z(He,Ue)?(be[We]=He,be[Ge]=Be,We=Ge):(be[We]=Ue,be[je]=Be,We=je);else if(Ge<pe&&0>z(He,Be))be[We]=He,be[Ge]=Be,We=Ge;else break e}}return Re}function z(be,Re){var Be=be.sortIndex-Re.sortIndex;return Be!==0?Be:be.id-Re.id}if(V.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var H=performance;V.unstable_now=function(){return H.now()}}else{var G=Date,$=G.now();V.unstable_now=function(){return G.now()-$}}var Q=[],W=[],X=1,ee=null,ie=3,ne=!1,re=!1,se=!1,de=!1,oe=typeof setTimeout=="function"?setTimeout:null,le=typeof clearTimeout=="function"?clearTimeout:null,ue=typeof setImmediate<"u"?setImmediate:null;function fe(be){for(var Re=j(W);Re!==null;){if(Re.callback===null)B(W);else if(Re.startTime<=be)B(W),Re.sortIndex=Re.expirationTime,U(Q,Re);else break;Re=j(W)}}function he(be){if(se=!1,fe(be),!re)if(j(Q)!==null)re=!0,ge||(ge=!0,ze());else{var Re=j(W);Re!==null&&qe(he,Re.startTime-be)}}var ge=!1,Ae=-1,_e=5,Pe=-1;function xe(){return de?!0:!(V.unstable_now()-Pe<_e)}function Ce(){if(de=!1,ge){var be=V.unstable_now();Pe=be;var Re=!0;try{e:{re=!1,se&&(se=!1,le(Ae),Ae=-1),ne=!0;var Be=ie;try{t:{for(fe(be),ee=j(Q);ee!==null&&!(ee.expirationTime>be&&xe());){var We=ee.callback;if(typeof We=="function"){ee.callback=null,ie=ee.priorityLevel;var pe=We(ee.expirationTime<=be);if(be=V.unstable_now(),typeof pe=="function"){ee.callback=pe,fe(be),Re=!0;break t}ee===j(Q)&&B(Q),fe(be)}else B(Q);ee=j(Q)}if(ee!==null)Re=!0;else{var we=j(W);we!==null&&qe(he,we.startTime-be),Re=!1}}break e}finally{ee=null,ie=Be,ne=!1}Re=void 0}}finally{Re?ze():ge=!1}}}var ze;if(typeof ue=="function")ze=function(){ue(Ce)};else if(typeof MessageChannel<"u"){var $e=new MessageChannel,Fe=$e.port2;$e.port1.onmessage=Ce,ze=function(){Fe.postMessage(null)}}else ze=function(){oe(Ce,0)};function qe(be,Re){Ae=oe(function(){be(V.unstable_now())},Re)}V.unstable_IdlePriority=5,V.unstable_ImmediatePriority=1,V.unstable_LowPriority=4,V.unstable_NormalPriority=3,V.unstable_Profiling=null,V.unstable_UserBlockingPriority=2,V.unstable_cancelCallback=function(be){be.callback=null},V.unstable_forceFrameRate=function(be){0>be||125<be?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_e=0<be?Math.floor(1e3/be):5},V.unstable_getCurrentPriorityLevel=function(){return ie},V.unstable_next=function(be){switch(ie){case 1:case 2:case 3:var Re=3;break;default:Re=ie}var Be=ie;ie=Re;try{return be()}finally{ie=Be}},V.unstable_requestPaint=function(){de=!0},V.unstable_runWithPriority=function(be,Re){switch(be){case 1:case 2:case 3:case 4:case 5:break;default:be=3}var Be=ie;ie=be;try{return Re()}finally{ie=Be}},V.unstable_scheduleCallback=function(be,Re,Be){var We=V.unstable_now();switch(typeof Be=="object"&&Be!==null?(Be=Be.delay,Be=typeof Be=="number"&&0<Be?We+Be:We):Be=We,be){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=Be+pe,be={id:X++,callback:Re,priorityLevel:be,startTime:Be,expirationTime:pe,sortIndex:-1},Be>We?(be.sortIndex=Be,U(W,be),j(Q)===null&&be===j(W)&&(se?(le(Ae),Ae=-1):se=!0,qe(he,Be-We))):(be.sortIndex=pe,U(Q,be),re||ne||(re=!0,ge||(ge=!0,ze()))),be},V.unstable_shouldYield=xe,V.unstable_wrapCallback=function(be){var Re=ie;return function(){var Be=ie;ie=Re;try{return be.apply(this,arguments)}finally{ie=Be}}}}(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var react={exports:{}},react_production={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var V=Symbol.for("react.transitional.element"),U=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),B=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),H=Symbol.for("react.consumer"),G=Symbol.for("react.context"),$=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),W=Symbol.for("react.memo"),X=Symbol.for("react.lazy"),ee=Symbol.iterator;function ie(pe){return pe===null||typeof pe!="object"?null:(pe=ee&&pe[ee]||pe["@@iterator"],typeof pe=="function"?pe:null)}var ne={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},re=Object.assign,se={};function de(pe,we,je){this.props=pe,this.context=we,this.refs=se,this.updater=je||ne}de.prototype.isReactComponent={},de.prototype.setState=function(pe,we){if(typeof pe!="object"&&typeof pe!="function"&&pe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,pe,we,"setState")},de.prototype.forceUpdate=function(pe){this.updater.enqueueForceUpdate(this,pe,"forceUpdate")};function oe(){}oe.prototype=de.prototype;function le(pe,we,je){this.props=pe,this.context=we,this.refs=se,this.updater=je||ne}var ue=le.prototype=new oe;ue.constructor=le,re(ue,de.prototype),ue.isPureReactComponent=!0;var fe=Array.isArray,he={H:null,A:null,T:null,S:null,V:null},ge=Object.prototype.hasOwnProperty;function Ae(pe,we,je,Ue,Ge,He){return je=He.ref,{$$typeof:V,type:pe,key:we,ref:je!==void 0?je:null,props:He}}function _e(pe,we){return Ae(pe.type,we,void 0,void 0,void 0,pe.props)}function Pe(pe){return typeof pe=="object"&&pe!==null&&pe.$$typeof===V}function xe(pe){var we={"=":"=0",":":"=2"};return"$"+pe.replace(/[=:]/g,function(je){return we[je]})}var Ce=/\/+/g;function ze(pe,we){return typeof pe=="object"&&pe!==null&&pe.key!=null?xe(""+pe.key):we.toString(36)}function $e(){}function Fe(pe){switch(pe.status){case"fulfilled":return pe.value;case"rejected":throw pe.reason;default:switch(typeof pe.status=="string"?pe.then($e,$e):(pe.status="pending",pe.then(function(we){pe.status==="pending"&&(pe.status="fulfilled",pe.value=we)},function(we){pe.status==="pending"&&(pe.status="rejected",pe.reason=we)})),pe.status){case"fulfilled":return pe.value;case"rejected":throw pe.reason}}throw pe}function qe(pe,we,je,Ue,Ge){var He=typeof pe;(He==="undefined"||He==="boolean")&&(pe=null);var De=!1;if(pe===null)De=!0;else switch(He){case"bigint":case"string":case"number":De=!0;break;case"object":switch(pe.$$typeof){case V:case U:De=!0;break;case X:return De=pe._init,qe(De(pe._payload),we,je,Ue,Ge)}}if(De)return Ge=Ge(pe),De=Ue===""?"."+ze(pe,0):Ue,fe(Ge)?(je="",De!=null&&(je=De.replace(Ce,"$&/")+"/"),qe(Ge,we,je,"",function(Je){return Je})):Ge!=null&&(Pe(Ge)&&(Ge=_e(Ge,je+(Ge.key==null||pe&&pe.key===Ge.key?"":(""+Ge.key).replace(Ce,"$&/")+"/")+De)),we.push(Ge)),1;De=0;var lt=Ue===""?".":Ue+":";if(fe(pe))for(var ut=0;ut<pe.length;ut++)Ue=pe[ut],He=lt+ze(Ue,ut),De+=qe(Ue,we,je,He,Ge);else if(ut=ie(pe),typeof ut=="function")for(pe=ut.call(pe),ut=0;!(Ue=pe.next()).done;)Ue=Ue.value,He=lt+ze(Ue,ut++),De+=qe(Ue,we,je,He,Ge);else if(He==="object"){if(typeof pe.then=="function")return qe(Fe(pe),we,je,Ue,Ge);throw we=String(pe),Error("Objects are not valid as a React child (found: "+(we==="[object Object]"?"object with keys {"+Object.keys(pe).join(", ")+"}":we)+"). If you meant to render a collection of children, use an array instead.")}return De}function be(pe,we,je){if(pe==null)return pe;var Ue=[],Ge=0;return qe(pe,Ue,"","",function(He){return we.call(je,He,Ge++)}),Ue}function Re(pe){if(pe._status===-1){var we=pe._result;we=we(),we.then(function(je){(pe._status===0||pe._status===-1)&&(pe._status=1,pe._result=je)},function(je){(pe._status===0||pe._status===-1)&&(pe._status=2,pe._result=je)}),pe._status===-1&&(pe._status=0,pe._result=we)}if(pe._status===1)return pe._result.default;throw pe._result}var Be=typeof reportError=="function"?reportError:function(pe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var we=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof pe=="object"&&pe!==null&&typeof pe.message=="string"?String(pe.message):String(pe),error:pe});if(!window.dispatchEvent(we))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",pe);return}console.error(pe)};function We(){}return react_production.Children={map:be,forEach:function(pe,we,je){be(pe,function(){we.apply(this,arguments)},je)},count:function(pe){var we=0;return be(pe,function(){we++}),we},toArray:function(pe){return be(pe,function(we){return we})||[]},only:function(pe){if(!Pe(pe))throw Error("React.Children.only expected to receive a single React element child.");return pe}},react_production.Component=de,react_production.Fragment=j,react_production.Profiler=z,react_production.PureComponent=le,react_production.StrictMode=B,react_production.Suspense=Q,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=he,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(pe){return he.H.useMemoCache(pe)}},react_production.cache=function(pe){return function(){return pe.apply(null,arguments)}},react_production.cloneElement=function(pe,we,je){if(pe==null)throw Error("The argument must be a React element, but you passed "+pe+".");var Ue=re({},pe.props),Ge=pe.key,He=void 0;if(we!=null)for(De in we.ref!==void 0&&(He=void 0),we.key!==void 0&&(Ge=""+we.key),we)!ge.call(we,De)||De==="key"||De==="__self"||De==="__source"||De==="ref"&&we.ref===void 0||(Ue[De]=we[De]);var De=arguments.length-2;if(De===1)Ue.children=je;else if(1<De){for(var lt=Array(De),ut=0;ut<De;ut++)lt[ut]=arguments[ut+2];Ue.children=lt}return Ae(pe.type,Ge,void 0,void 0,He,Ue)},react_production.createContext=function(pe){return pe={$$typeof:G,_currentValue:pe,_currentValue2:pe,_threadCount:0,Provider:null,Consumer:null},pe.Provider=pe,pe.Consumer={$$typeof:H,_context:pe},pe},react_production.createElement=function(pe,we,je){var Ue,Ge={},He=null;if(we!=null)for(Ue in we.key!==void 0&&(He=""+we.key),we)ge.call(we,Ue)&&Ue!=="key"&&Ue!=="__self"&&Ue!=="__source"&&(Ge[Ue]=we[Ue]);var De=arguments.length-2;if(De===1)Ge.children=je;else if(1<De){for(var lt=Array(De),ut=0;ut<De;ut++)lt[ut]=arguments[ut+2];Ge.children=lt}if(pe&&pe.defaultProps)for(Ue in De=pe.defaultProps,De)Ge[Ue]===void 0&&(Ge[Ue]=De[Ue]);return Ae(pe,He,void 0,void 0,null,Ge)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(pe){return{$$typeof:$,render:pe}},react_production.isValidElement=Pe,react_production.lazy=function(pe){return{$$typeof:X,_payload:{_status:-1,_result:pe},_init:Re}},react_production.memo=function(pe,we){return{$$typeof:W,type:pe,compare:we===void 0?null:we}},react_production.startTransition=function(pe){var we=he.T,je={};he.T=je;try{var Ue=pe(),Ge=he.S;Ge!==null&&Ge(je,Ue),typeof Ue=="object"&&Ue!==null&&typeof Ue.then=="function"&&Ue.then(We,Be)}catch(He){Be(He)}finally{he.T=we}},react_production.unstable_useCacheRefresh=function(){return he.H.useCacheRefresh()},react_production.use=function(pe){return he.H.use(pe)},react_production.useActionState=function(pe,we,je){return he.H.useActionState(pe,we,je)},react_production.useCallback=function(pe,we){return he.H.useCallback(pe,we)},react_production.useContext=function(pe){return he.H.useContext(pe)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(pe,we){return he.H.useDeferredValue(pe,we)},react_production.useEffect=function(pe,we,je){var Ue=he.H;if(typeof je=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ue.useEffect(pe,we)},react_production.useId=function(){return he.H.useId()},react_production.useImperativeHandle=function(pe,we,je){return he.H.useImperativeHandle(pe,we,je)},react_production.useInsertionEffect=function(pe,we){return he.H.useInsertionEffect(pe,we)},react_production.useLayoutEffect=function(pe,we){return he.H.useLayoutEffect(pe,we)},react_production.useMemo=function(pe,we){return he.H.useMemo(pe,we)},react_production.useOptimistic=function(pe,we){return he.H.useOptimistic(pe,we)},react_production.useReducer=function(pe,we,je){return he.H.useReducer(pe,we,je)},react_production.useRef=function(pe){return he.H.useRef(pe)},react_production.useState=function(pe){return he.H.useState(pe)},react_production.useSyncExternalStore=function(pe,we,je){return he.H.useSyncExternalStore(pe,we,je)},react_production.useTransition=function(){return he.H.useTransition()},react_production.version="19.1.0",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactDom={exports:{}},reactDom_production={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var V=requireReact();function U(Q){var W="https://react.dev/errors/"+Q;if(1<arguments.length){W+="?args[]="+encodeURIComponent(arguments[1]);for(var X=2;X<arguments.length;X++)W+="&args[]="+encodeURIComponent(arguments[X])}return"Minified React error #"+Q+"; visit "+W+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function j(){}var B={d:{f:j,r:function(){throw Error(U(522))},D:j,C:j,L:j,m:j,X:j,S:j,M:j},p:0,findDOMNode:null},z=Symbol.for("react.portal");function H(Q,W,X){var ee=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:z,key:ee==null?null:""+ee,children:Q,containerInfo:W,implementation:X}}var G=V.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function $(Q,W){if(Q==="font")return"";if(typeof W=="string")return W==="use-credentials"?W:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=B,reactDom_production.createPortal=function(Q,W){var X=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!W||W.nodeType!==1&&W.nodeType!==9&&W.nodeType!==11)throw Error(U(299));return H(Q,W,null,X)},reactDom_production.flushSync=function(Q){var W=G.T,X=B.p;try{if(G.T=null,B.p=2,Q)return Q()}finally{G.T=W,B.p=X,B.d.f()}},reactDom_production.preconnect=function(Q,W){typeof Q=="string"&&(W?(W=W.crossOrigin,W=typeof W=="string"?W==="use-credentials"?W:"":void 0):W=null,B.d.C(Q,W))},reactDom_production.prefetchDNS=function(Q){typeof Q=="string"&&B.d.D(Q)},reactDom_production.preinit=function(Q,W){if(typeof Q=="string"&&W&&typeof W.as=="string"){var X=W.as,ee=$(X,W.crossOrigin),ie=typeof W.integrity=="string"?W.integrity:void 0,ne=typeof W.fetchPriority=="string"?W.fetchPriority:void 0;X==="style"?B.d.S(Q,typeof W.precedence=="string"?W.precedence:void 0,{crossOrigin:ee,integrity:ie,fetchPriority:ne}):X==="script"&&B.d.X(Q,{crossOrigin:ee,integrity:ie,fetchPriority:ne,nonce:typeof W.nonce=="string"?W.nonce:void 0})}},reactDom_production.preinitModule=function(Q,W){if(typeof Q=="string")if(typeof W=="object"&&W!==null){if(W.as==null||W.as==="script"){var X=$(W.as,W.crossOrigin);B.d.M(Q,{crossOrigin:X,integrity:typeof W.integrity=="string"?W.integrity:void 0,nonce:typeof W.nonce=="string"?W.nonce:void 0})}}else W==null&&B.d.M(Q)},reactDom_production.preload=function(Q,W){if(typeof Q=="string"&&typeof W=="object"&&W!==null&&typeof W.as=="string"){var X=W.as,ee=$(X,W.crossOrigin);B.d.L(Q,X,{crossOrigin:ee,integrity:typeof W.integrity=="string"?W.integrity:void 0,nonce:typeof W.nonce=="string"?W.nonce:void 0,type:typeof W.type=="string"?W.type:void 0,fetchPriority:typeof W.fetchPriority=="string"?W.fetchPriority:void 0,referrerPolicy:typeof W.referrerPolicy=="string"?W.referrerPolicy:void 0,imageSrcSet:typeof W.imageSrcSet=="string"?W.imageSrcSet:void 0,imageSizes:typeof W.imageSizes=="string"?W.imageSizes:void 0,media:typeof W.media=="string"?W.media:void 0})}},reactDom_production.preloadModule=function(Q,W){if(typeof Q=="string")if(W){var X=$(W.as,W.crossOrigin);B.d.m(Q,{as:typeof W.as=="string"&&W.as!=="script"?W.as:void 0,crossOrigin:X,integrity:typeof W.integrity=="string"?W.integrity:void 0})}else B.d.m(Q)},reactDom_production.requestFormReset=function(Q){B.d.r(Q)},reactDom_production.unstable_batchedUpdates=function(Q,W){return Q(W)},reactDom_production.useFormState=function(Q,W,X){return G.H.useFormState(Q,W,X)},reactDom_production.useFormStatus=function(){return G.H.useHostTransitionStatus()},reactDom_production.version="19.1.0",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function V(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(V)}catch(U){console.error(U)}}return V(),reactDom.exports=requireReactDom_production(),reactDom.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var V=requireScheduler(),U=requireReact(),j=requireReactDom();function B(q){var F="https://react.dev/errors/"+q;if(1<arguments.length){F+="?args[]="+encodeURIComponent(arguments[1]);for(var K=2;K<arguments.length;K++)F+="&args[]="+encodeURIComponent(arguments[K])}return"Minified React error #"+q+"; visit "+F+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function z(q){return!(!q||q.nodeType!==1&&q.nodeType!==9&&q.nodeType!==11)}function H(q){var F=q,K=q;if(q.alternate)for(;F.return;)F=F.return;else{q=F;do F=q,(F.flags&4098)!==0&&(K=F.return),q=F.return;while(q)}return F.tag===3?K:null}function G(q){if(q.tag===13){var F=q.memoizedState;if(F===null&&(q=q.alternate,q!==null&&(F=q.memoizedState)),F!==null)return F.dehydrated}return null}function $(q){if(H(q)!==q)throw Error(B(188))}function Q(q){var F=q.alternate;if(!F){if(F=H(q),F===null)throw Error(B(188));return F!==q?null:q}for(var K=q,Y=F;;){var Z=K.return;if(Z===null)break;var te=Z.alternate;if(te===null){if(Y=Z.return,Y!==null){K=Y;continue}break}if(Z.child===te.child){for(te=Z.child;te;){if(te===K)return $(Z),q;if(te===Y)return $(Z),F;te=te.sibling}throw Error(B(188))}if(K.return!==Y.return)K=Z,Y=te;else{for(var ae=!1,ce=Z.child;ce;){if(ce===K){ae=!0,K=Z,Y=te;break}if(ce===Y){ae=!0,Y=Z,K=te;break}ce=ce.sibling}if(!ae){for(ce=te.child;ce;){if(ce===K){ae=!0,K=te,Y=Z;break}if(ce===Y){ae=!0,Y=te,K=Z;break}ce=ce.sibling}if(!ae)throw Error(B(189))}}if(K.alternate!==Y)throw Error(B(190))}if(K.tag!==3)throw Error(B(188));return K.stateNode.current===K?q:F}function W(q){var F=q.tag;if(F===5||F===26||F===27||F===6)return q;for(q=q.child;q!==null;){if(F=W(q),F!==null)return F;q=q.sibling}return null}var X=Object.assign,ee=Symbol.for("react.element"),ie=Symbol.for("react.transitional.element"),ne=Symbol.for("react.portal"),re=Symbol.for("react.fragment"),se=Symbol.for("react.strict_mode"),de=Symbol.for("react.profiler"),oe=Symbol.for("react.provider"),le=Symbol.for("react.consumer"),ue=Symbol.for("react.context"),fe=Symbol.for("react.forward_ref"),he=Symbol.for("react.suspense"),ge=Symbol.for("react.suspense_list"),Ae=Symbol.for("react.memo"),_e=Symbol.for("react.lazy"),Pe=Symbol.for("react.activity"),xe=Symbol.for("react.memo_cache_sentinel"),Ce=Symbol.iterator;function ze(q){return q===null||typeof q!="object"?null:(q=Ce&&q[Ce]||q["@@iterator"],typeof q=="function"?q:null)}var $e=Symbol.for("react.client.reference");function Fe(q){if(q==null)return null;if(typeof q=="function")return q.$$typeof===$e?null:q.displayName||q.name||null;if(typeof q=="string")return q;switch(q){case re:return"Fragment";case de:return"Profiler";case se:return"StrictMode";case he:return"Suspense";case ge:return"SuspenseList";case Pe:return"Activity"}if(typeof q=="object")switch(q.$$typeof){case ne:return"Portal";case ue:return(q.displayName||"Context")+".Provider";case le:return(q._context.displayName||"Context")+".Consumer";case fe:var F=q.render;return q=q.displayName,q||(q=F.displayName||F.name||"",q=q!==""?"ForwardRef("+q+")":"ForwardRef"),q;case Ae:return F=q.displayName||null,F!==null?F:Fe(q.type)||"Memo";case _e:F=q._payload,q=q._init;try{return Fe(q(F))}catch{}}return null}var qe=Array.isArray,be=U.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Re=j.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Be={pending:!1,data:null,method:null,action:null},We=[],pe=-1;function we(q){return{current:q}}function je(q){0>pe||(q.current=We[pe],We[pe]=null,pe--)}function Ue(q,F){pe++,We[pe]=q.current,q.current=F}var Ge=we(null),He=we(null),De=we(null),lt=we(null);function ut(q,F){switch(Ue(De,F),Ue(He,q),Ue(Ge,null),F.nodeType){case 9:case 11:q=(q=F.documentElement)&&(q=q.namespaceURI)?of(q):0;break;default:if(q=F.tagName,F=F.namespaceURI)F=of(F),q=cf(F,q);else switch(q){case"svg":q=1;break;case"math":q=2;break;default:q=0}}je(Ge),Ue(Ge,q)}function Je(){je(Ge),je(He),je(De)}function tt(q){q.memoizedState!==null&&Ue(lt,q);var F=Ge.current,K=cf(F,q.type);F!==K&&(Ue(He,q),Ue(Ge,K))}function St(q){He.current===q&&(je(Ge),je(He)),lt.current===q&&(je(lt),da._currentValue=Be)}var ti=Object.prototype.hasOwnProperty,$t=V.unstable_scheduleCallback,br=V.unstable_cancelCallback,ws=V.unstable_shouldYield,Tr=V.unstable_requestPaint,Et=V.unstable_now,ga=V.unstable_getCurrentPriorityLevel,Qt=V.unstable_ImmediatePriority,va=V.unstable_UserBlockingPriority,Dn=V.unstable_NormalPriority,As=V.unstable_LowPriority,Sr=V.unstable_IdlePriority,Ps=V.log,ii=V.unstable_setDisableYieldValue,zi=null,qt=null;function Ci(q){if(typeof Ps=="function"&&ii(q),qt&&typeof qt.setStrictMode=="function")try{qt.setStrictMode(zi,q)}catch{}}var It=Math.clz32?Math.clz32:Ms,Ds=Math.log,Os=Math.LN2;function Ms(q){return q>>>=0,q===0?32:31-(Ds(q)/Os|0)|0}var _t=256,Ne=4194304;function Me(q){var F=q&42;if(F!==0)return F;switch(q&-q){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return q&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return q&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return q}}function Ve(q,F,K){var Y=q.pendingLanes;if(Y===0)return 0;var Z=0,te=q.suspendedLanes,ae=q.pingedLanes;q=q.warmLanes;var ce=Y&134217727;return ce!==0?(Y=ce&~te,Y!==0?Z=Me(Y):(ae&=ce,ae!==0?Z=Me(ae):K||(K=ce&~q,K!==0&&(Z=Me(K))))):(ce=Y&~te,ce!==0?Z=Me(ce):ae!==0?Z=Me(ae):K||(K=Y&~q,K!==0&&(Z=Me(K)))),Z===0?0:F!==0&&F!==Z&&(F&te)===0&&(te=Z&-Z,K=F&-F,te>=K||te===32&&(K&4194048)!==0)?F:Z}function Ke(q,F){return(q.pendingLanes&~(q.suspendedLanes&~q.pingedLanes)&F)===0}function Qe(q,F){switch(q){case 1:case 2:case 4:case 8:case 64:return F+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return F+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nt(){var q=_t;return _t<<=1,(_t&4194048)===0&&(_t=256),q}function yt(){var q=Ne;return Ne<<=1,(Ne&62914560)===0&&(Ne=4194304),q}function Dt(q){for(var F=[],K=0;31>K;K++)F.push(q);return F}function wt(q,F){q.pendingLanes|=F,F!==268435456&&(q.suspendedLanes=0,q.pingedLanes=0,q.warmLanes=0)}function On(q,F,K,Y,Z,te){var ae=q.pendingLanes;q.pendingLanes=K,q.suspendedLanes=0,q.pingedLanes=0,q.warmLanes=0,q.expiredLanes&=K,q.entangledLanes&=K,q.errorRecoveryDisabledLanes&=K,q.shellSuspendCounter=0;var ce=q.entanglements,me=q.expirationTimes,Se=q.hiddenUpdates;for(K=ae&~K;0<K;){var Oe=31-It(K),Ie=1<<Oe;ce[Oe]=0,me[Oe]=-1;var ke=Se[Oe];if(ke!==null)for(Se[Oe]=null,Oe=0;Oe<ke.length;Oe++){var Ee=ke[Oe];Ee!==null&&(Ee.lane&=-536870913)}K&=~Ie}Y!==0&&Ls(q,Y,0),te!==0&&Z===0&&q.tag!==0&&(q.suspendedLanes|=te&~(ae&~F))}function Ls(q,F,K){q.pendingLanes|=F,q.suspendedLanes&=~F;var Y=31-It(F);q.entangledLanes|=F,q.entanglements[Y]=q.entanglements[Y]|1073741824|K&4194090}function Mn(q,F){var K=q.entangledLanes|=F;for(q=q.entanglements;K;){var Y=31-It(K),Z=1<<Y;Z&F|q[Y]&F&&(q[Y]|=F),K&=~Z}}function Ns(q){switch(q){case 2:q=1;break;case 8:q=4;break;case 32:q=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:q=128;break;case 268435456:q=134217728;break;default:q=0}return q}function Is(q){return q&=-q,2<q?8<q?(q&134217727)!==0?32:268435456:8:2}function Kc(){var q=Re.p;return q!==0?q:(q=window.event,q===void 0?32:Rf(q.type))}function Mf(q,F){var K=Re.p;try{return Re.p=q,F()}finally{Re.p=K}}var Hi=Math.random().toString(36).slice(2),Gt="__reactFiber$"+Hi,Wt="__reactProps$"+Hi,Ln="__reactContainer$"+Hi,Us="__reactEvents$"+Hi,Lf="__reactListeners$"+Hi,Nf="__reactHandles$"+Hi,$c="__reactResources$"+Hi,Cr="__reactMarker$"+Hi;function Vs(q){delete q[Gt],delete q[Wt],delete q[Us],delete q[Lf],delete q[Nf]}function Nn(q){var F=q[Gt];if(F)return F;for(var K=q.parentNode;K;){if(F=K[Ln]||K[Gt]){if(K=F.alternate,F.child!==null||K!==null&&K.child!==null)for(q=ff(q);q!==null;){if(K=q[Gt])return K;q=ff(q)}return F}q=K,K=q.parentNode}return null}function In(q){if(q=q[Gt]||q[Ln]){var F=q.tag;if(F===5||F===6||F===13||F===26||F===27||F===3)return q}return null}function kr(q){var F=q.tag;if(F===5||F===26||F===27||F===6)return q.stateNode;throw Error(B(33))}function Un(q){var F=q[$c];return F||(F=q[$c]={hoistableStyles:new Map,hoistableScripts:new Map}),F}function Ut(q){q[Cr]=!0}var Qc=new Set,Yc={};function pn(q,F){Vn(q,F),Vn(q+"Capture",F)}function Vn(q,F){for(Yc[q]=F,q=0;q<F.length;q++)Qc.add(F[q])}var If=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wc={},Xc={};function Uf(q){return ti.call(Xc,q)?!0:ti.call(Wc,q)?!1:If.test(q)?Xc[q]=!0:(Wc[q]=!0,!1)}function ya(q,F,K){if(Uf(F))if(K===null)q.removeAttribute(F);else{switch(typeof K){case"undefined":case"function":case"symbol":q.removeAttribute(F);return;case"boolean":var Y=F.toLowerCase().slice(0,5);if(Y!=="data-"&&Y!=="aria-"){q.removeAttribute(F);return}}q.setAttribute(F,""+K)}}function ba(q,F,K){if(K===null)q.removeAttribute(F);else{switch(typeof K){case"undefined":case"function":case"symbol":case"boolean":q.removeAttribute(F);return}q.setAttribute(F,""+K)}}function wi(q,F,K,Y){if(Y===null)q.removeAttribute(K);else{switch(typeof Y){case"undefined":case"function":case"symbol":case"boolean":q.removeAttribute(K);return}q.setAttributeNS(F,K,""+Y)}}var js,Jc;function jn(q){if(js===void 0)try{throw Error()}catch(K){var F=K.stack.trim().match(/\n( *(at )?)/);js=F&&F[1]||"",Jc=-1<K.stack.indexOf(`
    at`)?" (<anonymous>)":-1<K.stack.indexOf("@")?"@unknown:0:0":""}return`
`+js+q+Jc}var Bs=!1;function qs(q,F){if(!q||Bs)return"";Bs=!0;var K=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var Y={DetermineComponentFrameRoot:function(){try{if(F){var Ie=function(){throw Error()};if(Object.defineProperty(Ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ie,[])}catch(Ee){var ke=Ee}Reflect.construct(q,[],Ie)}else{try{Ie.call()}catch(Ee){ke=Ee}q.call(Ie.prototype)}}else{try{throw Error()}catch(Ee){ke=Ee}(Ie=q())&&typeof Ie.catch=="function"&&Ie.catch(function(){})}}catch(Ee){if(Ee&&ke&&typeof Ee.stack=="string")return[Ee.stack,ke.stack]}return[null,null]}};Y.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var Z=Object.getOwnPropertyDescriptor(Y.DetermineComponentFrameRoot,"name");Z&&Z.configurable&&Object.defineProperty(Y.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var te=Y.DetermineComponentFrameRoot(),ae=te[0],ce=te[1];if(ae&&ce){var me=ae.split(`
`),Se=ce.split(`
`);for(Z=Y=0;Y<me.length&&!me[Y].includes("DetermineComponentFrameRoot");)Y++;for(;Z<Se.length&&!Se[Z].includes("DetermineComponentFrameRoot");)Z++;if(Y===me.length||Z===Se.length)for(Y=me.length-1,Z=Se.length-1;1<=Y&&0<=Z&&me[Y]!==Se[Z];)Z--;for(;1<=Y&&0<=Z;Y--,Z--)if(me[Y]!==Se[Z]){if(Y!==1||Z!==1)do if(Y--,Z--,0>Z||me[Y]!==Se[Z]){var Oe=`
`+me[Y].replace(" at new "," at ");return q.displayName&&Oe.includes("<anonymous>")&&(Oe=Oe.replace("<anonymous>",q.displayName)),Oe}while(1<=Y&&0<=Z);break}}}finally{Bs=!1,Error.prepareStackTrace=K}return(K=q?q.displayName||q.name:"")?jn(K):""}function Vf(q){switch(q.tag){case 26:case 27:case 5:return jn(q.type);case 16:return jn("Lazy");case 13:return jn("Suspense");case 19:return jn("SuspenseList");case 0:case 15:return qs(q.type,!1);case 11:return qs(q.type.render,!1);case 1:return qs(q.type,!0);case 31:return jn("Activity");default:return""}}function Zc(q){try{var F="";do F+=Vf(q),q=q.return;while(q);return F}catch(K){return`
Error generating stack: `+K.message+`
`+K.stack}}function ui(q){switch(typeof q){case"bigint":case"boolean":case"number":case"string":case"undefined":return q;case"object":return q;default:return""}}function el(q){var F=q.type;return(q=q.nodeName)&&q.toLowerCase()==="input"&&(F==="checkbox"||F==="radio")}function jf(q){var F=el(q)?"checked":"value",K=Object.getOwnPropertyDescriptor(q.constructor.prototype,F),Y=""+q[F];if(!q.hasOwnProperty(F)&&typeof K<"u"&&typeof K.get=="function"&&typeof K.set=="function"){var Z=K.get,te=K.set;return Object.defineProperty(q,F,{configurable:!0,get:function(){return Z.call(this)},set:function(ae){Y=""+ae,te.call(this,ae)}}),Object.defineProperty(q,F,{enumerable:K.enumerable}),{getValue:function(){return Y},setValue:function(ae){Y=""+ae},stopTracking:function(){q._valueTracker=null,delete q[F]}}}}function Ta(q){q._valueTracker||(q._valueTracker=jf(q))}function tl(q){if(!q)return!1;var F=q._valueTracker;if(!F)return!0;var K=F.getValue(),Y="";return q&&(Y=el(q)?q.checked?"true":"false":q.value),q=Y,q!==K?(F.setValue(q),!0):!1}function Sa(q){if(q=q||(typeof document<"u"?document:void 0),typeof q>"u")return null;try{return q.activeElement||q.body}catch{return q.body}}var Bf=/[\n"\\]/g;function di(q){return q.replace(Bf,function(F){return"\\"+F.charCodeAt(0).toString(16)+" "})}function Fs(q,F,K,Y,Z,te,ae,ce){q.name="",ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"?q.type=ae:q.removeAttribute("type"),F!=null?ae==="number"?(F===0&&q.value===""||q.value!=F)&&(q.value=""+ui(F)):q.value!==""+ui(F)&&(q.value=""+ui(F)):ae!=="submit"&&ae!=="reset"||q.removeAttribute("value"),F!=null?zs(q,ae,ui(F)):K!=null?zs(q,ae,ui(K)):Y!=null&&q.removeAttribute("value"),Z==null&&te!=null&&(q.defaultChecked=!!te),Z!=null&&(q.checked=Z&&typeof Z!="function"&&typeof Z!="symbol"),ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"?q.name=""+ui(ce):q.removeAttribute("name")}function il(q,F,K,Y,Z,te,ae,ce){if(te!=null&&typeof te!="function"&&typeof te!="symbol"&&typeof te!="boolean"&&(q.type=te),F!=null||K!=null){if(!(te!=="submit"&&te!=="reset"||F!=null))return;K=K!=null?""+ui(K):"",F=F!=null?""+ui(F):K,ce||F===q.value||(q.value=F),q.defaultValue=F}Y=Y??Z,Y=typeof Y!="function"&&typeof Y!="symbol"&&!!Y,q.checked=ce?q.checked:!!Y,q.defaultChecked=!!Y,ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"&&(q.name=ae)}function zs(q,F,K){F==="number"&&Sa(q.ownerDocument)===q||q.defaultValue===""+K||(q.defaultValue=""+K)}function Bn(q,F,K,Y){if(q=q.options,F){F={};for(var Z=0;Z<K.length;Z++)F["$"+K[Z]]=!0;for(K=0;K<q.length;K++)Z=F.hasOwnProperty("$"+q[K].value),q[K].selected!==Z&&(q[K].selected=Z),Z&&Y&&(q[K].defaultSelected=!0)}else{for(K=""+ui(K),F=null,Z=0;Z<q.length;Z++){if(q[Z].value===K){q[Z].selected=!0,Y&&(q[Z].defaultSelected=!0);return}F!==null||q[Z].disabled||(F=q[Z])}F!==null&&(F.selected=!0)}}function nl(q,F,K){if(F!=null&&(F=""+ui(F),F!==q.value&&(q.value=F),K==null)){q.defaultValue!==F&&(q.defaultValue=F);return}q.defaultValue=K!=null?""+ui(K):""}function rl(q,F,K,Y){if(F==null){if(Y!=null){if(K!=null)throw Error(B(92));if(qe(Y)){if(1<Y.length)throw Error(B(93));Y=Y[0]}K=Y}K==null&&(K=""),F=K}K=ui(F),q.defaultValue=K,Y=q.textContent,Y===K&&Y!==""&&Y!==null&&(q.value=Y)}function qn(q,F){if(F){var K=q.firstChild;if(K&&K===q.lastChild&&K.nodeType===3){K.nodeValue=F;return}}q.textContent=F}var qf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function al(q,F,K){var Y=F.indexOf("--")===0;K==null||typeof K=="boolean"||K===""?Y?q.setProperty(F,""):F==="float"?q.cssFloat="":q[F]="":Y?q.setProperty(F,K):typeof K!="number"||K===0||qf.has(F)?F==="float"?q.cssFloat=K:q[F]=(""+K).trim():q[F]=K+"px"}function sl(q,F,K){if(F!=null&&typeof F!="object")throw Error(B(62));if(q=q.style,K!=null){for(var Y in K)!K.hasOwnProperty(Y)||F!=null&&F.hasOwnProperty(Y)||(Y.indexOf("--")===0?q.setProperty(Y,""):Y==="float"?q.cssFloat="":q[Y]="");for(var Z in F)Y=F[Z],F.hasOwnProperty(Z)&&K[Z]!==Y&&al(q,Z,Y)}else for(var te in F)F.hasOwnProperty(te)&&al(q,te,F[te])}function Hs(q){if(q.indexOf("-")===-1)return!1;switch(q){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ff=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),zf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ca(q){return zf.test(""+q)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":q}var Gs=null;function Ks(q){return q=q.target||q.srcElement||window,q.correspondingUseElement&&(q=q.correspondingUseElement),q.nodeType===3?q.parentNode:q}var Fn=null,zn=null;function ol(q){var F=In(q);if(F&&(q=F.stateNode)){var K=q[Wt]||null;e:switch(q=F.stateNode,F.type){case"input":if(Fs(q,K.value,K.defaultValue,K.defaultValue,K.checked,K.defaultChecked,K.type,K.name),F=K.name,K.type==="radio"&&F!=null){for(K=q;K.parentNode;)K=K.parentNode;for(K=K.querySelectorAll('input[name="'+di(""+F)+'"][type="radio"]'),F=0;F<K.length;F++){var Y=K[F];if(Y!==q&&Y.form===q.form){var Z=Y[Wt]||null;if(!Z)throw Error(B(90));Fs(Y,Z.value,Z.defaultValue,Z.defaultValue,Z.checked,Z.defaultChecked,Z.type,Z.name)}}for(F=0;F<K.length;F++)Y=K[F],Y.form===q.form&&tl(Y)}break e;case"textarea":nl(q,K.value,K.defaultValue);break e;case"select":F=K.value,F!=null&&Bn(q,!!K.multiple,F,!1)}}}var $s=!1;function cl(q,F,K){if($s)return q(F,K);$s=!0;try{var Y=q(F);return Y}finally{if($s=!1,(Fn!==null||zn!==null)&&(os(),Fn&&(F=Fn,q=zn,zn=Fn=null,ol(F),q)))for(F=0;F<q.length;F++)ol(q[F])}}function Er(q,F){var K=q.stateNode;if(K===null)return null;var Y=K[Wt]||null;if(Y===null)return null;K=Y[F];e:switch(F){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(Y=!Y.disabled)||(q=q.type,Y=!(q==="button"||q==="input"||q==="select"||q==="textarea")),q=!Y;break e;default:q=!1}if(q)return null;if(K&&typeof K!="function")throw Error(B(231,F,typeof K));return K}var Ai=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qs=!1;if(Ai)try{var _r={};Object.defineProperty(_r,"passive",{get:function(){Qs=!0}}),window.addEventListener("test",_r,_r),window.removeEventListener("test",_r,_r)}catch{Qs=!1}var Gi=null,Ys=null,ka=null;function ll(){if(ka)return ka;var q,F=Ys,K=F.length,Y,Z="value"in Gi?Gi.value:Gi.textContent,te=Z.length;for(q=0;q<K&&F[q]===Z[q];q++);var ae=K-q;for(Y=1;Y<=ae&&F[K-Y]===Z[te-Y];Y++);return ka=Z.slice(q,1<Y?1-Y:void 0)}function Ea(q){var F=q.keyCode;return"charCode"in q?(q=q.charCode,q===0&&F===13&&(q=13)):q=F,q===10&&(q=13),32<=q||q===13?q:0}function _a(){return!0}function ul(){return!1}function Xt(q){function F(K,Y,Z,te,ae){this._reactName=K,this._targetInst=Z,this.type=Y,this.nativeEvent=te,this.target=ae,this.currentTarget=null;for(var ce in q)q.hasOwnProperty(ce)&&(K=q[ce],this[ce]=K?K(te):te[ce]);return this.isDefaultPrevented=(te.defaultPrevented!=null?te.defaultPrevented:te.returnValue===!1)?_a:ul,this.isPropagationStopped=ul,this}return X(F.prototype,{preventDefault:function(){this.defaultPrevented=!0;var K=this.nativeEvent;K&&(K.preventDefault?K.preventDefault():typeof K.returnValue!="unknown"&&(K.returnValue=!1),this.isDefaultPrevented=_a)},stopPropagation:function(){var K=this.nativeEvent;K&&(K.stopPropagation?K.stopPropagation():typeof K.cancelBubble!="unknown"&&(K.cancelBubble=!0),this.isPropagationStopped=_a)},persist:function(){},isPersistent:_a}),F}var mn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(q){return q.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xa=Xt(mn),xr=X({},mn,{view:0,detail:0}),Hf=Xt(xr),Ws,Xs,Rr,Ra=X({},xr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zs,button:0,buttons:0,relatedTarget:function(q){return q.relatedTarget===void 0?q.fromElement===q.srcElement?q.toElement:q.fromElement:q.relatedTarget},movementX:function(q){return"movementX"in q?q.movementX:(q!==Rr&&(Rr&&q.type==="mousemove"?(Ws=q.screenX-Rr.screenX,Xs=q.screenY-Rr.screenY):Xs=Ws=0,Rr=q),Ws)},movementY:function(q){return"movementY"in q?q.movementY:Xs}}),dl=Xt(Ra),Gf=X({},Ra,{dataTransfer:0}),Kf=Xt(Gf),$f=X({},xr,{relatedTarget:0}),Js=Xt($f),Qf=X({},mn,{animationName:0,elapsedTime:0,pseudoElement:0}),Yf=Xt(Qf),Wf=X({},mn,{clipboardData:function(q){return"clipboardData"in q?q.clipboardData:window.clipboardData}}),Xf=Xt(Wf),Jf=X({},mn,{data:0}),fl=Xt(Jf),Zf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},th={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ih(q){var F=this.nativeEvent;return F.getModifierState?F.getModifierState(q):(q=th[q])?!!F[q]:!1}function Zs(){return ih}var nh=X({},xr,{key:function(q){if(q.key){var F=Zf[q.key]||q.key;if(F!=="Unidentified")return F}return q.type==="keypress"?(q=Ea(q),q===13?"Enter":String.fromCharCode(q)):q.type==="keydown"||q.type==="keyup"?eh[q.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zs,charCode:function(q){return q.type==="keypress"?Ea(q):0},keyCode:function(q){return q.type==="keydown"||q.type==="keyup"?q.keyCode:0},which:function(q){return q.type==="keypress"?Ea(q):q.type==="keydown"||q.type==="keyup"?q.keyCode:0}}),rh=Xt(nh),ah=X({},Ra,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hl=Xt(ah),sh=X({},xr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zs}),oh=Xt(sh),ch=X({},mn,{propertyName:0,elapsedTime:0,pseudoElement:0}),lh=Xt(ch),uh=X({},Ra,{deltaX:function(q){return"deltaX"in q?q.deltaX:"wheelDeltaX"in q?-q.wheelDeltaX:0},deltaY:function(q){return"deltaY"in q?q.deltaY:"wheelDeltaY"in q?-q.wheelDeltaY:"wheelDelta"in q?-q.wheelDelta:0},deltaZ:0,deltaMode:0}),dh=Xt(uh),fh=X({},mn,{newState:0,oldState:0}),hh=Xt(fh),ph=[9,13,27,32],eo=Ai&&"CompositionEvent"in window,wr=null;Ai&&"documentMode"in document&&(wr=document.documentMode);var mh=Ai&&"TextEvent"in window&&!wr,pl=Ai&&(!eo||wr&&8<wr&&11>=wr),ml=" ",gl=!1;function vl(q,F){switch(q){case"keyup":return ph.indexOf(F.keyCode)!==-1;case"keydown":return F.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yl(q){return q=q.detail,typeof q=="object"&&"data"in q?q.data:null}var Hn=!1;function gh(q,F){switch(q){case"compositionend":return yl(F);case"keypress":return F.which!==32?null:(gl=!0,ml);case"textInput":return q=F.data,q===ml&&gl?null:q;default:return null}}function yh(q,F){if(Hn)return q==="compositionend"||!eo&&vl(q,F)?(q=ll(),ka=Ys=Gi=null,Hn=!1,q):null;switch(q){case"paste":return null;case"keypress":if(!(F.ctrlKey||F.altKey||F.metaKey)||F.ctrlKey&&F.altKey){if(F.char&&1<F.char.length)return F.char;if(F.which)return String.fromCharCode(F.which)}return null;case"compositionend":return pl&&F.locale!=="ko"?null:F.data;default:return null}}var bh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bl(q){var F=q&&q.nodeName&&q.nodeName.toLowerCase();return F==="input"?!!bh[q.type]:F==="textarea"}function Tl(q,F,K,Y){Fn?zn?zn.push(Y):zn=[Y]:Fn=Y,F=hs(F,"onChange"),0<F.length&&(K=new xa("onChange","change",null,K,Y),q.push({event:K,listeners:F}))}var Ar=null,Pr=null;function Th(q){tf(q,0)}function wa(q){var F=kr(q);if(tl(F))return q}function Sl(q,F){if(q==="change")return F}var Cl=!1;if(Ai){var to;if(Ai){var io="oninput"in document;if(!io){var kl=document.createElement("div");kl.setAttribute("oninput","return;"),io=typeof kl.oninput=="function"}to=io}else to=!1;Cl=to&&(!document.documentMode||9<document.documentMode)}function El(){Ar&&(Ar.detachEvent("onpropertychange",_l),Pr=Ar=null)}function _l(q){if(q.propertyName==="value"&&wa(Pr)){var F=[];Tl(F,Pr,q,Ks(q)),cl(Th,F)}}function Sh(q,F,K){q==="focusin"?(El(),Ar=F,Pr=K,Ar.attachEvent("onpropertychange",_l)):q==="focusout"&&El()}function Ch(q){if(q==="selectionchange"||q==="keyup"||q==="keydown")return wa(Pr)}function kh(q,F){if(q==="click")return wa(F)}function Eh(q,F){if(q==="input"||q==="change")return wa(F)}function _h(q,F){return q===F&&(q!==0||1/q===1/F)||q!==q&&F!==F}var ni=typeof Object.is=="function"?Object.is:_h;function Dr(q,F){if(ni(q,F))return!0;if(typeof q!="object"||q===null||typeof F!="object"||F===null)return!1;var K=Object.keys(q),Y=Object.keys(F);if(K.length!==Y.length)return!1;for(Y=0;Y<K.length;Y++){var Z=K[Y];if(!ti.call(F,Z)||!ni(q[Z],F[Z]))return!1}return!0}function xl(q){for(;q&&q.firstChild;)q=q.firstChild;return q}function Rl(q,F){var K=xl(q);q=0;for(var Y;K;){if(K.nodeType===3){if(Y=q+K.textContent.length,q<=F&&Y>=F)return{node:K,offset:F-q};q=Y}e:{for(;K;){if(K.nextSibling){K=K.nextSibling;break e}K=K.parentNode}K=void 0}K=xl(K)}}function wl(q,F){return q&&F?q===F?!0:q&&q.nodeType===3?!1:F&&F.nodeType===3?wl(q,F.parentNode):"contains"in q?q.contains(F):q.compareDocumentPosition?!!(q.compareDocumentPosition(F)&16):!1:!1}function Al(q){q=q!=null&&q.ownerDocument!=null&&q.ownerDocument.defaultView!=null?q.ownerDocument.defaultView:window;for(var F=Sa(q.document);F instanceof q.HTMLIFrameElement;){try{var K=typeof F.contentWindow.location.href=="string"}catch{K=!1}if(K)q=F.contentWindow;else break;F=Sa(q.document)}return F}function no(q){var F=q&&q.nodeName&&q.nodeName.toLowerCase();return F&&(F==="input"&&(q.type==="text"||q.type==="search"||q.type==="tel"||q.type==="url"||q.type==="password")||F==="textarea"||q.contentEditable==="true")}var xh=Ai&&"documentMode"in document&&11>=document.documentMode,Gn=null,ro=null,Or=null,ao=!1;function Pl(q,F,K){var Y=K.window===K?K.document:K.nodeType===9?K:K.ownerDocument;ao||Gn==null||Gn!==Sa(Y)||(Y=Gn,"selectionStart"in Y&&no(Y)?Y={start:Y.selectionStart,end:Y.selectionEnd}:(Y=(Y.ownerDocument&&Y.ownerDocument.defaultView||window).getSelection(),Y={anchorNode:Y.anchorNode,anchorOffset:Y.anchorOffset,focusNode:Y.focusNode,focusOffset:Y.focusOffset}),Or&&Dr(Or,Y)||(Or=Y,Y=hs(ro,"onSelect"),0<Y.length&&(F=new xa("onSelect","select",null,F,K),q.push({event:F,listeners:Y}),F.target=Gn)))}function gn(q,F){var K={};return K[q.toLowerCase()]=F.toLowerCase(),K["Webkit"+q]="webkit"+F,K["Moz"+q]="moz"+F,K}var Kn={animationend:gn("Animation","AnimationEnd"),animationiteration:gn("Animation","AnimationIteration"),animationstart:gn("Animation","AnimationStart"),transitionrun:gn("Transition","TransitionRun"),transitionstart:gn("Transition","TransitionStart"),transitioncancel:gn("Transition","TransitionCancel"),transitionend:gn("Transition","TransitionEnd")},so={},Dl={};Ai&&(Dl=document.createElement("div").style,"AnimationEvent"in window||(delete Kn.animationend.animation,delete Kn.animationiteration.animation,delete Kn.animationstart.animation),"TransitionEvent"in window||delete Kn.transitionend.transition);function vn(q){if(so[q])return so[q];if(!Kn[q])return q;var F=Kn[q],K;for(K in F)if(F.hasOwnProperty(K)&&K in Dl)return so[q]=F[K];return q}var Ol=vn("animationend"),Ml=vn("animationiteration"),Ll=vn("animationstart"),Rh=vn("transitionrun"),wh=vn("transitionstart"),Ah=vn("transitioncancel"),Nl=vn("transitionend"),Il=new Map,oo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");oo.push("scrollEnd");function bi(q,F){Il.set(q,F),pn(F,[q])}var Ul=new WeakMap;function fi(q,F){if(typeof q=="object"&&q!==null){var K=Ul.get(q);return K!==void 0?K:(F={value:q,source:F,stack:Zc(F)},Ul.set(q,F),F)}return{value:q,source:F,stack:Zc(F)}}var hi=[],$n=0,co=0;function Aa(){for(var q=$n,F=co=$n=0;F<q;){var K=hi[F];hi[F++]=null;var Y=hi[F];hi[F++]=null;var Z=hi[F];hi[F++]=null;var te=hi[F];if(hi[F++]=null,Y!==null&&Z!==null){var ae=Y.pending;ae===null?Z.next=Z:(Z.next=ae.next,ae.next=Z),Y.pending=Z}te!==0&&Vl(K,Z,te)}}function Pa(q,F,K,Y){hi[$n++]=q,hi[$n++]=F,hi[$n++]=K,hi[$n++]=Y,co|=Y,q.lanes|=Y,q=q.alternate,q!==null&&(q.lanes|=Y)}function lo(q,F,K,Y){return Pa(q,F,K,Y),Da(q)}function Qn(q,F){return Pa(q,null,null,F),Da(q)}function Vl(q,F,K){q.lanes|=K;var Y=q.alternate;Y!==null&&(Y.lanes|=K);for(var Z=!1,te=q.return;te!==null;)te.childLanes|=K,Y=te.alternate,Y!==null&&(Y.childLanes|=K),te.tag===22&&(q=te.stateNode,q===null||q._visibility&1||(Z=!0)),q=te,te=te.return;return q.tag===3?(te=q.stateNode,Z&&F!==null&&(Z=31-It(K),q=te.hiddenUpdates,Y=q[Z],Y===null?q[Z]=[F]:Y.push(F),F.lane=K|536870912),te):null}function Da(q){if(50<na)throw na=0,gc=null,Error(B(185));for(var F=q.return;F!==null;)q=F,F=q.return;return q.tag===3?q.stateNode:null}var Yn={};function Ph(q,F,K,Y){this.tag=q,this.key=K,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=F,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=Y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ri(q,F,K,Y){return new Ph(q,F,K,Y)}function uo(q){return q=q.prototype,!(!q||!q.isReactComponent)}function Pi(q,F){var K=q.alternate;return K===null?(K=ri(q.tag,F,q.key,q.mode),K.elementType=q.elementType,K.type=q.type,K.stateNode=q.stateNode,K.alternate=q,q.alternate=K):(K.pendingProps=F,K.type=q.type,K.flags=0,K.subtreeFlags=0,K.deletions=null),K.flags=q.flags&65011712,K.childLanes=q.childLanes,K.lanes=q.lanes,K.child=q.child,K.memoizedProps=q.memoizedProps,K.memoizedState=q.memoizedState,K.updateQueue=q.updateQueue,F=q.dependencies,K.dependencies=F===null?null:{lanes:F.lanes,firstContext:F.firstContext},K.sibling=q.sibling,K.index=q.index,K.ref=q.ref,K.refCleanup=q.refCleanup,K}function jl(q,F){q.flags&=65011714;var K=q.alternate;return K===null?(q.childLanes=0,q.lanes=F,q.child=null,q.subtreeFlags=0,q.memoizedProps=null,q.memoizedState=null,q.updateQueue=null,q.dependencies=null,q.stateNode=null):(q.childLanes=K.childLanes,q.lanes=K.lanes,q.child=K.child,q.subtreeFlags=0,q.deletions=null,q.memoizedProps=K.memoizedProps,q.memoizedState=K.memoizedState,q.updateQueue=K.updateQueue,q.type=K.type,F=K.dependencies,q.dependencies=F===null?null:{lanes:F.lanes,firstContext:F.firstContext}),q}function Oa(q,F,K,Y,Z,te){var ae=0;if(Y=q,typeof q=="function")uo(q)&&(ae=1);else if(typeof q=="string")ae=Op(q,K,Ge.current)?26:q==="html"||q==="head"||q==="body"?27:5;else e:switch(q){case Pe:return q=ri(31,K,F,Z),q.elementType=Pe,q.lanes=te,q;case re:return yn(K.children,Z,te,F);case se:ae=8,Z|=24;break;case de:return q=ri(12,K,F,Z|2),q.elementType=de,q.lanes=te,q;case he:return q=ri(13,K,F,Z),q.elementType=he,q.lanes=te,q;case ge:return q=ri(19,K,F,Z),q.elementType=ge,q.lanes=te,q;default:if(typeof q=="object"&&q!==null)switch(q.$$typeof){case oe:case ue:ae=10;break e;case le:ae=9;break e;case fe:ae=11;break e;case Ae:ae=14;break e;case _e:ae=16,Y=null;break e}ae=29,K=Error(B(130,q===null?"null":typeof q,"")),Y=null}return F=ri(ae,K,F,Z),F.elementType=q,F.type=Y,F.lanes=te,F}function yn(q,F,K,Y){return q=ri(7,q,Y,F),q.lanes=K,q}function fo(q,F,K){return q=ri(6,q,null,F),q.lanes=K,q}function ho(q,F,K){return F=ri(4,q.children!==null?q.children:[],q.key,F),F.lanes=K,F.stateNode={containerInfo:q.containerInfo,pendingChildren:null,implementation:q.implementation},F}var Wn=[],Xn=0,Ma=null,La=0,pi=[],mi=0,bn=null,Di=1,Oi="";function Tn(q,F){Wn[Xn++]=La,Wn[Xn++]=Ma,Ma=q,La=F}function Bl(q,F,K){pi[mi++]=Di,pi[mi++]=Oi,pi[mi++]=bn,bn=q;var Y=Di;q=Oi;var Z=32-It(Y)-1;Y&=~(1<<Z),K+=1;var te=32-It(F)+Z;if(30<te){var ae=Z-Z%5;te=(Y&(1<<ae)-1).toString(32),Y>>=ae,Z-=ae,Di=1<<32-It(F)+Z|K<<Z|Y,Oi=te+q}else Di=1<<te|K<<Z|Y,Oi=q}function po(q){q.return!==null&&(Tn(q,1),Bl(q,1,0))}function mo(q){for(;q===Ma;)Ma=Wn[--Xn],Wn[Xn]=null,La=Wn[--Xn],Wn[Xn]=null;for(;q===bn;)bn=pi[--mi],pi[mi]=null,Oi=pi[--mi],pi[mi]=null,Di=pi[--mi],pi[mi]=null}var Yt=null,xt=null,ft=!1,Sn=null,ki=!1,go=Error(B(519));function Cn(q){var F=Error(B(418,""));throw Nr(fi(F,q)),go}function ql(q){var F=q.stateNode,K=q.type,Y=q.memoizedProps;switch(F[Gt]=q,F[Wt]=Y,K){case"dialog":ot("cancel",F),ot("close",F);break;case"iframe":case"object":case"embed":ot("load",F);break;case"video":case"audio":for(K=0;K<aa.length;K++)ot(aa[K],F);break;case"source":ot("error",F);break;case"img":case"image":case"link":ot("error",F),ot("load",F);break;case"details":ot("toggle",F);break;case"input":ot("invalid",F),il(F,Y.value,Y.defaultValue,Y.checked,Y.defaultChecked,Y.type,Y.name,!0),Ta(F);break;case"select":ot("invalid",F);break;case"textarea":ot("invalid",F),rl(F,Y.value,Y.defaultValue,Y.children),Ta(F)}K=Y.children,typeof K!="string"&&typeof K!="number"&&typeof K!="bigint"||F.textContent===""+K||Y.suppressHydrationWarning===!0||sf(F.textContent,K)?(Y.popover!=null&&(ot("beforetoggle",F),ot("toggle",F)),Y.onScroll!=null&&ot("scroll",F),Y.onScrollEnd!=null&&ot("scrollend",F),Y.onClick!=null&&(F.onclick=ps),F=!0):F=!1,F||Cn(q)}function Fl(q){for(Yt=q.return;Yt;)switch(Yt.tag){case 5:case 13:ki=!1;return;case 27:case 3:ki=!0;return;default:Yt=Yt.return}}function Mr(q){if(q!==Yt)return!1;if(!ft)return Fl(q),ft=!0,!1;var F=q.tag,K;if((K=F!==3&&F!==27)&&((K=F===5)&&(K=q.type,K=!(K!=="form"&&K!=="button")||Oc(q.type,q.memoizedProps)),K=!K),K&&xt&&Cn(q),Fl(q),F===13){if(q=q.memoizedState,q=q!==null?q.dehydrated:null,!q)throw Error(B(317));e:{for(q=q.nextSibling,F=0;q;){if(q.nodeType===8)if(K=q.data,K==="/$"){if(F===0){xt=Si(q.nextSibling);break e}F--}else K!=="$"&&K!=="$!"&&K!=="$?"||F++;q=q.nextSibling}xt=null}}else F===27?(F=xt,cn(q.type)?(q=Ic,Ic=null,xt=q):xt=F):xt=Yt?Si(q.stateNode.nextSibling):null;return!0}function Lr(){xt=Yt=null,ft=!1}function zl(){var q=Sn;return q!==null&&(ei===null?ei=q:ei.push.apply(ei,q),Sn=null),q}function Nr(q){Sn===null?Sn=[q]:Sn.push(q)}var vo=we(null),kn=null,Mi=null;function Ki(q,F,K){Ue(vo,F._currentValue),F._currentValue=K}function Li(q){q._currentValue=vo.current,je(vo)}function yo(q,F,K){for(;q!==null;){var Y=q.alternate;if((q.childLanes&F)!==F?(q.childLanes|=F,Y!==null&&(Y.childLanes|=F)):Y!==null&&(Y.childLanes&F)!==F&&(Y.childLanes|=F),q===K)break;q=q.return}}function bo(q,F,K,Y){var Z=q.child;for(Z!==null&&(Z.return=q);Z!==null;){var te=Z.dependencies;if(te!==null){var ae=Z.child;te=te.firstContext;e:for(;te!==null;){var ce=te;te=Z;for(var me=0;me<F.length;me++)if(ce.context===F[me]){te.lanes|=K,ce=te.alternate,ce!==null&&(ce.lanes|=K),yo(te.return,K,q),Y||(ae=null);break e}te=ce.next}}else if(Z.tag===18){if(ae=Z.return,ae===null)throw Error(B(341));ae.lanes|=K,te=ae.alternate,te!==null&&(te.lanes|=K),yo(ae,K,q),ae=null}else ae=Z.child;if(ae!==null)ae.return=Z;else for(ae=Z;ae!==null;){if(ae===q){ae=null;break}if(Z=ae.sibling,Z!==null){Z.return=ae.return,ae=Z;break}ae=ae.return}Z=ae}}function Ir(q,F,K,Y){q=null;for(var Z=F,te=!1;Z!==null;){if(!te){if((Z.flags&524288)!==0)te=!0;else if((Z.flags&262144)!==0)break}if(Z.tag===10){var ae=Z.alternate;if(ae===null)throw Error(B(387));if(ae=ae.memoizedProps,ae!==null){var ce=Z.type;ni(Z.pendingProps.value,ae.value)||(q!==null?q.push(ce):q=[ce])}}else if(Z===lt.current){if(ae=Z.alternate,ae===null)throw Error(B(387));ae.memoizedState.memoizedState!==Z.memoizedState.memoizedState&&(q!==null?q.push(da):q=[da])}Z=Z.return}q!==null&&bo(F,q,K,Y),F.flags|=262144}function Na(q){for(q=q.firstContext;q!==null;){if(!ni(q.context._currentValue,q.memoizedValue))return!0;q=q.next}return!1}function En(q){kn=q,Mi=null,q=q.dependencies,q!==null&&(q.firstContext=null)}function Kt(q){return Hl(kn,q)}function Ia(q,F){return kn===null&&En(q),Hl(q,F)}function Hl(q,F){var K=F._currentValue;if(F={context:F,memoizedValue:K,next:null},Mi===null){if(q===null)throw Error(B(308));Mi=F,q.dependencies={lanes:0,firstContext:F},q.flags|=524288}else Mi=Mi.next=F;return K}var Dh=typeof AbortController<"u"?AbortController:function(){var q=[],F=this.signal={aborted:!1,addEventListener:function(K,Y){q.push(Y)}};this.abort=function(){F.aborted=!0,q.forEach(function(K){return K()})}},Oh=V.unstable_scheduleCallback,Mh=V.unstable_NormalPriority,Lt={$$typeof:ue,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function To(){return{controller:new Dh,data:new Map,refCount:0}}function Ur(q){q.refCount--,q.refCount===0&&Oh(Mh,function(){q.controller.abort()})}var Vr=null,So=0,Jn=0,Zn=null;function Lh(q,F){if(Vr===null){var K=Vr=[];So=0,Jn=kc(),Zn={status:"pending",value:void 0,then:function(Y){K.push(Y)}}}return So++,F.then(Gl,Gl),F}function Gl(){if(--So===0&&Vr!==null){Zn!==null&&(Zn.status="fulfilled");var q=Vr;Vr=null,Jn=0,Zn=null;for(var F=0;F<q.length;F++)(0,q[F])()}}function Nh(q,F){var K=[],Y={status:"pending",value:null,reason:null,then:function(Z){K.push(Z)}};return q.then(function(){Y.status="fulfilled",Y.value=F;for(var Z=0;Z<K.length;Z++)(0,K[Z])(F)},function(Z){for(Y.status="rejected",Y.reason=Z,Z=0;Z<K.length;Z++)(0,K[Z])(void 0)}),Y}var Kl=be.S;be.S=function(q,F){typeof F=="object"&&F!==null&&typeof F.then=="function"&&Lh(q,F),Kl!==null&&Kl(q,F)};var _n=we(null);function Co(){var q=_n.current;return q!==null?q:Tt.pooledCache}function Ua(q,F){F===null?Ue(_n,_n.current):Ue(_n,F.pool)}function $l(){var q=Co();return q===null?null:{parent:Lt._currentValue,pool:q}}var jr=Error(B(460)),Ql=Error(B(474)),Va=Error(B(542)),ko={then:function(){}};function Yl(q){return q=q.status,q==="fulfilled"||q==="rejected"}function ja(){}function Wl(q,F,K){switch(K=q[K],K===void 0?q.push(F):K!==F&&(F.then(ja,ja),F=K),F.status){case"fulfilled":return F.value;case"rejected":throw q=F.reason,Jl(q),q;default:if(typeof F.status=="string")F.then(ja,ja);else{if(q=Tt,q!==null&&100<q.shellSuspendCounter)throw Error(B(482));q=F,q.status="pending",q.then(function(Y){if(F.status==="pending"){var Z=F;Z.status="fulfilled",Z.value=Y}},function(Y){if(F.status==="pending"){var Z=F;Z.status="rejected",Z.reason=Y}})}switch(F.status){case"fulfilled":return F.value;case"rejected":throw q=F.reason,Jl(q),q}throw Br=F,jr}}var Br=null;function Xl(){if(Br===null)throw Error(B(459));var q=Br;return Br=null,q}function Jl(q){if(q===jr||q===Va)throw Error(B(483))}var $i=!1;function Eo(q){q.updateQueue={baseState:q.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function _o(q,F){q=q.updateQueue,F.updateQueue===q&&(F.updateQueue={baseState:q.baseState,firstBaseUpdate:q.firstBaseUpdate,lastBaseUpdate:q.lastBaseUpdate,shared:q.shared,callbacks:null})}function Qi(q){return{lane:q,tag:0,payload:null,callback:null,next:null}}function Yi(q,F,K){var Y=q.updateQueue;if(Y===null)return null;if(Y=Y.shared,(ht&2)!==0){var Z=Y.pending;return Z===null?F.next=F:(F.next=Z.next,Z.next=F),Y.pending=F,F=Da(q),Vl(q,null,K),F}return Pa(q,Y,F,K),Da(q)}function qr(q,F,K){if(F=F.updateQueue,F!==null&&(F=F.shared,(K&4194048)!==0)){var Y=F.lanes;Y&=q.pendingLanes,K|=Y,F.lanes=K,Mn(q,K)}}function xo(q,F){var K=q.updateQueue,Y=q.alternate;if(Y!==null&&(Y=Y.updateQueue,K===Y)){var Z=null,te=null;if(K=K.firstBaseUpdate,K!==null){do{var ae={lane:K.lane,tag:K.tag,payload:K.payload,callback:null,next:null};te===null?Z=te=ae:te=te.next=ae,K=K.next}while(K!==null);te===null?Z=te=F:te=te.next=F}else Z=te=F;K={baseState:Y.baseState,firstBaseUpdate:Z,lastBaseUpdate:te,shared:Y.shared,callbacks:Y.callbacks},q.updateQueue=K;return}q=K.lastBaseUpdate,q===null?K.firstBaseUpdate=F:q.next=F,K.lastBaseUpdate=F}var Ro=!1;function Fr(){if(Ro){var q=Zn;if(q!==null)throw q}}function zr(q,F,K,Y){Ro=!1;var Z=q.updateQueue;$i=!1;var te=Z.firstBaseUpdate,ae=Z.lastBaseUpdate,ce=Z.shared.pending;if(ce!==null){Z.shared.pending=null;var me=ce,Se=me.next;me.next=null,ae===null?te=Se:ae.next=Se,ae=me;var Oe=q.alternate;Oe!==null&&(Oe=Oe.updateQueue,ce=Oe.lastBaseUpdate,ce!==ae&&(ce===null?Oe.firstBaseUpdate=Se:ce.next=Se,Oe.lastBaseUpdate=me))}if(te!==null){var Ie=Z.baseState;ae=0,Oe=Se=me=null,ce=te;do{var ke=ce.lane&-536870913,Ee=ke!==ce.lane;if(Ee?(ct&ke)===ke:(Y&ke)===ke){ke!==0&&ke===Jn&&(Ro=!0),Oe!==null&&(Oe=Oe.next={lane:0,tag:ce.tag,payload:ce.payload,callback:null,next:null});e:{var it=q,Ze=ce;ke=F;var vt=K;switch(Ze.tag){case 1:if(it=Ze.payload,typeof it=="function"){Ie=it.call(vt,Ie,ke);break e}Ie=it;break e;case 3:it.flags=it.flags&-65537|128;case 0:if(it=Ze.payload,ke=typeof it=="function"?it.call(vt,Ie,ke):it,ke==null)break e;Ie=X({},Ie,ke);break e;case 2:$i=!0}}ke=ce.callback,ke!==null&&(q.flags|=64,Ee&&(q.flags|=8192),Ee=Z.callbacks,Ee===null?Z.callbacks=[ke]:Ee.push(ke))}else Ee={lane:ke,tag:ce.tag,payload:ce.payload,callback:ce.callback,next:null},Oe===null?(Se=Oe=Ee,me=Ie):Oe=Oe.next=Ee,ae|=ke;if(ce=ce.next,ce===null){if(ce=Z.shared.pending,ce===null)break;Ee=ce,ce=Ee.next,Ee.next=null,Z.lastBaseUpdate=Ee,Z.shared.pending=null}}while(!0);Oe===null&&(me=Ie),Z.baseState=me,Z.firstBaseUpdate=Se,Z.lastBaseUpdate=Oe,te===null&&(Z.shared.lanes=0),rn|=ae,q.lanes=ae,q.memoizedState=Ie}}function Zl(q,F){if(typeof q!="function")throw Error(B(191,q));q.call(F)}function eu(q,F){var K=q.callbacks;if(K!==null)for(q.callbacks=null,q=0;q<K.length;q++)Zl(K[q],F)}var er=we(null),Ba=we(0);function tu(q,F){q=qi,Ue(Ba,q),Ue(er,F),qi=q|F.baseLanes}function wo(){Ue(Ba,qi),Ue(er,er.current)}function Ao(){qi=Ba.current,je(er),je(Ba)}var Wi=0,rt=null,mt=null,Ot=null,qa=!1,tr=!1,xn=!1,Fa=0,Hr=0,ir=null,Ih=0;function At(){throw Error(B(321))}function Po(q,F){if(F===null)return!1;for(var K=0;K<F.length&&K<q.length;K++)if(!ni(q[K],F[K]))return!1;return!0}function Do(q,F,K,Y,Z,te){return Wi=te,rt=F,F.memoizedState=null,F.updateQueue=null,F.lanes=0,be.H=q===null||q.memoizedState===null?Vu:ju,xn=!1,te=K(Y,Z),xn=!1,tr&&(te=nu(F,K,Y,Z)),iu(q),te}function iu(q){be.H=Qa;var F=mt!==null&&mt.next!==null;if(Wi=0,Ot=mt=rt=null,qa=!1,Hr=0,ir=null,F)throw Error(B(300));q===null||Vt||(q=q.dependencies,q!==null&&Na(q)&&(Vt=!0))}function nu(q,F,K,Y){rt=q;var Z=0;do{if(tr&&(ir=null),Hr=0,tr=!1,25<=Z)throw Error(B(301));if(Z+=1,Ot=mt=null,q.updateQueue!=null){var te=q.updateQueue;te.lastEffect=null,te.events=null,te.stores=null,te.memoCache!=null&&(te.memoCache.index=0)}be.H=zh,te=F(K,Y)}while(tr);return te}function Uh(){var q=be.H,F=q.useState()[0];return F=typeof F.then=="function"?Gr(F):F,q=q.useState()[0],(mt!==null?mt.memoizedState:null)!==q&&(rt.flags|=1024),F}function Oo(){var q=Fa!==0;return Fa=0,q}function Mo(q,F,K){F.updateQueue=q.updateQueue,F.flags&=-2053,q.lanes&=~K}function Lo(q){if(qa){for(q=q.memoizedState;q!==null;){var F=q.queue;F!==null&&(F.pending=null),q=q.next}qa=!1}Wi=0,Ot=mt=rt=null,tr=!1,Hr=Fa=0,ir=null}function Jt(){var q={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ot===null?rt.memoizedState=Ot=q:Ot=Ot.next=q,Ot}function Mt(){if(mt===null){var q=rt.alternate;q=q!==null?q.memoizedState:null}else q=mt.next;var F=Ot===null?rt.memoizedState:Ot.next;if(F!==null)Ot=F,mt=q;else{if(q===null)throw rt.alternate===null?Error(B(467)):Error(B(310));mt=q,q={memoizedState:mt.memoizedState,baseState:mt.baseState,baseQueue:mt.baseQueue,queue:mt.queue,next:null},Ot===null?rt.memoizedState=Ot=q:Ot=Ot.next=q}return Ot}function No(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Gr(q){var F=Hr;return Hr+=1,ir===null&&(ir=[]),q=Wl(ir,q,F),F=rt,(Ot===null?F.memoizedState:Ot.next)===null&&(F=F.alternate,be.H=F===null||F.memoizedState===null?Vu:ju),q}function za(q){if(q!==null&&typeof q=="object"){if(typeof q.then=="function")return Gr(q);if(q.$$typeof===ue)return Kt(q)}throw Error(B(438,String(q)))}function Io(q){var F=null,K=rt.updateQueue;if(K!==null&&(F=K.memoCache),F==null){var Y=rt.alternate;Y!==null&&(Y=Y.updateQueue,Y!==null&&(Y=Y.memoCache,Y!=null&&(F={data:Y.data.map(function(Z){return Z.slice()}),index:0})))}if(F==null&&(F={data:[],index:0}),K===null&&(K=No(),rt.updateQueue=K),K.memoCache=F,K=F.data[F.index],K===void 0)for(K=F.data[F.index]=Array(q),Y=0;Y<q;Y++)K[Y]=xe;return F.index++,K}function Ni(q,F){return typeof F=="function"?F(q):F}function Ha(q){var F=Mt();return Uo(F,mt,q)}function Uo(q,F,K){var Y=q.queue;if(Y===null)throw Error(B(311));Y.lastRenderedReducer=K;var Z=q.baseQueue,te=Y.pending;if(te!==null){if(Z!==null){var ae=Z.next;Z.next=te.next,te.next=ae}F.baseQueue=Z=te,Y.pending=null}if(te=q.baseState,Z===null)q.memoizedState=te;else{F=Z.next;var ce=ae=null,me=null,Se=F,Oe=!1;do{var Ie=Se.lane&-536870913;if(Ie!==Se.lane?(ct&Ie)===Ie:(Wi&Ie)===Ie){var ke=Se.revertLane;if(ke===0)me!==null&&(me=me.next={lane:0,revertLane:0,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null}),Ie===Jn&&(Oe=!0);else if((Wi&ke)===ke){Se=Se.next,ke===Jn&&(Oe=!0);continue}else Ie={lane:0,revertLane:Se.revertLane,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null},me===null?(ce=me=Ie,ae=te):me=me.next=Ie,rt.lanes|=ke,rn|=ke;Ie=Se.action,xn&&K(te,Ie),te=Se.hasEagerState?Se.eagerState:K(te,Ie)}else ke={lane:Ie,revertLane:Se.revertLane,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null},me===null?(ce=me=ke,ae=te):me=me.next=ke,rt.lanes|=Ie,rn|=Ie;Se=Se.next}while(Se!==null&&Se!==F);if(me===null?ae=te:me.next=ce,!ni(te,q.memoizedState)&&(Vt=!0,Oe&&(K=Zn,K!==null)))throw K;q.memoizedState=te,q.baseState=ae,q.baseQueue=me,Y.lastRenderedState=te}return Z===null&&(Y.lanes=0),[q.memoizedState,Y.dispatch]}function Vo(q){var F=Mt(),K=F.queue;if(K===null)throw Error(B(311));K.lastRenderedReducer=q;var Y=K.dispatch,Z=K.pending,te=F.memoizedState;if(Z!==null){K.pending=null;var ae=Z=Z.next;do te=q(te,ae.action),ae=ae.next;while(ae!==Z);ni(te,F.memoizedState)||(Vt=!0),F.memoizedState=te,F.baseQueue===null&&(F.baseState=te),K.lastRenderedState=te}return[te,Y]}function ru(q,F,K){var Y=rt,Z=Mt(),te=ft;if(te){if(K===void 0)throw Error(B(407));K=K()}else K=F();var ae=!ni((mt||Z).memoizedState,K);ae&&(Z.memoizedState=K,Vt=!0),Z=Z.queue;var ce=ou.bind(null,Y,Z,q);if(Kr(2048,8,ce,[q]),Z.getSnapshot!==F||ae||Ot!==null&&Ot.memoizedState.tag&1){if(Y.flags|=2048,nr(9,Ga(),su.bind(null,Y,Z,K,F),null),Tt===null)throw Error(B(349));te||(Wi&124)!==0||au(Y,F,K)}return K}function au(q,F,K){q.flags|=16384,q={getSnapshot:F,value:K},F=rt.updateQueue,F===null?(F=No(),rt.updateQueue=F,F.stores=[q]):(K=F.stores,K===null?F.stores=[q]:K.push(q))}function su(q,F,K,Y){F.value=K,F.getSnapshot=Y,cu(F)&&lu(q)}function ou(q,F,K){return K(function(){cu(F)&&lu(q)})}function cu(q){var F=q.getSnapshot;q=q.value;try{var K=F();return!ni(q,K)}catch{return!0}}function lu(q){var F=Qn(q,2);F!==null&&li(F,q,2)}function jo(q){var F=Jt();if(typeof q=="function"){var K=q;if(q=K(),xn){Ci(!0);try{K()}finally{Ci(!1)}}}return F.memoizedState=F.baseState=q,F.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ni,lastRenderedState:q},F}function uu(q,F,K,Y){return q.baseState=K,Uo(q,mt,typeof Y=="function"?Y:Ni)}function Vh(q,F,K,Y,Z){if($a(q))throw Error(B(485));if(q=F.action,q!==null){var te={payload:Z,action:q,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ae){te.listeners.push(ae)}};be.T!==null?K(!0):te.isTransition=!1,Y(te),K=F.pending,K===null?(te.next=F.pending=te,du(F,te)):(te.next=K.next,F.pending=K.next=te)}}function du(q,F){var K=F.action,Y=F.payload,Z=q.state;if(F.isTransition){var te=be.T,ae={};be.T=ae;try{var ce=K(Z,Y),me=be.S;me!==null&&me(ae,ce),fu(q,F,ce)}catch(Se){Bo(q,F,Se)}finally{be.T=te}}else try{te=K(Z,Y),fu(q,F,te)}catch(Se){Bo(q,F,Se)}}function fu(q,F,K){K!==null&&typeof K=="object"&&typeof K.then=="function"?K.then(function(Y){hu(q,F,Y)},function(Y){return Bo(q,F,Y)}):hu(q,F,K)}function hu(q,F,K){F.status="fulfilled",F.value=K,pu(F),q.state=K,F=q.pending,F!==null&&(K=F.next,K===F?q.pending=null:(K=K.next,F.next=K,du(q,K)))}function Bo(q,F,K){var Y=q.pending;if(q.pending=null,Y!==null){Y=Y.next;do F.status="rejected",F.reason=K,pu(F),F=F.next;while(F!==Y)}q.action=null}function pu(q){q=q.listeners;for(var F=0;F<q.length;F++)(0,q[F])()}function mu(q,F){return F}function gu(q,F){if(ft){var K=Tt.formState;if(K!==null){e:{var Y=rt;if(ft){if(xt){t:{for(var Z=xt,te=ki;Z.nodeType!==8;){if(!te){Z=null;break t}if(Z=Si(Z.nextSibling),Z===null){Z=null;break t}}te=Z.data,Z=te==="F!"||te==="F"?Z:null}if(Z){xt=Si(Z.nextSibling),Y=Z.data==="F!";break e}}Cn(Y)}Y=!1}Y&&(F=K[0])}}return K=Jt(),K.memoizedState=K.baseState=F,Y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mu,lastRenderedState:F},K.queue=Y,K=Nu.bind(null,rt,Y),Y.dispatch=K,Y=jo(!1),te=Go.bind(null,rt,!1,Y.queue),Y=Jt(),Z={state:F,dispatch:null,action:q,pending:null},Y.queue=Z,K=Vh.bind(null,rt,Z,te,K),Z.dispatch=K,Y.memoizedState=q,[F,K,!1]}function vu(q){var F=Mt();return yu(F,mt,q)}function yu(q,F,K){if(F=Uo(q,F,mu)[0],q=Ha(Ni)[0],typeof F=="object"&&F!==null&&typeof F.then=="function")try{var Y=Gr(F)}catch(ae){throw ae===jr?Va:ae}else Y=F;F=Mt();var Z=F.queue,te=Z.dispatch;return K!==F.memoizedState&&(rt.flags|=2048,nr(9,Ga(),jh.bind(null,Z,K),null)),[Y,te,q]}function jh(q,F){q.action=F}function bu(q){var F=Mt(),K=mt;if(K!==null)return yu(F,K,q);Mt(),F=F.memoizedState,K=Mt();var Y=K.queue.dispatch;return K.memoizedState=q,[F,Y,!1]}function nr(q,F,K,Y){return q={tag:q,create:K,deps:Y,inst:F,next:null},F=rt.updateQueue,F===null&&(F=No(),rt.updateQueue=F),K=F.lastEffect,K===null?F.lastEffect=q.next=q:(Y=K.next,K.next=q,q.next=Y,F.lastEffect=q),q}function Ga(){return{destroy:void 0,resource:void 0}}function Tu(){return Mt().memoizedState}function Ka(q,F,K,Y){var Z=Jt();Y=Y===void 0?null:Y,rt.flags|=q,Z.memoizedState=nr(1|F,Ga(),K,Y)}function Kr(q,F,K,Y){var Z=Mt();Y=Y===void 0?null:Y;var te=Z.memoizedState.inst;mt!==null&&Y!==null&&Po(Y,mt.memoizedState.deps)?Z.memoizedState=nr(F,te,K,Y):(rt.flags|=q,Z.memoizedState=nr(1|F,te,K,Y))}function Su(q,F){Ka(8390656,8,q,F)}function Cu(q,F){Kr(2048,8,q,F)}function ku(q,F){return Kr(4,2,q,F)}function Eu(q,F){return Kr(4,4,q,F)}function _u(q,F){if(typeof F=="function"){q=q();var K=F(q);return function(){typeof K=="function"?K():F(null)}}if(F!=null)return q=q(),F.current=q,function(){F.current=null}}function xu(q,F,K){K=K!=null?K.concat([q]):null,Kr(4,4,_u.bind(null,F,q),K)}function qo(){}function Ru(q,F){var K=Mt();F=F===void 0?null:F;var Y=K.memoizedState;return F!==null&&Po(F,Y[1])?Y[0]:(K.memoizedState=[q,F],q)}function wu(q,F){var K=Mt();F=F===void 0?null:F;var Y=K.memoizedState;if(F!==null&&Po(F,Y[1]))return Y[0];if(Y=q(),xn){Ci(!0);try{q()}finally{Ci(!1)}}return K.memoizedState=[Y,F],Y}function Fo(q,F,K){return K===void 0||(Wi&1073741824)!==0?q.memoizedState=F:(q.memoizedState=K,q=Od(),rt.lanes|=q,rn|=q,K)}function Au(q,F,K,Y){return ni(K,F)?K:er.current!==null?(q=Fo(q,K,Y),ni(q,F)||(Vt=!0),q):(Wi&42)===0?(Vt=!0,q.memoizedState=K):(q=Od(),rt.lanes|=q,rn|=q,F)}function Pu(q,F,K,Y,Z){var te=Re.p;Re.p=te!==0&&8>te?te:8;var ae=be.T,ce={};be.T=ce,Go(q,!1,F,K);try{var me=Z(),Se=be.S;if(Se!==null&&Se(ce,me),me!==null&&typeof me=="object"&&typeof me.then=="function"){var Oe=Nh(me,Y);$r(q,F,Oe,ci(q))}else $r(q,F,Y,ci(q))}catch(Ie){$r(q,F,{then:function(){},status:"rejected",reason:Ie},ci())}finally{Re.p=te,be.T=ae}}function Bh(){}function zo(q,F,K,Y){if(q.tag!==5)throw Error(B(476));var Z=Du(q).queue;Pu(q,Z,F,Be,K===null?Bh:function(){return Ou(q),K(Y)})}function Du(q){var F=q.memoizedState;if(F!==null)return F;F={memoizedState:Be,baseState:Be,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ni,lastRenderedState:Be},next:null};var K={};return F.next={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ni,lastRenderedState:K},next:null},q.memoizedState=F,q=q.alternate,q!==null&&(q.memoizedState=F),F}function Ou(q){var F=Du(q).next.queue;$r(q,F,{},ci())}function Ho(){return Kt(da)}function Mu(){return Mt().memoizedState}function Lu(){return Mt().memoizedState}function qh(q){for(var F=q.return;F!==null;){switch(F.tag){case 24:case 3:var K=ci();q=Qi(K);var Y=Yi(F,q,K);Y!==null&&(li(Y,F,K),qr(Y,F,K)),F={cache:To()},q.payload=F;return}F=F.return}}function Fh(q,F,K){var Y=ci();K={lane:Y,revertLane:0,action:K,hasEagerState:!1,eagerState:null,next:null},$a(q)?Iu(F,K):(K=lo(q,F,K,Y),K!==null&&(li(K,q,Y),Uu(K,F,Y)))}function Nu(q,F,K){var Y=ci();$r(q,F,K,Y)}function $r(q,F,K,Y){var Z={lane:Y,revertLane:0,action:K,hasEagerState:!1,eagerState:null,next:null};if($a(q))Iu(F,Z);else{var te=q.alternate;if(q.lanes===0&&(te===null||te.lanes===0)&&(te=F.lastRenderedReducer,te!==null))try{var ae=F.lastRenderedState,ce=te(ae,K);if(Z.hasEagerState=!0,Z.eagerState=ce,ni(ce,ae))return Pa(q,F,Z,0),Tt===null&&Aa(),!1}catch{}finally{}if(K=lo(q,F,Z,Y),K!==null)return li(K,q,Y),Uu(K,F,Y),!0}return!1}function Go(q,F,K,Y){if(Y={lane:2,revertLane:kc(),action:Y,hasEagerState:!1,eagerState:null,next:null},$a(q)){if(F)throw Error(B(479))}else F=lo(q,K,Y,2),F!==null&&li(F,q,2)}function $a(q){var F=q.alternate;return q===rt||F!==null&&F===rt}function Iu(q,F){tr=qa=!0;var K=q.pending;K===null?F.next=F:(F.next=K.next,K.next=F),q.pending=F}function Uu(q,F,K){if((K&4194048)!==0){var Y=F.lanes;Y&=q.pendingLanes,K|=Y,F.lanes=K,Mn(q,K)}}var Qa={readContext:Kt,use:za,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useLayoutEffect:At,useInsertionEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useSyncExternalStore:At,useId:At,useHostTransitionStatus:At,useFormState:At,useActionState:At,useOptimistic:At,useMemoCache:At,useCacheRefresh:At},Vu={readContext:Kt,use:za,useCallback:function(q,F){return Jt().memoizedState=[q,F===void 0?null:F],q},useContext:Kt,useEffect:Su,useImperativeHandle:function(q,F,K){K=K!=null?K.concat([q]):null,Ka(4194308,4,_u.bind(null,F,q),K)},useLayoutEffect:function(q,F){return Ka(4194308,4,q,F)},useInsertionEffect:function(q,F){Ka(4,2,q,F)},useMemo:function(q,F){var K=Jt();F=F===void 0?null:F;var Y=q();if(xn){Ci(!0);try{q()}finally{Ci(!1)}}return K.memoizedState=[Y,F],Y},useReducer:function(q,F,K){var Y=Jt();if(K!==void 0){var Z=K(F);if(xn){Ci(!0);try{K(F)}finally{Ci(!1)}}}else Z=F;return Y.memoizedState=Y.baseState=Z,q={pending:null,lanes:0,dispatch:null,lastRenderedReducer:q,lastRenderedState:Z},Y.queue=q,q=q.dispatch=Fh.bind(null,rt,q),[Y.memoizedState,q]},useRef:function(q){var F=Jt();return q={current:q},F.memoizedState=q},useState:function(q){q=jo(q);var F=q.queue,K=Nu.bind(null,rt,F);return F.dispatch=K,[q.memoizedState,K]},useDebugValue:qo,useDeferredValue:function(q,F){var K=Jt();return Fo(K,q,F)},useTransition:function(){var q=jo(!1);return q=Pu.bind(null,rt,q.queue,!0,!1),Jt().memoizedState=q,[!1,q]},useSyncExternalStore:function(q,F,K){var Y=rt,Z=Jt();if(ft){if(K===void 0)throw Error(B(407));K=K()}else{if(K=F(),Tt===null)throw Error(B(349));(ct&124)!==0||au(Y,F,K)}Z.memoizedState=K;var te={value:K,getSnapshot:F};return Z.queue=te,Su(ou.bind(null,Y,te,q),[q]),Y.flags|=2048,nr(9,Ga(),su.bind(null,Y,te,K,F),null),K},useId:function(){var q=Jt(),F=Tt.identifierPrefix;if(ft){var K=Oi,Y=Di;K=(Y&~(1<<32-It(Y)-1)).toString(32)+K,F="«"+F+"R"+K,K=Fa++,0<K&&(F+="H"+K.toString(32)),F+="»"}else K=Ih++,F="«"+F+"r"+K.toString(32)+"»";return q.memoizedState=F},useHostTransitionStatus:Ho,useFormState:gu,useActionState:gu,useOptimistic:function(q){var F=Jt();F.memoizedState=F.baseState=q;var K={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return F.queue=K,F=Go.bind(null,rt,!0,K),K.dispatch=F,[q,F]},useMemoCache:Io,useCacheRefresh:function(){return Jt().memoizedState=qh.bind(null,rt)}},ju={readContext:Kt,use:za,useCallback:Ru,useContext:Kt,useEffect:Cu,useImperativeHandle:xu,useInsertionEffect:ku,useLayoutEffect:Eu,useMemo:wu,useReducer:Ha,useRef:Tu,useState:function(){return Ha(Ni)},useDebugValue:qo,useDeferredValue:function(q,F){var K=Mt();return Au(K,mt.memoizedState,q,F)},useTransition:function(){var q=Ha(Ni)[0],F=Mt().memoizedState;return[typeof q=="boolean"?q:Gr(q),F]},useSyncExternalStore:ru,useId:Mu,useHostTransitionStatus:Ho,useFormState:vu,useActionState:vu,useOptimistic:function(q,F){var K=Mt();return uu(K,mt,q,F)},useMemoCache:Io,useCacheRefresh:Lu},zh={readContext:Kt,use:za,useCallback:Ru,useContext:Kt,useEffect:Cu,useImperativeHandle:xu,useInsertionEffect:ku,useLayoutEffect:Eu,useMemo:wu,useReducer:Vo,useRef:Tu,useState:function(){return Vo(Ni)},useDebugValue:qo,useDeferredValue:function(q,F){var K=Mt();return mt===null?Fo(K,q,F):Au(K,mt.memoizedState,q,F)},useTransition:function(){var q=Vo(Ni)[0],F=Mt().memoizedState;return[typeof q=="boolean"?q:Gr(q),F]},useSyncExternalStore:ru,useId:Mu,useHostTransitionStatus:Ho,useFormState:bu,useActionState:bu,useOptimistic:function(q,F){var K=Mt();return mt!==null?uu(K,mt,q,F):(K.baseState=q,[q,K.queue.dispatch])},useMemoCache:Io,useCacheRefresh:Lu},rr=null,Qr=0;function Ya(q){var F=Qr;return Qr+=1,rr===null&&(rr=[]),Wl(rr,q,F)}function Yr(q,F){F=F.props.ref,q.ref=F!==void 0?F:null}function Wa(q,F){throw F.$$typeof===ee?Error(B(525)):(q=Object.prototype.toString.call(F),Error(B(31,q==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":q)))}function Bu(q){var F=q._init;return F(q._payload)}function qu(q){function F(ye,ve){if(q){var Te=ye.deletions;Te===null?(ye.deletions=[ve],ye.flags|=16):Te.push(ve)}}function K(ye,ve){if(!q)return null;for(;ve!==null;)F(ye,ve),ve=ve.sibling;return null}function Y(ye){for(var ve=new Map;ye!==null;)ye.key!==null?ve.set(ye.key,ye):ve.set(ye.index,ye),ye=ye.sibling;return ve}function Z(ye,ve){return ye=Pi(ye,ve),ye.index=0,ye.sibling=null,ye}function te(ye,ve,Te){return ye.index=Te,q?(Te=ye.alternate,Te!==null?(Te=Te.index,Te<ve?(ye.flags|=67108866,ve):Te):(ye.flags|=67108866,ve)):(ye.flags|=1048576,ve)}function ae(ye){return q&&ye.alternate===null&&(ye.flags|=67108866),ye}function ce(ye,ve,Te,Le){return ve===null||ve.tag!==6?(ve=fo(Te,ye.mode,Le),ve.return=ye,ve):(ve=Z(ve,Te),ve.return=ye,ve)}function me(ye,ve,Te,Le){var Ye=Te.type;return Ye===re?Oe(ye,ve,Te.props.children,Le,Te.key):ve!==null&&(ve.elementType===Ye||typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===_e&&Bu(Ye)===ve.type)?(ve=Z(ve,Te.props),Yr(ve,Te),ve.return=ye,ve):(ve=Oa(Te.type,Te.key,Te.props,null,ye.mode,Le),Yr(ve,Te),ve.return=ye,ve)}function Se(ye,ve,Te,Le){return ve===null||ve.tag!==4||ve.stateNode.containerInfo!==Te.containerInfo||ve.stateNode.implementation!==Te.implementation?(ve=ho(Te,ye.mode,Le),ve.return=ye,ve):(ve=Z(ve,Te.children||[]),ve.return=ye,ve)}function Oe(ye,ve,Te,Le,Ye){return ve===null||ve.tag!==7?(ve=yn(Te,ye.mode,Le,Ye),ve.return=ye,ve):(ve=Z(ve,Te),ve.return=ye,ve)}function Ie(ye,ve,Te){if(typeof ve=="string"&&ve!==""||typeof ve=="number"||typeof ve=="bigint")return ve=fo(""+ve,ye.mode,Te),ve.return=ye,ve;if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case ie:return Te=Oa(ve.type,ve.key,ve.props,null,ye.mode,Te),Yr(Te,ve),Te.return=ye,Te;case ne:return ve=ho(ve,ye.mode,Te),ve.return=ye,ve;case _e:var Le=ve._init;return ve=Le(ve._payload),Ie(ye,ve,Te)}if(qe(ve)||ze(ve))return ve=yn(ve,ye.mode,Te,null),ve.return=ye,ve;if(typeof ve.then=="function")return Ie(ye,Ya(ve),Te);if(ve.$$typeof===ue)return Ie(ye,Ia(ye,ve),Te);Wa(ye,ve)}return null}function ke(ye,ve,Te,Le){var Ye=ve!==null?ve.key:null;if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return Ye!==null?null:ce(ye,ve,""+Te,Le);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case ie:return Te.key===Ye?me(ye,ve,Te,Le):null;case ne:return Te.key===Ye?Se(ye,ve,Te,Le):null;case _e:return Ye=Te._init,Te=Ye(Te._payload),ke(ye,ve,Te,Le)}if(qe(Te)||ze(Te))return Ye!==null?null:Oe(ye,ve,Te,Le,null);if(typeof Te.then=="function")return ke(ye,ve,Ya(Te),Le);if(Te.$$typeof===ue)return ke(ye,ve,Ia(ye,Te),Le);Wa(ye,Te)}return null}function Ee(ye,ve,Te,Le,Ye){if(typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint")return ye=ye.get(Te)||null,ce(ve,ye,""+Le,Ye);if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case ie:return ye=ye.get(Le.key===null?Te:Le.key)||null,me(ve,ye,Le,Ye);case ne:return ye=ye.get(Le.key===null?Te:Le.key)||null,Se(ve,ye,Le,Ye);case _e:var at=Le._init;return Le=at(Le._payload),Ee(ye,ve,Te,Le,Ye)}if(qe(Le)||ze(Le))return ye=ye.get(Te)||null,Oe(ve,ye,Le,Ye,null);if(typeof Le.then=="function")return Ee(ye,ve,Te,Ya(Le),Ye);if(Le.$$typeof===ue)return Ee(ye,ve,Te,Ia(ve,Le),Ye);Wa(ve,Le)}return null}function it(ye,ve,Te,Le){for(var Ye=null,at=null,Xe=ve,et=ve=0,Bt=null;Xe!==null&&et<Te.length;et++){Xe.index>et?(Bt=Xe,Xe=null):Bt=Xe.sibling;var dt=ke(ye,Xe,Te[et],Le);if(dt===null){Xe===null&&(Xe=Bt);break}q&&Xe&&dt.alternate===null&&F(ye,Xe),ve=te(dt,ve,et),at===null?Ye=dt:at.sibling=dt,at=dt,Xe=Bt}if(et===Te.length)return K(ye,Xe),ft&&Tn(ye,et),Ye;if(Xe===null){for(;et<Te.length;et++)Xe=Ie(ye,Te[et],Le),Xe!==null&&(ve=te(Xe,ve,et),at===null?Ye=Xe:at.sibling=Xe,at=Xe);return ft&&Tn(ye,et),Ye}for(Xe=Y(Xe);et<Te.length;et++)Bt=Ee(Xe,ye,et,Te[et],Le),Bt!==null&&(q&&Bt.alternate!==null&&Xe.delete(Bt.key===null?et:Bt.key),ve=te(Bt,ve,et),at===null?Ye=Bt:at.sibling=Bt,at=Bt);return q&&Xe.forEach(function(hn){return F(ye,hn)}),ft&&Tn(ye,et),Ye}function Ze(ye,ve,Te,Le){if(Te==null)throw Error(B(151));for(var Ye=null,at=null,Xe=ve,et=ve=0,Bt=null,dt=Te.next();Xe!==null&&!dt.done;et++,dt=Te.next()){Xe.index>et?(Bt=Xe,Xe=null):Bt=Xe.sibling;var hn=ke(ye,Xe,dt.value,Le);if(hn===null){Xe===null&&(Xe=Bt);break}q&&Xe&&hn.alternate===null&&F(ye,Xe),ve=te(hn,ve,et),at===null?Ye=hn:at.sibling=hn,at=hn,Xe=Bt}if(dt.done)return K(ye,Xe),ft&&Tn(ye,et),Ye;if(Xe===null){for(;!dt.done;et++,dt=Te.next())dt=Ie(ye,dt.value,Le),dt!==null&&(ve=te(dt,ve,et),at===null?Ye=dt:at.sibling=dt,at=dt);return ft&&Tn(ye,et),Ye}for(Xe=Y(Xe);!dt.done;et++,dt=Te.next())dt=Ee(Xe,ye,et,dt.value,Le),dt!==null&&(q&&dt.alternate!==null&&Xe.delete(dt.key===null?et:dt.key),ve=te(dt,ve,et),at===null?Ye=dt:at.sibling=dt,at=dt);return q&&Xe.forEach(function(Hp){return F(ye,Hp)}),ft&&Tn(ye,et),Ye}function vt(ye,ve,Te,Le){if(typeof Te=="object"&&Te!==null&&Te.type===re&&Te.key===null&&(Te=Te.props.children),typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case ie:e:{for(var Ye=Te.key;ve!==null;){if(ve.key===Ye){if(Ye=Te.type,Ye===re){if(ve.tag===7){K(ye,ve.sibling),Le=Z(ve,Te.props.children),Le.return=ye,ye=Le;break e}}else if(ve.elementType===Ye||typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===_e&&Bu(Ye)===ve.type){K(ye,ve.sibling),Le=Z(ve,Te.props),Yr(Le,Te),Le.return=ye,ye=Le;break e}K(ye,ve);break}else F(ye,ve);ve=ve.sibling}Te.type===re?(Le=yn(Te.props.children,ye.mode,Le,Te.key),Le.return=ye,ye=Le):(Le=Oa(Te.type,Te.key,Te.props,null,ye.mode,Le),Yr(Le,Te),Le.return=ye,ye=Le)}return ae(ye);case ne:e:{for(Ye=Te.key;ve!==null;){if(ve.key===Ye)if(ve.tag===4&&ve.stateNode.containerInfo===Te.containerInfo&&ve.stateNode.implementation===Te.implementation){K(ye,ve.sibling),Le=Z(ve,Te.children||[]),Le.return=ye,ye=Le;break e}else{K(ye,ve);break}else F(ye,ve);ve=ve.sibling}Le=ho(Te,ye.mode,Le),Le.return=ye,ye=Le}return ae(ye);case _e:return Ye=Te._init,Te=Ye(Te._payload),vt(ye,ve,Te,Le)}if(qe(Te))return it(ye,ve,Te,Le);if(ze(Te)){if(Ye=ze(Te),typeof Ye!="function")throw Error(B(150));return Te=Ye.call(Te),Ze(ye,ve,Te,Le)}if(typeof Te.then=="function")return vt(ye,ve,Ya(Te),Le);if(Te.$$typeof===ue)return vt(ye,ve,Ia(ye,Te),Le);Wa(ye,Te)}return typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint"?(Te=""+Te,ve!==null&&ve.tag===6?(K(ye,ve.sibling),Le=Z(ve,Te),Le.return=ye,ye=Le):(K(ye,ve),Le=fo(Te,ye.mode,Le),Le.return=ye,ye=Le),ae(ye)):K(ye,ve)}return function(ye,ve,Te,Le){try{Qr=0;var Ye=vt(ye,ve,Te,Le);return rr=null,Ye}catch(Xe){if(Xe===jr||Xe===Va)throw Xe;var at=ri(29,Xe,null,ye.mode);return at.lanes=Le,at.return=ye,at}finally{}}}var ar=qu(!0),Fu=qu(!1),gi=we(null),Ei=null;function Xi(q){var F=q.alternate;Ue(Nt,Nt.current&1),Ue(gi,q),Ei===null&&(F===null||er.current!==null||F.memoizedState!==null)&&(Ei=q)}function zu(q){if(q.tag===22){if(Ue(Nt,Nt.current),Ue(gi,q),Ei===null){var F=q.alternate;F!==null&&F.memoizedState!==null&&(Ei=q)}}else Ji()}function Ji(){Ue(Nt,Nt.current),Ue(gi,gi.current)}function Ii(q){je(gi),Ei===q&&(Ei=null),je(Nt)}var Nt=we(0);function Xa(q){for(var F=q;F!==null;){if(F.tag===13){var K=F.memoizedState;if(K!==null&&(K=K.dehydrated,K===null||K.data==="$?"||Nc(K)))return F}else if(F.tag===19&&F.memoizedProps.revealOrder!==void 0){if((F.flags&128)!==0)return F}else if(F.child!==null){F.child.return=F,F=F.child;continue}if(F===q)break;for(;F.sibling===null;){if(F.return===null||F.return===q)return null;F=F.return}F.sibling.return=F.return,F=F.sibling}return null}function Ko(q,F,K,Y){F=q.memoizedState,K=K(Y,F),K=K==null?F:X({},F,K),q.memoizedState=K,q.lanes===0&&(q.updateQueue.baseState=K)}var $o={enqueueSetState:function(q,F,K){q=q._reactInternals;var Y=ci(),Z=Qi(Y);Z.payload=F,K!=null&&(Z.callback=K),F=Yi(q,Z,Y),F!==null&&(li(F,q,Y),qr(F,q,Y))},enqueueReplaceState:function(q,F,K){q=q._reactInternals;var Y=ci(),Z=Qi(Y);Z.tag=1,Z.payload=F,K!=null&&(Z.callback=K),F=Yi(q,Z,Y),F!==null&&(li(F,q,Y),qr(F,q,Y))},enqueueForceUpdate:function(q,F){q=q._reactInternals;var K=ci(),Y=Qi(K);Y.tag=2,F!=null&&(Y.callback=F),F=Yi(q,Y,K),F!==null&&(li(F,q,K),qr(F,q,K))}};function Hu(q,F,K,Y,Z,te,ae){return q=q.stateNode,typeof q.shouldComponentUpdate=="function"?q.shouldComponentUpdate(Y,te,ae):F.prototype&&F.prototype.isPureReactComponent?!Dr(K,Y)||!Dr(Z,te):!0}function Gu(q,F,K,Y){q=F.state,typeof F.componentWillReceiveProps=="function"&&F.componentWillReceiveProps(K,Y),typeof F.UNSAFE_componentWillReceiveProps=="function"&&F.UNSAFE_componentWillReceiveProps(K,Y),F.state!==q&&$o.enqueueReplaceState(F,F.state,null)}function Rn(q,F){var K=F;if("ref"in F){K={};for(var Y in F)Y!=="ref"&&(K[Y]=F[Y])}if(q=q.defaultProps){K===F&&(K=X({},K));for(var Z in q)K[Z]===void 0&&(K[Z]=q[Z])}return K}var Ja=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var F=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(F))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)};function Ku(q){Ja(q)}function $u(q){console.error(q)}function Qu(q){Ja(q)}function Za(q,F){try{var K=q.onUncaughtError;K(F.value,{componentStack:F.stack})}catch(Y){setTimeout(function(){throw Y})}}function Yu(q,F,K){try{var Y=q.onCaughtError;Y(K.value,{componentStack:K.stack,errorBoundary:F.tag===1?F.stateNode:null})}catch(Z){setTimeout(function(){throw Z})}}function Qo(q,F,K){return K=Qi(K),K.tag=3,K.payload={element:null},K.callback=function(){Za(q,F)},K}function Wu(q){return q=Qi(q),q.tag=3,q}function Xu(q,F,K,Y){var Z=K.type.getDerivedStateFromError;if(typeof Z=="function"){var te=Y.value;q.payload=function(){return Z(te)},q.callback=function(){Yu(F,K,Y)}}var ae=K.stateNode;ae!==null&&typeof ae.componentDidCatch=="function"&&(q.callback=function(){Yu(F,K,Y),typeof Z!="function"&&(an===null?an=new Set([this]):an.add(this));var ce=Y.stack;this.componentDidCatch(Y.value,{componentStack:ce!==null?ce:""})})}function Hh(q,F,K,Y,Z){if(K.flags|=32768,Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){if(F=K.alternate,F!==null&&Ir(F,K,Z,!0),K=gi.current,K!==null){switch(K.tag){case 13:return Ei===null?yc():K.alternate===null&&Rt===0&&(Rt=3),K.flags&=-257,K.flags|=65536,K.lanes=Z,Y===ko?K.flags|=16384:(F=K.updateQueue,F===null?K.updateQueue=new Set([Y]):F.add(Y),Tc(q,Y,Z)),!1;case 22:return K.flags|=65536,Y===ko?K.flags|=16384:(F=K.updateQueue,F===null?(F={transitions:null,markerInstances:null,retryQueue:new Set([Y])},K.updateQueue=F):(K=F.retryQueue,K===null?F.retryQueue=new Set([Y]):K.add(Y)),Tc(q,Y,Z)),!1}throw Error(B(435,K.tag))}return Tc(q,Y,Z),yc(),!1}if(ft)return F=gi.current,F!==null?((F.flags&65536)===0&&(F.flags|=256),F.flags|=65536,F.lanes=Z,Y!==go&&(q=Error(B(422),{cause:Y}),Nr(fi(q,K)))):(Y!==go&&(F=Error(B(423),{cause:Y}),Nr(fi(F,K))),q=q.current.alternate,q.flags|=65536,Z&=-Z,q.lanes|=Z,Y=fi(Y,K),Z=Qo(q.stateNode,Y,Z),xo(q,Z),Rt!==4&&(Rt=2)),!1;var te=Error(B(520),{cause:Y});if(te=fi(te,K),ia===null?ia=[te]:ia.push(te),Rt!==4&&(Rt=2),F===null)return!0;Y=fi(Y,K),K=F;do{switch(K.tag){case 3:return K.flags|=65536,q=Z&-Z,K.lanes|=q,q=Qo(K.stateNode,Y,q),xo(K,q),!1;case 1:if(F=K.type,te=K.stateNode,(K.flags&128)===0&&(typeof F.getDerivedStateFromError=="function"||te!==null&&typeof te.componentDidCatch=="function"&&(an===null||!an.has(te))))return K.flags|=65536,Z&=-Z,K.lanes|=Z,Z=Wu(Z),Xu(Z,q,K,Y),xo(K,Z),!1}K=K.return}while(K!==null);return!1}var Ju=Error(B(461)),Vt=!1;function Ft(q,F,K,Y){F.child=q===null?Fu(F,null,K,Y):ar(F,q.child,K,Y)}function Zu(q,F,K,Y,Z){K=K.render;var te=F.ref;if("ref"in Y){var ae={};for(var ce in Y)ce!=="ref"&&(ae[ce]=Y[ce])}else ae=Y;return En(F),Y=Do(q,F,K,ae,te,Z),ce=Oo(),q!==null&&!Vt?(Mo(q,F,Z),Ui(q,F,Z)):(ft&&ce&&po(F),F.flags|=1,Ft(q,F,Y,Z),F.child)}function ed(q,F,K,Y,Z){if(q===null){var te=K.type;return typeof te=="function"&&!uo(te)&&te.defaultProps===void 0&&K.compare===null?(F.tag=15,F.type=te,td(q,F,te,Y,Z)):(q=Oa(K.type,null,Y,F,F.mode,Z),q.ref=F.ref,q.return=F,F.child=q)}if(te=q.child,!ic(q,Z)){var ae=te.memoizedProps;if(K=K.compare,K=K!==null?K:Dr,K(ae,Y)&&q.ref===F.ref)return Ui(q,F,Z)}return F.flags|=1,q=Pi(te,Y),q.ref=F.ref,q.return=F,F.child=q}function td(q,F,K,Y,Z){if(q!==null){var te=q.memoizedProps;if(Dr(te,Y)&&q.ref===F.ref)if(Vt=!1,F.pendingProps=Y=te,ic(q,Z))(q.flags&131072)!==0&&(Vt=!0);else return F.lanes=q.lanes,Ui(q,F,Z)}return Yo(q,F,K,Y,Z)}function nd(q,F,K){var Y=F.pendingProps,Z=Y.children,te=q!==null?q.memoizedState:null;if(Y.mode==="hidden"){if((F.flags&128)!==0){if(Y=te!==null?te.baseLanes|K:K,q!==null){for(Z=F.child=q.child,te=0;Z!==null;)te=te|Z.lanes|Z.childLanes,Z=Z.sibling;F.childLanes=te&~Y}else F.childLanes=0,F.child=null;return rd(q,F,Y,K)}if((K&536870912)!==0)F.memoizedState={baseLanes:0,cachePool:null},q!==null&&Ua(F,te!==null?te.cachePool:null),te!==null?tu(F,te):wo(),zu(F);else return F.lanes=F.childLanes=536870912,rd(q,F,te!==null?te.baseLanes|K:K,K)}else te!==null?(Ua(F,te.cachePool),tu(F,te),Ji(),F.memoizedState=null):(q!==null&&Ua(F,null),wo(),Ji());return Ft(q,F,Z,K),F.child}function rd(q,F,K,Y){var Z=Co();return Z=Z===null?null:{parent:Lt._currentValue,pool:Z},F.memoizedState={baseLanes:K,cachePool:Z},q!==null&&Ua(F,null),wo(),zu(F),q!==null&&Ir(q,F,Y,!0),null}function es(q,F){var K=F.ref;if(K===null)q!==null&&q.ref!==null&&(F.flags|=4194816);else{if(typeof K!="function"&&typeof K!="object")throw Error(B(284));(q===null||q.ref!==K)&&(F.flags|=4194816)}}function Yo(q,F,K,Y,Z){return En(F),K=Do(q,F,K,Y,void 0,Z),Y=Oo(),q!==null&&!Vt?(Mo(q,F,Z),Ui(q,F,Z)):(ft&&Y&&po(F),F.flags|=1,Ft(q,F,K,Z),F.child)}function ad(q,F,K,Y,Z,te){return En(F),F.updateQueue=null,K=nu(F,Y,K,Z),iu(q),Y=Oo(),q!==null&&!Vt?(Mo(q,F,te),Ui(q,F,te)):(ft&&Y&&po(F),F.flags|=1,Ft(q,F,K,te),F.child)}function sd(q,F,K,Y,Z){if(En(F),F.stateNode===null){var te=Yn,ae=K.contextType;typeof ae=="object"&&ae!==null&&(te=Kt(ae)),te=new K(Y,te),F.memoizedState=te.state!==null&&te.state!==void 0?te.state:null,te.updater=$o,F.stateNode=te,te._reactInternals=F,te=F.stateNode,te.props=Y,te.state=F.memoizedState,te.refs={},Eo(F),ae=K.contextType,te.context=typeof ae=="object"&&ae!==null?Kt(ae):Yn,te.state=F.memoizedState,ae=K.getDerivedStateFromProps,typeof ae=="function"&&(Ko(F,K,ae,Y),te.state=F.memoizedState),typeof K.getDerivedStateFromProps=="function"||typeof te.getSnapshotBeforeUpdate=="function"||typeof te.UNSAFE_componentWillMount!="function"&&typeof te.componentWillMount!="function"||(ae=te.state,typeof te.componentWillMount=="function"&&te.componentWillMount(),typeof te.UNSAFE_componentWillMount=="function"&&te.UNSAFE_componentWillMount(),ae!==te.state&&$o.enqueueReplaceState(te,te.state,null),zr(F,Y,te,Z),Fr(),te.state=F.memoizedState),typeof te.componentDidMount=="function"&&(F.flags|=4194308),Y=!0}else if(q===null){te=F.stateNode;var ce=F.memoizedProps,me=Rn(K,ce);te.props=me;var Se=te.context,Oe=K.contextType;ae=Yn,typeof Oe=="object"&&Oe!==null&&(ae=Kt(Oe));var Ie=K.getDerivedStateFromProps;Oe=typeof Ie=="function"||typeof te.getSnapshotBeforeUpdate=="function",ce=F.pendingProps!==ce,Oe||typeof te.UNSAFE_componentWillReceiveProps!="function"&&typeof te.componentWillReceiveProps!="function"||(ce||Se!==ae)&&Gu(F,te,Y,ae),$i=!1;var ke=F.memoizedState;te.state=ke,zr(F,Y,te,Z),Fr(),Se=F.memoizedState,ce||ke!==Se||$i?(typeof Ie=="function"&&(Ko(F,K,Ie,Y),Se=F.memoizedState),(me=$i||Hu(F,K,me,Y,ke,Se,ae))?(Oe||typeof te.UNSAFE_componentWillMount!="function"&&typeof te.componentWillMount!="function"||(typeof te.componentWillMount=="function"&&te.componentWillMount(),typeof te.UNSAFE_componentWillMount=="function"&&te.UNSAFE_componentWillMount()),typeof te.componentDidMount=="function"&&(F.flags|=4194308)):(typeof te.componentDidMount=="function"&&(F.flags|=4194308),F.memoizedProps=Y,F.memoizedState=Se),te.props=Y,te.state=Se,te.context=ae,Y=me):(typeof te.componentDidMount=="function"&&(F.flags|=4194308),Y=!1)}else{te=F.stateNode,_o(q,F),ae=F.memoizedProps,Oe=Rn(K,ae),te.props=Oe,Ie=F.pendingProps,ke=te.context,Se=K.contextType,me=Yn,typeof Se=="object"&&Se!==null&&(me=Kt(Se)),ce=K.getDerivedStateFromProps,(Se=typeof ce=="function"||typeof te.getSnapshotBeforeUpdate=="function")||typeof te.UNSAFE_componentWillReceiveProps!="function"&&typeof te.componentWillReceiveProps!="function"||(ae!==Ie||ke!==me)&&Gu(F,te,Y,me),$i=!1,ke=F.memoizedState,te.state=ke,zr(F,Y,te,Z),Fr();var Ee=F.memoizedState;ae!==Ie||ke!==Ee||$i||q!==null&&q.dependencies!==null&&Na(q.dependencies)?(typeof ce=="function"&&(Ko(F,K,ce,Y),Ee=F.memoizedState),(Oe=$i||Hu(F,K,Oe,Y,ke,Ee,me)||q!==null&&q.dependencies!==null&&Na(q.dependencies))?(Se||typeof te.UNSAFE_componentWillUpdate!="function"&&typeof te.componentWillUpdate!="function"||(typeof te.componentWillUpdate=="function"&&te.componentWillUpdate(Y,Ee,me),typeof te.UNSAFE_componentWillUpdate=="function"&&te.UNSAFE_componentWillUpdate(Y,Ee,me)),typeof te.componentDidUpdate=="function"&&(F.flags|=4),typeof te.getSnapshotBeforeUpdate=="function"&&(F.flags|=1024)):(typeof te.componentDidUpdate!="function"||ae===q.memoizedProps&&ke===q.memoizedState||(F.flags|=4),typeof te.getSnapshotBeforeUpdate!="function"||ae===q.memoizedProps&&ke===q.memoizedState||(F.flags|=1024),F.memoizedProps=Y,F.memoizedState=Ee),te.props=Y,te.state=Ee,te.context=me,Y=Oe):(typeof te.componentDidUpdate!="function"||ae===q.memoizedProps&&ke===q.memoizedState||(F.flags|=4),typeof te.getSnapshotBeforeUpdate!="function"||ae===q.memoizedProps&&ke===q.memoizedState||(F.flags|=1024),Y=!1)}return te=Y,es(q,F),Y=(F.flags&128)!==0,te||Y?(te=F.stateNode,K=Y&&typeof K.getDerivedStateFromError!="function"?null:te.render(),F.flags|=1,q!==null&&Y?(F.child=ar(F,q.child,null,Z),F.child=ar(F,null,K,Z)):Ft(q,F,K,Z),F.memoizedState=te.state,q=F.child):q=Ui(q,F,Z),q}function od(q,F,K,Y){return Lr(),F.flags|=256,Ft(q,F,K,Y),F.child}var Wo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Xo(q){return{baseLanes:q,cachePool:$l()}}function Jo(q,F,K){return q=q!==null?q.childLanes&~K:0,F&&(q|=vi),q}function cd(q,F,K){var Y=F.pendingProps,Z=!1,te=(F.flags&128)!==0,ae;if((ae=te)||(ae=q!==null&&q.memoizedState===null?!1:(Nt.current&2)!==0),ae&&(Z=!0,F.flags&=-129),ae=(F.flags&32)!==0,F.flags&=-33,q===null){if(ft){if(Z?Xi(F):Ji(),ft){var ce=xt,me;if(me=ce){e:{for(me=ce,ce=ki;me.nodeType!==8;){if(!ce){ce=null;break e}if(me=Si(me.nextSibling),me===null){ce=null;break e}}ce=me}ce!==null?(F.memoizedState={dehydrated:ce,treeContext:bn!==null?{id:Di,overflow:Oi}:null,retryLane:536870912,hydrationErrors:null},me=ri(18,null,null,0),me.stateNode=ce,me.return=F,F.child=me,Yt=F,xt=null,me=!0):me=!1}me||Cn(F)}if(ce=F.memoizedState,ce!==null&&(ce=ce.dehydrated,ce!==null))return Nc(ce)?F.lanes=32:F.lanes=536870912,null;Ii(F)}return ce=Y.children,Y=Y.fallback,Z?(Ji(),Z=F.mode,ce=ts({mode:"hidden",children:ce},Z),Y=yn(Y,Z,K,null),ce.return=F,Y.return=F,ce.sibling=Y,F.child=ce,Z=F.child,Z.memoizedState=Xo(K),Z.childLanes=Jo(q,ae,K),F.memoizedState=Wo,Y):(Xi(F),Zo(F,ce))}if(me=q.memoizedState,me!==null&&(ce=me.dehydrated,ce!==null)){if(te)F.flags&256?(Xi(F),F.flags&=-257,F=ec(q,F,K)):F.memoizedState!==null?(Ji(),F.child=q.child,F.flags|=128,F=null):(Ji(),Z=Y.fallback,ce=F.mode,Y=ts({mode:"visible",children:Y.children},ce),Z=yn(Z,ce,K,null),Z.flags|=2,Y.return=F,Z.return=F,Y.sibling=Z,F.child=Y,ar(F,q.child,null,K),Y=F.child,Y.memoizedState=Xo(K),Y.childLanes=Jo(q,ae,K),F.memoizedState=Wo,F=Z);else if(Xi(F),Nc(ce)){if(ae=ce.nextSibling&&ce.nextSibling.dataset,ae)var Se=ae.dgst;ae=Se,Y=Error(B(419)),Y.stack="",Y.digest=ae,Nr({value:Y,source:null,stack:null}),F=ec(q,F,K)}else if(Vt||Ir(q,F,K,!1),ae=(K&q.childLanes)!==0,Vt||ae){if(ae=Tt,ae!==null&&(Y=K&-K,Y=(Y&42)!==0?1:Ns(Y),Y=(Y&(ae.suspendedLanes|K))!==0?0:Y,Y!==0&&Y!==me.retryLane))throw me.retryLane=Y,Qn(q,Y),li(ae,q,Y),Ju;ce.data==="$?"||yc(),F=ec(q,F,K)}else ce.data==="$?"?(F.flags|=192,F.child=q.child,F=null):(q=me.treeContext,xt=Si(ce.nextSibling),Yt=F,ft=!0,Sn=null,ki=!1,q!==null&&(pi[mi++]=Di,pi[mi++]=Oi,pi[mi++]=bn,Di=q.id,Oi=q.overflow,bn=F),F=Zo(F,Y.children),F.flags|=4096);return F}return Z?(Ji(),Z=Y.fallback,ce=F.mode,me=q.child,Se=me.sibling,Y=Pi(me,{mode:"hidden",children:Y.children}),Y.subtreeFlags=me.subtreeFlags&65011712,Se!==null?Z=Pi(Se,Z):(Z=yn(Z,ce,K,null),Z.flags|=2),Z.return=F,Y.return=F,Y.sibling=Z,F.child=Y,Y=Z,Z=F.child,ce=q.child.memoizedState,ce===null?ce=Xo(K):(me=ce.cachePool,me!==null?(Se=Lt._currentValue,me=me.parent!==Se?{parent:Se,pool:Se}:me):me=$l(),ce={baseLanes:ce.baseLanes|K,cachePool:me}),Z.memoizedState=ce,Z.childLanes=Jo(q,ae,K),F.memoizedState=Wo,Y):(Xi(F),K=q.child,q=K.sibling,K=Pi(K,{mode:"visible",children:Y.children}),K.return=F,K.sibling=null,q!==null&&(ae=F.deletions,ae===null?(F.deletions=[q],F.flags|=16):ae.push(q)),F.child=K,F.memoizedState=null,K)}function Zo(q,F){return F=ts({mode:"visible",children:F},q.mode),F.return=q,q.child=F}function ts(q,F){return q=ri(22,q,null,F),q.lanes=0,q.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},q}function ec(q,F,K){return ar(F,q.child,null,K),q=Zo(F,F.pendingProps.children),q.flags|=2,F.memoizedState=null,q}function ld(q,F,K){q.lanes|=F;var Y=q.alternate;Y!==null&&(Y.lanes|=F),yo(q.return,F,K)}function tc(q,F,K,Y,Z){var te=q.memoizedState;te===null?q.memoizedState={isBackwards:F,rendering:null,renderingStartTime:0,last:Y,tail:K,tailMode:Z}:(te.isBackwards=F,te.rendering=null,te.renderingStartTime=0,te.last=Y,te.tail=K,te.tailMode=Z)}function ud(q,F,K){var Y=F.pendingProps,Z=Y.revealOrder,te=Y.tail;if(Ft(q,F,Y.children,K),Y=Nt.current,(Y&2)!==0)Y=Y&1|2,F.flags|=128;else{if(q!==null&&(q.flags&128)!==0)e:for(q=F.child;q!==null;){if(q.tag===13)q.memoizedState!==null&&ld(q,K,F);else if(q.tag===19)ld(q,K,F);else if(q.child!==null){q.child.return=q,q=q.child;continue}if(q===F)break e;for(;q.sibling===null;){if(q.return===null||q.return===F)break e;q=q.return}q.sibling.return=q.return,q=q.sibling}Y&=1}switch(Ue(Nt,Y),Z){case"forwards":for(K=F.child,Z=null;K!==null;)q=K.alternate,q!==null&&Xa(q)===null&&(Z=K),K=K.sibling;K=Z,K===null?(Z=F.child,F.child=null):(Z=K.sibling,K.sibling=null),tc(F,!1,Z,K,te);break;case"backwards":for(K=null,Z=F.child,F.child=null;Z!==null;){if(q=Z.alternate,q!==null&&Xa(q)===null){F.child=Z;break}q=Z.sibling,Z.sibling=K,K=Z,Z=q}tc(F,!0,K,null,te);break;case"together":tc(F,!1,null,null,void 0);break;default:F.memoizedState=null}return F.child}function Ui(q,F,K){if(q!==null&&(F.dependencies=q.dependencies),rn|=F.lanes,(K&F.childLanes)===0)if(q!==null){if(Ir(q,F,K,!1),(K&F.childLanes)===0)return null}else return null;if(q!==null&&F.child!==q.child)throw Error(B(153));if(F.child!==null){for(q=F.child,K=Pi(q,q.pendingProps),F.child=K,K.return=F;q.sibling!==null;)q=q.sibling,K=K.sibling=Pi(q,q.pendingProps),K.return=F;K.sibling=null}return F.child}function ic(q,F){return(q.lanes&F)!==0?!0:(q=q.dependencies,!!(q!==null&&Na(q)))}function Gh(q,F,K){switch(F.tag){case 3:ut(F,F.stateNode.containerInfo),Ki(F,Lt,q.memoizedState.cache),Lr();break;case 27:case 5:tt(F);break;case 4:ut(F,F.stateNode.containerInfo);break;case 10:Ki(F,F.type,F.memoizedProps.value);break;case 13:var Y=F.memoizedState;if(Y!==null)return Y.dehydrated!==null?(Xi(F),F.flags|=128,null):(K&F.child.childLanes)!==0?cd(q,F,K):(Xi(F),q=Ui(q,F,K),q!==null?q.sibling:null);Xi(F);break;case 19:var Z=(q.flags&128)!==0;if(Y=(K&F.childLanes)!==0,Y||(Ir(q,F,K,!1),Y=(K&F.childLanes)!==0),Z){if(Y)return ud(q,F,K);F.flags|=128}if(Z=F.memoizedState,Z!==null&&(Z.rendering=null,Z.tail=null,Z.lastEffect=null),Ue(Nt,Nt.current),Y)break;return null;case 22:case 23:return F.lanes=0,nd(q,F,K);case 24:Ki(F,Lt,q.memoizedState.cache)}return Ui(q,F,K)}function dd(q,F,K){if(q!==null)if(q.memoizedProps!==F.pendingProps)Vt=!0;else{if(!ic(q,K)&&(F.flags&128)===0)return Vt=!1,Gh(q,F,K);Vt=(q.flags&131072)!==0}else Vt=!1,ft&&(F.flags&1048576)!==0&&Bl(F,La,F.index);switch(F.lanes=0,F.tag){case 16:e:{q=F.pendingProps;var Y=F.elementType,Z=Y._init;if(Y=Z(Y._payload),F.type=Y,typeof Y=="function")uo(Y)?(q=Rn(Y,q),F.tag=1,F=sd(null,F,Y,q,K)):(F.tag=0,F=Yo(null,F,Y,q,K));else{if(Y!=null){if(Z=Y.$$typeof,Z===fe){F.tag=11,F=Zu(null,F,Y,q,K);break e}else if(Z===Ae){F.tag=14,F=ed(null,F,Y,q,K);break e}}throw F=Fe(Y)||Y,Error(B(306,F,""))}}return F;case 0:return Yo(q,F,F.type,F.pendingProps,K);case 1:return Y=F.type,Z=Rn(Y,F.pendingProps),sd(q,F,Y,Z,K);case 3:e:{if(ut(F,F.stateNode.containerInfo),q===null)throw Error(B(387));Y=F.pendingProps;var te=F.memoizedState;Z=te.element,_o(q,F),zr(F,Y,null,K);var ae=F.memoizedState;if(Y=ae.cache,Ki(F,Lt,Y),Y!==te.cache&&bo(F,[Lt],K,!0),Fr(),Y=ae.element,te.isDehydrated)if(te={element:Y,isDehydrated:!1,cache:ae.cache},F.updateQueue.baseState=te,F.memoizedState=te,F.flags&256){F=od(q,F,Y,K);break e}else if(Y!==Z){Z=fi(Error(B(424)),F),Nr(Z),F=od(q,F,Y,K);break e}else{switch(q=F.stateNode.containerInfo,q.nodeType){case 9:q=q.body;break;default:q=q.nodeName==="HTML"?q.ownerDocument.body:q}for(xt=Si(q.firstChild),Yt=F,ft=!0,Sn=null,ki=!0,K=Fu(F,null,Y,K),F.child=K;K;)K.flags=K.flags&-3|4096,K=K.sibling}else{if(Lr(),Y===Z){F=Ui(q,F,K);break e}Ft(q,F,Y,K)}F=F.child}return F;case 26:return es(q,F),q===null?(K=gf(F.type,null,F.pendingProps,null))?F.memoizedState=K:ft||(K=F.type,q=F.pendingProps,Y=ms(De.current).createElement(K),Y[Gt]=F,Y[Wt]=q,Ht(Y,K,q),Ut(Y),F.stateNode=Y):F.memoizedState=gf(F.type,q.memoizedProps,F.pendingProps,q.memoizedState),null;case 27:return tt(F),q===null&&ft&&(Y=F.stateNode=hf(F.type,F.pendingProps,De.current),Yt=F,ki=!0,Z=xt,cn(F.type)?(Ic=Z,xt=Si(Y.firstChild)):xt=Z),Ft(q,F,F.pendingProps.children,K),es(q,F),q===null&&(F.flags|=4194304),F.child;case 5:return q===null&&ft&&((Z=Y=xt)&&(Y=bp(Y,F.type,F.pendingProps,ki),Y!==null?(F.stateNode=Y,Yt=F,xt=Si(Y.firstChild),ki=!1,Z=!0):Z=!1),Z||Cn(F)),tt(F),Z=F.type,te=F.pendingProps,ae=q!==null?q.memoizedProps:null,Y=te.children,Oc(Z,te)?Y=null:ae!==null&&Oc(Z,ae)&&(F.flags|=32),F.memoizedState!==null&&(Z=Do(q,F,Uh,null,null,K),da._currentValue=Z),es(q,F),Ft(q,F,Y,K),F.child;case 6:return q===null&&ft&&((q=K=xt)&&(K=Tp(K,F.pendingProps,ki),K!==null?(F.stateNode=K,Yt=F,xt=null,q=!0):q=!1),q||Cn(F)),null;case 13:return cd(q,F,K);case 4:return ut(F,F.stateNode.containerInfo),Y=F.pendingProps,q===null?F.child=ar(F,null,Y,K):Ft(q,F,Y,K),F.child;case 11:return Zu(q,F,F.type,F.pendingProps,K);case 7:return Ft(q,F,F.pendingProps,K),F.child;case 8:return Ft(q,F,F.pendingProps.children,K),F.child;case 12:return Ft(q,F,F.pendingProps.children,K),F.child;case 10:return Y=F.pendingProps,Ki(F,F.type,Y.value),Ft(q,F,Y.children,K),F.child;case 9:return Z=F.type._context,Y=F.pendingProps.children,En(F),Z=Kt(Z),Y=Y(Z),F.flags|=1,Ft(q,F,Y,K),F.child;case 14:return ed(q,F,F.type,F.pendingProps,K);case 15:return td(q,F,F.type,F.pendingProps,K);case 19:return ud(q,F,K);case 31:return Y=F.pendingProps,K=F.mode,Y={mode:Y.mode,children:Y.children},q===null?(K=ts(Y,K),K.ref=F.ref,F.child=K,K.return=F,F=K):(K=Pi(q.child,Y),K.ref=F.ref,F.child=K,K.return=F,F=K),F;case 22:return nd(q,F,K);case 24:return En(F),Y=Kt(Lt),q===null?(Z=Co(),Z===null&&(Z=Tt,te=To(),Z.pooledCache=te,te.refCount++,te!==null&&(Z.pooledCacheLanes|=K),Z=te),F.memoizedState={parent:Y,cache:Z},Eo(F),Ki(F,Lt,Z)):((q.lanes&K)!==0&&(_o(q,F),zr(F,null,null,K),Fr()),Z=q.memoizedState,te=F.memoizedState,Z.parent!==Y?(Z={parent:Y,cache:Y},F.memoizedState=Z,F.lanes===0&&(F.memoizedState=F.updateQueue.baseState=Z),Ki(F,Lt,Y)):(Y=te.cache,Ki(F,Lt,Y),Y!==Z.cache&&bo(F,[Lt],K,!0))),Ft(q,F,F.pendingProps.children,K),F.child;case 29:throw F.pendingProps}throw Error(B(156,F.tag))}function Vi(q){q.flags|=4}function fd(q,F){if(F.type!=="stylesheet"||(F.state.loading&4)!==0)q.flags&=-16777217;else if(q.flags|=16777216,!Sf(F)){if(F=gi.current,F!==null&&((ct&4194048)===ct?Ei!==null:(ct&62914560)!==ct&&(ct&536870912)===0||F!==Ei))throw Br=ko,Ql;q.flags|=8192}}function is(q,F){F!==null&&(q.flags|=4),q.flags&16384&&(F=q.tag!==22?yt():536870912,q.lanes|=F,lr|=F)}function Wr(q,F){if(!ft)switch(q.tailMode){case"hidden":F=q.tail;for(var K=null;F!==null;)F.alternate!==null&&(K=F),F=F.sibling;K===null?q.tail=null:K.sibling=null;break;case"collapsed":K=q.tail;for(var Y=null;K!==null;)K.alternate!==null&&(Y=K),K=K.sibling;Y===null?F||q.tail===null?q.tail=null:q.tail.sibling=null:Y.sibling=null}}function kt(q){var F=q.alternate!==null&&q.alternate.child===q.child,K=0,Y=0;if(F)for(var Z=q.child;Z!==null;)K|=Z.lanes|Z.childLanes,Y|=Z.subtreeFlags&65011712,Y|=Z.flags&65011712,Z.return=q,Z=Z.sibling;else for(Z=q.child;Z!==null;)K|=Z.lanes|Z.childLanes,Y|=Z.subtreeFlags,Y|=Z.flags,Z.return=q,Z=Z.sibling;return q.subtreeFlags|=Y,q.childLanes=K,F}function Kh(q,F,K){var Y=F.pendingProps;switch(mo(F),F.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kt(F),null;case 1:return kt(F),null;case 3:return K=F.stateNode,Y=null,q!==null&&(Y=q.memoizedState.cache),F.memoizedState.cache!==Y&&(F.flags|=2048),Li(Lt),Je(),K.pendingContext&&(K.context=K.pendingContext,K.pendingContext=null),(q===null||q.child===null)&&(Mr(F)?Vi(F):q===null||q.memoizedState.isDehydrated&&(F.flags&256)===0||(F.flags|=1024,zl())),kt(F),null;case 26:return K=F.memoizedState,q===null?(Vi(F),K!==null?(kt(F),fd(F,K)):(kt(F),F.flags&=-16777217)):K?K!==q.memoizedState?(Vi(F),kt(F),fd(F,K)):(kt(F),F.flags&=-16777217):(q.memoizedProps!==Y&&Vi(F),kt(F),F.flags&=-16777217),null;case 27:St(F),K=De.current;var Z=F.type;if(q!==null&&F.stateNode!=null)q.memoizedProps!==Y&&Vi(F);else{if(!Y){if(F.stateNode===null)throw Error(B(166));return kt(F),null}q=Ge.current,Mr(F)?ql(F):(q=hf(Z,Y,K),F.stateNode=q,Vi(F))}return kt(F),null;case 5:if(St(F),K=F.type,q!==null&&F.stateNode!=null)q.memoizedProps!==Y&&Vi(F);else{if(!Y){if(F.stateNode===null)throw Error(B(166));return kt(F),null}if(q=Ge.current,Mr(F))ql(F);else{switch(Z=ms(De.current),q){case 1:q=Z.createElementNS("http://www.w3.org/2000/svg",K);break;case 2:q=Z.createElementNS("http://www.w3.org/1998/Math/MathML",K);break;default:switch(K){case"svg":q=Z.createElementNS("http://www.w3.org/2000/svg",K);break;case"math":q=Z.createElementNS("http://www.w3.org/1998/Math/MathML",K);break;case"script":q=Z.createElement("div"),q.innerHTML="<script><\/script>",q=q.removeChild(q.firstChild);break;case"select":q=typeof Y.is=="string"?Z.createElement("select",{is:Y.is}):Z.createElement("select"),Y.multiple?q.multiple=!0:Y.size&&(q.size=Y.size);break;default:q=typeof Y.is=="string"?Z.createElement(K,{is:Y.is}):Z.createElement(K)}}q[Gt]=F,q[Wt]=Y;e:for(Z=F.child;Z!==null;){if(Z.tag===5||Z.tag===6)q.appendChild(Z.stateNode);else if(Z.tag!==4&&Z.tag!==27&&Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===F)break e;for(;Z.sibling===null;){if(Z.return===null||Z.return===F)break e;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}F.stateNode=q;e:switch(Ht(q,K,Y),K){case"button":case"input":case"select":case"textarea":q=!!Y.autoFocus;break e;case"img":q=!0;break e;default:q=!1}q&&Vi(F)}}return kt(F),F.flags&=-16777217,null;case 6:if(q&&F.stateNode!=null)q.memoizedProps!==Y&&Vi(F);else{if(typeof Y!="string"&&F.stateNode===null)throw Error(B(166));if(q=De.current,Mr(F)){if(q=F.stateNode,K=F.memoizedProps,Y=null,Z=Yt,Z!==null)switch(Z.tag){case 27:case 5:Y=Z.memoizedProps}q[Gt]=F,q=!!(q.nodeValue===K||Y!==null&&Y.suppressHydrationWarning===!0||sf(q.nodeValue,K)),q||Cn(F)}else q=ms(q).createTextNode(Y),q[Gt]=F,F.stateNode=q}return kt(F),null;case 13:if(Y=F.memoizedState,q===null||q.memoizedState!==null&&q.memoizedState.dehydrated!==null){if(Z=Mr(F),Y!==null&&Y.dehydrated!==null){if(q===null){if(!Z)throw Error(B(318));if(Z=F.memoizedState,Z=Z!==null?Z.dehydrated:null,!Z)throw Error(B(317));Z[Gt]=F}else Lr(),(F.flags&128)===0&&(F.memoizedState=null),F.flags|=4;kt(F),Z=!1}else Z=zl(),q!==null&&q.memoizedState!==null&&(q.memoizedState.hydrationErrors=Z),Z=!0;if(!Z)return F.flags&256?(Ii(F),F):(Ii(F),null)}if(Ii(F),(F.flags&128)!==0)return F.lanes=K,F;if(K=Y!==null,q=q!==null&&q.memoizedState!==null,K){Y=F.child,Z=null,Y.alternate!==null&&Y.alternate.memoizedState!==null&&Y.alternate.memoizedState.cachePool!==null&&(Z=Y.alternate.memoizedState.cachePool.pool);var te=null;Y.memoizedState!==null&&Y.memoizedState.cachePool!==null&&(te=Y.memoizedState.cachePool.pool),te!==Z&&(Y.flags|=2048)}return K!==q&&K&&(F.child.flags|=8192),is(F,F.updateQueue),kt(F),null;case 4:return Je(),q===null&&Rc(F.stateNode.containerInfo),kt(F),null;case 10:return Li(F.type),kt(F),null;case 19:if(je(Nt),Z=F.memoizedState,Z===null)return kt(F),null;if(Y=(F.flags&128)!==0,te=Z.rendering,te===null)if(Y)Wr(Z,!1);else{if(Rt!==0||q!==null&&(q.flags&128)!==0)for(q=F.child;q!==null;){if(te=Xa(q),te!==null){for(F.flags|=128,Wr(Z,!1),q=te.updateQueue,F.updateQueue=q,is(F,q),F.subtreeFlags=0,q=K,K=F.child;K!==null;)jl(K,q),K=K.sibling;return Ue(Nt,Nt.current&1|2),F.child}q=q.sibling}Z.tail!==null&&Et()>as&&(F.flags|=128,Y=!0,Wr(Z,!1),F.lanes=4194304)}else{if(!Y)if(q=Xa(te),q!==null){if(F.flags|=128,Y=!0,q=q.updateQueue,F.updateQueue=q,is(F,q),Wr(Z,!0),Z.tail===null&&Z.tailMode==="hidden"&&!te.alternate&&!ft)return kt(F),null}else 2*Et()-Z.renderingStartTime>as&&K!==536870912&&(F.flags|=128,Y=!0,Wr(Z,!1),F.lanes=4194304);Z.isBackwards?(te.sibling=F.child,F.child=te):(q=Z.last,q!==null?q.sibling=te:F.child=te,Z.last=te)}return Z.tail!==null?(F=Z.tail,Z.rendering=F,Z.tail=F.sibling,Z.renderingStartTime=Et(),F.sibling=null,q=Nt.current,Ue(Nt,Y?q&1|2:q&1),F):(kt(F),null);case 22:case 23:return Ii(F),Ao(),Y=F.memoizedState!==null,q!==null?q.memoizedState!==null!==Y&&(F.flags|=8192):Y&&(F.flags|=8192),Y?(K&536870912)!==0&&(F.flags&128)===0&&(kt(F),F.subtreeFlags&6&&(F.flags|=8192)):kt(F),K=F.updateQueue,K!==null&&is(F,K.retryQueue),K=null,q!==null&&q.memoizedState!==null&&q.memoizedState.cachePool!==null&&(K=q.memoizedState.cachePool.pool),Y=null,F.memoizedState!==null&&F.memoizedState.cachePool!==null&&(Y=F.memoizedState.cachePool.pool),Y!==K&&(F.flags|=2048),q!==null&&je(_n),null;case 24:return K=null,q!==null&&(K=q.memoizedState.cache),F.memoizedState.cache!==K&&(F.flags|=2048),Li(Lt),kt(F),null;case 25:return null;case 30:return null}throw Error(B(156,F.tag))}function $h(q,F){switch(mo(F),F.tag){case 1:return q=F.flags,q&65536?(F.flags=q&-65537|128,F):null;case 3:return Li(Lt),Je(),q=F.flags,(q&65536)!==0&&(q&128)===0?(F.flags=q&-65537|128,F):null;case 26:case 27:case 5:return St(F),null;case 13:if(Ii(F),q=F.memoizedState,q!==null&&q.dehydrated!==null){if(F.alternate===null)throw Error(B(340));Lr()}return q=F.flags,q&65536?(F.flags=q&-65537|128,F):null;case 19:return je(Nt),null;case 4:return Je(),null;case 10:return Li(F.type),null;case 22:case 23:return Ii(F),Ao(),q!==null&&je(_n),q=F.flags,q&65536?(F.flags=q&-65537|128,F):null;case 24:return Li(Lt),null;case 25:return null;default:return null}}function hd(q,F){switch(mo(F),F.tag){case 3:Li(Lt),Je();break;case 26:case 27:case 5:St(F);break;case 4:Je();break;case 13:Ii(F);break;case 19:je(Nt);break;case 10:Li(F.type);break;case 22:case 23:Ii(F),Ao(),q!==null&&je(_n);break;case 24:Li(Lt)}}function Xr(q,F){try{var K=F.updateQueue,Y=K!==null?K.lastEffect:null;if(Y!==null){var Z=Y.next;K=Z;do{if((K.tag&q)===q){Y=void 0;var te=K.create,ae=K.inst;Y=te(),ae.destroy=Y}K=K.next}while(K!==Z)}}catch(ce){bt(F,F.return,ce)}}function Zi(q,F,K){try{var Y=F.updateQueue,Z=Y!==null?Y.lastEffect:null;if(Z!==null){var te=Z.next;Y=te;do{if((Y.tag&q)===q){var ae=Y.inst,ce=ae.destroy;if(ce!==void 0){ae.destroy=void 0,Z=F;var me=K,Se=ce;try{Se()}catch(Oe){bt(Z,me,Oe)}}}Y=Y.next}while(Y!==te)}}catch(Oe){bt(F,F.return,Oe)}}function pd(q){var F=q.updateQueue;if(F!==null){var K=q.stateNode;try{eu(F,K)}catch(Y){bt(q,q.return,Y)}}}function md(q,F,K){K.props=Rn(q.type,q.memoizedProps),K.state=q.memoizedState;try{K.componentWillUnmount()}catch(Y){bt(q,F,Y)}}function Jr(q,F){try{var K=q.ref;if(K!==null){switch(q.tag){case 26:case 27:case 5:var Y=q.stateNode;break;case 30:Y=q.stateNode;break;default:Y=q.stateNode}typeof K=="function"?q.refCleanup=K(Y):K.current=Y}}catch(Z){bt(q,F,Z)}}function _i(q,F){var K=q.ref,Y=q.refCleanup;if(K!==null)if(typeof Y=="function")try{Y()}catch(Z){bt(q,F,Z)}finally{q.refCleanup=null,q=q.alternate,q!=null&&(q.refCleanup=null)}else if(typeof K=="function")try{K(null)}catch(Z){bt(q,F,Z)}else K.current=null}function gd(q){var F=q.type,K=q.memoizedProps,Y=q.stateNode;try{e:switch(F){case"button":case"input":case"select":case"textarea":K.autoFocus&&Y.focus();break e;case"img":K.src?Y.src=K.src:K.srcSet&&(Y.srcset=K.srcSet)}}catch(Z){bt(q,q.return,Z)}}function nc(q,F,K){try{var Y=q.stateNode;pp(Y,q.type,K,F),Y[Wt]=F}catch(Z){bt(q,q.return,Z)}}function vd(q){return q.tag===5||q.tag===3||q.tag===26||q.tag===27&&cn(q.type)||q.tag===4}function rc(q){e:for(;;){for(;q.sibling===null;){if(q.return===null||vd(q.return))return null;q=q.return}for(q.sibling.return=q.return,q=q.sibling;q.tag!==5&&q.tag!==6&&q.tag!==18;){if(q.tag===27&&cn(q.type)||q.flags&2||q.child===null||q.tag===4)continue e;q.child.return=q,q=q.child}if(!(q.flags&2))return q.stateNode}}function ac(q,F,K){var Y=q.tag;if(Y===5||Y===6)q=q.stateNode,F?(K.nodeType===9?K.body:K.nodeName==="HTML"?K.ownerDocument.body:K).insertBefore(q,F):(F=K.nodeType===9?K.body:K.nodeName==="HTML"?K.ownerDocument.body:K,F.appendChild(q),K=K._reactRootContainer,K!=null||F.onclick!==null||(F.onclick=ps));else if(Y!==4&&(Y===27&&cn(q.type)&&(K=q.stateNode,F=null),q=q.child,q!==null))for(ac(q,F,K),q=q.sibling;q!==null;)ac(q,F,K),q=q.sibling}function ns(q,F,K){var Y=q.tag;if(Y===5||Y===6)q=q.stateNode,F?K.insertBefore(q,F):K.appendChild(q);else if(Y!==4&&(Y===27&&cn(q.type)&&(K=q.stateNode),q=q.child,q!==null))for(ns(q,F,K),q=q.sibling;q!==null;)ns(q,F,K),q=q.sibling}function yd(q){var F=q.stateNode,K=q.memoizedProps;try{for(var Y=q.type,Z=F.attributes;Z.length;)F.removeAttributeNode(Z[0]);Ht(F,Y,K),F[Gt]=q,F[Wt]=K}catch(te){bt(q,q.return,te)}}var ji=!1,Pt=!1,sc=!1,bd=typeof WeakSet=="function"?WeakSet:Set,jt=null;function Qh(q,F){if(q=q.containerInfo,Pc=Ss,q=Al(q),no(q)){if("selectionStart"in q)var K={start:q.selectionStart,end:q.selectionEnd};else e:{K=(K=q.ownerDocument)&&K.defaultView||window;var Y=K.getSelection&&K.getSelection();if(Y&&Y.rangeCount!==0){K=Y.anchorNode;var Z=Y.anchorOffset,te=Y.focusNode;Y=Y.focusOffset;try{K.nodeType,te.nodeType}catch{K=null;break e}var ae=0,ce=-1,me=-1,Se=0,Oe=0,Ie=q,ke=null;t:for(;;){for(var Ee;Ie!==K||Z!==0&&Ie.nodeType!==3||(ce=ae+Z),Ie!==te||Y!==0&&Ie.nodeType!==3||(me=ae+Y),Ie.nodeType===3&&(ae+=Ie.nodeValue.length),(Ee=Ie.firstChild)!==null;)ke=Ie,Ie=Ee;for(;;){if(Ie===q)break t;if(ke===K&&++Se===Z&&(ce=ae),ke===te&&++Oe===Y&&(me=ae),(Ee=Ie.nextSibling)!==null)break;Ie=ke,ke=Ie.parentNode}Ie=Ee}K=ce===-1||me===-1?null:{start:ce,end:me}}else K=null}K=K||{start:0,end:0}}else K=null;for(Dc={focusedElem:q,selectionRange:K},Ss=!1,jt=F;jt!==null;)if(F=jt,q=F.child,(F.subtreeFlags&1024)!==0&&q!==null)q.return=F,jt=q;else for(;jt!==null;){switch(F=jt,te=F.alternate,q=F.flags,F.tag){case 0:break;case 11:case 15:break;case 1:if((q&1024)!==0&&te!==null){q=void 0,K=F,Z=te.memoizedProps,te=te.memoizedState,Y=K.stateNode;try{var it=Rn(K.type,Z,K.elementType===K.type);q=Y.getSnapshotBeforeUpdate(it,te),Y.__reactInternalSnapshotBeforeUpdate=q}catch(Ze){bt(K,K.return,Ze)}}break;case 3:if((q&1024)!==0){if(q=F.stateNode.containerInfo,K=q.nodeType,K===9)Lc(q);else if(K===1)switch(q.nodeName){case"HEAD":case"HTML":case"BODY":Lc(q);break;default:q.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((q&1024)!==0)throw Error(B(163))}if(q=F.sibling,q!==null){q.return=F.return,jt=q;break}jt=F.return}}function Td(q,F,K){var Y=K.flags;switch(K.tag){case 0:case 11:case 15:en(q,K),Y&4&&Xr(5,K);break;case 1:if(en(q,K),Y&4)if(q=K.stateNode,F===null)try{q.componentDidMount()}catch(ae){bt(K,K.return,ae)}else{var Z=Rn(K.type,F.memoizedProps);F=F.memoizedState;try{q.componentDidUpdate(Z,F,q.__reactInternalSnapshotBeforeUpdate)}catch(ae){bt(K,K.return,ae)}}Y&64&&pd(K),Y&512&&Jr(K,K.return);break;case 3:if(en(q,K),Y&64&&(q=K.updateQueue,q!==null)){if(F=null,K.child!==null)switch(K.child.tag){case 27:case 5:F=K.child.stateNode;break;case 1:F=K.child.stateNode}try{eu(q,F)}catch(ae){bt(K,K.return,ae)}}break;case 27:F===null&&Y&4&&yd(K);case 26:case 5:en(q,K),F===null&&Y&4&&gd(K),Y&512&&Jr(K,K.return);break;case 12:en(q,K);break;case 13:en(q,K),Y&4&&kd(q,K),Y&64&&(q=K.memoizedState,q!==null&&(q=q.dehydrated,q!==null&&(K=np.bind(null,K),Sp(q,K))));break;case 22:if(Y=K.memoizedState!==null||ji,!Y){F=F!==null&&F.memoizedState!==null||Pt,Z=ji;var te=Pt;ji=Y,(Pt=F)&&!te?tn(q,K,(K.subtreeFlags&8772)!==0):en(q,K),ji=Z,Pt=te}break;case 30:break;default:en(q,K)}}function Sd(q){var F=q.alternate;F!==null&&(q.alternate=null,Sd(F)),q.child=null,q.deletions=null,q.sibling=null,q.tag===5&&(F=q.stateNode,F!==null&&Vs(F)),q.stateNode=null,q.return=null,q.dependencies=null,q.memoizedProps=null,q.memoizedState=null,q.pendingProps=null,q.stateNode=null,q.updateQueue=null}var Ct=null,Zt=!1;function Bi(q,F,K){for(K=K.child;K!==null;)Cd(q,F,K),K=K.sibling}function Cd(q,F,K){if(qt&&typeof qt.onCommitFiberUnmount=="function")try{qt.onCommitFiberUnmount(zi,K)}catch{}switch(K.tag){case 26:Pt||_i(K,F),Bi(q,F,K),K.memoizedState?K.memoizedState.count--:K.stateNode&&(K=K.stateNode,K.parentNode.removeChild(K));break;case 27:Pt||_i(K,F);var Y=Ct,Z=Zt;cn(K.type)&&(Ct=K.stateNode,Zt=!1),Bi(q,F,K),oa(K.stateNode),Ct=Y,Zt=Z;break;case 5:Pt||_i(K,F);case 6:if(Y=Ct,Z=Zt,Ct=null,Bi(q,F,K),Ct=Y,Zt=Z,Ct!==null)if(Zt)try{(Ct.nodeType===9?Ct.body:Ct.nodeName==="HTML"?Ct.ownerDocument.body:Ct).removeChild(K.stateNode)}catch(te){bt(K,F,te)}else try{Ct.removeChild(K.stateNode)}catch(te){bt(K,F,te)}break;case 18:Ct!==null&&(Zt?(q=Ct,df(q.nodeType===9?q.body:q.nodeName==="HTML"?q.ownerDocument.body:q,K.stateNode),ma(q)):df(Ct,K.stateNode));break;case 4:Y=Ct,Z=Zt,Ct=K.stateNode.containerInfo,Zt=!0,Bi(q,F,K),Ct=Y,Zt=Z;break;case 0:case 11:case 14:case 15:Pt||Zi(2,K,F),Pt||Zi(4,K,F),Bi(q,F,K);break;case 1:Pt||(_i(K,F),Y=K.stateNode,typeof Y.componentWillUnmount=="function"&&md(K,F,Y)),Bi(q,F,K);break;case 21:Bi(q,F,K);break;case 22:Pt=(Y=Pt)||K.memoizedState!==null,Bi(q,F,K),Pt=Y;break;default:Bi(q,F,K)}}function kd(q,F){if(F.memoizedState===null&&(q=F.alternate,q!==null&&(q=q.memoizedState,q!==null&&(q=q.dehydrated,q!==null))))try{ma(q)}catch(K){bt(F,F.return,K)}}function Yh(q){switch(q.tag){case 13:case 19:var F=q.stateNode;return F===null&&(F=q.stateNode=new bd),F;case 22:return q=q.stateNode,F=q._retryCache,F===null&&(F=q._retryCache=new bd),F;default:throw Error(B(435,q.tag))}}function oc(q,F){var K=Yh(q);F.forEach(function(Y){var Z=rp.bind(null,q,Y);K.has(Y)||(K.add(Y),Y.then(Z,Z))})}function ai(q,F){var K=F.deletions;if(K!==null)for(var Y=0;Y<K.length;Y++){var Z=K[Y],te=q,ae=F,ce=ae;e:for(;ce!==null;){switch(ce.tag){case 27:if(cn(ce.type)){Ct=ce.stateNode,Zt=!1;break e}break;case 5:Ct=ce.stateNode,Zt=!1;break e;case 3:case 4:Ct=ce.stateNode.containerInfo,Zt=!0;break e}ce=ce.return}if(Ct===null)throw Error(B(160));Cd(te,ae,Z),Ct=null,Zt=!1,te=Z.alternate,te!==null&&(te.return=null),Z.return=null}if(F.subtreeFlags&13878)for(F=F.child;F!==null;)Ed(F,q),F=F.sibling}var Ti=null;function Ed(q,F){var K=q.alternate,Y=q.flags;switch(q.tag){case 0:case 11:case 14:case 15:ai(F,q),si(q),Y&4&&(Zi(3,q,q.return),Xr(3,q),Zi(5,q,q.return));break;case 1:ai(F,q),si(q),Y&512&&(Pt||K===null||_i(K,K.return)),Y&64&&ji&&(q=q.updateQueue,q!==null&&(Y=q.callbacks,Y!==null&&(K=q.shared.hiddenCallbacks,q.shared.hiddenCallbacks=K===null?Y:K.concat(Y))));break;case 26:var Z=Ti;if(ai(F,q),si(q),Y&512&&(Pt||K===null||_i(K,K.return)),Y&4){var te=K!==null?K.memoizedState:null;if(Y=q.memoizedState,K===null)if(Y===null)if(q.stateNode===null){e:{Y=q.type,K=q.memoizedProps,Z=Z.ownerDocument||Z;t:switch(Y){case"title":te=Z.getElementsByTagName("title")[0],(!te||te[Cr]||te[Gt]||te.namespaceURI==="http://www.w3.org/2000/svg"||te.hasAttribute("itemprop"))&&(te=Z.createElement(Y),Z.head.insertBefore(te,Z.querySelector("head > title"))),Ht(te,Y,K),te[Gt]=q,Ut(te),Y=te;break e;case"link":var ae=bf("link","href",Z).get(Y+(K.href||""));if(ae){for(var ce=0;ce<ae.length;ce++)if(te=ae[ce],te.getAttribute("href")===(K.href==null||K.href===""?null:K.href)&&te.getAttribute("rel")===(K.rel==null?null:K.rel)&&te.getAttribute("title")===(K.title==null?null:K.title)&&te.getAttribute("crossorigin")===(K.crossOrigin==null?null:K.crossOrigin)){ae.splice(ce,1);break t}}te=Z.createElement(Y),Ht(te,Y,K),Z.head.appendChild(te);break;case"meta":if(ae=bf("meta","content",Z).get(Y+(K.content||""))){for(ce=0;ce<ae.length;ce++)if(te=ae[ce],te.getAttribute("content")===(K.content==null?null:""+K.content)&&te.getAttribute("name")===(K.name==null?null:K.name)&&te.getAttribute("property")===(K.property==null?null:K.property)&&te.getAttribute("http-equiv")===(K.httpEquiv==null?null:K.httpEquiv)&&te.getAttribute("charset")===(K.charSet==null?null:K.charSet)){ae.splice(ce,1);break t}}te=Z.createElement(Y),Ht(te,Y,K),Z.head.appendChild(te);break;default:throw Error(B(468,Y))}te[Gt]=q,Ut(te),Y=te}q.stateNode=Y}else Tf(Z,q.type,q.stateNode);else q.stateNode=yf(Z,Y,q.memoizedProps);else te!==Y?(te===null?K.stateNode!==null&&(K=K.stateNode,K.parentNode.removeChild(K)):te.count--,Y===null?Tf(Z,q.type,q.stateNode):yf(Z,Y,q.memoizedProps)):Y===null&&q.stateNode!==null&&nc(q,q.memoizedProps,K.memoizedProps)}break;case 27:ai(F,q),si(q),Y&512&&(Pt||K===null||_i(K,K.return)),K!==null&&Y&4&&nc(q,q.memoizedProps,K.memoizedProps);break;case 5:if(ai(F,q),si(q),Y&512&&(Pt||K===null||_i(K,K.return)),q.flags&32){Z=q.stateNode;try{qn(Z,"")}catch(Ee){bt(q,q.return,Ee)}}Y&4&&q.stateNode!=null&&(Z=q.memoizedProps,nc(q,Z,K!==null?K.memoizedProps:Z)),Y&1024&&(sc=!0);break;case 6:if(ai(F,q),si(q),Y&4){if(q.stateNode===null)throw Error(B(162));Y=q.memoizedProps,K=q.stateNode;try{K.nodeValue=Y}catch(Ee){bt(q,q.return,Ee)}}break;case 3:if(ys=null,Z=Ti,Ti=gs(F.containerInfo),ai(F,q),Ti=Z,si(q),Y&4&&K!==null&&K.memoizedState.isDehydrated)try{ma(F.containerInfo)}catch(Ee){bt(q,q.return,Ee)}sc&&(sc=!1,_d(q));break;case 4:Y=Ti,Ti=gs(q.stateNode.containerInfo),ai(F,q),si(q),Ti=Y;break;case 12:ai(F,q),si(q);break;case 13:ai(F,q),si(q),q.child.flags&8192&&q.memoizedState!==null!=(K!==null&&K.memoizedState!==null)&&(hc=Et()),Y&4&&(Y=q.updateQueue,Y!==null&&(q.updateQueue=null,oc(q,Y)));break;case 22:Z=q.memoizedState!==null;var me=K!==null&&K.memoizedState!==null,Se=ji,Oe=Pt;if(ji=Se||Z,Pt=Oe||me,ai(F,q),Pt=Oe,ji=Se,si(q),Y&8192)e:for(F=q.stateNode,F._visibility=Z?F._visibility&-2:F._visibility|1,Z&&(K===null||me||ji||Pt||wn(q)),K=null,F=q;;){if(F.tag===5||F.tag===26){if(K===null){me=K=F;try{if(te=me.stateNode,Z)ae=te.style,typeof ae.setProperty=="function"?ae.setProperty("display","none","important"):ae.display="none";else{ce=me.stateNode;var Ie=me.memoizedProps.style,ke=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null;ce.style.display=ke==null||typeof ke=="boolean"?"":(""+ke).trim()}}catch(Ee){bt(me,me.return,Ee)}}}else if(F.tag===6){if(K===null){me=F;try{me.stateNode.nodeValue=Z?"":me.memoizedProps}catch(Ee){bt(me,me.return,Ee)}}}else if((F.tag!==22&&F.tag!==23||F.memoizedState===null||F===q)&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===q)break e;for(;F.sibling===null;){if(F.return===null||F.return===q)break e;K===F&&(K=null),F=F.return}K===F&&(K=null),F.sibling.return=F.return,F=F.sibling}Y&4&&(Y=q.updateQueue,Y!==null&&(K=Y.retryQueue,K!==null&&(Y.retryQueue=null,oc(q,K))));break;case 19:ai(F,q),si(q),Y&4&&(Y=q.updateQueue,Y!==null&&(q.updateQueue=null,oc(q,Y)));break;case 30:break;case 21:break;default:ai(F,q),si(q)}}function si(q){var F=q.flags;if(F&2){try{for(var K,Y=q.return;Y!==null;){if(vd(Y)){K=Y;break}Y=Y.return}if(K==null)throw Error(B(160));switch(K.tag){case 27:var Z=K.stateNode,te=rc(q);ns(q,te,Z);break;case 5:var ae=K.stateNode;K.flags&32&&(qn(ae,""),K.flags&=-33);var ce=rc(q);ns(q,ce,ae);break;case 3:case 4:var me=K.stateNode.containerInfo,Se=rc(q);ac(q,Se,me);break;default:throw Error(B(161))}}catch(Oe){bt(q,q.return,Oe)}q.flags&=-3}F&4096&&(q.flags&=-4097)}function _d(q){if(q.subtreeFlags&1024)for(q=q.child;q!==null;){var F=q;_d(F),F.tag===5&&F.flags&1024&&F.stateNode.reset(),q=q.sibling}}function en(q,F){if(F.subtreeFlags&8772)for(F=F.child;F!==null;)Td(q,F.alternate,F),F=F.sibling}function wn(q){for(q=q.child;q!==null;){var F=q;switch(F.tag){case 0:case 11:case 14:case 15:Zi(4,F,F.return),wn(F);break;case 1:_i(F,F.return);var K=F.stateNode;typeof K.componentWillUnmount=="function"&&md(F,F.return,K),wn(F);break;case 27:oa(F.stateNode);case 26:case 5:_i(F,F.return),wn(F);break;case 22:F.memoizedState===null&&wn(F);break;case 30:wn(F);break;default:wn(F)}q=q.sibling}}function tn(q,F,K){for(K=K&&(F.subtreeFlags&8772)!==0,F=F.child;F!==null;){var Y=F.alternate,Z=q,te=F,ae=te.flags;switch(te.tag){case 0:case 11:case 15:tn(Z,te,K),Xr(4,te);break;case 1:if(tn(Z,te,K),Y=te,Z=Y.stateNode,typeof Z.componentDidMount=="function")try{Z.componentDidMount()}catch(Se){bt(Y,Y.return,Se)}if(Y=te,Z=Y.updateQueue,Z!==null){var ce=Y.stateNode;try{var me=Z.shared.hiddenCallbacks;if(me!==null)for(Z.shared.hiddenCallbacks=null,Z=0;Z<me.length;Z++)Zl(me[Z],ce)}catch(Se){bt(Y,Y.return,Se)}}K&&ae&64&&pd(te),Jr(te,te.return);break;case 27:yd(te);case 26:case 5:tn(Z,te,K),K&&Y===null&&ae&4&&gd(te),Jr(te,te.return);break;case 12:tn(Z,te,K);break;case 13:tn(Z,te,K),K&&ae&4&&kd(Z,te);break;case 22:te.memoizedState===null&&tn(Z,te,K),Jr(te,te.return);break;case 30:break;default:tn(Z,te,K)}F=F.sibling}}function cc(q,F){var K=null;q!==null&&q.memoizedState!==null&&q.memoizedState.cachePool!==null&&(K=q.memoizedState.cachePool.pool),q=null,F.memoizedState!==null&&F.memoizedState.cachePool!==null&&(q=F.memoizedState.cachePool.pool),q!==K&&(q!=null&&q.refCount++,K!=null&&Ur(K))}function lc(q,F){q=null,F.alternate!==null&&(q=F.alternate.memoizedState.cache),F=F.memoizedState.cache,F!==q&&(F.refCount++,q!=null&&Ur(q))}function xi(q,F,K,Y){if(F.subtreeFlags&10256)for(F=F.child;F!==null;)xd(q,F,K,Y),F=F.sibling}function xd(q,F,K,Y){var Z=F.flags;switch(F.tag){case 0:case 11:case 15:xi(q,F,K,Y),Z&2048&&Xr(9,F);break;case 1:xi(q,F,K,Y);break;case 3:xi(q,F,K,Y),Z&2048&&(q=null,F.alternate!==null&&(q=F.alternate.memoizedState.cache),F=F.memoizedState.cache,F!==q&&(F.refCount++,q!=null&&Ur(q)));break;case 12:if(Z&2048){xi(q,F,K,Y),q=F.stateNode;try{var te=F.memoizedProps,ae=te.id,ce=te.onPostCommit;typeof ce=="function"&&ce(ae,F.alternate===null?"mount":"update",q.passiveEffectDuration,-0)}catch(me){bt(F,F.return,me)}}else xi(q,F,K,Y);break;case 13:xi(q,F,K,Y);break;case 23:break;case 22:te=F.stateNode,ae=F.alternate,F.memoizedState!==null?te._visibility&2?xi(q,F,K,Y):Zr(q,F):te._visibility&2?xi(q,F,K,Y):(te._visibility|=2,sr(q,F,K,Y,(F.subtreeFlags&10256)!==0)),Z&2048&&cc(ae,F);break;case 24:xi(q,F,K,Y),Z&2048&&lc(F.alternate,F);break;default:xi(q,F,K,Y)}}function sr(q,F,K,Y,Z){for(Z=Z&&(F.subtreeFlags&10256)!==0,F=F.child;F!==null;){var te=q,ae=F,ce=K,me=Y,Se=ae.flags;switch(ae.tag){case 0:case 11:case 15:sr(te,ae,ce,me,Z),Xr(8,ae);break;case 23:break;case 22:var Oe=ae.stateNode;ae.memoizedState!==null?Oe._visibility&2?sr(te,ae,ce,me,Z):Zr(te,ae):(Oe._visibility|=2,sr(te,ae,ce,me,Z)),Z&&Se&2048&&cc(ae.alternate,ae);break;case 24:sr(te,ae,ce,me,Z),Z&&Se&2048&&lc(ae.alternate,ae);break;default:sr(te,ae,ce,me,Z)}F=F.sibling}}function Zr(q,F){if(F.subtreeFlags&10256)for(F=F.child;F!==null;){var K=q,Y=F,Z=Y.flags;switch(Y.tag){case 22:Zr(K,Y),Z&2048&&cc(Y.alternate,Y);break;case 24:Zr(K,Y),Z&2048&&lc(Y.alternate,Y);break;default:Zr(K,Y)}F=F.sibling}}var ea=8192;function or(q){if(q.subtreeFlags&ea)for(q=q.child;q!==null;)Rd(q),q=q.sibling}function Rd(q){switch(q.tag){case 26:or(q),q.flags&ea&&q.memoizedState!==null&&Lp(Ti,q.memoizedState,q.memoizedProps);break;case 5:or(q);break;case 3:case 4:var F=Ti;Ti=gs(q.stateNode.containerInfo),or(q),Ti=F;break;case 22:q.memoizedState===null&&(F=q.alternate,F!==null&&F.memoizedState!==null?(F=ea,ea=16777216,or(q),ea=F):or(q));break;default:or(q)}}function wd(q){var F=q.alternate;if(F!==null&&(q=F.child,q!==null)){F.child=null;do F=q.sibling,q.sibling=null,q=F;while(q!==null)}}function ta(q){var F=q.deletions;if((q.flags&16)!==0){if(F!==null)for(var K=0;K<F.length;K++){var Y=F[K];jt=Y,Pd(Y,q)}wd(q)}if(q.subtreeFlags&10256)for(q=q.child;q!==null;)Ad(q),q=q.sibling}function Ad(q){switch(q.tag){case 0:case 11:case 15:ta(q),q.flags&2048&&Zi(9,q,q.return);break;case 3:ta(q);break;case 12:ta(q);break;case 22:var F=q.stateNode;q.memoizedState!==null&&F._visibility&2&&(q.return===null||q.return.tag!==13)?(F._visibility&=-3,rs(q)):ta(q);break;default:ta(q)}}function rs(q){var F=q.deletions;if((q.flags&16)!==0){if(F!==null)for(var K=0;K<F.length;K++){var Y=F[K];jt=Y,Pd(Y,q)}wd(q)}for(q=q.child;q!==null;){switch(F=q,F.tag){case 0:case 11:case 15:Zi(8,F,F.return),rs(F);break;case 22:K=F.stateNode,K._visibility&2&&(K._visibility&=-3,rs(F));break;default:rs(F)}q=q.sibling}}function Pd(q,F){for(;jt!==null;){var K=jt;switch(K.tag){case 0:case 11:case 15:Zi(8,K,F);break;case 23:case 22:if(K.memoizedState!==null&&K.memoizedState.cachePool!==null){var Y=K.memoizedState.cachePool.pool;Y!=null&&Y.refCount++}break;case 24:Ur(K.memoizedState.cache)}if(Y=K.child,Y!==null)Y.return=K,jt=Y;else e:for(K=q;jt!==null;){Y=jt;var Z=Y.sibling,te=Y.return;if(Sd(Y),Y===K){jt=null;break e}if(Z!==null){Z.return=te,jt=Z;break e}jt=te}}}var Wh={getCacheForType:function(q){var F=Kt(Lt),K=F.data.get(q);return K===void 0&&(K=q(),F.data.set(q,K)),K}},Xh=typeof WeakMap=="function"?WeakMap:Map,ht=0,Tt=null,st=null,ct=0,pt=0,oi=null,nn=!1,cr=!1,uc=!1,qi=0,Rt=0,rn=0,An=0,dc=0,vi=0,lr=0,ia=null,ei=null,fc=!1,hc=0,as=1/0,ss=null,an=null,zt=0,sn=null,ur=null,dr=0,pc=0,mc=null,Dd=null,na=0,gc=null;function ci(){if((ht&2)!==0&&ct!==0)return ct&-ct;if(be.T!==null){var q=Jn;return q!==0?q:kc()}return Kc()}function Od(){vi===0&&(vi=(ct&536870912)===0||ft?nt():536870912);var q=gi.current;return q!==null&&(q.flags|=32),vi}function li(q,F,K){(q===Tt&&(pt===2||pt===9)||q.cancelPendingCommit!==null)&&(fr(q,0),on(q,ct,vi,!1)),wt(q,K),((ht&2)===0||q!==Tt)&&(q===Tt&&((ht&2)===0&&(An|=K),Rt===4&&on(q,ct,vi,!1)),Ri(q))}function Md(q,F,K){if((ht&6)!==0)throw Error(B(327));var Y=!K&&(F&124)===0&&(F&q.expiredLanes)===0||Ke(q,F),Z=Y?ep(q,F):bc(q,F,!0),te=Y;do{if(Z===0){cr&&!Y&&on(q,F,0,!1);break}else{if(K=q.current.alternate,te&&!Jh(K)){Z=bc(q,F,!1),te=!1;continue}if(Z===2){if(te=F,q.errorRecoveryDisabledLanes&te)var ae=0;else ae=q.pendingLanes&-536870913,ae=ae!==0?ae:ae&536870912?536870912:0;if(ae!==0){F=ae;e:{var ce=q;Z=ia;var me=ce.current.memoizedState.isDehydrated;if(me&&(fr(ce,ae).flags|=256),ae=bc(ce,ae,!1),ae!==2){if(uc&&!me){ce.errorRecoveryDisabledLanes|=te,An|=te,Z=4;break e}te=ei,ei=Z,te!==null&&(ei===null?ei=te:ei.push.apply(ei,te))}Z=ae}if(te=!1,Z!==2)continue}}if(Z===1){fr(q,0),on(q,F,0,!0);break}e:{switch(Y=q,te=Z,te){case 0:case 1:throw Error(B(345));case 4:if((F&4194048)!==F)break;case 6:on(Y,F,vi,!nn);break e;case 2:ei=null;break;case 3:case 5:break;default:throw Error(B(329))}if((F&62914560)===F&&(Z=hc+300-Et(),10<Z)){if(on(Y,F,vi,!nn),Ve(Y,0,!0)!==0)break e;Y.timeoutHandle=lf(Ld.bind(null,Y,K,ei,ss,fc,F,vi,An,lr,nn,te,2,-0,0),Z);break e}Ld(Y,K,ei,ss,fc,F,vi,An,lr,nn,te,0,-0,0)}}break}while(!0);Ri(q)}function Ld(q,F,K,Y,Z,te,ae,ce,me,Se,Oe,Ie,ke,Ee){if(q.timeoutHandle=-1,Ie=F.subtreeFlags,(Ie&8192||(Ie&16785408)===16785408)&&(ua={stylesheets:null,count:0,unsuspend:Mp},Rd(F),Ie=Np(),Ie!==null)){q.cancelPendingCommit=Ie(qd.bind(null,q,F,te,K,Y,Z,ae,ce,me,Oe,1,ke,Ee)),on(q,te,ae,!Se);return}qd(q,F,te,K,Y,Z,ae,ce,me)}function Jh(q){for(var F=q;;){var K=F.tag;if((K===0||K===11||K===15)&&F.flags&16384&&(K=F.updateQueue,K!==null&&(K=K.stores,K!==null)))for(var Y=0;Y<K.length;Y++){var Z=K[Y],te=Z.getSnapshot;Z=Z.value;try{if(!ni(te(),Z))return!1}catch{return!1}}if(K=F.child,F.subtreeFlags&16384&&K!==null)K.return=F,F=K;else{if(F===q)break;for(;F.sibling===null;){if(F.return===null||F.return===q)return!0;F=F.return}F.sibling.return=F.return,F=F.sibling}}return!0}function on(q,F,K,Y){F&=~dc,F&=~An,q.suspendedLanes|=F,q.pingedLanes&=~F,Y&&(q.warmLanes|=F),Y=q.expirationTimes;for(var Z=F;0<Z;){var te=31-It(Z),ae=1<<te;Y[te]=-1,Z&=~ae}K!==0&&Ls(q,K,F)}function os(){return(ht&6)===0?(ra(0),!1):!0}function vc(){if(st!==null){if(pt===0)var q=st.return;else q=st,Mi=kn=null,Lo(q),rr=null,Qr=0,q=st;for(;q!==null;)hd(q.alternate,q),q=q.return;st=null}}function fr(q,F){var K=q.timeoutHandle;K!==-1&&(q.timeoutHandle=-1,gp(K)),K=q.cancelPendingCommit,K!==null&&(q.cancelPendingCommit=null,K()),vc(),Tt=q,st=K=Pi(q.current,null),ct=F,pt=0,oi=null,nn=!1,cr=Ke(q,F),uc=!1,lr=vi=dc=An=rn=Rt=0,ei=ia=null,fc=!1,(F&8)!==0&&(F|=F&32);var Y=q.entangledLanes;if(Y!==0)for(q=q.entanglements,Y&=F;0<Y;){var Z=31-It(Y),te=1<<Z;F|=q[Z],Y&=~te}return qi=F,Aa(),K}function Nd(q,F){rt=null,be.H=Qa,F===jr||F===Va?(F=Xl(),pt=3):F===Ql?(F=Xl(),pt=4):pt=F===Ju?8:F!==null&&typeof F=="object"&&typeof F.then=="function"?6:1,oi=F,st===null&&(Rt=1,Za(q,fi(F,q.current)))}function Id(){var q=be.H;return be.H=Qa,q===null?Qa:q}function Ud(){var q=be.A;return be.A=Wh,q}function yc(){Rt=4,nn||(ct&4194048)!==ct&&gi.current!==null||(cr=!0),(rn&134217727)===0&&(An&134217727)===0||Tt===null||on(Tt,ct,vi,!1)}function bc(q,F,K){var Y=ht;ht|=2;var Z=Id(),te=Ud();(Tt!==q||ct!==F)&&(ss=null,fr(q,F)),F=!1;var ae=Rt;e:do try{if(pt!==0&&st!==null){var ce=st,me=oi;switch(pt){case 8:vc(),ae=6;break e;case 3:case 2:case 9:case 6:gi.current===null&&(F=!0);var Se=pt;if(pt=0,oi=null,hr(q,ce,me,Se),K&&cr){ae=0;break e}break;default:Se=pt,pt=0,oi=null,hr(q,ce,me,Se)}}Zh(),ae=Rt;break}catch(Oe){Nd(q,Oe)}while(!0);return F&&q.shellSuspendCounter++,Mi=kn=null,ht=Y,be.H=Z,be.A=te,st===null&&(Tt=null,ct=0,Aa()),ae}function Zh(){for(;st!==null;)Vd(st)}function ep(q,F){var K=ht;ht|=2;var Y=Id(),Z=Ud();Tt!==q||ct!==F?(ss=null,as=Et()+500,fr(q,F)):cr=Ke(q,F);e:do try{if(pt!==0&&st!==null){F=st;var te=oi;t:switch(pt){case 1:pt=0,oi=null,hr(q,F,te,1);break;case 2:case 9:if(Yl(te)){pt=0,oi=null,jd(F);break}F=function(){pt!==2&&pt!==9||Tt!==q||(pt=7),Ri(q)},te.then(F,F);break e;case 3:pt=7;break e;case 4:pt=5;break e;case 7:Yl(te)?(pt=0,oi=null,jd(F)):(pt=0,oi=null,hr(q,F,te,7));break;case 5:var ae=null;switch(st.tag){case 26:ae=st.memoizedState;case 5:case 27:var ce=st;if(!ae||Sf(ae)){pt=0,oi=null;var me=ce.sibling;if(me!==null)st=me;else{var Se=ce.return;Se!==null?(st=Se,cs(Se)):st=null}break t}}pt=0,oi=null,hr(q,F,te,5);break;case 6:pt=0,oi=null,hr(q,F,te,6);break;case 8:vc(),Rt=6;break e;default:throw Error(B(462))}}tp();break}catch(Oe){Nd(q,Oe)}while(!0);return Mi=kn=null,be.H=Y,be.A=Z,ht=K,st!==null?0:(Tt=null,ct=0,Aa(),Rt)}function tp(){for(;st!==null&&!ws();)Vd(st)}function Vd(q){var F=dd(q.alternate,q,qi);q.memoizedProps=q.pendingProps,F===null?cs(q):st=F}function jd(q){var F=q,K=F.alternate;switch(F.tag){case 15:case 0:F=ad(K,F,F.pendingProps,F.type,void 0,ct);break;case 11:F=ad(K,F,F.pendingProps,F.type.render,F.ref,ct);break;case 5:Lo(F);default:hd(K,F),F=st=jl(F,qi),F=dd(K,F,qi)}q.memoizedProps=q.pendingProps,F===null?cs(q):st=F}function hr(q,F,K,Y){Mi=kn=null,Lo(F),rr=null,Qr=0;var Z=F.return;try{if(Hh(q,Z,F,K,ct)){Rt=1,Za(q,fi(K,q.current)),st=null;return}}catch(te){if(Z!==null)throw st=Z,te;Rt=1,Za(q,fi(K,q.current)),st=null;return}F.flags&32768?(ft||Y===1?q=!0:cr||(ct&536870912)!==0?q=!1:(nn=q=!0,(Y===2||Y===9||Y===3||Y===6)&&(Y=gi.current,Y!==null&&Y.tag===13&&(Y.flags|=16384))),Bd(F,q)):cs(F)}function cs(q){var F=q;do{if((F.flags&32768)!==0){Bd(F,nn);return}q=F.return;var K=Kh(F.alternate,F,qi);if(K!==null){st=K;return}if(F=F.sibling,F!==null){st=F;return}st=F=q}while(F!==null);Rt===0&&(Rt=5)}function Bd(q,F){do{var K=$h(q.alternate,q);if(K!==null){K.flags&=32767,st=K;return}if(K=q.return,K!==null&&(K.flags|=32768,K.subtreeFlags=0,K.deletions=null),!F&&(q=q.sibling,q!==null)){st=q;return}st=q=K}while(q!==null);Rt=6,st=null}function qd(q,F,K,Y,Z,te,ae,ce,me){q.cancelPendingCommit=null;do ls();while(zt!==0);if((ht&6)!==0)throw Error(B(327));if(F!==null){if(F===q.current)throw Error(B(177));if(te=F.lanes|F.childLanes,te|=co,On(q,K,te,ae,ce,me),q===Tt&&(st=Tt=null,ct=0),ur=F,sn=q,dr=K,pc=te,mc=Z,Dd=Y,(F.subtreeFlags&10256)!==0||(F.flags&10256)!==0?(q.callbackNode=null,q.callbackPriority=0,ap(Dn,function(){return Kd(),null})):(q.callbackNode=null,q.callbackPriority=0),Y=(F.flags&13878)!==0,(F.subtreeFlags&13878)!==0||Y){Y=be.T,be.T=null,Z=Re.p,Re.p=2,ae=ht,ht|=4;try{Qh(q,F,K)}finally{ht=ae,Re.p=Z,be.T=Y}}zt=1,Fd(),zd(),Hd()}}function Fd(){if(zt===1){zt=0;var q=sn,F=ur,K=(F.flags&13878)!==0;if((F.subtreeFlags&13878)!==0||K){K=be.T,be.T=null;var Y=Re.p;Re.p=2;var Z=ht;ht|=4;try{Ed(F,q);var te=Dc,ae=Al(q.containerInfo),ce=te.focusedElem,me=te.selectionRange;if(ae!==ce&&ce&&ce.ownerDocument&&wl(ce.ownerDocument.documentElement,ce)){if(me!==null&&no(ce)){var Se=me.start,Oe=me.end;if(Oe===void 0&&(Oe=Se),"selectionStart"in ce)ce.selectionStart=Se,ce.selectionEnd=Math.min(Oe,ce.value.length);else{var Ie=ce.ownerDocument||document,ke=Ie&&Ie.defaultView||window;if(ke.getSelection){var Ee=ke.getSelection(),it=ce.textContent.length,Ze=Math.min(me.start,it),vt=me.end===void 0?Ze:Math.min(me.end,it);!Ee.extend&&Ze>vt&&(ae=vt,vt=Ze,Ze=ae);var ye=Rl(ce,Ze),ve=Rl(ce,vt);if(ye&&ve&&(Ee.rangeCount!==1||Ee.anchorNode!==ye.node||Ee.anchorOffset!==ye.offset||Ee.focusNode!==ve.node||Ee.focusOffset!==ve.offset)){var Te=Ie.createRange();Te.setStart(ye.node,ye.offset),Ee.removeAllRanges(),Ze>vt?(Ee.addRange(Te),Ee.extend(ve.node,ve.offset)):(Te.setEnd(ve.node,ve.offset),Ee.addRange(Te))}}}}for(Ie=[],Ee=ce;Ee=Ee.parentNode;)Ee.nodeType===1&&Ie.push({element:Ee,left:Ee.scrollLeft,top:Ee.scrollTop});for(typeof ce.focus=="function"&&ce.focus(),ce=0;ce<Ie.length;ce++){var Le=Ie[ce];Le.element.scrollLeft=Le.left,Le.element.scrollTop=Le.top}}Ss=!!Pc,Dc=Pc=null}finally{ht=Z,Re.p=Y,be.T=K}}q.current=F,zt=2}}function zd(){if(zt===2){zt=0;var q=sn,F=ur,K=(F.flags&8772)!==0;if((F.subtreeFlags&8772)!==0||K){K=be.T,be.T=null;var Y=Re.p;Re.p=2;var Z=ht;ht|=4;try{Td(q,F.alternate,F)}finally{ht=Z,Re.p=Y,be.T=K}}zt=3}}function Hd(){if(zt===4||zt===3){zt=0,Tr();var q=sn,F=ur,K=dr,Y=Dd;(F.subtreeFlags&10256)!==0||(F.flags&10256)!==0?zt=5:(zt=0,ur=sn=null,Gd(q,q.pendingLanes));var Z=q.pendingLanes;if(Z===0&&(an=null),Is(K),F=F.stateNode,qt&&typeof qt.onCommitFiberRoot=="function")try{qt.onCommitFiberRoot(zi,F,void 0,(F.current.flags&128)===128)}catch{}if(Y!==null){F=be.T,Z=Re.p,Re.p=2,be.T=null;try{for(var te=q.onRecoverableError,ae=0;ae<Y.length;ae++){var ce=Y[ae];te(ce.value,{componentStack:ce.stack})}}finally{be.T=F,Re.p=Z}}(dr&3)!==0&&ls(),Ri(q),Z=q.pendingLanes,(K&4194090)!==0&&(Z&42)!==0?q===gc?na++:(na=0,gc=q):na=0,ra(0)}}function Gd(q,F){(q.pooledCacheLanes&=F)===0&&(F=q.pooledCache,F!=null&&(q.pooledCache=null,Ur(F)))}function ls(q){return Fd(),zd(),Hd(),Kd()}function Kd(){if(zt!==5)return!1;var q=sn,F=pc;pc=0;var K=Is(dr),Y=be.T,Z=Re.p;try{Re.p=32>K?32:K,be.T=null,K=mc,mc=null;var te=sn,ae=dr;if(zt=0,ur=sn=null,dr=0,(ht&6)!==0)throw Error(B(331));var ce=ht;if(ht|=4,Ad(te.current),xd(te,te.current,ae,K),ht=ce,ra(0,!1),qt&&typeof qt.onPostCommitFiberRoot=="function")try{qt.onPostCommitFiberRoot(zi,te)}catch{}return!0}finally{Re.p=Z,be.T=Y,Gd(q,F)}}function $d(q,F,K){F=fi(K,F),F=Qo(q.stateNode,F,2),q=Yi(q,F,2),q!==null&&(wt(q,2),Ri(q))}function bt(q,F,K){if(q.tag===3)$d(q,q,K);else for(;F!==null;){if(F.tag===3){$d(F,q,K);break}else if(F.tag===1){var Y=F.stateNode;if(typeof F.type.getDerivedStateFromError=="function"||typeof Y.componentDidCatch=="function"&&(an===null||!an.has(Y))){q=fi(K,q),K=Wu(2),Y=Yi(F,K,2),Y!==null&&(Xu(K,Y,F,q),wt(Y,2),Ri(Y));break}}F=F.return}}function Tc(q,F,K){var Y=q.pingCache;if(Y===null){Y=q.pingCache=new Xh;var Z=new Set;Y.set(F,Z)}else Z=Y.get(F),Z===void 0&&(Z=new Set,Y.set(F,Z));Z.has(K)||(uc=!0,Z.add(K),q=ip.bind(null,q,F,K),F.then(q,q))}function ip(q,F,K){var Y=q.pingCache;Y!==null&&Y.delete(F),q.pingedLanes|=q.suspendedLanes&K,q.warmLanes&=~K,Tt===q&&(ct&K)===K&&(Rt===4||Rt===3&&(ct&62914560)===ct&&300>Et()-hc?(ht&2)===0&&fr(q,0):dc|=K,lr===ct&&(lr=0)),Ri(q)}function Qd(q,F){F===0&&(F=yt()),q=Qn(q,F),q!==null&&(wt(q,F),Ri(q))}function np(q){var F=q.memoizedState,K=0;F!==null&&(K=F.retryLane),Qd(q,K)}function rp(q,F){var K=0;switch(q.tag){case 13:var Y=q.stateNode,Z=q.memoizedState;Z!==null&&(K=Z.retryLane);break;case 19:Y=q.stateNode;break;case 22:Y=q.stateNode._retryCache;break;default:throw Error(B(314))}Y!==null&&Y.delete(F),Qd(q,K)}function ap(q,F){return $t(q,F)}var us=null,pr=null,Sc=!1,ds=!1,Cc=!1,Pn=0;function Ri(q){q!==pr&&q.next===null&&(pr===null?us=pr=q:pr=pr.next=q),ds=!0,Sc||(Sc=!0,op())}function ra(q,F){if(!Cc&&ds){Cc=!0;do for(var K=!1,Y=us;Y!==null;){if(q!==0){var Z=Y.pendingLanes;if(Z===0)var te=0;else{var ae=Y.suspendedLanes,ce=Y.pingedLanes;te=(1<<31-It(42|q)+1)-1,te&=Z&~(ae&~ce),te=te&201326741?te&201326741|1:te?te|2:0}te!==0&&(K=!0,Jd(Y,te))}else te=ct,te=Ve(Y,Y===Tt?te:0,Y.cancelPendingCommit!==null||Y.timeoutHandle!==-1),(te&3)===0||Ke(Y,te)||(K=!0,Jd(Y,te));Y=Y.next}while(K);Cc=!1}}function sp(){Yd()}function Yd(){ds=Sc=!1;var q=0;Pn!==0&&(mp()&&(q=Pn),Pn=0);for(var F=Et(),K=null,Y=us;Y!==null;){var Z=Y.next,te=Wd(Y,F);te===0?(Y.next=null,K===null?us=Z:K.next=Z,Z===null&&(pr=K)):(K=Y,(q!==0||(te&3)!==0)&&(ds=!0)),Y=Z}ra(q)}function Wd(q,F){for(var K=q.suspendedLanes,Y=q.pingedLanes,Z=q.expirationTimes,te=q.pendingLanes&-62914561;0<te;){var ae=31-It(te),ce=1<<ae,me=Z[ae];me===-1?((ce&K)===0||(ce&Y)!==0)&&(Z[ae]=Qe(ce,F)):me<=F&&(q.expiredLanes|=ce),te&=~ce}if(F=Tt,K=ct,K=Ve(q,q===F?K:0,q.cancelPendingCommit!==null||q.timeoutHandle!==-1),Y=q.callbackNode,K===0||q===F&&(pt===2||pt===9)||q.cancelPendingCommit!==null)return Y!==null&&Y!==null&&br(Y),q.callbackNode=null,q.callbackPriority=0;if((K&3)===0||Ke(q,K)){if(F=K&-K,F===q.callbackPriority)return F;switch(Y!==null&&br(Y),Is(K)){case 2:case 8:K=va;break;case 32:K=Dn;break;case 268435456:K=Sr;break;default:K=Dn}return Y=Xd.bind(null,q),K=$t(K,Y),q.callbackPriority=F,q.callbackNode=K,F}return Y!==null&&Y!==null&&br(Y),q.callbackPriority=2,q.callbackNode=null,2}function Xd(q,F){if(zt!==0&&zt!==5)return q.callbackNode=null,q.callbackPriority=0,null;var K=q.callbackNode;if(ls()&&q.callbackNode!==K)return null;var Y=ct;return Y=Ve(q,q===Tt?Y:0,q.cancelPendingCommit!==null||q.timeoutHandle!==-1),Y===0?null:(Md(q,Y,F),Wd(q,Et()),q.callbackNode!=null&&q.callbackNode===K?Xd.bind(null,q):null)}function Jd(q,F){if(ls())return null;Md(q,F,!0)}function op(){vp(function(){(ht&6)!==0?$t(Qt,sp):Yd()})}function kc(){return Pn===0&&(Pn=nt()),Pn}function Zd(q){return q==null||typeof q=="symbol"||typeof q=="boolean"?null:typeof q=="function"?q:Ca(""+q)}function ef(q,F){var K=F.ownerDocument.createElement("input");return K.name=F.name,K.value=F.value,q.id&&K.setAttribute("form",q.id),F.parentNode.insertBefore(K,F),q=new FormData(q),K.parentNode.removeChild(K),q}function cp(q,F,K,Y,Z){if(F==="submit"&&K&&K.stateNode===Z){var te=Zd((Z[Wt]||null).action),ae=Y.submitter;ae&&(F=(F=ae[Wt]||null)?Zd(F.formAction):ae.getAttribute("formAction"),F!==null&&(te=F,ae=null));var ce=new xa("action","action",null,Y,Z);q.push({event:ce,listeners:[{instance:null,listener:function(){if(Y.defaultPrevented){if(Pn!==0){var me=ae?ef(Z,ae):new FormData(Z);zo(K,{pending:!0,data:me,method:Z.method,action:te},null,me)}}else typeof te=="function"&&(ce.preventDefault(),me=ae?ef(Z,ae):new FormData(Z),zo(K,{pending:!0,data:me,method:Z.method,action:te},te,me))},currentTarget:Z}]})}}for(var Ec=0;Ec<oo.length;Ec++){var _c=oo[Ec],lp=_c.toLowerCase(),up=_c[0].toUpperCase()+_c.slice(1);bi(lp,"on"+up)}bi(Ol,"onAnimationEnd"),bi(Ml,"onAnimationIteration"),bi(Ll,"onAnimationStart"),bi("dblclick","onDoubleClick"),bi("focusin","onFocus"),bi("focusout","onBlur"),bi(Rh,"onTransitionRun"),bi(wh,"onTransitionStart"),bi(Ah,"onTransitionCancel"),bi(Nl,"onTransitionEnd"),Vn("onMouseEnter",["mouseout","mouseover"]),Vn("onMouseLeave",["mouseout","mouseover"]),Vn("onPointerEnter",["pointerout","pointerover"]),Vn("onPointerLeave",["pointerout","pointerover"]),pn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),pn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),pn("onBeforeInput",["compositionend","keypress","textInput","paste"]),pn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),pn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),pn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var aa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(aa));function tf(q,F){F=(F&4)!==0;for(var K=0;K<q.length;K++){var Y=q[K],Z=Y.event;Y=Y.listeners;e:{var te=void 0;if(F)for(var ae=Y.length-1;0<=ae;ae--){var ce=Y[ae],me=ce.instance,Se=ce.currentTarget;if(ce=ce.listener,me!==te&&Z.isPropagationStopped())break e;te=ce,Z.currentTarget=Se;try{te(Z)}catch(Oe){Ja(Oe)}Z.currentTarget=null,te=me}else for(ae=0;ae<Y.length;ae++){if(ce=Y[ae],me=ce.instance,Se=ce.currentTarget,ce=ce.listener,me!==te&&Z.isPropagationStopped())break e;te=ce,Z.currentTarget=Se;try{te(Z)}catch(Oe){Ja(Oe)}Z.currentTarget=null,te=me}}}}function ot(q,F){var K=F[Us];K===void 0&&(K=F[Us]=new Set);var Y=q+"__bubble";K.has(Y)||(nf(F,q,2,!1),K.add(Y))}function xc(q,F,K){var Y=0;F&&(Y|=4),nf(K,q,Y,F)}var fs="_reactListening"+Math.random().toString(36).slice(2);function Rc(q){if(!q[fs]){q[fs]=!0,Qc.forEach(function(K){K!=="selectionchange"&&(dp.has(K)||xc(K,!1,q),xc(K,!0,q))});var F=q.nodeType===9?q:q.ownerDocument;F===null||F[fs]||(F[fs]=!0,xc("selectionchange",!1,F))}}function nf(q,F,K,Y){switch(Rf(F)){case 2:var Z=Vp;break;case 8:Z=jp;break;default:Z=qc}K=Z.bind(null,F,K,q),Z=void 0,!Qs||F!=="touchstart"&&F!=="touchmove"&&F!=="wheel"||(Z=!0),Y?Z!==void 0?q.addEventListener(F,K,{capture:!0,passive:Z}):q.addEventListener(F,K,!0):Z!==void 0?q.addEventListener(F,K,{passive:Z}):q.addEventListener(F,K,!1)}function wc(q,F,K,Y,Z){var te=Y;if((F&1)===0&&(F&2)===0&&Y!==null)e:for(;;){if(Y===null)return;var ae=Y.tag;if(ae===3||ae===4){var ce=Y.stateNode.containerInfo;if(ce===Z)break;if(ae===4)for(ae=Y.return;ae!==null;){var me=ae.tag;if((me===3||me===4)&&ae.stateNode.containerInfo===Z)return;ae=ae.return}for(;ce!==null;){if(ae=Nn(ce),ae===null)return;if(me=ae.tag,me===5||me===6||me===26||me===27){Y=te=ae;continue e}ce=ce.parentNode}}Y=Y.return}cl(function(){var Se=te,Oe=Ks(K),Ie=[];e:{var ke=Il.get(q);if(ke!==void 0){var Ee=xa,it=q;switch(q){case"keypress":if(Ea(K)===0)break e;case"keydown":case"keyup":Ee=rh;break;case"focusin":it="focus",Ee=Js;break;case"focusout":it="blur",Ee=Js;break;case"beforeblur":case"afterblur":Ee=Js;break;case"click":if(K.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ee=dl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ee=Kf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ee=oh;break;case Ol:case Ml:case Ll:Ee=Yf;break;case Nl:Ee=lh;break;case"scroll":case"scrollend":Ee=Hf;break;case"wheel":Ee=dh;break;case"copy":case"cut":case"paste":Ee=Xf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ee=hl;break;case"toggle":case"beforetoggle":Ee=hh}var Ze=(F&4)!==0,vt=!Ze&&(q==="scroll"||q==="scrollend"),ye=Ze?ke!==null?ke+"Capture":null:ke;Ze=[];for(var ve=Se,Te;ve!==null;){var Le=ve;if(Te=Le.stateNode,Le=Le.tag,Le!==5&&Le!==26&&Le!==27||Te===null||ye===null||(Le=Er(ve,ye),Le!=null&&Ze.push(sa(ve,Le,Te))),vt)break;ve=ve.return}0<Ze.length&&(ke=new Ee(ke,it,null,K,Oe),Ie.push({event:ke,listeners:Ze}))}}if((F&7)===0){e:{if(ke=q==="mouseover"||q==="pointerover",Ee=q==="mouseout"||q==="pointerout",ke&&K!==Gs&&(it=K.relatedTarget||K.fromElement)&&(Nn(it)||it[Ln]))break e;if((Ee||ke)&&(ke=Oe.window===Oe?Oe:(ke=Oe.ownerDocument)?ke.defaultView||ke.parentWindow:window,Ee?(it=K.relatedTarget||K.toElement,Ee=Se,it=it?Nn(it):null,it!==null&&(vt=H(it),Ze=it.tag,it!==vt||Ze!==5&&Ze!==27&&Ze!==6)&&(it=null)):(Ee=null,it=Se),Ee!==it)){if(Ze=dl,Le="onMouseLeave",ye="onMouseEnter",ve="mouse",(q==="pointerout"||q==="pointerover")&&(Ze=hl,Le="onPointerLeave",ye="onPointerEnter",ve="pointer"),vt=Ee==null?ke:kr(Ee),Te=it==null?ke:kr(it),ke=new Ze(Le,ve+"leave",Ee,K,Oe),ke.target=vt,ke.relatedTarget=Te,Le=null,Nn(Oe)===Se&&(Ze=new Ze(ye,ve+"enter",it,K,Oe),Ze.target=Te,Ze.relatedTarget=vt,Le=Ze),vt=Le,Ee&&it)t:{for(Ze=Ee,ye=it,ve=0,Te=Ze;Te;Te=mr(Te))ve++;for(Te=0,Le=ye;Le;Le=mr(Le))Te++;for(;0<ve-Te;)Ze=mr(Ze),ve--;for(;0<Te-ve;)ye=mr(ye),Te--;for(;ve--;){if(Ze===ye||ye!==null&&Ze===ye.alternate)break t;Ze=mr(Ze),ye=mr(ye)}Ze=null}else Ze=null;Ee!==null&&rf(Ie,ke,Ee,Ze,!1),it!==null&&vt!==null&&rf(Ie,vt,it,Ze,!0)}}e:{if(ke=Se?kr(Se):window,Ee=ke.nodeName&&ke.nodeName.toLowerCase(),Ee==="select"||Ee==="input"&&ke.type==="file")var Ye=Sl;else if(bl(ke))if(Cl)Ye=Eh;else{Ye=Ch;var at=Sh}else Ee=ke.nodeName,!Ee||Ee.toLowerCase()!=="input"||ke.type!=="checkbox"&&ke.type!=="radio"?Se&&Hs(Se.elementType)&&(Ye=Sl):Ye=kh;if(Ye&&(Ye=Ye(q,Se))){Tl(Ie,Ye,K,Oe);break e}at&&at(q,ke,Se),q==="focusout"&&Se&&ke.type==="number"&&Se.memoizedProps.value!=null&&zs(ke,"number",ke.value)}switch(at=Se?kr(Se):window,q){case"focusin":(bl(at)||at.contentEditable==="true")&&(Gn=at,ro=Se,Or=null);break;case"focusout":Or=ro=Gn=null;break;case"mousedown":ao=!0;break;case"contextmenu":case"mouseup":case"dragend":ao=!1,Pl(Ie,K,Oe);break;case"selectionchange":if(xh)break;case"keydown":case"keyup":Pl(Ie,K,Oe)}var Xe;if(eo)e:{switch(q){case"compositionstart":var et="onCompositionStart";break e;case"compositionend":et="onCompositionEnd";break e;case"compositionupdate":et="onCompositionUpdate";break e}et=void 0}else Hn?vl(q,K)&&(et="onCompositionEnd"):q==="keydown"&&K.keyCode===229&&(et="onCompositionStart");et&&(pl&&K.locale!=="ko"&&(Hn||et!=="onCompositionStart"?et==="onCompositionEnd"&&Hn&&(Xe=ll()):(Gi=Oe,Ys="value"in Gi?Gi.value:Gi.textContent,Hn=!0)),at=hs(Se,et),0<at.length&&(et=new fl(et,q,null,K,Oe),Ie.push({event:et,listeners:at}),Xe?et.data=Xe:(Xe=yl(K),Xe!==null&&(et.data=Xe)))),(Xe=mh?gh(q,K):yh(q,K))&&(et=hs(Se,"onBeforeInput"),0<et.length&&(at=new fl("onBeforeInput","beforeinput",null,K,Oe),Ie.push({event:at,listeners:et}),at.data=Xe)),cp(Ie,q,Se,K,Oe)}tf(Ie,F)})}function sa(q,F,K){return{instance:q,listener:F,currentTarget:K}}function hs(q,F){for(var K=F+"Capture",Y=[];q!==null;){var Z=q,te=Z.stateNode;if(Z=Z.tag,Z!==5&&Z!==26&&Z!==27||te===null||(Z=Er(q,K),Z!=null&&Y.unshift(sa(q,Z,te)),Z=Er(q,F),Z!=null&&Y.push(sa(q,Z,te))),q.tag===3)return Y;q=q.return}return[]}function mr(q){if(q===null)return null;do q=q.return;while(q&&q.tag!==5&&q.tag!==27);return q||null}function rf(q,F,K,Y,Z){for(var te=F._reactName,ae=[];K!==null&&K!==Y;){var ce=K,me=ce.alternate,Se=ce.stateNode;if(ce=ce.tag,me!==null&&me===Y)break;ce!==5&&ce!==26&&ce!==27||Se===null||(me=Se,Z?(Se=Er(K,te),Se!=null&&ae.unshift(sa(K,Se,me))):Z||(Se=Er(K,te),Se!=null&&ae.push(sa(K,Se,me)))),K=K.return}ae.length!==0&&q.push({event:F,listeners:ae})}var fp=/\r\n?/g,hp=/\u0000|\uFFFD/g;function af(q){return(typeof q=="string"?q:""+q).replace(fp,`
`).replace(hp,"")}function sf(q,F){return F=af(F),af(q)===F}function ps(){}function gt(q,F,K,Y,Z,te){switch(K){case"children":typeof Y=="string"?F==="body"||F==="textarea"&&Y===""||qn(q,Y):(typeof Y=="number"||typeof Y=="bigint")&&F!=="body"&&qn(q,""+Y);break;case"className":ba(q,"class",Y);break;case"tabIndex":ba(q,"tabindex",Y);break;case"dir":case"role":case"viewBox":case"width":case"height":ba(q,K,Y);break;case"style":sl(q,Y,te);break;case"data":if(F!=="object"){ba(q,"data",Y);break}case"src":case"href":if(Y===""&&(F!=="a"||K!=="href")){q.removeAttribute(K);break}if(Y==null||typeof Y=="function"||typeof Y=="symbol"||typeof Y=="boolean"){q.removeAttribute(K);break}Y=Ca(""+Y),q.setAttribute(K,Y);break;case"action":case"formAction":if(typeof Y=="function"){q.setAttribute(K,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof te=="function"&&(K==="formAction"?(F!=="input"&&gt(q,F,"name",Z.name,Z,null),gt(q,F,"formEncType",Z.formEncType,Z,null),gt(q,F,"formMethod",Z.formMethod,Z,null),gt(q,F,"formTarget",Z.formTarget,Z,null)):(gt(q,F,"encType",Z.encType,Z,null),gt(q,F,"method",Z.method,Z,null),gt(q,F,"target",Z.target,Z,null)));if(Y==null||typeof Y=="symbol"||typeof Y=="boolean"){q.removeAttribute(K);break}Y=Ca(""+Y),q.setAttribute(K,Y);break;case"onClick":Y!=null&&(q.onclick=ps);break;case"onScroll":Y!=null&&ot("scroll",q);break;case"onScrollEnd":Y!=null&&ot("scrollend",q);break;case"dangerouslySetInnerHTML":if(Y!=null){if(typeof Y!="object"||!("__html"in Y))throw Error(B(61));if(K=Y.__html,K!=null){if(Z.children!=null)throw Error(B(60));q.innerHTML=K}}break;case"multiple":q.multiple=Y&&typeof Y!="function"&&typeof Y!="symbol";break;case"muted":q.muted=Y&&typeof Y!="function"&&typeof Y!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(Y==null||typeof Y=="function"||typeof Y=="boolean"||typeof Y=="symbol"){q.removeAttribute("xlink:href");break}K=Ca(""+Y),q.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",K);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":Y!=null&&typeof Y!="function"&&typeof Y!="symbol"?q.setAttribute(K,""+Y):q.removeAttribute(K);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":Y&&typeof Y!="function"&&typeof Y!="symbol"?q.setAttribute(K,""):q.removeAttribute(K);break;case"capture":case"download":Y===!0?q.setAttribute(K,""):Y!==!1&&Y!=null&&typeof Y!="function"&&typeof Y!="symbol"?q.setAttribute(K,Y):q.removeAttribute(K);break;case"cols":case"rows":case"size":case"span":Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&!isNaN(Y)&&1<=Y?q.setAttribute(K,Y):q.removeAttribute(K);break;case"rowSpan":case"start":Y==null||typeof Y=="function"||typeof Y=="symbol"||isNaN(Y)?q.removeAttribute(K):q.setAttribute(K,Y);break;case"popover":ot("beforetoggle",q),ot("toggle",q),ya(q,"popover",Y);break;case"xlinkActuate":wi(q,"http://www.w3.org/1999/xlink","xlink:actuate",Y);break;case"xlinkArcrole":wi(q,"http://www.w3.org/1999/xlink","xlink:arcrole",Y);break;case"xlinkRole":wi(q,"http://www.w3.org/1999/xlink","xlink:role",Y);break;case"xlinkShow":wi(q,"http://www.w3.org/1999/xlink","xlink:show",Y);break;case"xlinkTitle":wi(q,"http://www.w3.org/1999/xlink","xlink:title",Y);break;case"xlinkType":wi(q,"http://www.w3.org/1999/xlink","xlink:type",Y);break;case"xmlBase":wi(q,"http://www.w3.org/XML/1998/namespace","xml:base",Y);break;case"xmlLang":wi(q,"http://www.w3.org/XML/1998/namespace","xml:lang",Y);break;case"xmlSpace":wi(q,"http://www.w3.org/XML/1998/namespace","xml:space",Y);break;case"is":ya(q,"is",Y);break;case"innerText":case"textContent":break;default:(!(2<K.length)||K[0]!=="o"&&K[0]!=="O"||K[1]!=="n"&&K[1]!=="N")&&(K=Ff.get(K)||K,ya(q,K,Y))}}function Ac(q,F,K,Y,Z,te){switch(K){case"style":sl(q,Y,te);break;case"dangerouslySetInnerHTML":if(Y!=null){if(typeof Y!="object"||!("__html"in Y))throw Error(B(61));if(K=Y.__html,K!=null){if(Z.children!=null)throw Error(B(60));q.innerHTML=K}}break;case"children":typeof Y=="string"?qn(q,Y):(typeof Y=="number"||typeof Y=="bigint")&&qn(q,""+Y);break;case"onScroll":Y!=null&&ot("scroll",q);break;case"onScrollEnd":Y!=null&&ot("scrollend",q);break;case"onClick":Y!=null&&(q.onclick=ps);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Yc.hasOwnProperty(K))e:{if(K[0]==="o"&&K[1]==="n"&&(Z=K.endsWith("Capture"),F=K.slice(2,Z?K.length-7:void 0),te=q[Wt]||null,te=te!=null?te[K]:null,typeof te=="function"&&q.removeEventListener(F,te,Z),typeof Y=="function")){typeof te!="function"&&te!==null&&(K in q?q[K]=null:q.hasAttribute(K)&&q.removeAttribute(K)),q.addEventListener(F,Y,Z);break e}K in q?q[K]=Y:Y===!0?q.setAttribute(K,""):ya(q,K,Y)}}}function Ht(q,F,K){switch(F){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ot("error",q),ot("load",q);var Y=!1,Z=!1,te;for(te in K)if(K.hasOwnProperty(te)){var ae=K[te];if(ae!=null)switch(te){case"src":Y=!0;break;case"srcSet":Z=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(B(137,F));default:gt(q,F,te,ae,K,null)}}Z&&gt(q,F,"srcSet",K.srcSet,K,null),Y&&gt(q,F,"src",K.src,K,null);return;case"input":ot("invalid",q);var ce=te=ae=Z=null,me=null,Se=null;for(Y in K)if(K.hasOwnProperty(Y)){var Oe=K[Y];if(Oe!=null)switch(Y){case"name":Z=Oe;break;case"type":ae=Oe;break;case"checked":me=Oe;break;case"defaultChecked":Se=Oe;break;case"value":te=Oe;break;case"defaultValue":ce=Oe;break;case"children":case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(B(137,F));break;default:gt(q,F,Y,Oe,K,null)}}il(q,te,ce,me,Se,ae,Z,!1),Ta(q);return;case"select":ot("invalid",q),Y=ae=te=null;for(Z in K)if(K.hasOwnProperty(Z)&&(ce=K[Z],ce!=null))switch(Z){case"value":te=ce;break;case"defaultValue":ae=ce;break;case"multiple":Y=ce;default:gt(q,F,Z,ce,K,null)}F=te,K=ae,q.multiple=!!Y,F!=null?Bn(q,!!Y,F,!1):K!=null&&Bn(q,!!Y,K,!0);return;case"textarea":ot("invalid",q),te=Z=Y=null;for(ae in K)if(K.hasOwnProperty(ae)&&(ce=K[ae],ce!=null))switch(ae){case"value":Y=ce;break;case"defaultValue":Z=ce;break;case"children":te=ce;break;case"dangerouslySetInnerHTML":if(ce!=null)throw Error(B(91));break;default:gt(q,F,ae,ce,K,null)}rl(q,Y,Z,te),Ta(q);return;case"option":for(me in K)if(K.hasOwnProperty(me)&&(Y=K[me],Y!=null))switch(me){case"selected":q.selected=Y&&typeof Y!="function"&&typeof Y!="symbol";break;default:gt(q,F,me,Y,K,null)}return;case"dialog":ot("beforetoggle",q),ot("toggle",q),ot("cancel",q),ot("close",q);break;case"iframe":case"object":ot("load",q);break;case"video":case"audio":for(Y=0;Y<aa.length;Y++)ot(aa[Y],q);break;case"image":ot("error",q),ot("load",q);break;case"details":ot("toggle",q);break;case"embed":case"source":case"link":ot("error",q),ot("load",q);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Se in K)if(K.hasOwnProperty(Se)&&(Y=K[Se],Y!=null))switch(Se){case"children":case"dangerouslySetInnerHTML":throw Error(B(137,F));default:gt(q,F,Se,Y,K,null)}return;default:if(Hs(F)){for(Oe in K)K.hasOwnProperty(Oe)&&(Y=K[Oe],Y!==void 0&&Ac(q,F,Oe,Y,K,void 0));return}}for(ce in K)K.hasOwnProperty(ce)&&(Y=K[ce],Y!=null&&gt(q,F,ce,Y,K,null))}function pp(q,F,K,Y){switch(F){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var Z=null,te=null,ae=null,ce=null,me=null,Se=null,Oe=null;for(Ee in K){var Ie=K[Ee];if(K.hasOwnProperty(Ee)&&Ie!=null)switch(Ee){case"checked":break;case"value":break;case"defaultValue":me=Ie;default:Y.hasOwnProperty(Ee)||gt(q,F,Ee,null,Y,Ie)}}for(var ke in Y){var Ee=Y[ke];if(Ie=K[ke],Y.hasOwnProperty(ke)&&(Ee!=null||Ie!=null))switch(ke){case"type":te=Ee;break;case"name":Z=Ee;break;case"checked":Se=Ee;break;case"defaultChecked":Oe=Ee;break;case"value":ae=Ee;break;case"defaultValue":ce=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(B(137,F));break;default:Ee!==Ie&&gt(q,F,ke,Ee,Y,Ie)}}Fs(q,ae,ce,me,Se,Oe,te,Z);return;case"select":Ee=ae=ce=ke=null;for(te in K)if(me=K[te],K.hasOwnProperty(te)&&me!=null)switch(te){case"value":break;case"multiple":Ee=me;default:Y.hasOwnProperty(te)||gt(q,F,te,null,Y,me)}for(Z in Y)if(te=Y[Z],me=K[Z],Y.hasOwnProperty(Z)&&(te!=null||me!=null))switch(Z){case"value":ke=te;break;case"defaultValue":ce=te;break;case"multiple":ae=te;default:te!==me&&gt(q,F,Z,te,Y,me)}F=ce,K=ae,Y=Ee,ke!=null?Bn(q,!!K,ke,!1):!!Y!=!!K&&(F!=null?Bn(q,!!K,F,!0):Bn(q,!!K,K?[]:"",!1));return;case"textarea":Ee=ke=null;for(ce in K)if(Z=K[ce],K.hasOwnProperty(ce)&&Z!=null&&!Y.hasOwnProperty(ce))switch(ce){case"value":break;case"children":break;default:gt(q,F,ce,null,Y,Z)}for(ae in Y)if(Z=Y[ae],te=K[ae],Y.hasOwnProperty(ae)&&(Z!=null||te!=null))switch(ae){case"value":ke=Z;break;case"defaultValue":Ee=Z;break;case"children":break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(B(91));break;default:Z!==te&&gt(q,F,ae,Z,Y,te)}nl(q,ke,Ee);return;case"option":for(var it in K)if(ke=K[it],K.hasOwnProperty(it)&&ke!=null&&!Y.hasOwnProperty(it))switch(it){case"selected":q.selected=!1;break;default:gt(q,F,it,null,Y,ke)}for(me in Y)if(ke=Y[me],Ee=K[me],Y.hasOwnProperty(me)&&ke!==Ee&&(ke!=null||Ee!=null))switch(me){case"selected":q.selected=ke&&typeof ke!="function"&&typeof ke!="symbol";break;default:gt(q,F,me,ke,Y,Ee)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ze in K)ke=K[Ze],K.hasOwnProperty(Ze)&&ke!=null&&!Y.hasOwnProperty(Ze)&&gt(q,F,Ze,null,Y,ke);for(Se in Y)if(ke=Y[Se],Ee=K[Se],Y.hasOwnProperty(Se)&&ke!==Ee&&(ke!=null||Ee!=null))switch(Se){case"children":case"dangerouslySetInnerHTML":if(ke!=null)throw Error(B(137,F));break;default:gt(q,F,Se,ke,Y,Ee)}return;default:if(Hs(F)){for(var vt in K)ke=K[vt],K.hasOwnProperty(vt)&&ke!==void 0&&!Y.hasOwnProperty(vt)&&Ac(q,F,vt,void 0,Y,ke);for(Oe in Y)ke=Y[Oe],Ee=K[Oe],!Y.hasOwnProperty(Oe)||ke===Ee||ke===void 0&&Ee===void 0||Ac(q,F,Oe,ke,Y,Ee);return}}for(var ye in K)ke=K[ye],K.hasOwnProperty(ye)&&ke!=null&&!Y.hasOwnProperty(ye)&&gt(q,F,ye,null,Y,ke);for(Ie in Y)ke=Y[Ie],Ee=K[Ie],!Y.hasOwnProperty(Ie)||ke===Ee||ke==null&&Ee==null||gt(q,F,Ie,ke,Y,Ee)}var Pc=null,Dc=null;function ms(q){return q.nodeType===9?q:q.ownerDocument}function of(q){switch(q){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function cf(q,F){if(q===0)switch(F){case"svg":return 1;case"math":return 2;default:return 0}return q===1&&F==="foreignObject"?0:q}function Oc(q,F){return q==="textarea"||q==="noscript"||typeof F.children=="string"||typeof F.children=="number"||typeof F.children=="bigint"||typeof F.dangerouslySetInnerHTML=="object"&&F.dangerouslySetInnerHTML!==null&&F.dangerouslySetInnerHTML.__html!=null}var Mc=null;function mp(){var q=window.event;return q&&q.type==="popstate"?q===Mc?!1:(Mc=q,!0):(Mc=null,!1)}var lf=typeof setTimeout=="function"?setTimeout:void 0,gp=typeof clearTimeout=="function"?clearTimeout:void 0,uf=typeof Promise=="function"?Promise:void 0,vp=typeof queueMicrotask=="function"?queueMicrotask:typeof uf<"u"?function(q){return uf.resolve(null).then(q).catch(yp)}:lf;function yp(q){setTimeout(function(){throw q})}function cn(q){return q==="head"}function df(q,F){var K=F,Y=0,Z=0;do{var te=K.nextSibling;if(q.removeChild(K),te&&te.nodeType===8)if(K=te.data,K==="/$"){if(0<Y&&8>Y){K=Y;var ae=q.ownerDocument;if(K&1&&oa(ae.documentElement),K&2&&oa(ae.body),K&4)for(K=ae.head,oa(K),ae=K.firstChild;ae;){var ce=ae.nextSibling,me=ae.nodeName;ae[Cr]||me==="SCRIPT"||me==="STYLE"||me==="LINK"&&ae.rel.toLowerCase()==="stylesheet"||K.removeChild(ae),ae=ce}}if(Z===0){q.removeChild(te),ma(F);return}Z--}else K==="$"||K==="$?"||K==="$!"?Z++:Y=K.charCodeAt(0)-48;else Y=0;K=te}while(K);ma(F)}function Lc(q){var F=q.firstChild;for(F&&F.nodeType===10&&(F=F.nextSibling);F;){var K=F;switch(F=F.nextSibling,K.nodeName){case"HTML":case"HEAD":case"BODY":Lc(K),Vs(K);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(K.rel.toLowerCase()==="stylesheet")continue}q.removeChild(K)}}function bp(q,F,K,Y){for(;q.nodeType===1;){var Z=K;if(q.nodeName.toLowerCase()!==F.toLowerCase()){if(!Y&&(q.nodeName!=="INPUT"||q.type!=="hidden"))break}else if(Y){if(!q[Cr])switch(F){case"meta":if(!q.hasAttribute("itemprop"))break;return q;case"link":if(te=q.getAttribute("rel"),te==="stylesheet"&&q.hasAttribute("data-precedence"))break;if(te!==Z.rel||q.getAttribute("href")!==(Z.href==null||Z.href===""?null:Z.href)||q.getAttribute("crossorigin")!==(Z.crossOrigin==null?null:Z.crossOrigin)||q.getAttribute("title")!==(Z.title==null?null:Z.title))break;return q;case"style":if(q.hasAttribute("data-precedence"))break;return q;case"script":if(te=q.getAttribute("src"),(te!==(Z.src==null?null:Z.src)||q.getAttribute("type")!==(Z.type==null?null:Z.type)||q.getAttribute("crossorigin")!==(Z.crossOrigin==null?null:Z.crossOrigin))&&te&&q.hasAttribute("async")&&!q.hasAttribute("itemprop"))break;return q;default:return q}}else if(F==="input"&&q.type==="hidden"){var te=Z.name==null?null:""+Z.name;if(Z.type==="hidden"&&q.getAttribute("name")===te)return q}else return q;if(q=Si(q.nextSibling),q===null)break}return null}function Tp(q,F,K){if(F==="")return null;for(;q.nodeType!==3;)if((q.nodeType!==1||q.nodeName!=="INPUT"||q.type!=="hidden")&&!K||(q=Si(q.nextSibling),q===null))return null;return q}function Nc(q){return q.data==="$!"||q.data==="$?"&&q.ownerDocument.readyState==="complete"}function Sp(q,F){var K=q.ownerDocument;if(q.data!=="$?"||K.readyState==="complete")F();else{var Y=function(){F(),K.removeEventListener("DOMContentLoaded",Y)};K.addEventListener("DOMContentLoaded",Y),q._reactRetry=Y}}function Si(q){for(;q!=null;q=q.nextSibling){var F=q.nodeType;if(F===1||F===3)break;if(F===8){if(F=q.data,F==="$"||F==="$!"||F==="$?"||F==="F!"||F==="F")break;if(F==="/$")return null}}return q}var Ic=null;function ff(q){q=q.previousSibling;for(var F=0;q;){if(q.nodeType===8){var K=q.data;if(K==="$"||K==="$!"||K==="$?"){if(F===0)return q;F--}else K==="/$"&&F++}q=q.previousSibling}return null}function hf(q,F,K){switch(F=ms(K),q){case"html":if(q=F.documentElement,!q)throw Error(B(452));return q;case"head":if(q=F.head,!q)throw Error(B(453));return q;case"body":if(q=F.body,!q)throw Error(B(454));return q;default:throw Error(B(451))}}function oa(q){for(var F=q.attributes;F.length;)q.removeAttributeNode(F[0]);Vs(q)}var yi=new Map,pf=new Set;function gs(q){return typeof q.getRootNode=="function"?q.getRootNode():q.nodeType===9?q:q.ownerDocument}var Fi=Re.d;Re.d={f:Cp,r:kp,D:Ep,C:_p,L:xp,m:Rp,X:Ap,S:wp,M:Pp};function Cp(){var q=Fi.f(),F=os();return q||F}function kp(q){var F=In(q);F!==null&&F.tag===5&&F.type==="form"?Ou(F):Fi.r(q)}var gr=typeof document>"u"?null:document;function mf(q,F,K){var Y=gr;if(Y&&typeof F=="string"&&F){var Z=di(F);Z='link[rel="'+q+'"][href="'+Z+'"]',typeof K=="string"&&(Z+='[crossorigin="'+K+'"]'),pf.has(Z)||(pf.add(Z),q={rel:q,crossOrigin:K,href:F},Y.querySelector(Z)===null&&(F=Y.createElement("link"),Ht(F,"link",q),Ut(F),Y.head.appendChild(F)))}}function Ep(q){Fi.D(q),mf("dns-prefetch",q,null)}function _p(q,F){Fi.C(q,F),mf("preconnect",q,F)}function xp(q,F,K){Fi.L(q,F,K);var Y=gr;if(Y&&q&&F){var Z='link[rel="preload"][as="'+di(F)+'"]';F==="image"&&K&&K.imageSrcSet?(Z+='[imagesrcset="'+di(K.imageSrcSet)+'"]',typeof K.imageSizes=="string"&&(Z+='[imagesizes="'+di(K.imageSizes)+'"]')):Z+='[href="'+di(q)+'"]';var te=Z;switch(F){case"style":te=vr(q);break;case"script":te=yr(q)}yi.has(te)||(q=X({rel:"preload",href:F==="image"&&K&&K.imageSrcSet?void 0:q,as:F},K),yi.set(te,q),Y.querySelector(Z)!==null||F==="style"&&Y.querySelector(ca(te))||F==="script"&&Y.querySelector(la(te))||(F=Y.createElement("link"),Ht(F,"link",q),Ut(F),Y.head.appendChild(F)))}}function Rp(q,F){Fi.m(q,F);var K=gr;if(K&&q){var Y=F&&typeof F.as=="string"?F.as:"script",Z='link[rel="modulepreload"][as="'+di(Y)+'"][href="'+di(q)+'"]',te=Z;switch(Y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":te=yr(q)}if(!yi.has(te)&&(q=X({rel:"modulepreload",href:q},F),yi.set(te,q),K.querySelector(Z)===null)){switch(Y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(K.querySelector(la(te)))return}Y=K.createElement("link"),Ht(Y,"link",q),Ut(Y),K.head.appendChild(Y)}}}function wp(q,F,K){Fi.S(q,F,K);var Y=gr;if(Y&&q){var Z=Un(Y).hoistableStyles,te=vr(q);F=F||"default";var ae=Z.get(te);if(!ae){var ce={loading:0,preload:null};if(ae=Y.querySelector(ca(te)))ce.loading=5;else{q=X({rel:"stylesheet",href:q,"data-precedence":F},K),(K=yi.get(te))&&Uc(q,K);var me=ae=Y.createElement("link");Ut(me),Ht(me,"link",q),me._p=new Promise(function(Se,Oe){me.onload=Se,me.onerror=Oe}),me.addEventListener("load",function(){ce.loading|=1}),me.addEventListener("error",function(){ce.loading|=2}),ce.loading|=4,vs(ae,F,Y)}ae={type:"stylesheet",instance:ae,count:1,state:ce},Z.set(te,ae)}}}function Ap(q,F){Fi.X(q,F);var K=gr;if(K&&q){var Y=Un(K).hoistableScripts,Z=yr(q),te=Y.get(Z);te||(te=K.querySelector(la(Z)),te||(q=X({src:q,async:!0},F),(F=yi.get(Z))&&Vc(q,F),te=K.createElement("script"),Ut(te),Ht(te,"link",q),K.head.appendChild(te)),te={type:"script",instance:te,count:1,state:null},Y.set(Z,te))}}function Pp(q,F){Fi.M(q,F);var K=gr;if(K&&q){var Y=Un(K).hoistableScripts,Z=yr(q),te=Y.get(Z);te||(te=K.querySelector(la(Z)),te||(q=X({src:q,async:!0,type:"module"},F),(F=yi.get(Z))&&Vc(q,F),te=K.createElement("script"),Ut(te),Ht(te,"link",q),K.head.appendChild(te)),te={type:"script",instance:te,count:1,state:null},Y.set(Z,te))}}function gf(q,F,K,Y){var Z=(Z=De.current)?gs(Z):null;if(!Z)throw Error(B(446));switch(q){case"meta":case"title":return null;case"style":return typeof K.precedence=="string"&&typeof K.href=="string"?(F=vr(K.href),K=Un(Z).hoistableStyles,Y=K.get(F),Y||(Y={type:"style",instance:null,count:0,state:null},K.set(F,Y)),Y):{type:"void",instance:null,count:0,state:null};case"link":if(K.rel==="stylesheet"&&typeof K.href=="string"&&typeof K.precedence=="string"){q=vr(K.href);var te=Un(Z).hoistableStyles,ae=te.get(q);if(ae||(Z=Z.ownerDocument||Z,ae={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},te.set(q,ae),(te=Z.querySelector(ca(q)))&&!te._p&&(ae.instance=te,ae.state.loading=5),yi.has(q)||(K={rel:"preload",as:"style",href:K.href,crossOrigin:K.crossOrigin,integrity:K.integrity,media:K.media,hrefLang:K.hrefLang,referrerPolicy:K.referrerPolicy},yi.set(q,K),te||Dp(Z,q,K,ae.state))),F&&Y===null)throw Error(B(528,""));return ae}if(F&&Y!==null)throw Error(B(529,""));return null;case"script":return F=K.async,K=K.src,typeof K=="string"&&F&&typeof F!="function"&&typeof F!="symbol"?(F=yr(K),K=Un(Z).hoistableScripts,Y=K.get(F),Y||(Y={type:"script",instance:null,count:0,state:null},K.set(F,Y)),Y):{type:"void",instance:null,count:0,state:null};default:throw Error(B(444,q))}}function vr(q){return'href="'+di(q)+'"'}function ca(q){return'link[rel="stylesheet"]['+q+"]"}function vf(q){return X({},q,{"data-precedence":q.precedence,precedence:null})}function Dp(q,F,K,Y){q.querySelector('link[rel="preload"][as="style"]['+F+"]")?Y.loading=1:(F=q.createElement("link"),Y.preload=F,F.addEventListener("load",function(){return Y.loading|=1}),F.addEventListener("error",function(){return Y.loading|=2}),Ht(F,"link",K),Ut(F),q.head.appendChild(F))}function yr(q){return'[src="'+di(q)+'"]'}function la(q){return"script[async]"+q}function yf(q,F,K){if(F.count++,F.instance===null)switch(F.type){case"style":var Y=q.querySelector('style[data-href~="'+di(K.href)+'"]');if(Y)return F.instance=Y,Ut(Y),Y;var Z=X({},K,{"data-href":K.href,"data-precedence":K.precedence,href:null,precedence:null});return Y=(q.ownerDocument||q).createElement("style"),Ut(Y),Ht(Y,"style",Z),vs(Y,K.precedence,q),F.instance=Y;case"stylesheet":Z=vr(K.href);var te=q.querySelector(ca(Z));if(te)return F.state.loading|=4,F.instance=te,Ut(te),te;Y=vf(K),(Z=yi.get(Z))&&Uc(Y,Z),te=(q.ownerDocument||q).createElement("link"),Ut(te);var ae=te;return ae._p=new Promise(function(ce,me){ae.onload=ce,ae.onerror=me}),Ht(te,"link",Y),F.state.loading|=4,vs(te,K.precedence,q),F.instance=te;case"script":return te=yr(K.src),(Z=q.querySelector(la(te)))?(F.instance=Z,Ut(Z),Z):(Y=K,(Z=yi.get(te))&&(Y=X({},K),Vc(Y,Z)),q=q.ownerDocument||q,Z=q.createElement("script"),Ut(Z),Ht(Z,"link",Y),q.head.appendChild(Z),F.instance=Z);case"void":return null;default:throw Error(B(443,F.type))}else F.type==="stylesheet"&&(F.state.loading&4)===0&&(Y=F.instance,F.state.loading|=4,vs(Y,K.precedence,q));return F.instance}function vs(q,F,K){for(var Y=K.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),Z=Y.length?Y[Y.length-1]:null,te=Z,ae=0;ae<Y.length;ae++){var ce=Y[ae];if(ce.dataset.precedence===F)te=ce;else if(te!==Z)break}te?te.parentNode.insertBefore(q,te.nextSibling):(F=K.nodeType===9?K.head:K,F.insertBefore(q,F.firstChild))}function Uc(q,F){q.crossOrigin==null&&(q.crossOrigin=F.crossOrigin),q.referrerPolicy==null&&(q.referrerPolicy=F.referrerPolicy),q.title==null&&(q.title=F.title)}function Vc(q,F){q.crossOrigin==null&&(q.crossOrigin=F.crossOrigin),q.referrerPolicy==null&&(q.referrerPolicy=F.referrerPolicy),q.integrity==null&&(q.integrity=F.integrity)}var ys=null;function bf(q,F,K){if(ys===null){var Y=new Map,Z=ys=new Map;Z.set(K,Y)}else Z=ys,Y=Z.get(K),Y||(Y=new Map,Z.set(K,Y));if(Y.has(q))return Y;for(Y.set(q,null),K=K.getElementsByTagName(q),Z=0;Z<K.length;Z++){var te=K[Z];if(!(te[Cr]||te[Gt]||q==="link"&&te.getAttribute("rel")==="stylesheet")&&te.namespaceURI!=="http://www.w3.org/2000/svg"){var ae=te.getAttribute(F)||"";ae=q+ae;var ce=Y.get(ae);ce?ce.push(te):Y.set(ae,[te])}}return Y}function Tf(q,F,K){q=q.ownerDocument||q,q.head.insertBefore(K,F==="title"?q.querySelector("head > title"):null)}function Op(q,F,K){if(K===1||F.itemProp!=null)return!1;switch(q){case"meta":case"title":return!0;case"style":if(typeof F.precedence!="string"||typeof F.href!="string"||F.href==="")break;return!0;case"link":if(typeof F.rel!="string"||typeof F.href!="string"||F.href===""||F.onLoad||F.onError)break;switch(F.rel){case"stylesheet":return q=F.disabled,typeof F.precedence=="string"&&q==null;default:return!0}case"script":if(F.async&&typeof F.async!="function"&&typeof F.async!="symbol"&&!F.onLoad&&!F.onError&&F.src&&typeof F.src=="string")return!0}return!1}function Sf(q){return!(q.type==="stylesheet"&&(q.state.loading&3)===0)}var ua=null;function Mp(){}function Lp(q,F,K){if(ua===null)throw Error(B(475));var Y=ua;if(F.type==="stylesheet"&&(typeof K.media!="string"||matchMedia(K.media).matches!==!1)&&(F.state.loading&4)===0){if(F.instance===null){var Z=vr(K.href),te=q.querySelector(ca(Z));if(te){q=te._p,q!==null&&typeof q=="object"&&typeof q.then=="function"&&(Y.count++,Y=bs.bind(Y),q.then(Y,Y)),F.state.loading|=4,F.instance=te,Ut(te);return}te=q.ownerDocument||q,K=vf(K),(Z=yi.get(Z))&&Uc(K,Z),te=te.createElement("link"),Ut(te);var ae=te;ae._p=new Promise(function(ce,me){ae.onload=ce,ae.onerror=me}),Ht(te,"link",K),F.instance=te}Y.stylesheets===null&&(Y.stylesheets=new Map),Y.stylesheets.set(F,q),(q=F.state.preload)&&(F.state.loading&3)===0&&(Y.count++,F=bs.bind(Y),q.addEventListener("load",F),q.addEventListener("error",F))}}function Np(){if(ua===null)throw Error(B(475));var q=ua;return q.stylesheets&&q.count===0&&jc(q,q.stylesheets),0<q.count?function(F){var K=setTimeout(function(){if(q.stylesheets&&jc(q,q.stylesheets),q.unsuspend){var Y=q.unsuspend;q.unsuspend=null,Y()}},6e4);return q.unsuspend=F,function(){q.unsuspend=null,clearTimeout(K)}}:null}function bs(){if(this.count--,this.count===0){if(this.stylesheets)jc(this,this.stylesheets);else if(this.unsuspend){var q=this.unsuspend;this.unsuspend=null,q()}}}var Ts=null;function jc(q,F){q.stylesheets=null,q.unsuspend!==null&&(q.count++,Ts=new Map,F.forEach(Ip,q),Ts=null,bs.call(q))}function Ip(q,F){if(!(F.state.loading&4)){var K=Ts.get(q);if(K)var Y=K.get(null);else{K=new Map,Ts.set(q,K);for(var Z=q.querySelectorAll("link[data-precedence],style[data-precedence]"),te=0;te<Z.length;te++){var ae=Z[te];(ae.nodeName==="LINK"||ae.getAttribute("media")!=="not all")&&(K.set(ae.dataset.precedence,ae),Y=ae)}Y&&K.set(null,Y)}Z=F.instance,ae=Z.getAttribute("data-precedence"),te=K.get(ae)||Y,te===Y&&K.set(null,Z),K.set(ae,Z),this.count++,Y=bs.bind(this),Z.addEventListener("load",Y),Z.addEventListener("error",Y),te?te.parentNode.insertBefore(Z,te.nextSibling):(q=q.nodeType===9?q.head:q,q.insertBefore(Z,q.firstChild)),F.state.loading|=4}}var da={$$typeof:ue,Provider:null,Consumer:null,_currentValue:Be,_currentValue2:Be,_threadCount:0};function Up(q,F,K,Y,Z,te,ae,ce){this.tag=1,this.containerInfo=q,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Dt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dt(0),this.hiddenUpdates=Dt(null),this.identifierPrefix=Y,this.onUncaughtError=Z,this.onCaughtError=te,this.onRecoverableError=ae,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ce,this.incompleteTransitions=new Map}function Cf(q,F,K,Y,Z,te,ae,ce,me,Se,Oe,Ie){return q=new Up(q,F,K,ae,ce,me,Se,Ie),F=1,te===!0&&(F|=24),te=ri(3,null,null,F),q.current=te,te.stateNode=q,F=To(),F.refCount++,q.pooledCache=F,F.refCount++,te.memoizedState={element:Y,isDehydrated:K,cache:F},Eo(te),q}function kf(q){return q?(q=Yn,q):Yn}function Ef(q,F,K,Y,Z,te){Z=kf(Z),Y.context===null?Y.context=Z:Y.pendingContext=Z,Y=Qi(F),Y.payload={element:K},te=te===void 0?null:te,te!==null&&(Y.callback=te),K=Yi(q,Y,F),K!==null&&(li(K,q,F),qr(K,q,F))}function _f(q,F){if(q=q.memoizedState,q!==null&&q.dehydrated!==null){var K=q.retryLane;q.retryLane=K!==0&&K<F?K:F}}function Bc(q,F){_f(q,F),(q=q.alternate)&&_f(q,F)}function xf(q){if(q.tag===13){var F=Qn(q,67108864);F!==null&&li(F,q,67108864),Bc(q,67108864)}}var Ss=!0;function Vp(q,F,K,Y){var Z=be.T;be.T=null;var te=Re.p;try{Re.p=2,qc(q,F,K,Y)}finally{Re.p=te,be.T=Z}}function jp(q,F,K,Y){var Z=be.T;be.T=null;var te=Re.p;try{Re.p=8,qc(q,F,K,Y)}finally{Re.p=te,be.T=Z}}function qc(q,F,K,Y){if(Ss){var Z=Fc(Y);if(Z===null)wc(q,F,Y,Cs,K),wf(q,Y);else if(qp(Z,q,F,K,Y))Y.stopPropagation();else if(wf(q,Y),F&4&&-1<Bp.indexOf(q)){for(;Z!==null;){var te=In(Z);if(te!==null)switch(te.tag){case 3:if(te=te.stateNode,te.current.memoizedState.isDehydrated){var ae=Me(te.pendingLanes);if(ae!==0){var ce=te;for(ce.pendingLanes|=2,ce.entangledLanes|=2;ae;){var me=1<<31-It(ae);ce.entanglements[1]|=me,ae&=~me}Ri(te),(ht&6)===0&&(as=Et()+500,ra(0))}}break;case 13:ce=Qn(te,2),ce!==null&&li(ce,te,2),os(),Bc(te,2)}if(te=Fc(Y),te===null&&wc(q,F,Y,Cs,K),te===Z)break;Z=te}Z!==null&&Y.stopPropagation()}else wc(q,F,Y,null,K)}}function Fc(q){return q=Ks(q),zc(q)}var Cs=null;function zc(q){if(Cs=null,q=Nn(q),q!==null){var F=H(q);if(F===null)q=null;else{var K=F.tag;if(K===13){if(q=G(F),q!==null)return q;q=null}else if(K===3){if(F.stateNode.current.memoizedState.isDehydrated)return F.tag===3?F.stateNode.containerInfo:null;q=null}else F!==q&&(q=null)}}return Cs=q,null}function Rf(q){switch(q){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ga()){case Qt:return 2;case va:return 8;case Dn:case As:return 32;case Sr:return 268435456;default:return 32}default:return 32}}var Hc=!1,ln=null,un=null,dn=null,fa=new Map,ha=new Map,fn=[],Bp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function wf(q,F){switch(q){case"focusin":case"focusout":ln=null;break;case"dragenter":case"dragleave":un=null;break;case"mouseover":case"mouseout":dn=null;break;case"pointerover":case"pointerout":fa.delete(F.pointerId);break;case"gotpointercapture":case"lostpointercapture":ha.delete(F.pointerId)}}function pa(q,F,K,Y,Z,te){return q===null||q.nativeEvent!==te?(q={blockedOn:F,domEventName:K,eventSystemFlags:Y,nativeEvent:te,targetContainers:[Z]},F!==null&&(F=In(F),F!==null&&xf(F)),q):(q.eventSystemFlags|=Y,F=q.targetContainers,Z!==null&&F.indexOf(Z)===-1&&F.push(Z),q)}function qp(q,F,K,Y,Z){switch(F){case"focusin":return ln=pa(ln,q,F,K,Y,Z),!0;case"dragenter":return un=pa(un,q,F,K,Y,Z),!0;case"mouseover":return dn=pa(dn,q,F,K,Y,Z),!0;case"pointerover":var te=Z.pointerId;return fa.set(te,pa(fa.get(te)||null,q,F,K,Y,Z)),!0;case"gotpointercapture":return te=Z.pointerId,ha.set(te,pa(ha.get(te)||null,q,F,K,Y,Z)),!0}return!1}function Af(q){var F=Nn(q.target);if(F!==null){var K=H(F);if(K!==null){if(F=K.tag,F===13){if(F=G(K),F!==null){q.blockedOn=F,Mf(q.priority,function(){if(K.tag===13){var Y=ci();Y=Ns(Y);var Z=Qn(K,Y);Z!==null&&li(Z,K,Y),Bc(K,Y)}});return}}else if(F===3&&K.stateNode.current.memoizedState.isDehydrated){q.blockedOn=K.tag===3?K.stateNode.containerInfo:null;return}}}q.blockedOn=null}function ks(q){if(q.blockedOn!==null)return!1;for(var F=q.targetContainers;0<F.length;){var K=Fc(q.nativeEvent);if(K===null){K=q.nativeEvent;var Y=new K.constructor(K.type,K);Gs=Y,K.target.dispatchEvent(Y),Gs=null}else return F=In(K),F!==null&&xf(F),q.blockedOn=K,!1;F.shift()}return!0}function Pf(q,F,K){ks(q)&&K.delete(F)}function Fp(){Hc=!1,ln!==null&&ks(ln)&&(ln=null),un!==null&&ks(un)&&(un=null),dn!==null&&ks(dn)&&(dn=null),fa.forEach(Pf),ha.forEach(Pf)}function Es(q,F){q.blockedOn===F&&(q.blockedOn=null,Hc||(Hc=!0,V.unstable_scheduleCallback(V.unstable_NormalPriority,Fp)))}var _s=null;function Df(q){_s!==q&&(_s=q,V.unstable_scheduleCallback(V.unstable_NormalPriority,function(){_s===q&&(_s=null);for(var F=0;F<q.length;F+=3){var K=q[F],Y=q[F+1],Z=q[F+2];if(typeof Y!="function"){if(zc(Y||K)===null)continue;break}var te=In(K);te!==null&&(q.splice(F,3),F-=3,zo(te,{pending:!0,data:Z,method:K.method,action:Y},Y,Z))}}))}function ma(q){function F(me){return Es(me,q)}ln!==null&&Es(ln,q),un!==null&&Es(un,q),dn!==null&&Es(dn,q),fa.forEach(F),ha.forEach(F);for(var K=0;K<fn.length;K++){var Y=fn[K];Y.blockedOn===q&&(Y.blockedOn=null)}for(;0<fn.length&&(K=fn[0],K.blockedOn===null);)Af(K),K.blockedOn===null&&fn.shift();if(K=(q.ownerDocument||q).$$reactFormReplay,K!=null)for(Y=0;Y<K.length;Y+=3){var Z=K[Y],te=K[Y+1],ae=Z[Wt]||null;if(typeof te=="function")ae||Df(K);else if(ae){var ce=null;if(te&&te.hasAttribute("formAction")){if(Z=te,ae=te[Wt]||null)ce=ae.formAction;else if(zc(Z)!==null)continue}else ce=ae.action;typeof ce=="function"?K[Y+1]=ce:(K.splice(Y,3),Y-=3),Df(K)}}}function Gc(q){this._internalRoot=q}xs.prototype.render=Gc.prototype.render=function(q){var F=this._internalRoot;if(F===null)throw Error(B(409));var K=F.current,Y=ci();Ef(K,Y,q,F,null,null)},xs.prototype.unmount=Gc.prototype.unmount=function(){var q=this._internalRoot;if(q!==null){this._internalRoot=null;var F=q.containerInfo;Ef(q.current,2,null,q,null,null),os(),F[Ln]=null}};function xs(q){this._internalRoot=q}xs.prototype.unstable_scheduleHydration=function(q){if(q){var F=Kc();q={blockedOn:null,target:q,priority:F};for(var K=0;K<fn.length&&F!==0&&F<fn[K].priority;K++);fn.splice(K,0,q),K===0&&Af(q)}};var Of=U.version;if(Of!=="19.1.0")throw Error(B(527,Of,"19.1.0"));Re.findDOMNode=function(q){var F=q._reactInternals;if(F===void 0)throw typeof q.render=="function"?Error(B(188)):(q=Object.keys(q).join(","),Error(B(268,q)));return q=Q(F),q=q!==null?W(q):null,q=q===null?null:q.stateNode,q};var zp={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:be,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Rs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Rs.isDisabled&&Rs.supportsFiber)try{zi=Rs.inject(zp),qt=Rs}catch{}}return reactDomClient_production.createRoot=function(q,F){if(!z(q))throw Error(B(299));var K=!1,Y="",Z=Ku,te=$u,ae=Qu,ce=null;return F!=null&&(F.unstable_strictMode===!0&&(K=!0),F.identifierPrefix!==void 0&&(Y=F.identifierPrefix),F.onUncaughtError!==void 0&&(Z=F.onUncaughtError),F.onCaughtError!==void 0&&(te=F.onCaughtError),F.onRecoverableError!==void 0&&(ae=F.onRecoverableError),F.unstable_transitionCallbacks!==void 0&&(ce=F.unstable_transitionCallbacks)),F=Cf(q,1,!1,null,null,K,Y,Z,te,ae,ce,null),q[Ln]=F.current,Rc(q),new Gc(F)},reactDomClient_production.hydrateRoot=function(q,F,K){if(!z(q))throw Error(B(299));var Y=!1,Z="",te=Ku,ae=$u,ce=Qu,me=null,Se=null;return K!=null&&(K.unstable_strictMode===!0&&(Y=!0),K.identifierPrefix!==void 0&&(Z=K.identifierPrefix),K.onUncaughtError!==void 0&&(te=K.onUncaughtError),K.onCaughtError!==void 0&&(ae=K.onCaughtError),K.onRecoverableError!==void 0&&(ce=K.onRecoverableError),K.unstable_transitionCallbacks!==void 0&&(me=K.unstable_transitionCallbacks),K.formState!==void 0&&(Se=K.formState)),F=Cf(q,1,!0,F,K??null,Y,Z,te,ae,ce,me,Se),F.context=kf(null),K=F.current,Y=ci(),Y=Ns(Y),Z=Qi(Y),Z.callback=null,Yi(K,Z,Y),K=Y,F.current.lanes=K,wt(F,K),Ri(F),q[Ln]=F.current,Rc(q),new xs(F)},reactDomClient_production.version="19.1.0",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function V(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(V)}catch(U){console.error(U)}}return V(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient(),reactExports=requireReact();const LayoutGroupContext=reactExports.createContext({});function useConstant(V){const U=reactExports.useRef(null);return U.current===null&&(U.current=V()),U.current}const isBrowser=typeof window<"u",useIsomorphicLayoutEffect=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,PresenceContext=reactExports.createContext(null);function addUniqueItem(V,U){V.indexOf(U)===-1&&V.push(U)}function removeItem(V,U){const j=V.indexOf(U);j>-1&&V.splice(j,1)}const clamp=(V,U,j)=>j>U?U:j<V?V:j;let invariant=()=>{};const MotionGlobalConfig={},isNumericalString=V=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(V);function isObject$1(V){return typeof V=="object"&&V!==null}const isZeroValueString=V=>/^0[^.\s]+$/u.test(V);function memo(V){let U;return()=>(U===void 0&&(U=V()),U)}const noop=V=>V,combineFunctions=(V,U)=>j=>U(V(j)),pipe=(...V)=>V.reduce(combineFunctions),progress=(V,U,j)=>{const B=U-V;return B===0?1:(j-V)/B};class SubscriptionManager{constructor(){this.subscriptions=[]}add(U){return addUniqueItem(this.subscriptions,U),()=>removeItem(this.subscriptions,U)}notify(U,j,B){const z=this.subscriptions.length;if(z)if(z===1)this.subscriptions[0](U,j,B);else for(let H=0;H<z;H++){const G=this.subscriptions[H];G&&G(U,j,B)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const secondsToMilliseconds=V=>V*1e3,millisecondsToSeconds=V=>V/1e3;function velocityPerSecond(V,U){return U?V*(1e3/U):0}const calcBezier=(V,U,j)=>(((1-3*j+3*U)*V+(3*j-6*U))*V+3*U)*V,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(V,U,j,B,z){let H,G,$=0;do G=U+(j-U)/2,H=calcBezier(G,B,z)-V,H>0?j=G:U=G;while(Math.abs(H)>subdivisionPrecision&&++$<subdivisionMaxIterations);return G}function cubicBezier(V,U,j,B){if(V===U&&j===B)return noop;const z=H=>binarySubdivide(H,0,1,V,j);return H=>H===0||H===1?H:calcBezier(z(H),U,B)}const mirrorEasing=V=>U=>U<=.5?V(2*U)/2:(2-V(2*(1-U)))/2,reverseEasing=V=>U=>1-V(1-U),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=V=>(V*=2)<1?.5*backIn(V):.5*(2-Math.pow(2,-10*(V-1))),circIn=V=>1-Math.sin(Math.acos(V)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=V=>Array.isArray(V)&&typeof V[0]!="number",isBezierDefinition=V=>Array.isArray(V)&&typeof V[0]=="number",easingLookup={linear:noop,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},isValidEasing=V=>typeof V=="string",easingDefinitionToFunction=V=>{if(isBezierDefinition(V)){invariant(V.length===4);const[U,j,B,z]=V;return cubicBezier(U,j,B,z)}else if(isValidEasing(V))return easingLookup[V];return V},stepsOrder=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],statsBuffer={value:null};function createRenderStep(V,U){let j=new Set,B=new Set,z=!1,H=!1;const G=new WeakSet;let $={delta:0,timestamp:0,isProcessing:!1},Q=0;function W(ee){G.has(ee)&&(X.schedule(ee),V()),Q++,ee($)}const X={schedule:(ee,ie=!1,ne=!1)=>{const se=ne&&z?j:B;return ie&&G.add(ee),se.has(ee)||se.add(ee),ee},cancel:ee=>{B.delete(ee),G.delete(ee)},process:ee=>{if($=ee,z){H=!0;return}z=!0,[j,B]=[B,j],j.forEach(W),U&&statsBuffer.value&&statsBuffer.value.frameloop[U].push(Q),Q=0,j.clear(),z=!1,H&&(H=!1,X.process(ee))}};return X}const maxElapsed=40;function createRenderBatcher(V,U){let j=!1,B=!0;const z={delta:0,timestamp:0,isProcessing:!1},H=()=>j=!0,G=stepsOrder.reduce((ue,fe)=>(ue[fe]=createRenderStep(H,U?fe:void 0),ue),{}),{setup:$,read:Q,resolveKeyframes:W,preUpdate:X,update:ee,preRender:ie,render:ne,postRender:re}=G,se=()=>{const ue=MotionGlobalConfig.useManualTiming?z.timestamp:performance.now();j=!1,MotionGlobalConfig.useManualTiming||(z.delta=B?1e3/60:Math.max(Math.min(ue-z.timestamp,maxElapsed),1)),z.timestamp=ue,z.isProcessing=!0,$.process(z),Q.process(z),W.process(z),X.process(z),ee.process(z),ie.process(z),ne.process(z),re.process(z),z.isProcessing=!1,j&&U&&(B=!1,V(se))},de=()=>{j=!0,B=!0,z.isProcessing||V(se)};return{schedule:stepsOrder.reduce((ue,fe)=>{const he=G[fe];return ue[fe]=(ge,Ae=!1,_e=!1)=>(j||de(),he.schedule(ge,Ae,_e)),ue},{}),cancel:ue=>{for(let fe=0;fe<stepsOrder.length;fe++)G[stepsOrder[fe]].cancel(ue)},state:z,steps:G}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop,!0);let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:V=>{now=V,queueMicrotask(clearTime)}},checkStringStartsWith=V=>U=>typeof U=="string"&&U.startsWith(V),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=V=>startsAsVariableToken(V)?singleCssVariableRegex.test(V.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,number={test:V=>typeof V=="number",parse:parseFloat,transform:V=>V},alpha={...number,transform:V=>clamp(0,1,V)},scale={...number,default:1},sanitize=V=>Math.round(V*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(V){return V==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(V,U)=>j=>!!(typeof j=="string"&&singleColorRegex.test(j)&&j.startsWith(V)||U&&!isNullish(j)&&Object.prototype.hasOwnProperty.call(j,U)),splitColor=(V,U,j)=>B=>{if(typeof B!="string")return B;const[z,H,G,$]=B.match(floatRegex);return{[V]:parseFloat(z),[U]:parseFloat(H),[j]:parseFloat(G),alpha:$!==void 0?parseFloat($):1}},clampRgbUnit=V=>clamp(0,255,V),rgbUnit={...number,transform:V=>Math.round(clampRgbUnit(V))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:V,green:U,blue:j,alpha:B=1})=>"rgba("+rgbUnit.transform(V)+", "+rgbUnit.transform(U)+", "+rgbUnit.transform(j)+", "+sanitize(alpha.transform(B))+")"};function parseHex(V){let U="",j="",B="",z="";return V.length>5?(U=V.substring(1,3),j=V.substring(3,5),B=V.substring(5,7),z=V.substring(7,9)):(U=V.substring(1,2),j=V.substring(2,3),B=V.substring(3,4),z=V.substring(4,5),U+=U,j+=j,B+=B,z+=z),{red:parseInt(U,16),green:parseInt(j,16),blue:parseInt(B,16),alpha:z?parseInt(z,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},createUnitType=V=>({test:U=>typeof U=="string"&&U.endsWith(V)&&U.split(" ").length===1,parse:parseFloat,transform:U=>`${U}${V}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:V=>percent.parse(V)/100,transform:V=>percent.transform(V*100)},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:V,saturation:U,lightness:j,alpha:B=1})=>"hsla("+Math.round(V)+", "+percent.transform(sanitize(U))+", "+percent.transform(sanitize(j))+", "+sanitize(alpha.transform(B))+")"},color={test:V=>rgba.test(V)||hex.test(V)||hsla.test(V),parse:V=>rgba.test(V)?rgba.parse(V):hsla.test(V)?hsla.parse(V):hex.parse(V),transform:V=>typeof V=="string"?V:V.hasOwnProperty("red")?rgba.transform(V):hsla.transform(V),getAnimatableNone:V=>{const U=color.parse(V);return U.alpha=0,color.transform(U)}},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test(V){return isNaN(V)&&typeof V=="string"&&(V.match(floatRegex)?.length||0)+(V.match(colorRegex)?.length||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(V){const U=V.toString(),j=[],B={color:[],number:[],var:[]},z=[];let H=0;const $=U.replace(complexRegex,Q=>(color.test(Q)?(B.color.push(H),z.push(COLOR_TOKEN),j.push(color.parse(Q))):Q.startsWith(VAR_FUNCTION_TOKEN)?(B.var.push(H),z.push(VAR_TOKEN),j.push(Q)):(B.number.push(H),z.push(NUMBER_TOKEN),j.push(parseFloat(Q))),++H,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:j,split:$,indexes:B,types:z}}function parseComplexValue(V){return analyseComplexValue(V).values}function createTransformer(V){const{split:U,types:j}=analyseComplexValue(V),B=U.length;return z=>{let H="";for(let G=0;G<B;G++)if(H+=U[G],z[G]!==void 0){const $=j[G];$===NUMBER_TOKEN?H+=sanitize(z[G]):$===COLOR_TOKEN?H+=color.transform(z[G]):H+=z[G]}return H}}const convertNumbersToZero=V=>typeof V=="number"?0:color.test(V)?color.getAnimatableNone(V):V;function getAnimatableNone$1(V){const U=parseComplexValue(V);return createTransformer(V)(U.map(convertNumbersToZero))}const complex={test,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1};function hueToRgb(V,U,j){return j<0&&(j+=1),j>1&&(j-=1),j<1/6?V+(U-V)*6*j:j<1/2?U:j<2/3?V+(U-V)*(2/3-j)*6:V}function hslaToRgba({hue:V,saturation:U,lightness:j,alpha:B}){V/=360,U/=100,j/=100;let z=0,H=0,G=0;if(!U)z=H=G=j;else{const $=j<.5?j*(1+U):j+U-j*U,Q=2*j-$;z=hueToRgb(Q,$,V+1/3),H=hueToRgb(Q,$,V),G=hueToRgb(Q,$,V-1/3)}return{red:Math.round(z*255),green:Math.round(H*255),blue:Math.round(G*255),alpha:B}}function mixImmediate(V,U){return j=>j>0?U:V}const mixNumber$1=(V,U,j)=>V+(U-V)*j,mixLinearColor=(V,U,j)=>{const B=V*V,z=j*(U*U-B)+B;return z<0?0:Math.sqrt(z)},colorTypes=[hex,rgba,hsla],getColorType=V=>colorTypes.find(U=>U.test(V));function asRGBA(V){const U=getColorType(V);if(!U)return!1;let j=U.parse(V);return U===hsla&&(j=hslaToRgba(j)),j}const mixColor=(V,U)=>{const j=asRGBA(V),B=asRGBA(U);if(!j||!B)return mixImmediate(V,U);const z={...j};return H=>(z.red=mixLinearColor(j.red,B.red,H),z.green=mixLinearColor(j.green,B.green,H),z.blue=mixLinearColor(j.blue,B.blue,H),z.alpha=mixNumber$1(j.alpha,B.alpha,H),rgba.transform(z))},invisibleValues=new Set(["none","hidden"]);function mixVisibility(V,U){return invisibleValues.has(V)?j=>j<=0?V:U:j=>j>=1?U:V}function mixNumber(V,U){return j=>mixNumber$1(V,U,j)}function getMixer(V){return typeof V=="number"?mixNumber:typeof V=="string"?isCSSVariableToken(V)?mixImmediate:color.test(V)?mixColor:mixComplex:Array.isArray(V)?mixArray:typeof V=="object"?color.test(V)?mixColor:mixObject:mixImmediate}function mixArray(V,U){const j=[...V],B=j.length,z=V.map((H,G)=>getMixer(H)(H,U[G]));return H=>{for(let G=0;G<B;G++)j[G]=z[G](H);return j}}function mixObject(V,U){const j={...V,...U},B={};for(const z in j)V[z]!==void 0&&U[z]!==void 0&&(B[z]=getMixer(V[z])(V[z],U[z]));return z=>{for(const H in B)j[H]=B[H](z);return j}}function matchOrder(V,U){const j=[],B={color:0,var:0,number:0};for(let z=0;z<U.values.length;z++){const H=U.types[z],G=V.indexes[H][B[H]],$=V.values[G]??0;j[z]=$,B[H]++}return j}const mixComplex=(V,U)=>{const j=complex.createTransformer(U),B=analyseComplexValue(V),z=analyseComplexValue(U);return B.indexes.var.length===z.indexes.var.length&&B.indexes.color.length===z.indexes.color.length&&B.indexes.number.length>=z.indexes.number.length?invisibleValues.has(V)&&!z.values.length||invisibleValues.has(U)&&!B.values.length?mixVisibility(V,U):pipe(mixArray(matchOrder(B,z),z.values),j):mixImmediate(V,U)};function mix(V,U,j){return typeof V=="number"&&typeof U=="number"&&typeof j=="number"?mixNumber$1(V,U,j):getMixer(V)(V,U)}const frameloopDriver=V=>{const U=({timestamp:j})=>V(j);return{start:(j=!0)=>frame.update(U,j),stop:()=>cancelFrame(U),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generateLinearEasing=(V,U,j=10)=>{let B="";const z=Math.max(Math.round(U/j),2);for(let H=0;H<z;H++)B+=Math.round(V(H/(z-1))*1e4)/1e4+", ";return`linear(${B.substring(0,B.length-2)})`},maxGeneratorDuration=2e4;function calcGeneratorDuration(V){let U=0;const j=50;let B=V.next(U);for(;!B.done&&U<maxGeneratorDuration;)U+=j,B=V.next(U);return U>=maxGeneratorDuration?1/0:U}function createGeneratorEasing(V,U=100,j){const B=j({...V,keyframes:[0,U]}),z=Math.min(calcGeneratorDuration(B),maxGeneratorDuration);return{type:"keyframes",ease:H=>B.next(z*H).value/U,duration:millisecondsToSeconds(z)}}const velocitySampleDuration=5;function calcGeneratorVelocity(V,U,j){const B=Math.max(U-velocitySampleDuration,0);return velocityPerSecond(j-V(B),U-B)}const springDefaults={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},safeMin=.001;function findSpring({duration:V=springDefaults.duration,bounce:U=springDefaults.bounce,velocity:j=springDefaults.velocity,mass:B=springDefaults.mass}){let z,H,G=1-U;G=clamp(springDefaults.minDamping,springDefaults.maxDamping,G),V=clamp(springDefaults.minDuration,springDefaults.maxDuration,millisecondsToSeconds(V)),G<1?(z=W=>{const X=W*G,ee=X*V,ie=X-j,ne=calcAngularFreq(W,G),re=Math.exp(-ee);return safeMin-ie/ne*re},H=W=>{const ee=W*G*V,ie=ee*j+j,ne=Math.pow(G,2)*Math.pow(W,2)*V,re=Math.exp(-ee),se=calcAngularFreq(Math.pow(W,2),G);return(-z(W)+safeMin>0?-1:1)*((ie-ne)*re)/se}):(z=W=>{const X=Math.exp(-W*V),ee=(W-j)*V+1;return-safeMin+X*ee},H=W=>{const X=Math.exp(-W*V),ee=(j-W)*(V*V);return X*ee});const $=5/V,Q=approximateRoot(z,H,$);if(V=secondsToMilliseconds(V),isNaN(Q))return{stiffness:springDefaults.stiffness,damping:springDefaults.damping,duration:V};{const W=Math.pow(Q,2)*B;return{stiffness:W,damping:G*2*Math.sqrt(B*W),duration:V}}}const rootIterations=12;function approximateRoot(V,U,j){let B=j;for(let z=1;z<rootIterations;z++)B=B-V(B)/U(B);return B}function calcAngularFreq(V,U){return V*Math.sqrt(1-U*U)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(V,U){return U.some(j=>V[j]!==void 0)}function getSpringOptions(V){let U={velocity:springDefaults.velocity,stiffness:springDefaults.stiffness,damping:springDefaults.damping,mass:springDefaults.mass,isResolvedFromDuration:!1,...V};if(!isSpringType(V,physicsKeys)&&isSpringType(V,durationKeys))if(V.visualDuration){const j=V.visualDuration,B=2*Math.PI/(j*1.2),z=B*B,H=2*clamp(.05,1,1-(V.bounce||0))*Math.sqrt(z);U={...U,mass:springDefaults.mass,stiffness:z,damping:H}}else{const j=findSpring(V);U={...U,...j,mass:springDefaults.mass},U.isResolvedFromDuration=!0}return U}function spring(V=springDefaults.visualDuration,U=springDefaults.bounce){const j=typeof V!="object"?{visualDuration:V,keyframes:[0,1],bounce:U}:V;let{restSpeed:B,restDelta:z}=j;const H=j.keyframes[0],G=j.keyframes[j.keyframes.length-1],$={done:!1,value:H},{stiffness:Q,damping:W,mass:X,duration:ee,velocity:ie,isResolvedFromDuration:ne}=getSpringOptions({...j,velocity:-millisecondsToSeconds(j.velocity||0)}),re=ie||0,se=W/(2*Math.sqrt(Q*X)),de=G-H,oe=millisecondsToSeconds(Math.sqrt(Q/X)),le=Math.abs(de)<5;B||(B=le?springDefaults.restSpeed.granular:springDefaults.restSpeed.default),z||(z=le?springDefaults.restDelta.granular:springDefaults.restDelta.default);let ue;if(se<1){const he=calcAngularFreq(oe,se);ue=ge=>{const Ae=Math.exp(-se*oe*ge);return G-Ae*((re+se*oe*de)/he*Math.sin(he*ge)+de*Math.cos(he*ge))}}else if(se===1)ue=he=>G-Math.exp(-oe*he)*(de+(re+oe*de)*he);else{const he=oe*Math.sqrt(se*se-1);ue=ge=>{const Ae=Math.exp(-se*oe*ge),_e=Math.min(he*ge,300);return G-Ae*((re+se*oe*de)*Math.sinh(_e)+he*de*Math.cosh(_e))/he}}const fe={calculatedDuration:ne&&ee||null,next:he=>{const ge=ue(he);if(ne)$.done=he>=ee;else{let Ae=he===0?re:0;se<1&&(Ae=he===0?secondsToMilliseconds(re):calcGeneratorVelocity(ue,he,ge));const _e=Math.abs(Ae)<=B,Pe=Math.abs(G-ge)<=z;$.done=_e&&Pe}return $.value=$.done?G:ge,$},toString:()=>{const he=Math.min(calcGeneratorDuration(fe),maxGeneratorDuration),ge=generateLinearEasing(Ae=>fe.next(he*Ae).value,he,30);return he+"ms "+ge},toTransition:()=>{}};return fe}spring.applyToOptions=V=>{const U=createGeneratorEasing(V,100,spring);return V.ease=U.ease,V.duration=secondsToMilliseconds(U.duration),V.type="keyframes",V};function inertia({keyframes:V,velocity:U=0,power:j=.8,timeConstant:B=325,bounceDamping:z=10,bounceStiffness:H=500,modifyTarget:G,min:$,max:Q,restDelta:W=.5,restSpeed:X}){const ee=V[0],ie={done:!1,value:ee},ne=_e=>$!==void 0&&_e<$||Q!==void 0&&_e>Q,re=_e=>$===void 0?Q:Q===void 0||Math.abs($-_e)<Math.abs(Q-_e)?$:Q;let se=j*U;const de=ee+se,oe=G===void 0?de:G(de);oe!==de&&(se=oe-ee);const le=_e=>-se*Math.exp(-_e/B),ue=_e=>oe+le(_e),fe=_e=>{const Pe=le(_e),xe=ue(_e);ie.done=Math.abs(Pe)<=W,ie.value=ie.done?oe:xe};let he,ge;const Ae=_e=>{ne(ie.value)&&(he=_e,ge=spring({keyframes:[ie.value,re(ie.value)],velocity:calcGeneratorVelocity(ue,_e,ie.value),damping:z,stiffness:H,restDelta:W,restSpeed:X}))};return Ae(0),{calculatedDuration:null,next:_e=>{let Pe=!1;return!ge&&he===void 0&&(Pe=!0,fe(_e),Ae(_e)),he!==void 0&&_e>=he?ge.next(_e-he):(!Pe&&fe(_e),ie)}}}function createMixers(V,U,j){const B=[],z=j||MotionGlobalConfig.mix||mix,H=V.length-1;for(let G=0;G<H;G++){let $=z(V[G],V[G+1]);if(U){const Q=Array.isArray(U)?U[G]||noop:U;$=pipe(Q,$)}B.push($)}return B}function interpolate(V,U,{clamp:j=!0,ease:B,mixer:z}={}){const H=V.length;if(invariant(H===U.length),H===1)return()=>U[0];if(H===2&&U[0]===U[1])return()=>U[1];const G=V[0]===V[1];V[0]>V[H-1]&&(V=[...V].reverse(),U=[...U].reverse());const $=createMixers(U,B,z),Q=$.length,W=X=>{if(G&&X<V[0])return U[0];let ee=0;if(Q>1)for(;ee<V.length-2&&!(X<V[ee+1]);ee++);const ie=progress(V[ee],V[ee+1],X);return $[ee](ie)};return j?X=>W(clamp(V[0],V[H-1],X)):W}function fillOffset(V,U){const j=V[V.length-1];for(let B=1;B<=U;B++){const z=progress(0,U,B);V.push(mixNumber$1(j,1,z))}}function defaultOffset(V){const U=[0];return fillOffset(U,V.length-1),U}function convertOffsetToTimes(V,U){return V.map(j=>j*U)}function defaultEasing(V,U){return V.map(()=>U||easeInOut).splice(0,V.length-1)}function keyframes({duration:V=300,keyframes:U,times:j,ease:B="easeInOut"}){const z=isEasingArray(B)?B.map(easingDefinitionToFunction):easingDefinitionToFunction(B),H={done:!1,value:U[0]},G=convertOffsetToTimes(j&&j.length===U.length?j:defaultOffset(U),V),$=interpolate(G,U,{ease:Array.isArray(z)?z:defaultEasing(U,z)});return{calculatedDuration:V,next:Q=>(H.value=$(Q),H.done=Q>=V,H)}}const isNotNull$1=V=>V!==null;function getFinalKeyframe$1(V,{repeat:U,repeatType:j="loop"},B,z=1){const H=V.filter(isNotNull$1),$=z<0||U&&j!=="loop"&&U%2===1?0:H.length-1;return!$||B===void 0?H[$]:B}const transitionTypeMap={decay:inertia,inertia,tween:keyframes,keyframes,spring};function replaceTransitionType(V){typeof V.type=="string"&&(V.type=transitionTypeMap[V.type])}class WithPromise{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(U=>{this.resolve=U})}notifyFinished(){this.resolve()}then(U,j){return this.finished.then(U,j)}}const percentToProgress=V=>V/100;class JSAnimation extends WithPromise{constructor(U){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:j}=this.options;j&&j.updatedAt!==time.now()&&this.tick(time.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=U,this.initAnimation(),this.play(),U.autoplay===!1&&this.pause()}initAnimation(){const{options:U}=this;replaceTransitionType(U);const{type:j=keyframes,repeat:B=0,repeatDelay:z=0,repeatType:H,velocity:G=0}=U;let{keyframes:$}=U;const Q=j||keyframes;Q!==keyframes&&typeof $[0]!="number"&&(this.mixKeyframes=pipe(percentToProgress,mix($[0],$[1])),$=[0,100]);const W=Q({...U,keyframes:$});H==="mirror"&&(this.mirroredGenerator=Q({...U,keyframes:[...$].reverse(),velocity:-G})),W.calculatedDuration===null&&(W.calculatedDuration=calcGeneratorDuration(W));const{calculatedDuration:X}=W;this.calculatedDuration=X,this.resolvedDuration=X+z,this.totalDuration=this.resolvedDuration*(B+1)-z,this.generator=W}updateTime(U){const j=Math.round(U-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=j}tick(U,j=!1){const{generator:B,totalDuration:z,mixKeyframes:H,mirroredGenerator:G,resolvedDuration:$,calculatedDuration:Q}=this;if(this.startTime===null)return B.next(0);const{delay:W=0,keyframes:X,repeat:ee,repeatType:ie,repeatDelay:ne,type:re,onUpdate:se,finalKeyframe:de}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,U):this.speed<0&&(this.startTime=Math.min(U-z/this.speed,this.startTime)),j?this.currentTime=U:this.updateTime(U);const oe=this.currentTime-W*(this.playbackSpeed>=0?1:-1),le=this.playbackSpeed>=0?oe<0:oe>z;this.currentTime=Math.max(oe,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=z);let ue=this.currentTime,fe=B;if(ee){const _e=Math.min(this.currentTime,z)/$;let Pe=Math.floor(_e),xe=_e%1;!xe&&_e>=1&&(xe=1),xe===1&&Pe--,Pe=Math.min(Pe,ee+1),!!(Pe%2)&&(ie==="reverse"?(xe=1-xe,ne&&(xe-=ne/$)):ie==="mirror"&&(fe=G)),ue=clamp(0,1,xe)*$}const he=le?{done:!1,value:X[0]}:fe.next(ue);H&&(he.value=H(he.value));let{done:ge}=he;!le&&Q!==null&&(ge=this.playbackSpeed>=0?this.currentTime>=z:this.currentTime<=0);const Ae=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ge);return Ae&&re!==inertia&&(he.value=getFinalKeyframe$1(X,this.options,de,this.speed)),se&&se(he.value),Ae&&this.finish(),he}then(U,j){return this.finished.then(U,j)}get duration(){return millisecondsToSeconds(this.calculatedDuration)}get time(){return millisecondsToSeconds(this.currentTime)}set time(U){U=secondsToMilliseconds(U),this.currentTime=U,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=U:this.driver&&(this.startTime=this.driver.now()-U/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(U){this.updateTime(time.now());const j=this.playbackSpeed!==U;this.playbackSpeed=U,j&&(this.time=millisecondsToSeconds(this.currentTime))}play(){if(this.isStopped)return;const{driver:U=frameloopDriver,startTime:j}=this.options;this.driver||(this.driver=U(z=>this.tick(z))),this.options.onPlay?.();const B=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=B):this.holdTime!==null?this.startTime=B-this.holdTime:this.startTime||(this.startTime=j??B),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(time.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(U){return this.startTime=0,this.tick(U,!0)}attachTimeline(U){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),U.observe(this)}}function fillWildcards(V){for(let U=1;U<V.length;U++)V[U]??(V[U]=V[U-1])}const radToDeg=V=>V*180/Math.PI,rotate=V=>{const U=radToDeg(Math.atan2(V[1],V[0]));return rebaseAngle(U)},matrix2dParsers={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:V=>(Math.abs(V[0])+Math.abs(V[3]))/2,rotate,rotateZ:rotate,skewX:V=>radToDeg(Math.atan(V[1])),skewY:V=>radToDeg(Math.atan(V[2])),skew:V=>(Math.abs(V[1])+Math.abs(V[2]))/2},rebaseAngle=V=>(V=V%360,V<0&&(V+=360),V),rotateZ=rotate,scaleX=V=>Math.sqrt(V[0]*V[0]+V[1]*V[1]),scaleY=V=>Math.sqrt(V[4]*V[4]+V[5]*V[5]),matrix3dParsers={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX,scaleY,scale:V=>(scaleX(V)+scaleY(V))/2,rotateX:V=>rebaseAngle(radToDeg(Math.atan2(V[6],V[5]))),rotateY:V=>rebaseAngle(radToDeg(Math.atan2(-V[2],V[0]))),rotateZ,rotate:rotateZ,skewX:V=>radToDeg(Math.atan(V[4])),skewY:V=>radToDeg(Math.atan(V[1])),skew:V=>(Math.abs(V[1])+Math.abs(V[4]))/2};function defaultTransformValue(V){return V.includes("scale")?1:0}function parseValueFromTransform(V,U){if(!V||V==="none")return defaultTransformValue(U);const j=V.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let B,z;if(j)B=matrix3dParsers,z=j;else{const $=V.match(/^matrix\(([-\d.e\s,]+)\)$/u);B=matrix2dParsers,z=$}if(!z)return defaultTransformValue(U);const H=B[U],G=z[1].split(",").map(convertTransformToNumber);return typeof H=="function"?H(G):G[H]}const readTransformValue=(V,U)=>{const{transform:j="none"}=getComputedStyle(V);return parseValueFromTransform(j,U)};function convertTransformToNumber(V){return parseFloat(V.trim())}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),isNumOrPxType=V=>V===number||V===px,transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(V=>!transformKeys.has(V));function removeNonTranslationalTransform(V){const U=[];return nonTranslationalTransformKeys.forEach(j=>{const B=V.getValue(j);B!==void 0&&(U.push([j,B.get()]),B.set(j.startsWith("scale")?1:0))}),U}const positionalValues={width:({x:V},{paddingLeft:U="0",paddingRight:j="0"})=>V.max-V.min-parseFloat(U)-parseFloat(j),height:({y:V},{paddingTop:U="0",paddingBottom:j="0"})=>V.max-V.min-parseFloat(U)-parseFloat(j),top:(V,{top:U})=>parseFloat(U),left:(V,{left:U})=>parseFloat(U),bottom:({y:V},{top:U})=>parseFloat(U)+(V.max-V.min),right:({x:V},{left:U})=>parseFloat(U)+(V.max-V.min),x:(V,{transform:U})=>parseValueFromTransform(U,"x"),y:(V,{transform:U})=>parseValueFromTransform(U,"y")};positionalValues.translateX=positionalValues.x,positionalValues.translateY=positionalValues.y;const toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1,isForced=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const V=Array.from(toResolve).filter(B=>B.needsMeasurement),U=new Set(V.map(B=>B.element)),j=new Map;U.forEach(B=>{const z=removeNonTranslationalTransform(B);z.length&&(j.set(B,z),B.render())}),V.forEach(B=>B.measureInitialState()),U.forEach(B=>{B.render();const z=j.get(B);z&&z.forEach(([H,G])=>{B.getValue(H)?.set(G)})}),V.forEach(B=>B.measureEndState()),V.forEach(B=>{B.suspendedScrollY!==void 0&&window.scrollTo(0,B.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(V=>V.complete(isForced)),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(V=>{V.readKeyframes(),V.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){isForced=!0,readAllKeyframes(),measureAllKeyframes(),isForced=!1}class KeyframeResolver{constructor(U,j,B,z,H,G=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...U],this.onComplete=j,this.name=B,this.motionValue=z,this.element=H,this.isAsync=G}scheduleResolve(){this.state="scheduled",this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:U,name:j,element:B,motionValue:z}=this;if(U[0]===null){const H=z?.get(),G=U[U.length-1];if(H!==void 0)U[0]=H;else if(B&&j){const $=B.readValue(j,G);$!=null&&(U[0]=$)}U[0]===void 0&&(U[0]=G),z&&H===void 0&&z.set(U[0])}fillWildcards(U)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(U=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,U),toResolve.delete(this)}cancel(){this.state==="scheduled"&&(toResolve.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const isCSSVar=V=>V.startsWith("--");function setStyle(V,U,j){isCSSVar(U)?V.style.setProperty(U,j):V.style[U]=j}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0),supportsFlags={};function memoSupports(V,U){const j=memo(V);return()=>supportsFlags[U]??j()}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cubicBezierAsString=([V,U,j,B])=>`cubic-bezier(${V}, ${U}, ${j}, ${B})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(V,U){if(V)return typeof V=="function"?supportsLinearEasing()?generateLinearEasing(V,U):"ease-out":isBezierDefinition(V)?cubicBezierAsString(V):Array.isArray(V)?V.map(j=>mapEasingToNativeEasing(j,U)||supportedWaapiEasing.easeOut):supportedWaapiEasing[V]}function startWaapiAnimation(V,U,j,{delay:B=0,duration:z=300,repeat:H=0,repeatType:G="loop",ease:$="easeOut",times:Q}={},W=void 0){const X={[U]:j};Q&&(X.offset=Q);const ee=mapEasingToNativeEasing($,z);Array.isArray(ee)&&(X.easing=ee);const ie={delay:B,duration:z,easing:Array.isArray(ee)?"linear":ee,fill:"both",iterations:H+1,direction:G==="reverse"?"alternate":"normal"};return W&&(ie.pseudoElement=W),V.animate(X,ie)}function isGenerator(V){return typeof V=="function"&&"applyToOptions"in V}function applyGeneratorOptions({type:V,...U}){return isGenerator(V)&&supportsLinearEasing()?V.applyToOptions(U):(U.duration??(U.duration=300),U.ease??(U.ease="easeOut"),U)}class NativeAnimation extends WithPromise{constructor(U){if(super(),this.finishedTime=null,this.isStopped=!1,!U)return;const{element:j,name:B,keyframes:z,pseudoElement:H,allowFlatten:G=!1,finalKeyframe:$,onComplete:Q}=U;this.isPseudoElement=!!H,this.allowFlatten=G,this.options=U,invariant(typeof U.type!="string");const W=applyGeneratorOptions(U);this.animation=startWaapiAnimation(j,B,z,W,H),W.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!H){const X=getFinalKeyframe$1(z,this.options,$,this.speed);this.updateMotionValue?this.updateMotionValue(X):setStyle(j,B,X),this.animation.cancel()}Q?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:U}=this;U==="idle"||U==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const U=this.animation.effect?.getComputedTiming?.().duration||0;return millisecondsToSeconds(Number(U))}get time(){return millisecondsToSeconds(Number(this.animation.currentTime)||0)}set time(U){this.finishedTime=null,this.animation.currentTime=secondsToMilliseconds(U)}get speed(){return this.animation.playbackRate}set speed(U){U<0&&(this.finishedTime=null),this.animation.playbackRate=U}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(U){this.animation.startTime=U}attachTimeline({timeline:U,observe:j}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,U&&supportsScrollTimeline()?(this.animation.timeline=U,noop):j(this)}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(V){return V in unsupportedEasingFunctions}function replaceStringEasing(V){typeof V.ease=="string"&&isUnsupportedEase(V.ease)&&(V.ease=unsupportedEasingFunctions[V.ease])}const sampleDelta=10;class NativeAnimationExtended extends NativeAnimation{constructor(U){replaceStringEasing(U),replaceTransitionType(U),super(U),U.startTime&&(this.startTime=U.startTime),this.options=U}updateMotionValue(U){const{motionValue:j,onUpdate:B,onComplete:z,element:H,...G}=this.options;if(!j)return;if(U!==void 0){j.set(U);return}const $=new JSAnimation({...G,autoplay:!1}),Q=secondsToMilliseconds(this.finishedTime??this.time);j.setWithVelocity($.sample(Q-sampleDelta).value,$.sample(Q).value,sampleDelta),$.stop()}}const isAnimatable=(V,U)=>U==="zIndex"?!1:!!(typeof V=="number"||Array.isArray(V)||typeof V=="string"&&(complex.test(V)||V==="0")&&!V.startsWith("url("));function hasKeyframesChanged(V){const U=V[0];if(V.length===1)return!0;for(let j=0;j<V.length;j++)if(V[j]!==U)return!0}function canAnimate(V,U,j,B){const z=V[0];if(z===null)return!1;if(U==="display"||U==="visibility")return!0;const H=V[V.length-1],G=isAnimatable(z,U),$=isAnimatable(H,U);return!G||!$?!1:hasKeyframesChanged(V)||(j==="spring"||isGenerator(j))&&B}function isHTMLElement(V){return isObject$1(V)&&"offsetHeight"in V}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function supportsBrowserAnimation(V){const{motionValue:U,name:j,repeatDelay:B,repeatType:z,damping:H,type:G}=V;if(!isHTMLElement(U?.owner?.current))return!1;const{onUpdate:$,transformTemplate:Q}=U.owner.getProps();return supportsWaapi()&&j&&acceleratedValues.has(j)&&(j!=="transform"||!Q)&&!$&&!B&&z!=="mirror"&&H!==0&&G!=="inertia"}const MAX_RESOLVE_DELAY=40;class AsyncMotionValueAnimation extends WithPromise{constructor({autoplay:U=!0,delay:j=0,type:B="keyframes",repeat:z=0,repeatDelay:H=0,repeatType:G="loop",keyframes:$,name:Q,motionValue:W,element:X,...ee}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=time.now();const ie={autoplay:U,delay:j,type:B,repeat:z,repeatDelay:H,repeatType:G,name:Q,motionValue:W,element:X,...ee},ne=X?.KeyframeResolver||KeyframeResolver;this.keyframeResolver=new ne($,(re,se,de)=>this.onKeyframesResolved(re,se,ie,!de),Q,W,X),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(U,j,B,z){this.keyframeResolver=void 0;const{name:H,type:G,velocity:$,delay:Q,isHandoff:W,onUpdate:X}=B;this.resolvedAt=time.now(),canAnimate(U,H,G,$)||((MotionGlobalConfig.instantAnimations||!Q)&&X?.(getFinalKeyframe$1(U,B,j)),U[0]=U[U.length-1],B.duration=0,B.repeat=0);const ie={startTime:z?this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:j,...B,keyframes:U},ne=!W&&supportsBrowserAnimation(ie)?new NativeAnimationExtended({...ie,element:ie.motionValue.owner.current}):new JSAnimation(ie);ne.finished.then(()=>this.notifyFinished()).catch(noop),this.pendingTimeline&&(this.stopTimeline=ne.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=ne}get finished(){return this._animation?this.animation.finished:this._finished}then(U,j){return this.finished.finally(U).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),flushKeyframeResolvers()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(U){this.animation.time=U}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(U){this.animation.speed=U}get startTime(){return this.animation.startTime}attachTimeline(U){return this._animation?this.stopTimeline=this.animation.attachTimeline(U):this.pendingTimeline=U,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(V){const U=splitCSSVariableRegex.exec(V);if(!U)return[,];const[,j,B,z]=U;return[`--${j??B}`,z]}function getVariableValue(V,U,j=1){const[B,z]=parseCSSVariable(V);if(!B)return;const H=window.getComputedStyle(U).getPropertyValue(B);if(H){const G=H.trim();return isNumericalString(G)?parseFloat(G):G}return isCSSVariableToken(z)?getVariableValue(z,U,j+1):z}function getValueTransition(V,U){return V?.[U]??V?.default??V}const positionalKeys=new Set(["width","height","top","left","right","bottom",...transformPropOrder]),auto={test:V=>V==="auto",parse:V=>V},testValueType=V=>U=>U.test(V),dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=V=>dimensionValueTypes.find(testValueType(V));function isNone(V){return typeof V=="number"?V===0:V!==null?V==="none"||V==="0"||isZeroValueString(V):!0}const maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(V){const[U,j]=V.slice(0,-1).split("(");if(U==="drop-shadow")return V;const[B]=j.match(floatRegex)||[];if(!B)return V;const z=j.replace(B,"");let H=maxDefaults.has(U)?1:0;return B!==j&&(H*=100),U+"("+H+z+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:V=>{const U=V.match(functionRegex);return U?U.map(applyDefaultFilter).join(" "):V}},int={...number,transform:Math.round},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},numberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,backgroundPositionX:px,backgroundPositionY:px,...transformValueTypes,zIndex:int,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter,WebkitFilter:filter},getDefaultValueType=V=>defaultValueTypes[V];function getAnimatableNone(V,U){let j=getDefaultValueType(V);return j!==filter&&(j=complex),j.getAnimatableNone?j.getAnimatableNone(U):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(V,U,j){let B=0,z;for(;B<V.length&&!z;){const H=V[B];typeof H=="string"&&!invalidTemplates.has(H)&&analyseComplexValue(H).values.length&&(z=V[B]),B++}if(z&&j)for(const H of U)V[H]=getAnimatableNone(j,z)}class DOMKeyframesResolver extends KeyframeResolver{constructor(U,j,B,z,H){super(U,j,B,z,H,!0)}readKeyframes(){const{unresolvedKeyframes:U,element:j,name:B}=this;if(!j||!j.current)return;super.readKeyframes();for(let Q=0;Q<U.length;Q++){let W=U[Q];if(typeof W=="string"&&(W=W.trim(),isCSSVariableToken(W))){const X=getVariableValue(W,j.current);X!==void 0&&(U[Q]=X),Q===U.length-1&&(this.finalKeyframe=W)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(B)||U.length!==2)return;const[z,H]=U,G=findDimensionValueType(z),$=findDimensionValueType(H);if(G!==$)if(isNumOrPxType(G)&&isNumOrPxType($))for(let Q=0;Q<U.length;Q++){const W=U[Q];typeof W=="string"&&(U[Q]=parseFloat(W))}else positionalValues[B]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:U,name:j}=this,B=[];for(let z=0;z<U.length;z++)(U[z]===null||isNone(U[z]))&&B.push(z);B.length&&makeNoneKeyframesAnimatable(U,B,j)}measureInitialState(){const{element:U,unresolvedKeyframes:j,name:B}=this;if(!U||!U.current)return;B==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[B](U.measureViewportBox(),window.getComputedStyle(U.current)),j[0]=this.measuredOrigin;const z=j[j.length-1];z!==void 0&&U.getValue(B,z).jump(z,!1)}measureEndState(){const{element:U,name:j,unresolvedKeyframes:B}=this;if(!U||!U.current)return;const z=U.getValue(j);z&&z.jump(this.measuredOrigin,!1);const H=B.length-1,G=B[H];B[H]=positionalValues[j](U.measureViewportBox(),window.getComputedStyle(U.current)),G!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=G),this.removedTransforms?.length&&this.removedTransforms.forEach(([$,Q])=>{U.getValue($).set(Q)}),this.resolveNoneKeyframes()}}function resolveElements(V,U,j){if(V instanceof EventTarget)return[V];if(typeof V=="string"){let B=document;const z=j?.[V]??B.querySelectorAll(V);return z?Array.from(z):[]}return Array.from(V)}const getValueAsType=(V,U)=>U&&typeof V=="number"?U.transform(V):V,MAX_VELOCITY_DELTA=30,isFloat=V=>!isNaN(parseFloat(V));class MotionValue{constructor(U,j={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=(B,z=!0)=>{const H=time.now();if(this.updatedAt!==H&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(B),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const G of this.dependents)G.dirty();z&&this.events.renderRequest?.notify(this.current)},this.hasAnimated=!1,this.setCurrent(U),this.owner=j.owner}setCurrent(U){this.current=U,this.updatedAt=time.now(),this.canTrackVelocity===null&&U!==void 0&&(this.canTrackVelocity=isFloat(this.current))}setPrevFrameValue(U=this.current){this.prevFrameValue=U,this.prevUpdatedAt=this.updatedAt}onChange(U){return this.on("change",U)}on(U,j){this.events[U]||(this.events[U]=new SubscriptionManager);const B=this.events[U].add(j);return U==="change"?()=>{B(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:B}clearListeners(){for(const U in this.events)this.events[U].clear()}attach(U,j){this.passiveEffect=U,this.stopPassiveEffect=j}set(U,j=!0){!j||!this.passiveEffect?this.updateAndNotify(U,j):this.passiveEffect(U,this.updateAndNotify)}setWithVelocity(U,j,B){this.set(j),this.prev=void 0,this.prevFrameValue=U,this.prevUpdatedAt=this.updatedAt-B}jump(U,j=!0){this.updateAndNotify(U),this.prev=U,this.prevUpdatedAt=this.prevFrameValue=void 0,j&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(U){this.dependents||(this.dependents=new Set),this.dependents.add(U)}removeDependent(U){this.dependents&&this.dependents.delete(U)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const U=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||U-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const j=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),j)}start(U){return this.stop(),new Promise(j=>{this.hasAnimated=!0,this.animation=U(j),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(V,U){return new MotionValue(V,U)}const{schedule:microtask}=createRenderBatcher(queueMicrotask,!1),isDragging={x:!1,y:!1};function isDragActive(){return isDragging.x||isDragging.y}function setDragLock(V){return V==="x"||V==="y"?isDragging[V]?null:(isDragging[V]=!0,()=>{isDragging[V]=!1}):isDragging.x||isDragging.y?null:(isDragging.x=isDragging.y=!0,()=>{isDragging.x=isDragging.y=!1})}function setupGesture(V,U){const j=resolveElements(V),B=new AbortController,z={passive:!0,...U,signal:B.signal};return[j,z,()=>B.abort()]}function isValidHover(V){return!(V.pointerType==="touch"||isDragActive())}function hover(V,U,j={}){const[B,z,H]=setupGesture(V,j),G=$=>{if(!isValidHover($))return;const{target:Q}=$,W=U(Q,$);if(typeof W!="function"||!Q)return;const X=ee=>{isValidHover(ee)&&(W(ee),Q.removeEventListener("pointerleave",X))};Q.addEventListener("pointerleave",X,z)};return B.forEach($=>{$.addEventListener("pointerenter",G,z)}),H}const isNodeOrChild=(V,U)=>U?V===U?!0:isNodeOrChild(V,U.parentElement):!1,isPrimaryPointer=V=>V.pointerType==="mouse"?typeof V.button!="number"||V.button<=0:V.isPrimary!==!1,focusableElements=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function isElementKeyboardAccessible(V){return focusableElements.has(V.tagName)||V.tabIndex!==-1}const isPressing=new WeakSet;function filterEvents(V){return U=>{U.key==="Enter"&&V(U)}}function firePointerEvent(V,U){V.dispatchEvent(new PointerEvent("pointer"+U,{isPrimary:!0,bubbles:!0}))}const enableKeyboardPress=(V,U)=>{const j=V.currentTarget;if(!j)return;const B=filterEvents(()=>{if(isPressing.has(j))return;firePointerEvent(j,"down");const z=filterEvents(()=>{firePointerEvent(j,"up")}),H=()=>firePointerEvent(j,"cancel");j.addEventListener("keyup",z,U),j.addEventListener("blur",H,U)});j.addEventListener("keydown",B,U),j.addEventListener("blur",()=>j.removeEventListener("keydown",B),U)};function isValidPressEvent(V){return isPrimaryPointer(V)&&!isDragActive()}function press(V,U,j={}){const[B,z,H]=setupGesture(V,j),G=$=>{const Q=$.currentTarget;if(!isValidPressEvent($))return;isPressing.add(Q);const W=U(Q,$),X=(ne,re)=>{window.removeEventListener("pointerup",ee),window.removeEventListener("pointercancel",ie),isPressing.has(Q)&&isPressing.delete(Q),isValidPressEvent(ne)&&typeof W=="function"&&W(ne,{success:re})},ee=ne=>{X(ne,Q===window||Q===document||j.useGlobalTarget||isNodeOrChild(Q,ne.target))},ie=ne=>{X(ne,!1)};window.addEventListener("pointerup",ee,z),window.addEventListener("pointercancel",ie,z)};return B.forEach($=>{(j.useGlobalTarget?window:$).addEventListener("pointerdown",G,z),isHTMLElement($)&&($.addEventListener("focus",W=>enableKeyboardPress(W,z)),!isElementKeyboardAccessible($)&&!$.hasAttribute("tabindex")&&($.tabIndex=0))}),H}function isSVGElement(V){return isObject$1(V)&&"ownerSVGElement"in V}function isSVGSVGElement(V){return isSVGElement(V)&&V.tagName==="svg"}const isMotionValue=V=>!!(V&&V.getVelocity),valueTypes=[...dimensionValueTypes,color,complex],findValueType=V=>valueTypes.find(testValueType(V)),MotionConfigContext=reactExports.createContext({transformPagePoint:V=>V,isStatic:!1,reducedMotion:"never"});class PopChildMeasure extends reactExports.Component{getSnapshotBeforeUpdate(U){const j=this.props.childRef.current;if(j&&U.isPresent&&!this.props.isPresent){const B=j.offsetParent,z=isHTMLElement(B)&&B.offsetWidth||0,H=this.props.sizeRef.current;H.height=j.offsetHeight||0,H.width=j.offsetWidth||0,H.top=j.offsetTop,H.left=j.offsetLeft,H.right=z-H.width-H.left}return null}componentDidUpdate(){}render(){return this.props.children}}function PopChild({children:V,isPresent:U,anchorX:j,root:B}){const z=reactExports.useId(),H=reactExports.useRef(null),G=reactExports.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:$}=reactExports.useContext(MotionConfigContext);return reactExports.useInsertionEffect(()=>{const{width:Q,height:W,top:X,left:ee,right:ie}=G.current;if(U||!H.current||!Q||!W)return;const ne=j==="left"?`left: ${ee}`:`right: ${ie}`;H.current.dataset.motionPopId=z;const re=document.createElement("style");$&&(re.nonce=$);const se=B??document.head;return se.appendChild(re),re.sheet&&re.sheet.insertRule(`
          [data-motion-pop-id="${z}"] {
            position: absolute !important;
            width: ${Q}px !important;
            height: ${W}px !important;
            ${ne}px !important;
            top: ${X}px !important;
          }
        `),()=>{se.removeChild(re),se.contains(re)&&se.removeChild(re)}},[U]),jsxRuntimeExports.jsx(PopChildMeasure,{isPresent:U,childRef:H,sizeRef:G,children:reactExports.cloneElement(V,{ref:H})})}const PresenceChild=({children:V,initial:U,isPresent:j,onExitComplete:B,custom:z,presenceAffectsLayout:H,mode:G,anchorX:$,root:Q})=>{const W=useConstant(newChildrenMap),X=reactExports.useId();let ee=!0,ie=reactExports.useMemo(()=>(ee=!1,{id:X,initial:U,isPresent:j,custom:z,onExitComplete:ne=>{W.set(ne,!0);for(const re of W.values())if(!re)return;B&&B()},register:ne=>(W.set(ne,!1),()=>W.delete(ne))}),[j,W,B]);return H&&ee&&(ie={...ie}),reactExports.useMemo(()=>{W.forEach((ne,re)=>W.set(re,!1))},[j]),reactExports.useEffect(()=>{!j&&!W.size&&B&&B()},[j]),G==="popLayout"&&(V=jsxRuntimeExports.jsx(PopChild,{isPresent:j,anchorX:$,root:Q,children:V})),jsxRuntimeExports.jsx(PresenceContext.Provider,{value:ie,children:V})};function newChildrenMap(){return new Map}function usePresence(V=!0){const U=reactExports.useContext(PresenceContext);if(U===null)return[!0,null];const{isPresent:j,onExitComplete:B,register:z}=U,H=reactExports.useId();reactExports.useEffect(()=>{if(V)return z(H)},[V]);const G=reactExports.useCallback(()=>V&&B&&B(H),[H,B,V]);return!j&&B?[!1,G]:[!0]}const getChildKey=V=>V.key||"";function onlyElements(V){const U=[];return reactExports.Children.forEach(V,j=>{reactExports.isValidElement(j)&&U.push(j)}),U}const AnimatePresence=({children:V,custom:U,initial:j=!0,onExitComplete:B,presenceAffectsLayout:z=!0,mode:H="sync",propagate:G=!1,anchorX:$="left",root:Q})=>{const[W,X]=usePresence(G),ee=reactExports.useMemo(()=>onlyElements(V),[V]),ie=G&&!W?[]:ee.map(getChildKey),ne=reactExports.useRef(!0),re=reactExports.useRef(ee),se=useConstant(()=>new Map),[de,oe]=reactExports.useState(ee),[le,ue]=reactExports.useState(ee);useIsomorphicLayoutEffect(()=>{ne.current=!1,re.current=ee;for(let ge=0;ge<le.length;ge++){const Ae=getChildKey(le[ge]);ie.includes(Ae)?se.delete(Ae):se.get(Ae)!==!0&&se.set(Ae,!1)}},[le,ie.length,ie.join("-")]);const fe=[];if(ee!==de){let ge=[...ee];for(let Ae=0;Ae<le.length;Ae++){const _e=le[Ae],Pe=getChildKey(_e);ie.includes(Pe)||(ge.splice(Ae,0,_e),fe.push(_e))}return H==="wait"&&fe.length&&(ge=fe),ue(onlyElements(ge)),oe(ee),null}const{forceRender:he}=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:le.map(ge=>{const Ae=getChildKey(ge),_e=G&&!W?!1:ee===le||ie.includes(Ae),Pe=()=>{if(se.has(Ae))se.set(Ae,!0);else return;let xe=!0;se.forEach(Ce=>{Ce||(xe=!1)}),xe&&(he?.(),ue(re.current),G&&X?.(),B&&B())};return jsxRuntimeExports.jsx(PresenceChild,{isPresent:_e,initial:!ne.current||j?void 0:!1,custom:U,presenceAffectsLayout:z,mode:H,root:Q,onExitComplete:_e?void 0:Pe,anchorX:$,children:ge},Ae)})})},LazyContext=reactExports.createContext({strict:!1}),featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const V in featureProps)featureDefinitions[V]={isEnabled:U=>featureProps[V].some(j=>!!U[j])};function loadFeatures(V){for(const U in V)featureDefinitions[U]={...featureDefinitions[U],...V[U]}}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(V){return V.startsWith("while")||V.startsWith("drag")&&V!=="draggable"||V.startsWith("layout")||V.startsWith("onTap")||V.startsWith("onPan")||V.startsWith("onLayout")||validMotionProps.has(V)}let shouldForward=V=>!isValidMotionProp(V);function loadExternalIsValidProp(V){typeof V=="function"&&(shouldForward=U=>U.startsWith("on")?!isValidMotionProp(U):V(U))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(V,U,j){const B={};for(const z in V)z==="values"&&typeof V.values=="object"||(shouldForward(z)||j===!0&&isValidMotionProp(z)||!U&&!isValidMotionProp(z)||V.draggable&&z.startsWith("onDrag"))&&(B[z]=V[z]);return B}function createDOMMotionComponentProxy(V){if(typeof Proxy>"u")return V;const U=new Map,j=(...B)=>V(...B);return new Proxy(j,{get:(B,z)=>z==="create"?V:(U.has(z)||U.set(z,V(z)),U.get(z))})}const MotionContext=reactExports.createContext({});function isAnimationControls(V){return V!==null&&typeof V=="object"&&typeof V.start=="function"}function isVariantLabel(V){return typeof V=="string"||Array.isArray(V)}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(V){return isAnimationControls(V.animate)||variantProps.some(U=>isVariantLabel(V[U]))}function isVariantNode(V){return!!(isControllingVariants(V)||V.variants)}function getCurrentTreeVariants(V,U){if(isControllingVariants(V)){const{initial:j,animate:B}=V;return{initial:j===!1||isVariantLabel(j)?j:void 0,animate:isVariantLabel(B)?B:void 0}}return V.inherit!==!1?U:{}}function useCreateMotionContext(V){const{initial:U,animate:j}=getCurrentTreeVariants(V,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:U,animate:j}),[variantLabelsAsDependency(U),variantLabelsAsDependency(j)])}function variantLabelsAsDependency(V){return Array.isArray(V)?V.join(" "):V}const motionComponentSymbol=Symbol.for("motionComponentSymbol");function isRefObject(V){return V&&typeof V=="object"&&Object.prototype.hasOwnProperty.call(V,"current")}function useMotionRef(V,U,j){return reactExports.useCallback(B=>{B&&V.onMount&&V.onMount(B),U&&(B?U.mount(B):U.unmount()),j&&(typeof j=="function"?j(B):isRefObject(j)&&(j.current=B))},[U])}const camelToDash=V=>V.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),SwitchLayoutGroupContext=reactExports.createContext({});function useVisualElement(V,U,j,B,z){const{visualElement:H}=reactExports.useContext(MotionContext),G=reactExports.useContext(LazyContext),$=reactExports.useContext(PresenceContext),Q=reactExports.useContext(MotionConfigContext).reducedMotion,W=reactExports.useRef(null);B=B||G.renderer,!W.current&&B&&(W.current=B(V,{visualState:U,parent:H,props:j,presenceContext:$,blockInitialAnimation:$?$.initial===!1:!1,reducedMotionConfig:Q}));const X=W.current,ee=reactExports.useContext(SwitchLayoutGroupContext);X&&!X.projection&&z&&(X.type==="html"||X.type==="svg")&&createProjectionNode$1(W.current,j,z,ee);const ie=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{X&&ie.current&&X.update(j,$)});const ne=j[optimizedAppearDataAttribute],re=reactExports.useRef(!!ne&&!window.MotionHandoffIsComplete?.(ne)&&window.MotionHasOptimisedAnimation?.(ne));return useIsomorphicLayoutEffect(()=>{X&&(ie.current=!0,window.MotionIsMounted=!0,X.updateFeatures(),microtask.render(X.render),re.current&&X.animationState&&X.animationState.animateChanges())}),reactExports.useEffect(()=>{X&&(!re.current&&X.animationState&&X.animationState.animateChanges(),re.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(ne)}),re.current=!1))}),X}function createProjectionNode$1(V,U,j,B){const{layoutId:z,layout:H,drag:G,dragConstraints:$,layoutScroll:Q,layoutRoot:W,layoutCrossfade:X}=U;V.projection=new j(V.latestValues,U["data-framer-portal-id"]?void 0:getClosestProjectingNode(V.parent)),V.projection.setOptions({layoutId:z,layout:H,alwaysMeasureLayout:!!G||$&&isRefObject($),visualElement:V,animationType:typeof H=="string"?H:"both",initialPromotionConfig:B,crossfade:X,layoutScroll:Q,layoutRoot:W})}function getClosestProjectingNode(V){if(V)return V.options.allowProjection!==!1?V.projection:getClosestProjectingNode(V.parent)}function createRendererMotionComponent({preloadedFeatures:V,createVisualElement:U,useRender:j,useVisualState:B,Component:z}){V&&loadFeatures(V);function H($,Q){let W;const X={...reactExports.useContext(MotionConfigContext),...$,layoutId:useLayoutId($)},{isStatic:ee}=X,ie=useCreateMotionContext($),ne=B($,ee);if(!ee&&isBrowser){useStrictMode();const re=getProjectionFunctionality(X);W=re.MeasureLayout,ie.visualElement=useVisualElement(z,ne,X,U,re.ProjectionNode)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:ie,children:[W&&ie.visualElement?jsxRuntimeExports.jsx(W,{visualElement:ie.visualElement,...X}):null,j(z,$,useMotionRef(ne,ie.visualElement,Q),ne,ee,ie.visualElement)]})}H.displayName=`motion.${typeof z=="string"?z:`create(${z.displayName??z.name??""})`}`;const G=reactExports.forwardRef(H);return G[motionComponentSymbol]=z,G}function useLayoutId({layoutId:V}){const U=reactExports.useContext(LayoutGroupContext).id;return U&&V!==void 0?U+"-"+V:V}function useStrictMode(V,U){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(V){const{drag:U,layout:j}=featureDefinitions;if(!U&&!j)return{};const B={...U,...j};return{MeasureLayout:U?.isEnabled(V)||j?.isEnabled(V)?B.MeasureLayout:void 0,ProjectionNode:B.ProjectionNode}}const scaleCorrectors={};function addScaleCorrector(V){for(const U in V)scaleCorrectors[U]=V[U],isCSSVariableName(U)&&(scaleCorrectors[U].isCSSVariable=!0)}function isForcedMotionValue(V,{layout:U,layoutId:j}){return transformProps.has(V)||V.startsWith("origin")||(U||j!==void 0)&&(!!scaleCorrectors[V]||V==="opacity")}const translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(V,U,j){let B="",z=!0;for(let H=0;H<numTransforms;H++){const G=transformPropOrder[H],$=V[G];if($===void 0)continue;let Q=!0;if(typeof $=="number"?Q=$===(G.startsWith("scale")?1:0):Q=parseFloat($)===0,!Q||j){const W=getValueAsType($,numberValueTypes[G]);if(!Q){z=!1;const X=translateAlias[G]||G;B+=`${X}(${W}) `}j&&(U[G]=W)}}return B=B.trim(),j?B=j(U,z?"":B):z&&(B="none"),B}function buildHTMLStyles(V,U,j){const{style:B,vars:z,transformOrigin:H}=V;let G=!1,$=!1;for(const Q in U){const W=U[Q];if(transformProps.has(Q)){G=!0;continue}else if(isCSSVariableName(Q)){z[Q]=W;continue}else{const X=getValueAsType(W,numberValueTypes[Q]);Q.startsWith("origin")?($=!0,H[Q]=X):B[Q]=X}}if(U.transform||(G||j?B.transform=buildTransform(U,V.transform,j):B.transform&&(B.transform="none")),$){const{originX:Q="50%",originY:W="50%",originZ:X=0}=H;B.transformOrigin=`${Q} ${W} ${X}`}}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function copyRawValuesOnly(V,U,j){for(const B in U)!isMotionValue(U[B])&&!isForcedMotionValue(B,j)&&(V[B]=U[B])}function useInitialMotionValues({transformTemplate:V},U){return reactExports.useMemo(()=>{const j=createHtmlRenderState();return buildHTMLStyles(j,U,V),Object.assign({},j.vars,j.style)},[U])}function useStyle(V,U){const j=V.style||{},B={};return copyRawValuesOnly(B,j,V),Object.assign(B,useInitialMotionValues(V,U)),B}function useHTMLProps(V,U){const j={},B=useStyle(V,U);return V.drag&&V.dragListener!==!1&&(j.draggable=!1,B.userSelect=B.WebkitUserSelect=B.WebkitTouchCallout="none",B.touchAction=V.drag===!0?"none":`pan-${V.drag==="x"?"y":"x"}`),V.tabIndex===void 0&&(V.onTap||V.onTapStart||V.whileTap)&&(j.tabIndex=0),j.style=B,j}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(V,U,j=1,B=0,z=!0){V.pathLength=1;const H=z?dashKeys:camelKeys;V[H.offset]=px.transform(-B);const G=px.transform(U),$=px.transform(j);V[H.array]=`${G} ${$}`}function buildSVGAttrs(V,{attrX:U,attrY:j,attrScale:B,pathLength:z,pathSpacing:H=1,pathOffset:G=0,...$},Q,W,X){if(buildHTMLStyles(V,$,W),Q){V.style.viewBox&&(V.attrs.viewBox=V.style.viewBox);return}V.attrs=V.style,V.style={};const{attrs:ee,style:ie}=V;ee.transform&&(ie.transform=ee.transform,delete ee.transform),(ie.transform||ee.transformOrigin)&&(ie.transformOrigin=ee.transformOrigin??"50% 50%",delete ee.transformOrigin),ie.transform&&(ie.transformBox=X?.transformBox??"fill-box",delete ee.transformBox),U!==void 0&&(ee.x=U),j!==void 0&&(ee.y=j),B!==void 0&&(ee.scale=B),z!==void 0&&buildSVGPath(ee,z,H,G,!1)}const createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=V=>typeof V=="string"&&V.toLowerCase()==="svg";function useSVGProps(V,U,j,B){const z=reactExports.useMemo(()=>{const H=createSvgRenderState();return buildSVGAttrs(H,U,isSVGTag(B),V.transformTemplate,V.style),{...H.attrs,style:{...H.style}}},[U]);if(V.style){const H={};copyRawValuesOnly(H,V.style,V),z.style={...H,...z.style}}return z}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(V){return typeof V!="string"||V.includes("-")?!1:!!(lowercaseSVGElements.indexOf(V)>-1||/[A-Z]/u.test(V))}function createUseRender(V=!1){return(j,B,z,{latestValues:H},G)=>{const Q=(isSVGComponent(j)?useSVGProps:useHTMLProps)(B,H,G,j),W=filterProps(B,typeof j=="string",V),X=j!==reactExports.Fragment?{...W,...Q,ref:z}:{},{children:ee}=B,ie=reactExports.useMemo(()=>isMotionValue(ee)?ee.get():ee,[ee]);return reactExports.createElement(j,{...X,children:ie})}}function getValueState(V){const U=[{},{}];return V?.values.forEach((j,B)=>{U[0][B]=j.get(),U[1][B]=j.getVelocity()}),U}function resolveVariantFromProps(V,U,j,B){if(typeof U=="function"){const[z,H]=getValueState(B);U=U(j!==void 0?j:V.custom,z,H)}if(typeof U=="string"&&(U=V.variants&&V.variants[U]),typeof U=="function"){const[z,H]=getValueState(B);U=U(j!==void 0?j:V.custom,z,H)}return U}function resolveMotionValue(V){return isMotionValue(V)?V.get():V}function makeState({scrapeMotionValuesFromProps:V,createRenderState:U},j,B,z){return{latestValues:makeLatestValues(j,B,z,V),renderState:U()}}const makeUseVisualState=V=>(U,j)=>{const B=reactExports.useContext(MotionContext),z=reactExports.useContext(PresenceContext),H=()=>makeState(V,U,B,z);return j?H():useConstant(H)};function makeLatestValues(V,U,j,B){const z={},H=B(V,{});for(const ie in H)z[ie]=resolveMotionValue(H[ie]);let{initial:G,animate:$}=V;const Q=isControllingVariants(V),W=isVariantNode(V);U&&W&&!Q&&V.inherit!==!1&&(G===void 0&&(G=U.initial),$===void 0&&($=U.animate));let X=j?j.initial===!1:!1;X=X||G===!1;const ee=X?$:G;if(ee&&typeof ee!="boolean"&&!isAnimationControls(ee)){const ie=Array.isArray(ee)?ee:[ee];for(let ne=0;ne<ie.length;ne++){const re=resolveVariantFromProps(V,ie[ne]);if(re){const{transitionEnd:se,transition:de,...oe}=re;for(const le in oe){let ue=oe[le];if(Array.isArray(ue)){const fe=X?ue.length-1:0;ue=ue[fe]}ue!==null&&(z[le]=ue)}for(const le in se)z[le]=se[le]}}}return z}function scrapeMotionValuesFromProps$1(V,U,j){const{style:B}=V,z={};for(const H in B)(isMotionValue(B[H])||U.style&&isMotionValue(U.style[H])||isForcedMotionValue(H,V)||j?.getValue(H)?.liveStyle!==void 0)&&(z[H]=B[H]);return z}const htmlMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState})};function scrapeMotionValuesFromProps(V,U,j){const B=scrapeMotionValuesFromProps$1(V,U,j);for(const z in V)if(isMotionValue(V[z])||isMotionValue(U[z])){const H=transformPropOrder.indexOf(z)!==-1?"attr"+z.charAt(0).toUpperCase()+z.substring(1):z;B[H]=V[z]}return B}const svgMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState})};function createMotionComponentFactory(V,U){return function(B,{forwardMotionProps:z}={forwardMotionProps:!1}){const G={...isSVGComponent(B)?svgMotionConfig:htmlMotionConfig,preloadedFeatures:V,useRender:createUseRender(z),createVisualElement:U,Component:B};return createRendererMotionComponent(G)}}function resolveVariant(V,U,j){const B=V.getProps();return resolveVariantFromProps(B,U,j!==void 0?j:B.custom,V)}const isKeyframesTarget=V=>Array.isArray(V);function setMotionValue(V,U,j){V.hasValue(U)?V.getValue(U).set(j):V.addValue(U,motionValue(j))}function resolveFinalValueInKeyframes(V){return isKeyframesTarget(V)?V[V.length-1]||0:V}function setTarget(V,U){const j=resolveVariant(V,U);let{transitionEnd:B={},transition:z={},...H}=j||{};H={...H,...B};for(const G in H){const $=resolveFinalValueInKeyframes(H[G]);setMotionValue(V,G,$)}}function isWillChangeMotionValue(V){return!!(isMotionValue(V)&&V.add)}function addValueToWillChange(V,U){const j=V.getValue("willChange");if(isWillChangeMotionValue(j))return j.add(U);if(!j&&MotionGlobalConfig.WillChange){const B=new MotionGlobalConfig.WillChange("auto");V.addValue("willChange",B),B.add(U)}}function getOptimisedAppearId(V){return V.props[optimizedAppearDataAttribute]}const isNotNull=V=>V!==null;function getFinalKeyframe(V,{repeat:U,repeatType:j="loop"},B){const z=V.filter(isNotNull),H=U&&j!=="loop"&&U%2===1?0:z.length-1;return z[H]}const underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=V=>({type:"spring",stiffness:550,damping:V===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(V,{keyframes:U})=>U.length>2?keyframesTransition:transformProps.has(V)?V.startsWith("scale")?criticallyDampedSpring(U[1]):underDampedSpring:ease;function isTransitionDefined({when:V,delay:U,delayChildren:j,staggerChildren:B,staggerDirection:z,repeat:H,repeatType:G,repeatDelay:$,from:Q,elapsed:W,...X}){return!!Object.keys(X).length}const animateMotionValue=(V,U,j,B={},z,H)=>G=>{const $=getValueTransition(B,V)||{},Q=$.delay||B.delay||0;let{elapsed:W=0}=B;W=W-secondsToMilliseconds(Q);const X={keyframes:Array.isArray(j)?j:[null,j],ease:"easeOut",velocity:U.getVelocity(),...$,delay:-W,onUpdate:ie=>{U.set(ie),$.onUpdate&&$.onUpdate(ie)},onComplete:()=>{G(),$.onComplete&&$.onComplete()},name:V,motionValue:U,element:H?void 0:z};isTransitionDefined($)||Object.assign(X,getDefaultTransition(V,X)),X.duration&&(X.duration=secondsToMilliseconds(X.duration)),X.repeatDelay&&(X.repeatDelay=secondsToMilliseconds(X.repeatDelay)),X.from!==void 0&&(X.keyframes[0]=X.from);let ee=!1;if((X.type===!1||X.duration===0&&!X.repeatDelay)&&(X.duration=0,X.delay===0&&(ee=!0)),(MotionGlobalConfig.instantAnimations||MotionGlobalConfig.skipAnimations)&&(ee=!0,X.duration=0,X.delay=0),X.allowFlatten=!$.type&&!$.ease,ee&&!H&&U.get()!==void 0){const ie=getFinalKeyframe(X.keyframes,$);if(ie!==void 0){frame.update(()=>{X.onUpdate(ie),X.onComplete()});return}}return $.isSync?new JSAnimation(X):new AsyncMotionValueAnimation(X)};function shouldBlockAnimation({protectedKeys:V,needsAnimating:U},j){const B=V.hasOwnProperty(j)&&U[j]!==!0;return U[j]=!1,B}function animateTarget(V,U,{delay:j=0,transitionOverride:B,type:z}={}){let{transition:H=V.getDefaultTransition(),transitionEnd:G,...$}=U;B&&(H=B);const Q=[],W=z&&V.animationState&&V.animationState.getState()[z];for(const X in $){const ee=V.getValue(X,V.latestValues[X]??null),ie=$[X];if(ie===void 0||W&&shouldBlockAnimation(W,X))continue;const ne={delay:j,...getValueTransition(H||{},X)},re=ee.get();if(re!==void 0&&!ee.isAnimating&&!Array.isArray(ie)&&ie===re&&!ne.velocity)continue;let se=!1;if(window.MotionHandoffAnimation){const oe=getOptimisedAppearId(V);if(oe){const le=window.MotionHandoffAnimation(oe,X,frame);le!==null&&(ne.startTime=le,se=!0)}}addValueToWillChange(V,X),ee.start(animateMotionValue(X,ee,ie,V.shouldReduceMotion&&positionalKeys.has(X)?{type:!1}:ne,V,se));const de=ee.animation;de&&Q.push(de)}return G&&Promise.all(Q).then(()=>{frame.update(()=>{G&&setTarget(V,G)})}),Q}function animateVariant(V,U,j={}){const B=resolveVariant(V,U,j.type==="exit"?V.presenceContext?.custom:void 0);let{transition:z=V.getDefaultTransition()||{}}=B||{};j.transitionOverride&&(z=j.transitionOverride);const H=B?()=>Promise.all(animateTarget(V,B,j)):()=>Promise.resolve(),G=V.variantChildren&&V.variantChildren.size?(Q=0)=>{const{delayChildren:W=0,staggerChildren:X,staggerDirection:ee}=z;return animateChildren(V,U,Q,W,X,ee,j)}:()=>Promise.resolve(),{when:$}=z;if($){const[Q,W]=$==="beforeChildren"?[H,G]:[G,H];return Q().then(()=>W())}else return Promise.all([H(),G(j.delay)])}function animateChildren(V,U,j=0,B=0,z=0,H=1,G){const $=[],Q=V.variantChildren.size,W=(Q-1)*z,X=typeof B=="function",ee=X?ie=>B(ie,Q):H===1?(ie=0)=>ie*z:(ie=0)=>W-ie*z;return Array.from(V.variantChildren).sort(sortByTreeOrder).forEach((ie,ne)=>{ie.notify("AnimationStart",U),$.push(animateVariant(ie,U,{...G,delay:j+(X?0:B)+ee(ne)}).then(()=>ie.notify("AnimationComplete",U)))}),Promise.all($)}function sortByTreeOrder(V,U){return V.sortNodePosition(U)}function animateVisualElement(V,U,j={}){V.notify("AnimationStart",U);let B;if(Array.isArray(U)){const z=U.map(H=>animateVariant(V,H,j));B=Promise.all(z)}else if(typeof U=="string")B=animateVariant(V,U,j);else{const z=typeof U=="function"?resolveVariant(V,U,j.custom):U;B=Promise.all(animateTarget(V,z,j))}return B.then(()=>{V.notify("AnimationComplete",U)})}function shallowCompare(V,U){if(!Array.isArray(U))return!1;const j=U.length;if(j!==V.length)return!1;for(let B=0;B<j;B++)if(U[B]!==V[B])return!1;return!0}const numVariantProps=variantProps.length;function getVariantContext(V){if(!V)return;if(!V.isControllingVariants){const j=V.parent?getVariantContext(V.parent)||{}:{};return V.props.initial!==void 0&&(j.initial=V.props.initial),j}const U={};for(let j=0;j<numVariantProps;j++){const B=variantProps[j],z=V.props[B];(isVariantLabel(z)||z===!1)&&(U[B]=z)}return U}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(V){return U=>Promise.all(U.map(({animation:j,options:B})=>animateVisualElement(V,j,B)))}function createAnimationState(V){let U=animateList(V),j=createState(),B=!0;const z=Q=>(W,X)=>{const ee=resolveVariant(V,X,Q==="exit"?V.presenceContext?.custom:void 0);if(ee){const{transition:ie,transitionEnd:ne,...re}=ee;W={...W,...re,...ne}}return W};function H(Q){U=Q(V)}function G(Q){const{props:W}=V,X=getVariantContext(V.parent)||{},ee=[],ie=new Set;let ne={},re=1/0;for(let de=0;de<numAnimationTypes;de++){const oe=reversePriorityOrder[de],le=j[oe],ue=W[oe]!==void 0?W[oe]:X[oe],fe=isVariantLabel(ue),he=oe===Q?le.isActive:null;he===!1&&(re=de);let ge=ue===X[oe]&&ue!==W[oe]&&fe;if(ge&&B&&V.manuallyAnimateOnMount&&(ge=!1),le.protectedKeys={...ne},!le.isActive&&he===null||!ue&&!le.prevProp||isAnimationControls(ue)||typeof ue=="boolean")continue;const Ae=checkVariantsDidChange(le.prevProp,ue);let _e=Ae||oe===Q&&le.isActive&&!ge&&fe||de>re&&fe,Pe=!1;const xe=Array.isArray(ue)?ue:[ue];let Ce=xe.reduce(z(oe),{});he===!1&&(Ce={});const{prevResolvedValues:ze={}}=le,$e={...ze,...Ce},Fe=Re=>{_e=!0,ie.has(Re)&&(Pe=!0,ie.delete(Re)),le.needsAnimating[Re]=!0;const Be=V.getValue(Re);Be&&(Be.liveStyle=!1)};for(const Re in $e){const Be=Ce[Re],We=ze[Re];if(ne.hasOwnProperty(Re))continue;let pe=!1;isKeyframesTarget(Be)&&isKeyframesTarget(We)?pe=!shallowCompare(Be,We):pe=Be!==We,pe?Be!=null?Fe(Re):ie.add(Re):Be!==void 0&&ie.has(Re)?Fe(Re):le.protectedKeys[Re]=!0}le.prevProp=ue,le.prevResolvedValues=Ce,le.isActive&&(ne={...ne,...Ce}),B&&V.blockInitialAnimation&&(_e=!1),_e&&(!(ge&&Ae)||Pe)&&ee.push(...xe.map(Re=>({animation:Re,options:{type:oe}})))}if(ie.size){const de={};if(typeof W.initial!="boolean"){const oe=resolveVariant(V,Array.isArray(W.initial)?W.initial[0]:W.initial);oe&&oe.transition&&(de.transition=oe.transition)}ie.forEach(oe=>{const le=V.getBaseTarget(oe),ue=V.getValue(oe);ue&&(ue.liveStyle=!0),de[oe]=le??null}),ee.push({animation:de})}let se=!!ee.length;return B&&(W.initial===!1||W.initial===W.animate)&&!V.manuallyAnimateOnMount&&(se=!1),B=!1,se?U(ee):Promise.resolve()}function $(Q,W){if(j[Q].isActive===W)return Promise.resolve();V.variantChildren?.forEach(ee=>ee.animationState?.setActive(Q,W)),j[Q].isActive=W;const X=G(Q);for(const ee in j)j[ee].protectedKeys={};return X}return{animateChanges:G,setActive:$,setAnimateFunction:H,getState:()=>j,reset:()=>{j=createState(),B=!0}}}function checkVariantsDidChange(V,U){return typeof U=="string"?U!==V:Array.isArray(U)?!shallowCompare(U,V):!1}function createTypeState(V=!1){return{isActive:V,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}class Feature{constructor(U){this.isMounted=!1,this.node=U}update(){}}class AnimationFeature extends Feature{constructor(U){super(U),U.animationState||(U.animationState=createAnimationState(U))}updateAnimationControlsSubscription(){const{animate:U}=this.node.getProps();isAnimationControls(U)&&(this.unmountControls=U.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:U}=this.node.getProps(),{animate:j}=this.node.prevProps||{};U!==j&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let id$1=0;class ExitAnimationFeature extends Feature{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:U,onExitComplete:j}=this.node.presenceContext,{isPresent:B}=this.node.prevPresenceContext||{};if(!this.node.animationState||U===B)return;const z=this.node.animationState.setActive("exit",!U);j&&!U&&z.then(()=>{j(this.id)})}mount(){const{register:U,onExitComplete:j}=this.node.presenceContext||{};j&&j(this.id),U&&(this.unmount=U(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}};function addDomEvent(V,U,j,B={passive:!0}){return V.addEventListener(U,j,B),()=>V.removeEventListener(U,j)}function extractEventInfo(V){return{point:{x:V.pageX,y:V.pageY}}}const addPointerInfo=V=>U=>isPrimaryPointer(U)&&V(U,extractEventInfo(U));function addPointerEvent(V,U,j,B){return addDomEvent(V,U,addPointerInfo(j),B)}function convertBoundingBoxToBox({top:V,left:U,right:j,bottom:B}){return{x:{min:U,max:j},y:{min:V,max:B}}}function convertBoxToBoundingBox({x:V,y:U}){return{top:U.min,right:V.max,bottom:U.max,left:V.min}}function transformBoxPoints(V,U){if(!U)return V;const j=U({x:V.left,y:V.top}),B=U({x:V.right,y:V.bottom});return{top:j.y,left:j.x,bottom:B.y,right:B.x}}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(V){return V.max-V.min}function isNear(V,U,j){return Math.abs(V-U)<=j}function calcAxisDelta(V,U,j,B=.5){V.origin=B,V.originPoint=mixNumber$1(U.min,U.max,V.origin),V.scale=calcLength(j)/calcLength(U),V.translate=mixNumber$1(j.min,j.max,V.origin)-V.originPoint,(V.scale>=SCALE_MIN&&V.scale<=SCALE_MAX||isNaN(V.scale))&&(V.scale=1),(V.translate>=TRANSLATE_MIN&&V.translate<=TRANSLATE_MAX||isNaN(V.translate))&&(V.translate=0)}function calcBoxDelta(V,U,j,B){calcAxisDelta(V.x,U.x,j.x,B?B.originX:void 0),calcAxisDelta(V.y,U.y,j.y,B?B.originY:void 0)}function calcRelativeAxis(V,U,j){V.min=j.min+U.min,V.max=V.min+calcLength(U)}function calcRelativeBox(V,U,j){calcRelativeAxis(V.x,U.x,j.x),calcRelativeAxis(V.y,U.y,j.y)}function calcRelativeAxisPosition(V,U,j){V.min=U.min-j.min,V.max=V.min+calcLength(U)}function calcRelativePosition(V,U,j){calcRelativeAxisPosition(V.x,U.x,j.x),calcRelativeAxisPosition(V.y,U.y,j.y)}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()});function eachAxis(V){return[V("x"),V("y")]}function isIdentityScale(V){return V===void 0||V===1}function hasScale({scale:V,scaleX:U,scaleY:j}){return!isIdentityScale(V)||!isIdentityScale(U)||!isIdentityScale(j)}function hasTransform(V){return hasScale(V)||has2DTranslate(V)||V.z||V.rotate||V.rotateX||V.rotateY||V.skewX||V.skewY}function has2DTranslate(V){return is2DTranslate(V.x)||is2DTranslate(V.y)}function is2DTranslate(V){return V&&V!=="0%"}function scalePoint(V,U,j){const B=V-j,z=U*B;return j+z}function applyPointDelta(V,U,j,B,z){return z!==void 0&&(V=scalePoint(V,z,B)),scalePoint(V,j,B)+U}function applyAxisDelta(V,U=0,j=1,B,z){V.min=applyPointDelta(V.min,U,j,B,z),V.max=applyPointDelta(V.max,U,j,B,z)}function applyBoxDelta(V,{x:U,y:j}){applyAxisDelta(V.x,U.translate,U.scale,U.originPoint),applyAxisDelta(V.y,j.translate,j.scale,j.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(V,U,j,B=!1){const z=j.length;if(!z)return;U.x=U.y=1;let H,G;for(let $=0;$<z;$++){H=j[$],G=H.projectionDelta;const{visualElement:Q}=H.options;Q&&Q.props.style&&Q.props.style.display==="contents"||(B&&H.options.layoutScroll&&H.scroll&&H!==H.root&&transformBox(V,{x:-H.scroll.offset.x,y:-H.scroll.offset.y}),G&&(U.x*=G.x.scale,U.y*=G.y.scale,applyBoxDelta(V,G)),B&&hasTransform(H.latestValues)&&transformBox(V,H.latestValues))}U.x<TREE_SCALE_SNAP_MAX&&U.x>TREE_SCALE_SNAP_MIN&&(U.x=1),U.y<TREE_SCALE_SNAP_MAX&&U.y>TREE_SCALE_SNAP_MIN&&(U.y=1)}function translateAxis(V,U){V.min=V.min+U,V.max=V.max+U}function transformAxis(V,U,j,B,z=.5){const H=mixNumber$1(V.min,V.max,z);applyAxisDelta(V,U,j,H,B)}function transformBox(V,U){transformAxis(V.x,U.x,U.scaleX,U.scale,U.originX),transformAxis(V.y,U.y,U.scaleY,U.scale,U.originY)}function measureViewportBox(V,U){return convertBoundingBoxToBox(transformBoxPoints(V.getBoundingClientRect(),U))}function measurePageBox(V,U,j){const B=measureViewportBox(V,j),{scroll:z}=U;return z&&(translateAxis(B.x,z.offset.x),translateAxis(B.y,z.offset.y)),B}const getContextWindow=({current:V})=>V?V.ownerDocument.defaultView:null,distance=(V,U)=>Math.abs(V-U);function distance2D(V,U){const j=distance(V.x,U.x),B=distance(V.y,U.y);return Math.sqrt(j**2+B**2)}class PanSession{constructor(U,j,{transformPagePoint:B,contextWindow:z=window,dragSnapToOrigin:H=!1,distanceThreshold:G=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const ie=getPanInfo(this.lastMoveEventInfo,this.history),ne=this.startEvent!==null,re=distance2D(ie.offset,{x:0,y:0})>=this.distanceThreshold;if(!ne&&!re)return;const{point:se}=ie,{timestamp:de}=frameData;this.history.push({...se,timestamp:de});const{onStart:oe,onMove:le}=this.handlers;ne||(oe&&oe(this.lastMoveEvent,ie),this.startEvent=this.lastMoveEvent),le&&le(this.lastMoveEvent,ie)},this.handlePointerMove=(ie,ne)=>{this.lastMoveEvent=ie,this.lastMoveEventInfo=transformPoint(ne,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(ie,ne)=>{this.end();const{onEnd:re,onSessionEnd:se,resumeAnimation:de}=this.handlers;if(this.dragSnapToOrigin&&de&&de(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const oe=getPanInfo(ie.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(ne,this.transformPagePoint),this.history);this.startEvent&&re&&re(ie,oe),se&&se(ie,oe)},!isPrimaryPointer(U))return;this.dragSnapToOrigin=H,this.handlers=j,this.transformPagePoint=B,this.distanceThreshold=G,this.contextWindow=z||window;const $=extractEventInfo(U),Q=transformPoint($,this.transformPagePoint),{point:W}=Q,{timestamp:X}=frameData;this.history=[{...W,timestamp:X}];const{onSessionStart:ee}=j;ee&&ee(U,getPanInfo(Q,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(U){this.handlers=U}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(V,U){return U?{point:U(V.point)}:V}function subtractPoint(V,U){return{x:V.x-U.x,y:V.y-U.y}}function getPanInfo({point:V},U){return{point:V,delta:subtractPoint(V,lastDevicePoint(U)),offset:subtractPoint(V,startDevicePoint(U)),velocity:getVelocity(U,.1)}}function startDevicePoint(V){return V[0]}function lastDevicePoint(V){return V[V.length-1]}function getVelocity(V,U){if(V.length<2)return{x:0,y:0};let j=V.length-1,B=null;const z=lastDevicePoint(V);for(;j>=0&&(B=V[j],!(z.timestamp-B.timestamp>secondsToMilliseconds(U)));)j--;if(!B)return{x:0,y:0};const H=millisecondsToSeconds(z.timestamp-B.timestamp);if(H===0)return{x:0,y:0};const G={x:(z.x-B.x)/H,y:(z.y-B.y)/H};return G.x===1/0&&(G.x=0),G.y===1/0&&(G.y=0),G}function applyConstraints(V,{min:U,max:j},B){return U!==void 0&&V<U?V=B?mixNumber$1(U,V,B.min):Math.max(V,U):j!==void 0&&V>j&&(V=B?mixNumber$1(j,V,B.max):Math.min(V,j)),V}function calcRelativeAxisConstraints(V,U,j){return{min:U!==void 0?V.min+U:void 0,max:j!==void 0?V.max+j-(V.max-V.min):void 0}}function calcRelativeConstraints(V,{top:U,left:j,bottom:B,right:z}){return{x:calcRelativeAxisConstraints(V.x,j,z),y:calcRelativeAxisConstraints(V.y,U,B)}}function calcViewportAxisConstraints(V,U){let j=U.min-V.min,B=U.max-V.max;return U.max-U.min<V.max-V.min&&([j,B]=[B,j]),{min:j,max:B}}function calcViewportConstraints(V,U){return{x:calcViewportAxisConstraints(V.x,U.x),y:calcViewportAxisConstraints(V.y,U.y)}}function calcOrigin(V,U){let j=.5;const B=calcLength(V),z=calcLength(U);return z>B?j=progress(U.min,U.max-B,V.min):B>z&&(j=progress(V.min,V.max-z,U.min)),clamp(0,1,j)}function rebaseAxisConstraints(V,U){const j={};return U.min!==void 0&&(j.min=U.min-V.min),U.max!==void 0&&(j.max=U.max-V.min),j}const defaultElastic=.35;function resolveDragElastic(V=defaultElastic){return V===!1?V=0:V===!0&&(V=defaultElastic),{x:resolveAxisElastic(V,"left","right"),y:resolveAxisElastic(V,"top","bottom")}}function resolveAxisElastic(V,U,j){return{min:resolvePointElastic(V,U),max:resolvePointElastic(V,j)}}function resolvePointElastic(V,U){return typeof V=="number"?V:V[U]||0}const elementDragControls=new WeakMap;class VisualElementDragControls{constructor(U){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.visualElement=U}start(U,{snapToCursor:j=!1,distanceThreshold:B}={}){const{presenceContext:z}=this.visualElement;if(z&&z.isPresent===!1)return;const H=ee=>{const{dragSnapToOrigin:ie}=this.getProps();ie?this.pauseAnimation():this.stopAnimation(),j&&this.snapToCursor(extractEventInfo(ee).point)},G=(ee,ie)=>{const{drag:ne,dragPropagation:re,onDragStart:se}=this.getProps();if(ne&&!re&&(this.openDragLock&&this.openDragLock(),this.openDragLock=setDragLock(ne),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(oe=>{let le=this.getAxisMotionValue(oe).get()||0;if(percent.test(le)){const{projection:ue}=this.visualElement;if(ue&&ue.layout){const fe=ue.layout.layoutBox[oe];fe&&(le=calcLength(fe)*(parseFloat(le)/100))}}this.originPoint[oe]=le}),se&&frame.postRender(()=>se(ee,ie)),addValueToWillChange(this.visualElement,"transform");const{animationState:de}=this.visualElement;de&&de.setActive("whileDrag",!0)},$=(ee,ie)=>{const{dragPropagation:ne,dragDirectionLock:re,onDirectionLock:se,onDrag:de}=this.getProps();if(!ne&&!this.openDragLock)return;const{offset:oe}=ie;if(re&&this.currentDirection===null){this.currentDirection=getCurrentDirection(oe),this.currentDirection!==null&&se&&se(this.currentDirection);return}this.updateAxis("x",ie.point,oe),this.updateAxis("y",ie.point,oe),this.visualElement.render(),de&&de(ee,ie)},Q=(ee,ie)=>this.stop(ee,ie),W=()=>eachAxis(ee=>this.getAnimationState(ee)==="paused"&&this.getAxisMotionValue(ee).animation?.play()),{dragSnapToOrigin:X}=this.getProps();this.panSession=new PanSession(U,{onSessionStart:H,onStart:G,onMove:$,onSessionEnd:Q,resumeAnimation:W},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:X,distanceThreshold:B,contextWindow:getContextWindow(this.visualElement)})}stop(U,j){const B=this.isDragging;if(this.cancel(),!B)return;const{velocity:z}=j;this.startAnimation(z);const{onDragEnd:H}=this.getProps();H&&frame.postRender(()=>H(U,j))}cancel(){this.isDragging=!1;const{projection:U,animationState:j}=this.visualElement;U&&(U.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:B}=this.getProps();!B&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),j&&j.setActive("whileDrag",!1)}updateAxis(U,j,B){const{drag:z}=this.getProps();if(!B||!shouldDrag(U,z,this.currentDirection))return;const H=this.getAxisMotionValue(U);let G=this.originPoint[U]+B[U];this.constraints&&this.constraints[U]&&(G=applyConstraints(G,this.constraints[U],this.elastic[U])),H.set(G)}resolveConstraints(){const{dragConstraints:U,dragElastic:j}=this.getProps(),B=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,z=this.constraints;U&&isRefObject(U)?this.constraints||(this.constraints=this.resolveRefConstraints()):U&&B?this.constraints=calcRelativeConstraints(B.layoutBox,U):this.constraints=!1,this.elastic=resolveDragElastic(j),z!==this.constraints&&B&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(H=>{this.constraints!==!1&&this.getAxisMotionValue(H)&&(this.constraints[H]=rebaseAxisConstraints(B.layoutBox[H],this.constraints[H]))})}resolveRefConstraints(){const{dragConstraints:U,onMeasureDragConstraints:j}=this.getProps();if(!U||!isRefObject(U))return!1;const B=U.current,{projection:z}=this.visualElement;if(!z||!z.layout)return!1;const H=measurePageBox(B,z.root,this.visualElement.getTransformPagePoint());let G=calcViewportConstraints(z.layout.layoutBox,H);if(j){const $=j(convertBoxToBoundingBox(G));this.hasMutatedConstraints=!!$,$&&(G=convertBoundingBoxToBox($))}return G}startAnimation(U){const{drag:j,dragMomentum:B,dragElastic:z,dragTransition:H,dragSnapToOrigin:G,onDragTransitionEnd:$}=this.getProps(),Q=this.constraints||{},W=eachAxis(X=>{if(!shouldDrag(X,j,this.currentDirection))return;let ee=Q&&Q[X]||{};G&&(ee={min:0,max:0});const ie=z?200:1e6,ne=z?40:1e7,re={type:"inertia",velocity:B?U[X]:0,bounceStiffness:ie,bounceDamping:ne,timeConstant:750,restDelta:1,restSpeed:10,...H,...ee};return this.startAxisValueAnimation(X,re)});return Promise.all(W).then($)}startAxisValueAnimation(U,j){const B=this.getAxisMotionValue(U);return addValueToWillChange(this.visualElement,U),B.start(animateMotionValue(U,B,0,j,this.visualElement,!1))}stopAnimation(){eachAxis(U=>this.getAxisMotionValue(U).stop())}pauseAnimation(){eachAxis(U=>this.getAxisMotionValue(U).animation?.pause())}getAnimationState(U){return this.getAxisMotionValue(U).animation?.state}getAxisMotionValue(U){const j=`_drag${U.toUpperCase()}`,B=this.visualElement.getProps(),z=B[j];return z||this.visualElement.getValue(U,(B.initial?B.initial[U]:void 0)||0)}snapToCursor(U){eachAxis(j=>{const{drag:B}=this.getProps();if(!shouldDrag(j,B,this.currentDirection))return;const{projection:z}=this.visualElement,H=this.getAxisMotionValue(j);if(z&&z.layout){const{min:G,max:$}=z.layout.layoutBox[j];H.set(U[j]-mixNumber$1(G,$,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:U,dragConstraints:j}=this.getProps(),{projection:B}=this.visualElement;if(!isRefObject(j)||!B||!this.constraints)return;this.stopAnimation();const z={x:0,y:0};eachAxis(G=>{const $=this.getAxisMotionValue(G);if($&&this.constraints!==!1){const Q=$.get();z[G]=calcOrigin({min:Q,max:Q},this.constraints[G])}});const{transformTemplate:H}=this.visualElement.getProps();this.visualElement.current.style.transform=H?H({},""):"none",B.root&&B.root.updateScroll(),B.updateLayout(),this.resolveConstraints(),eachAxis(G=>{if(!shouldDrag(G,U,null))return;const $=this.getAxisMotionValue(G),{min:Q,max:W}=this.constraints[G];$.set(mixNumber$1(Q,W,z[G]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const U=this.visualElement.current,j=addPointerEvent(U,"pointerdown",Q=>{const{drag:W,dragListener:X=!0}=this.getProps();W&&X&&this.start(Q)}),B=()=>{const{dragConstraints:Q}=this.getProps();isRefObject(Q)&&Q.current&&(this.constraints=this.resolveRefConstraints())},{projection:z}=this.visualElement,H=z.addEventListener("measure",B);z&&!z.layout&&(z.root&&z.root.updateScroll(),z.updateLayout()),frame.read(B);const G=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),$=z.addEventListener("didUpdate",({delta:Q,hasLayoutChanged:W})=>{this.isDragging&&W&&(eachAxis(X=>{const ee=this.getAxisMotionValue(X);ee&&(this.originPoint[X]+=Q[X].translate,ee.set(ee.get()+Q[X].translate))}),this.visualElement.render())});return()=>{G(),j(),H(),$&&$()}}getProps(){const U=this.visualElement.getProps(),{drag:j=!1,dragDirectionLock:B=!1,dragPropagation:z=!1,dragConstraints:H=!1,dragElastic:G=defaultElastic,dragMomentum:$=!0}=U;return{...U,drag:j,dragDirectionLock:B,dragPropagation:z,dragConstraints:H,dragElastic:G,dragMomentum:$}}}function shouldDrag(V,U,j){return(U===!0||U===V)&&(j===null||j===V)}function getCurrentDirection(V,U=10){let j=null;return Math.abs(V.y)>U?j="y":Math.abs(V.x)>U&&(j="x"),j}class DragGesture extends Feature{constructor(U){super(U),this.removeGroupControls=noop,this.removeListeners=noop,this.controls=new VisualElementDragControls(U)}mount(){const{dragControls:U}=this.node.getProps();U&&(this.removeGroupControls=U.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=V=>(U,j)=>{V&&frame.postRender(()=>V(U,j))};class PanGesture extends Feature{constructor(){super(...arguments),this.removePointerDownListener=noop}onPointerDown(U){this.session=new PanSession(U,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:U,onPanStart:j,onPan:B,onPanEnd:z}=this.node.getProps();return{onSessionStart:asyncHandler(U),onStart:asyncHandler(j),onMove:B,onEnd:(H,G)=>{delete this.session,z&&frame.postRender(()=>z(H,G))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",U=>this.onPointerDown(U))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pixelsToPercent(V,U){return U.max===U.min?0:V/(U.max-U.min)*100}const correctBorderRadius={correct:(V,U)=>{if(!U.target)return V;if(typeof V=="string")if(px.test(V))V=parseFloat(V);else return V;const j=pixelsToPercent(V,U.target.x),B=pixelsToPercent(V,U.target.y);return`${j}% ${B}%`}},correctBoxShadow={correct:(V,{treeScale:U,projectionDelta:j})=>{const B=V,z=complex.parse(V);if(z.length>5)return B;const H=complex.createTransformer(V),G=typeof z[0]!="number"?1:0,$=j.x.scale*U.x,Q=j.y.scale*U.y;z[0+G]/=$,z[1+G]/=Q;const W=mixNumber$1($,Q,.5);return typeof z[2+G]=="number"&&(z[2+G]/=W),typeof z[3+G]=="number"&&(z[3+G]/=W),H(z)}};let hasTakenAnySnapshot=!1;class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:U,layoutGroup:j,switchLayoutGroup:B,layoutId:z}=this.props,{projection:H}=U;addScaleCorrector(defaultScaleCorrectors),H&&(j.group&&j.group.add(H),B&&B.register&&z&&B.register(H),hasTakenAnySnapshot&&H.root.didUpdate(),H.addEventListener("animationComplete",()=>{this.safeToRemove()}),H.setOptions({...H.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(U){const{layoutDependency:j,visualElement:B,drag:z,isPresent:H}=this.props,{projection:G}=B;return G&&(G.isPresent=H,hasTakenAnySnapshot=!0,z||U.layoutDependency!==j||j===void 0||U.isPresent!==H?G.willUpdate():this.safeToRemove(),U.isPresent!==H&&(H?G.promote():G.relegate()||frame.postRender(()=>{const $=G.getStack();(!$||!$.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:U}=this.props.visualElement;U&&(U.root.didUpdate(),microtask.postRender(()=>{!U.currentAnimation&&U.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:U,layoutGroup:j,switchLayoutGroup:B}=this.props,{projection:z}=U;z&&(z.scheduleCheckAfterUnmount(),j&&j.group&&j.group.remove(z),B&&B.deregister&&B.deregister(z))}safeToRemove(){const{safeToRemove:U}=this.props;U&&U()}render(){return null}}function MeasureLayout(V){const[U,j]=usePresence(),B=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...V,layoutGroup:B,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:U,safeToRemove:j})}const defaultScaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow};function animateSingleValue(V,U,j){const B=isMotionValue(V)?V:motionValue(V);return B.start(animateMotionValue("",B,U,j)),B.animation}const compareByDepth=(V,U)=>V.depth-U.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(U){addUniqueItem(this.children,U),this.isDirty=!0}remove(U){removeItem(this.children,U),this.isDirty=!0}forEach(U){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(U)}}function delay(V,U){const j=time.now(),B=({timestamp:z})=>{const H=z-j;H>=U&&(cancelFrame(B),V(H-U))};return frame.setup(B,!0),()=>cancelFrame(B)}const borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=V=>typeof V=="string"?parseFloat(V):V,isPx=V=>typeof V=="number"||px.test(V);function mixValues(V,U,j,B,z,H){z?(V.opacity=mixNumber$1(0,j.opacity??1,easeCrossfadeIn(B)),V.opacityExit=mixNumber$1(U.opacity??1,0,easeCrossfadeOut(B))):H&&(V.opacity=mixNumber$1(U.opacity??1,j.opacity??1,B));for(let G=0;G<numBorders;G++){const $=`border${borders[G]}Radius`;let Q=getRadius(U,$),W=getRadius(j,$);if(Q===void 0&&W===void 0)continue;Q||(Q=0),W||(W=0),Q===0||W===0||isPx(Q)===isPx(W)?(V[$]=Math.max(mixNumber$1(asNumber(Q),asNumber(W),B),0),(percent.test(W)||percent.test(Q))&&(V[$]+="%")):V[$]=W}(U.rotate||j.rotate)&&(V.rotate=mixNumber$1(U.rotate||0,j.rotate||0,B))}function getRadius(V,U){return V[U]!==void 0?V[U]:V.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop);function compress(V,U,j){return B=>B<V?0:B>U?1:j(progress(V,U,B))}function copyAxisInto(V,U){V.min=U.min,V.max=U.max}function copyBoxInto(V,U){copyAxisInto(V.x,U.x),copyAxisInto(V.y,U.y)}function copyAxisDeltaInto(V,U){V.translate=U.translate,V.scale=U.scale,V.originPoint=U.originPoint,V.origin=U.origin}function removePointDelta(V,U,j,B,z){return V-=U,V=scalePoint(V,1/j,B),z!==void 0&&(V=scalePoint(V,1/z,B)),V}function removeAxisDelta(V,U=0,j=1,B=.5,z,H=V,G=V){if(percent.test(U)&&(U=parseFloat(U),U=mixNumber$1(G.min,G.max,U/100)-G.min),typeof U!="number")return;let $=mixNumber$1(H.min,H.max,B);V===H&&($-=U),V.min=removePointDelta(V.min,U,j,$,z),V.max=removePointDelta(V.max,U,j,$,z)}function removeAxisTransforms(V,U,[j,B,z],H,G){removeAxisDelta(V,U[j],U[B],U[z],U.scale,H,G)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(V,U,j,B){removeAxisTransforms(V.x,U,xKeys,j?j.x:void 0,B?B.x:void 0),removeAxisTransforms(V.y,U,yKeys,j?j.y:void 0,B?B.y:void 0)}function isAxisDeltaZero(V){return V.translate===0&&V.scale===1}function isDeltaZero(V){return isAxisDeltaZero(V.x)&&isAxisDeltaZero(V.y)}function axisEquals(V,U){return V.min===U.min&&V.max===U.max}function boxEquals(V,U){return axisEquals(V.x,U.x)&&axisEquals(V.y,U.y)}function axisEqualsRounded(V,U){return Math.round(V.min)===Math.round(U.min)&&Math.round(V.max)===Math.round(U.max)}function boxEqualsRounded(V,U){return axisEqualsRounded(V.x,U.x)&&axisEqualsRounded(V.y,U.y)}function aspectRatio(V){return calcLength(V.x)/calcLength(V.y)}function axisDeltaEquals(V,U){return V.translate===U.translate&&V.scale===U.scale&&V.originPoint===U.originPoint}class NodeStack{constructor(){this.members=[]}add(U){addUniqueItem(this.members,U),U.scheduleRender()}remove(U){if(removeItem(this.members,U),U===this.prevLead&&(this.prevLead=void 0),U===this.lead){const j=this.members[this.members.length-1];j&&this.promote(j)}}relegate(U){const j=this.members.findIndex(z=>U===z);if(j===0)return!1;let B;for(let z=j;z>=0;z--){const H=this.members[z];if(H.isPresent!==!1){B=H;break}}return B?(this.promote(B),!0):!1}promote(U,j){const B=this.lead;if(U!==B&&(this.prevLead=B,this.lead=U,U.show(),B)){B.instance&&B.scheduleRender(),U.scheduleRender(),U.resumeFrom=B,j&&(U.resumeFrom.preserveOpacity=!0),B.snapshot&&(U.snapshot=B.snapshot,U.snapshot.latestValues=B.animationValues||B.latestValues),U.root&&U.root.isUpdating&&(U.isLayoutDirty=!0);const{crossfade:z}=U.options;z===!1&&B.hide()}}exitAnimationComplete(){this.members.forEach(U=>{const{options:j,resumingFrom:B}=U;j.onExitComplete&&j.onExitComplete(),B&&B.options.onExitComplete&&B.options.onExitComplete()})}scheduleRender(){this.members.forEach(U=>{U.instance&&U.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(V,U,j){let B="";const z=V.x.translate/U.x,H=V.y.translate/U.y,G=j?.z||0;if((z||H||G)&&(B=`translate3d(${z}px, ${H}px, ${G}px) `),(U.x!==1||U.y!==1)&&(B+=`scale(${1/U.x}, ${1/U.y}) `),j){const{transformPerspective:W,rotate:X,rotateX:ee,rotateY:ie,skewX:ne,skewY:re}=j;W&&(B=`perspective(${W}px) ${B}`),X&&(B+=`rotate(${X}deg) `),ee&&(B+=`rotateX(${ee}deg) `),ie&&(B+=`rotateY(${ie}deg) `),ne&&(B+=`skewX(${ne}deg) `),re&&(B+=`skewY(${re}deg) `)}const $=V.x.scale*U.x,Q=V.y.scale*U.y;return($!==1||Q!==1)&&(B+=`scale(${$}, ${Q})`),B||"none"}const transformAxes=["","X","Y","Z"],animationTarget=1e3;let id=0;function resetDistortingTransform(V,U,j,B){const{latestValues:z}=U;z[V]&&(j[V]=z[V],U.setStaticValue(V,0),B&&(B[V]=0))}function cancelTreeOptimisedTransformAnimations(V){if(V.hasCheckedOptimisedAppear=!0,V.root===V)return;const{visualElement:U}=V.options;if(!U)return;const j=getOptimisedAppearId(U);if(window.MotionHasOptimisedAnimation(j,"transform")){const{layout:z,layoutId:H}=V.options;window.MotionCancelOptimisedAnimation(j,"transform",frame,!(z||H))}const{parent:B}=V;B&&!B.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(B)}function createProjectionNode({attachResizeListener:V,defaultParent:U,measureScroll:j,checkIsScrollRoot:B,resetTransform:z}){return class{constructor(G={},$=U?.()){this.id=id++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=G,this.root=$?$.root||$:this,this.path=$?[...$.path,$]:[],this.parent=$,this.depth=$?$.depth+1:0;for(let Q=0;Q<this.path.length;Q++)this.path[Q].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(G,$){return this.eventHandlers.has(G)||this.eventHandlers.set(G,new SubscriptionManager),this.eventHandlers.get(G).add($)}notifyListeners(G,...$){const Q=this.eventHandlers.get(G);Q&&Q.notify(...$)}hasListeners(G){return this.eventHandlers.has(G)}mount(G){if(this.instance)return;this.isSVG=isSVGElement(G)&&!isSVGSVGElement(G),this.instance=G;const{layoutId:$,layout:Q,visualElement:W}=this.options;if(W&&!W.current&&W.mount(G),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(Q||$)&&(this.isLayoutDirty=!0),V){let X,ee=0;const ie=()=>this.root.updateBlockedByResize=!1;frame.read(()=>{ee=window.innerWidth}),V(G,()=>{const ne=window.innerWidth;ne!==ee&&(ee=ne,this.root.updateBlockedByResize=!0,X&&X(),X=delay(ie,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation)))})}$&&this.root.registerSharedNode($,this),this.options.animate!==!1&&W&&($||Q)&&this.addEventListener("didUpdate",({delta:X,hasLayoutChanged:ee,hasRelativeLayoutChanged:ie,layout:ne})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const re=this.options.transition||W.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:se,onLayoutAnimationComplete:de}=W.getProps(),oe=!this.targetLayout||!boxEqualsRounded(this.targetLayout,ne),le=!ee&&ie;if(this.options.layoutRoot||this.resumeFrom||le||ee&&(oe||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const ue={...getValueTransition(re,"layout"),onPlay:se,onComplete:de};(W.shouldReduceMotion||this.options.layoutRoot)&&(ue.delay=0,ue.type=!1),this.startAnimation(ue),this.setAnimationOrigin(X,le)}else ee||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=ne})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const G=this.getStack();G&&G.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:G}=this.options;return G&&G.getProps().transformTemplate}willUpdate(G=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let X=0;X<this.path.length;X++){const ee=this.path[X];ee.shouldResetTransform=!0,ee.updateScroll("snapshot"),ee.options.layoutRoot&&ee.willUpdate(!1)}const{layoutId:$,layout:Q}=this.options;if($===void 0&&!Q)return;const W=this.getTransformTemplate();this.prevTransformTemplateValue=W?W(this.latestValues,""):void 0,this.updateSnapshot(),G&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(clearIsLayoutDirty);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate)):this.nodes.forEach(clearIsLayoutDirty),this.clearAllSnapshots();const $=time.now();frameData.delta=clamp(0,1e3/60,$-frameData.timestamp),frameData.timestamp=$,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!calcLength(this.snapshot.measuredBox.x)&&!calcLength(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let Q=0;Q<this.path.length;Q++)this.path[Q].updateScroll();const G=this.layout;this.layout=this.measure(!1),this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:$}=this.options;$&&$.notify("LayoutMeasure",this.layout.layoutBox,G?G.layoutBox:void 0)}updateScroll(G="measure"){let $=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===G&&($=!1),$&&this.instance){const Q=B(this.instance);this.scroll={animationId:this.root.animationId,phase:G,isRoot:Q,offset:j(this.instance),wasRoot:this.scroll?this.scroll.isRoot:Q}}}resetTransform(){if(!z)return;const G=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,$=this.projectionDelta&&!isDeltaZero(this.projectionDelta),Q=this.getTransformTemplate(),W=Q?Q(this.latestValues,""):void 0,X=W!==this.prevTransformTemplateValue;G&&this.instance&&($||hasTransform(this.latestValues)||X)&&(z(this.instance,W),this.shouldResetTransform=!1,this.scheduleRender())}measure(G=!0){const $=this.measurePageBox();let Q=this.removeElementScroll($);return G&&(Q=this.removeTransform(Q)),roundBox(Q),{animationId:this.root.animationId,measuredBox:$,layoutBox:Q,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:G}=this.options;if(!G)return createBox();const $=G.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(checkNodeWasScrollRoot))){const{scroll:W}=this.root;W&&(translateAxis($.x,W.offset.x),translateAxis($.y,W.offset.y))}return $}removeElementScroll(G){const $=createBox();if(copyBoxInto($,G),this.scroll?.wasRoot)return $;for(let Q=0;Q<this.path.length;Q++){const W=this.path[Q],{scroll:X,options:ee}=W;W!==this.root&&X&&ee.layoutScroll&&(X.wasRoot&&copyBoxInto($,G),translateAxis($.x,X.offset.x),translateAxis($.y,X.offset.y))}return $}applyTransform(G,$=!1){const Q=createBox();copyBoxInto(Q,G);for(let W=0;W<this.path.length;W++){const X=this.path[W];!$&&X.options.layoutScroll&&X.scroll&&X!==X.root&&transformBox(Q,{x:-X.scroll.offset.x,y:-X.scroll.offset.y}),hasTransform(X.latestValues)&&transformBox(Q,X.latestValues)}return hasTransform(this.latestValues)&&transformBox(Q,this.latestValues),Q}removeTransform(G){const $=createBox();copyBoxInto($,G);for(let Q=0;Q<this.path.length;Q++){const W=this.path[Q];if(!W.instance||!hasTransform(W.latestValues))continue;hasScale(W.latestValues)&&W.updateSnapshot();const X=createBox(),ee=W.measurePageBox();copyBoxInto(X,ee),removeBoxTransforms($,W.latestValues,W.snapshot?W.snapshot.layoutBox:void 0,X)}return hasTransform(this.latestValues)&&removeBoxTransforms($,this.latestValues),$}setTargetDelta(G){this.targetDelta=G,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(G){this.options={...this.options,...G,crossfade:G.crossfade!==void 0?G.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(G=!1){const $=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=$.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=$.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=$.isSharedProjectionDirty);const Q=!!this.resumingFrom||this!==$;if(!(G||Q&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:X,layoutId:ee}=this.options;if(!(!this.layout||!(X||ee))){if(this.resolvedRelativeTargetAt=frameData.timestamp,!this.targetDelta&&!this.relativeTarget){const ie=this.getClosestProjectingParent();ie&&ie.layout&&this.animationProgress!==1?(this.relativeParent=ie,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.layout.layoutBox,ie.layout.layoutBox),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const ie=this.getClosestProjectingParent();ie&&!!ie.resumingFrom==!!this.resumingFrom&&!ie.options.layoutScroll&&ie.target&&this.animationProgress!==1?(this.relativeParent=ie,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.target,ie.target),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const G=this.getLead(),$=!!this.resumingFrom||this!==G;let Q=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(Q=!1),$&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(Q=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(Q=!1),Q)return;const{layout:W,layoutId:X}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(W||X))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const ee=this.treeScale.x,ie=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,$),G.layout&&!G.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(G.target=G.layout.layoutBox,G.targetWithTransforms=createBox());const{target:ne}=G;if(!ne){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,ne,this.latestValues),(this.treeScale.x!==ee||this.treeScale.y!==ie||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",ne))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(G=!0){if(this.options.visualElement?.scheduleRender(),G){const $=this.getStack();$&&$.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(G,$=!1){const Q=this.snapshot,W=Q?Q.latestValues:{},X={...this.latestValues},ee=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!$;const ie=createBox(),ne=Q?Q.source:void 0,re=this.layout?this.layout.source:void 0,se=ne!==re,de=this.getStack(),oe=!de||de.members.length<=1,le=!!(se&&!oe&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let ue;this.mixTargetDelta=fe=>{const he=fe/1e3;mixAxisDelta(ee.x,G.x,he),mixAxisDelta(ee.y,G.y,he),this.setTargetDelta(ee),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(ie,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,ie,he),ue&&boxEquals(this.relativeTarget,ue)&&(this.isProjectionDirty=!1),ue||(ue=createBox()),copyBoxInto(ue,this.relativeTarget)),se&&(this.animationValues=X,mixValues(X,W,this.latestValues,he,le,oe)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=he},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(G){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=motionValue(0)),this.currentAnimation=animateSingleValue(this.motionValue,[0,1e3],{...G,velocity:0,isSync:!0,onUpdate:$=>{this.mixTargetDelta($),G.onUpdate&&G.onUpdate($)},onStop:()=>{},onComplete:()=>{G.onComplete&&G.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const G=this.getStack();G&&G.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const G=this.getLead();let{targetWithTransforms:$,target:Q,layout:W,latestValues:X}=G;if(!(!$||!Q||!W)){if(this!==G&&this.layout&&W&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,W.layoutBox)){Q=this.target||createBox();const ee=calcLength(this.layout.layoutBox.x);Q.x.min=G.target.x.min,Q.x.max=Q.x.min+ee;const ie=calcLength(this.layout.layoutBox.y);Q.y.min=G.target.y.min,Q.y.max=Q.y.min+ie}copyBoxInto($,Q),transformBox($,X),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,$,X)}}registerSharedNode(G,$){this.sharedNodes.has(G)||this.sharedNodes.set(G,new NodeStack),this.sharedNodes.get(G).add($);const W=$.options.initialPromotionConfig;$.promote({transition:W?W.transition:void 0,preserveFollowOpacity:W&&W.shouldPreserveFollowOpacity?W.shouldPreserveFollowOpacity($):void 0})}isLead(){const G=this.getStack();return G?G.lead===this:!0}getLead(){const{layoutId:G}=this.options;return G?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:G}=this.options;return G?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:G}=this.options;if(G)return this.root.sharedNodes.get(G)}promote({needsReset:G,transition:$,preserveFollowOpacity:Q}={}){const W=this.getStack();W&&W.promote(this,Q),G&&(this.projectionDelta=void 0,this.needsReset=!0),$&&this.setOptions({transition:$})}relegate(){const G=this.getStack();return G?G.relegate(this):!1}resetSkewAndRotation(){const{visualElement:G}=this.options;if(!G)return;let $=!1;const{latestValues:Q}=G;if((Q.z||Q.rotate||Q.rotateX||Q.rotateY||Q.rotateZ||Q.skewX||Q.skewY)&&($=!0),!$)return;const W={};Q.z&&resetDistortingTransform("z",G,W,this.animationValues);for(let X=0;X<transformAxes.length;X++)resetDistortingTransform(`rotate${transformAxes[X]}`,G,W,this.animationValues),resetDistortingTransform(`skew${transformAxes[X]}`,G,W,this.animationValues);G.render();for(const X in W)G.setStaticValue(X,W[X]),this.animationValues&&(this.animationValues[X]=W[X]);G.scheduleRender()}applyProjectionStyles(G,$){if(!this.instance||this.isSVG)return;if(!this.isVisible){G.visibility="hidden";return}const Q=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,G.visibility="",G.opacity="",G.pointerEvents=resolveMotionValue($?.pointerEvents)||"",G.transform=Q?Q(this.latestValues,""):"none";return}const W=this.getLead();if(!this.projectionDelta||!this.layout||!W.target){this.options.layoutId&&(G.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,G.pointerEvents=resolveMotionValue($?.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(G.transform=Q?Q({},""):"none",this.hasProjected=!1);return}G.visibility="";const X=W.animationValues||W.latestValues;this.applyTransformsToTarget();let ee=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,X);Q&&(ee=Q(X,ee)),G.transform=ee;const{x:ie,y:ne}=this.projectionDelta;G.transformOrigin=`${ie.origin*100}% ${ne.origin*100}% 0`,W.animationValues?G.opacity=W===this?X.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:X.opacityExit:G.opacity=W===this?X.opacity!==void 0?X.opacity:"":X.opacityExit!==void 0?X.opacityExit:0;for(const re in scaleCorrectors){if(X[re]===void 0)continue;const{correct:se,applyTo:de,isCSSVariable:oe}=scaleCorrectors[re],le=ee==="none"?X[re]:se(X[re],W);if(de){const ue=de.length;for(let fe=0;fe<ue;fe++)G[de[fe]]=le}else oe?this.options.visualElement.renderState.vars[re]=le:G[re]=le}this.options.layoutId&&(G.pointerEvents=W===this?resolveMotionValue($?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(G=>G.currentAnimation?.stop()),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(V){V.updateLayout()}function notifyLayoutUpdate(V){const U=V.resumeFrom?.snapshot||V.snapshot;if(V.isLead()&&V.layout&&U&&V.hasListeners("didUpdate")){const{layoutBox:j,measuredBox:B}=V.layout,{animationType:z}=V.options,H=U.source!==V.layout.source;z==="size"?eachAxis(X=>{const ee=H?U.measuredBox[X]:U.layoutBox[X],ie=calcLength(ee);ee.min=j[X].min,ee.max=ee.min+ie}):shouldAnimatePositionOnly(z,U.layoutBox,j)&&eachAxis(X=>{const ee=H?U.measuredBox[X]:U.layoutBox[X],ie=calcLength(j[X]);ee.max=ee.min+ie,V.relativeTarget&&!V.currentAnimation&&(V.isProjectionDirty=!0,V.relativeTarget[X].max=V.relativeTarget[X].min+ie)});const G=createDelta();calcBoxDelta(G,j,U.layoutBox);const $=createDelta();H?calcBoxDelta($,V.applyTransform(B,!0),U.measuredBox):calcBoxDelta($,j,U.layoutBox);const Q=!isDeltaZero(G);let W=!1;if(!V.resumeFrom){const X=V.getClosestProjectingParent();if(X&&!X.resumeFrom){const{snapshot:ee,layout:ie}=X;if(ee&&ie){const ne=createBox();calcRelativePosition(ne,U.layoutBox,ee.layoutBox);const re=createBox();calcRelativePosition(re,j,ie.layoutBox),boxEqualsRounded(ne,re)||(W=!0),X.options.layoutRoot&&(V.relativeTarget=re,V.relativeTargetOrigin=ne,V.relativeParent=X)}}}V.notifyListeners("didUpdate",{layout:j,snapshot:U,delta:$,layoutDelta:G,hasLayoutChanged:Q,hasRelativeLayoutChanged:W})}else if(V.isLead()){const{onExitComplete:j}=V.options;j&&j()}V.options.transition=void 0}function propagateDirtyNodes(V){V.parent&&(V.isProjecting()||(V.isProjectionDirty=V.parent.isProjectionDirty),V.isSharedProjectionDirty||(V.isSharedProjectionDirty=!!(V.isProjectionDirty||V.parent.isProjectionDirty||V.parent.isSharedProjectionDirty)),V.isTransformDirty||(V.isTransformDirty=V.parent.isTransformDirty))}function cleanDirtyNodes(V){V.isProjectionDirty=V.isSharedProjectionDirty=V.isTransformDirty=!1}function clearSnapshot(V){V.clearSnapshot()}function clearMeasurements(V){V.clearMeasurements()}function clearIsLayoutDirty(V){V.isLayoutDirty=!1}function resetTransformStyle(V){const{visualElement:U}=V.options;U&&U.getProps().onBeforeLayoutMeasure&&U.notify("BeforeLayoutMeasure"),V.resetTransform()}function finishAnimation(V){V.finishAnimation(),V.targetDelta=V.relativeTarget=V.target=void 0,V.isProjectionDirty=!0}function resolveTargetDelta(V){V.resolveTargetDelta()}function calcProjection(V){V.calcProjection()}function resetSkewAndRotation(V){V.resetSkewAndRotation()}function removeLeadSnapshots(V){V.removeLeadSnapshot()}function mixAxisDelta(V,U,j){V.translate=mixNumber$1(U.translate,0,j),V.scale=mixNumber$1(U.scale,1,j),V.origin=U.origin,V.originPoint=U.originPoint}function mixAxis(V,U,j,B){V.min=mixNumber$1(U.min,j.min,B),V.max=mixNumber$1(U.max,j.max,B)}function mixBox(V,U,j,B){mixAxis(V.x,U.x,j.x,B),mixAxis(V.y,U.y,j.y,B)}function hasOpacityCrossfade(V){return V.animationValues&&V.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=V=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(V),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop;function roundAxis(V){V.min=roundPoint(V.min),V.max=roundPoint(V.max)}function roundBox(V){roundAxis(V.x),roundAxis(V.y)}function shouldAnimatePositionOnly(V,U,j){return V==="position"||V==="preserve-aspect"&&!isNear(aspectRatio(U),aspectRatio(j),.2)}function checkNodeWasScrollRoot(V){return V!==V.root&&V.scroll?.wasRoot}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(V,U)=>addDomEvent(V,"resize",U),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:V=>({x:V.scrollLeft,y:V.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const V=new DocumentProjectionNode({});V.mount(window),V.setOptions({layoutScroll:!0}),rootProjectionNode.current=V}return rootProjectionNode.current},resetTransform:(V,U)=>{V.style.transform=U!==void 0?U:"none"},checkIsScrollRoot:V=>window.getComputedStyle(V).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function handleHoverEvent(V,U,j){const{props:B}=V;V.animationState&&B.whileHover&&V.animationState.setActive("whileHover",j==="Start");const z="onHover"+j,H=B[z];H&&frame.postRender(()=>H(U,extractEventInfo(U)))}class HoverGesture extends Feature{mount(){const{current:U}=this.node;U&&(this.unmount=hover(U,(j,B)=>(handleHoverEvent(this.node,B,"Start"),z=>handleHoverEvent(this.node,z,"End"))))}unmount(){}}class FocusGesture extends Feature{constructor(){super(...arguments),this.isActive=!1}onFocus(){let U=!1;try{U=this.node.current.matches(":focus-visible")}catch{U=!0}!U||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function handlePressEvent(V,U,j){const{props:B}=V;if(V.current instanceof HTMLButtonElement&&V.current.disabled)return;V.animationState&&B.whileTap&&V.animationState.setActive("whileTap",j==="Start");const z="onTap"+(j==="End"?"":j),H=B[z];H&&frame.postRender(()=>H(U,extractEventInfo(U)))}class PressGesture extends Feature{mount(){const{current:U}=this.node;U&&(this.unmount=press(U,(j,B)=>(handlePressEvent(this.node,B,"Start"),(z,{success:H})=>handlePressEvent(this.node,z,H?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=V=>{const U=observerCallbacks.get(V.target);U&&U(V)},fireAllObserverCallbacks=V=>{V.forEach(fireObserverCallback)};function initIntersectionObserver({root:V,...U}){const j=V||document;observers.has(j)||observers.set(j,{});const B=observers.get(j),z=JSON.stringify(U);return B[z]||(B[z]=new IntersectionObserver(fireAllObserverCallbacks,{root:V,...U})),B[z]}function observeIntersection(V,U,j){const B=initIntersectionObserver(U);return observerCallbacks.set(V,j),B.observe(V),()=>{observerCallbacks.delete(V),B.unobserve(V)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:U={}}=this.node.getProps(),{root:j,margin:B,amount:z="some",once:H}=U,G={root:j?j.current:void 0,rootMargin:B,threshold:typeof z=="number"?z:thresholdNames[z]},$=Q=>{const{isIntersecting:W}=Q;if(this.isInView===W||(this.isInView=W,H&&!W&&this.hasEnteredView))return;W&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",W);const{onViewportEnter:X,onViewportLeave:ee}=this.node.getProps(),ie=W?X:ee;ie&&ie(Q)};return observeIntersection(this.node.current,G,$)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:U,prevProps:j}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(U,j))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:V={}},{viewport:U={}}={}){return j=>V[j]!==U[j]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const V=window.matchMedia("(prefers-reduced-motion)"),U=()=>prefersReducedMotion.current=V.matches;V.addEventListener("change",U),U()}else prefersReducedMotion.current=!1}const visualElementStore=new WeakMap;function updateMotionValuesFromProps(V,U,j){for(const B in U){const z=U[B],H=j[B];if(isMotionValue(z))V.addValue(B,z);else if(isMotionValue(H))V.addValue(B,motionValue(z,{owner:V}));else if(H!==z)if(V.hasValue(B)){const G=V.getValue(B);G.liveStyle===!0?G.jump(z):G.hasAnimated||G.set(z)}else{const G=V.getStaticValue(B);V.addValue(B,motionValue(G!==void 0?G:z,{owner:V}))}}for(const B in j)U[B]===void 0&&V.removeValue(B);return U}const propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VisualElement{scrapeMotionValuesFromProps(U,j,B){return{}}constructor({parent:U,props:j,presenceContext:B,reducedMotionConfig:z,blockInitialAnimation:H,visualState:G},$={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const ie=time.now();this.renderScheduledAt<ie&&(this.renderScheduledAt=ie,frame.render(this.render,!1,!0))};const{latestValues:Q,renderState:W}=G;this.latestValues=Q,this.baseTarget={...Q},this.initialValues=j.initial?{...Q}:{},this.renderState=W,this.parent=U,this.props=j,this.presenceContext=B,this.depth=U?U.depth+1:0,this.reducedMotionConfig=z,this.options=$,this.blockInitialAnimation=!!H,this.isControllingVariants=isControllingVariants(j),this.isVariantNode=isVariantNode(j),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(U&&U.current);const{willChange:X,...ee}=this.scrapeMotionValuesFromProps(j,{},this);for(const ie in ee){const ne=ee[ie];Q[ie]!==void 0&&isMotionValue(ne)&&ne.set(Q[ie],!1)}}mount(U){this.current=U,visualElementStore.set(U,this),this.projection&&!this.projection.instance&&this.projection.mount(U),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((j,B)=>this.bindToMotionValue(B,j)),hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:prefersReducedMotion.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(U=>U()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const U in this.events)this.events[U].clear();for(const U in this.features){const j=this.features[U];j&&(j.unmount(),j.isMounted=!1)}this.current=null}bindToMotionValue(U,j){this.valueSubscriptions.has(U)&&this.valueSubscriptions.get(U)();const B=transformProps.has(U);B&&this.onBindTransform&&this.onBindTransform();const z=j.on("change",$=>{this.latestValues[U]=$,this.props.onUpdate&&frame.preRender(this.notifyUpdate),B&&this.projection&&(this.projection.isTransformDirty=!0)}),H=j.on("renderRequest",this.scheduleRender);let G;window.MotionCheckAppearSync&&(G=window.MotionCheckAppearSync(this,U,j)),this.valueSubscriptions.set(U,()=>{z(),H(),G&&G(),j.owner&&j.stop()})}sortNodePosition(U){return!this.current||!this.sortInstanceNodePosition||this.type!==U.type?0:this.sortInstanceNodePosition(this.current,U.current)}updateFeatures(){let U="animation";for(U in featureDefinitions){const j=featureDefinitions[U];if(!j)continue;const{isEnabled:B,Feature:z}=j;if(!this.features[U]&&z&&B(this.props)&&(this.features[U]=new z(this)),this.features[U]){const H=this.features[U];H.isMounted?H.update():(H.mount(),H.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(U){return this.latestValues[U]}setStaticValue(U,j){this.latestValues[U]=j}update(U,j){(U.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=U,this.prevPresenceContext=this.presenceContext,this.presenceContext=j;for(let B=0;B<propEventHandlers.length;B++){const z=propEventHandlers[B];this.propEventSubscriptions[z]&&(this.propEventSubscriptions[z](),delete this.propEventSubscriptions[z]);const H="on"+z,G=U[H];G&&(this.propEventSubscriptions[z]=this.on(z,G))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(U,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(U){return this.props.variants?this.props.variants[U]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(U){const j=this.getClosestVariantNode();if(j)return j.variantChildren&&j.variantChildren.add(U),()=>j.variantChildren.delete(U)}addValue(U,j){const B=this.values.get(U);j!==B&&(B&&this.removeValue(U),this.bindToMotionValue(U,j),this.values.set(U,j),this.latestValues[U]=j.get())}removeValue(U){this.values.delete(U);const j=this.valueSubscriptions.get(U);j&&(j(),this.valueSubscriptions.delete(U)),delete this.latestValues[U],this.removeValueFromRenderState(U,this.renderState)}hasValue(U){return this.values.has(U)}getValue(U,j){if(this.props.values&&this.props.values[U])return this.props.values[U];let B=this.values.get(U);return B===void 0&&j!==void 0&&(B=motionValue(j===null?void 0:j,{owner:this}),this.addValue(U,B)),B}readValue(U,j){let B=this.latestValues[U]!==void 0||!this.current?this.latestValues[U]:this.getBaseTargetFromProps(this.props,U)??this.readValueFromInstance(this.current,U,this.options);return B!=null&&(typeof B=="string"&&(isNumericalString(B)||isZeroValueString(B))?B=parseFloat(B):!findValueType(B)&&complex.test(j)&&(B=getAnimatableNone(U,j)),this.setBaseTarget(U,isMotionValue(B)?B.get():B)),isMotionValue(B)?B.get():B}setBaseTarget(U,j){this.baseTarget[U]=j}getBaseTarget(U){const{initial:j}=this.props;let B;if(typeof j=="string"||typeof j=="object"){const H=resolveVariantFromProps(this.props,j,this.presenceContext?.custom);H&&(B=H[U])}if(j&&B!==void 0)return B;const z=this.getBaseTargetFromProps(this.props,U);return z!==void 0&&!isMotionValue(z)?z:this.initialValues[U]!==void 0&&B===void 0?void 0:this.baseTarget[U]}on(U,j){return this.events[U]||(this.events[U]=new SubscriptionManager),this.events[U].add(j)}notify(U,...j){this.events[U]&&this.events[U].notify(...j)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(U,j){return U.compareDocumentPosition(j)&2?1:-1}getBaseTargetFromProps(U,j){return U.style?U.style[j]:void 0}removeValueFromRenderState(U,{vars:j,style:B}){delete j[U],delete B[U]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:U}=this.props;isMotionValue(U)&&(this.childSubscription=U.on("change",j=>{this.current&&(this.current.textContent=`${j}`)}))}}function renderHTML(V,{style:U,vars:j},B,z){const H=V.style;let G;for(G in U)H[G]=U[G];z?.applyProjectionStyles(H,B);for(G in j)H.setProperty(G,j[G])}function getComputedStyle$1(V){return window.getComputedStyle(V)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(U,j){if(transformProps.has(j))return this.projection?.isProjecting?defaultTransformValue(j):readTransformValue(U,j);{const B=getComputedStyle$1(U),z=(isCSSVariableName(j)?B.getPropertyValue(j):B[j])||0;return typeof z=="string"?z.trim():z}}measureInstanceViewportBox(U,{transformPagePoint:j}){return measureViewportBox(U,j)}build(U,j,B){buildHTMLStyles(U,j,B.transformTemplate)}scrapeMotionValuesFromProps(U,j,B){return scrapeMotionValuesFromProps$1(U,j,B)}}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(V,U,j,B){renderHTML(V,U,void 0,B);for(const z in U.attrs)V.setAttribute(camelCaseAttributes.has(z)?z:camelToDash(z),U.attrs[z])}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(U,j){return U[j]}readValueFromInstance(U,j){if(transformProps.has(j)){const B=getDefaultValueType(j);return B&&B.default||0}return j=camelCaseAttributes.has(j)?j:camelToDash(j),U.getAttribute(j)}scrapeMotionValuesFromProps(U,j,B){return scrapeMotionValuesFromProps(U,j,B)}build(U,j,B){buildSVGAttrs(U,j,this.isSVGTag,B.transformTemplate,B.style)}renderInstance(U,j,B,z){renderSVG(U,j,B,z)}mount(U){this.isSVGTag=isSVGTag(U.tagName),super.mount(U)}}const createDomVisualElement=(V,U)=>isSVGComponent(V)?new SVGVisualElement(U):new HTMLVisualElement(U,{allowProjection:V!==reactExports.Fragment}),createMotionComponent=createMotionComponentFactory({...animations,...gestureAnimations,...drag,...layout},createDomVisualElement),motion=createDOMMotionComponentProxy(createMotionComponent);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=V=>V.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),toCamelCase=V=>V.replace(/^([A-Z])|[\s-_]+(\w)/g,(U,j,B)=>B?B.toUpperCase():j.toLowerCase()),toPascalCase=V=>{const U=toCamelCase(V);return U.charAt(0).toUpperCase()+U.slice(1)},mergeClasses=(...V)=>V.filter((U,j,B)=>!!U&&U.trim()!==""&&B.indexOf(U)===j).join(" ").trim(),hasA11yProp=V=>{for(const U in V)if(U.startsWith("aria-")||U==="role"||U==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Icon=reactExports.forwardRef(({color:V="currentColor",size:U=24,strokeWidth:j=2,absoluteStrokeWidth:B,className:z="",children:H,iconNode:G,...$},Q)=>reactExports.createElement("svg",{ref:Q,...defaultAttributes,width:U,height:U,stroke:V,strokeWidth:B?Number(j)*24/Number(U):j,className:mergeClasses("lucide",z),...!H&&!hasA11yProp($)&&{"aria-hidden":"true"},...$},[...G.map(([W,X])=>reactExports.createElement(W,X)),...Array.isArray(H)?H:[H]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const createLucideIcon=(V,U)=>{const j=reactExports.forwardRef(({className:B,...z},H)=>reactExports.createElement(Icon,{ref:H,iconNode:U,className:mergeClasses(`lucide-${toKebabCase(toPascalCase(V))}`,`lucide-${V}`,B),...z}));return j.displayName=toPascalCase(V),j};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$k=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],Bot=createLucideIcon("bot",__iconNode$k);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$j=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Check=createLucideIcon("check",__iconNode$j);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$i=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],LoaderCircle=createLucideIcon("loader-circle",__iconNode$i);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$h=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Mail=createLucideIcon("mail",__iconNode$h);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$g=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Maximize2=createLucideIcon("maximize-2",__iconNode$g);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$f=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],MessageCircle=createLucideIcon("message-circle",__iconNode$f);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$e=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],MicOff=createLucideIcon("mic-off",__iconNode$e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$d=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Mic=createLucideIcon("mic",__iconNode$d);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$c=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Minimize2=createLucideIcon("minimize-2",__iconNode$c);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$b=[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]],PhoneOff=createLucideIcon("phone-off",__iconNode$b);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$a=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Phone=createLucideIcon("phone",__iconNode$a);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$9=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Send=createLucideIcon("send",__iconNode$9);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$8=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Sparkles=createLucideIcon("sparkles",__iconNode$8);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$7=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Trash2=createLucideIcon("trash-2",__iconNode$7);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$6=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],User=createLucideIcon("user",__iconNode$6);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$5=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],VideoOff=createLucideIcon("video-off",__iconNode$5);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$4=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Video=createLucideIcon("video",__iconNode$4);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$3=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Volume2=createLucideIcon("volume-2",__iconNode$3);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$2=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],VolumeX=createLucideIcon("volume-x",__iconNode$2);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode$1=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],WifiOff=createLucideIcon("wifi-off",__iconNode$1);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __iconNode=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Wifi=createLucideIcon("wifi",__iconNode);var define_process_env_default={};function _mergeNamespaces$1(V,U){return U.forEach(function(j){j&&typeof j!="string"&&!Array.isArray(j)&&Object.keys(j).forEach(function(B){if(B!=="default"&&!(B in V)){var z=Object.getOwnPropertyDescriptor(j,B);Object.defineProperty(V,B,z.get?z:{enumerable:!0,get:function(){return j[B]}})}})}),Object.freeze(V)}var e$1=Object.defineProperty,h$1=(V,U,j)=>U in V?e$1(V,U,{enumerable:!0,configurable:!0,writable:!0,value:j}):V[U]=j,o$1=(V,U,j)=>h$1(V,typeof U!="symbol"?U+"":U,j);let _$1=class{constructor(){o$1(this,"_locking"),o$1(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let U;const j=new Promise(z=>U=()=>{this._locks-=1,z()}),B=this._locking.then(()=>U);return this._locking=this._locking.then(()=>j),B}};function assert(V,U){if(!V)throw new Error(U)}const FLOAT32_MAX=34028234663852886e22,FLOAT32_MIN=-34028234663852886e22,UINT32_MAX=4294967295,INT32_MAX=2147483647,INT32_MIN=-2147483648;function assertInt32(V){if(typeof V!="number")throw new Error("invalid int 32: "+typeof V);if(!Number.isInteger(V)||V>INT32_MAX||V<INT32_MIN)throw new Error("invalid int 32: "+V)}function assertUInt32(V){if(typeof V!="number")throw new Error("invalid uint 32: "+typeof V);if(!Number.isInteger(V)||V>UINT32_MAX||V<0)throw new Error("invalid uint 32: "+V)}function assertFloat32(V){if(typeof V!="number")throw new Error("invalid float 32: "+typeof V);if(Number.isFinite(V)&&(V>FLOAT32_MAX||V<FLOAT32_MIN))throw new Error("invalid float 32: "+V)}const enumTypeSymbol=Symbol("@bufbuild/protobuf/enum-type");function getEnumType(V){const U=V[enumTypeSymbol];return assert(U,"missing enum type on enum object"),U}function setEnumType(V,U,j,B){V[enumTypeSymbol]=makeEnumType(U,j.map(z=>({no:z.no,name:z.name,localName:V[z.no]})))}function makeEnumType(V,U,j){const B=Object.create(null),z=Object.create(null),H=[];for(const G of U){const $=normalizeEnumValue(G);H.push($),B[G.name]=$,z[G.no]=$}return{typeName:V,values:H,findName(G){return B[G]},findNumber(G){return z[G]}}}function makeEnum(V,U,j){const B={};for(const z of U){const H=normalizeEnumValue(z);B[H.localName]=H.no,B[H.no]=H.localName}return setEnumType(B,V,U),B}function normalizeEnumValue(V){return"localName"in V?V:Object.assign(Object.assign({},V),{localName:V.name})}class Message{equals(U){return this.getType().runtime.util.equals(this.getType(),this,U)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(U,j){const B=this.getType(),z=B.runtime.bin,H=z.makeReadOptions(j);return z.readMessage(this,H.readerFactory(U),U.byteLength,H),this}fromJson(U,j){const B=this.getType(),z=B.runtime.json,H=z.makeReadOptions(j);return z.readMessage(B,U,H,this),this}fromJsonString(U,j){let B;try{B=JSON.parse(U)}catch(z){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(z instanceof Error?z.message:String(z)))}return this.fromJson(B,j)}toBinary(U){const j=this.getType(),B=j.runtime.bin,z=B.makeWriteOptions(U),H=z.writerFactory();return B.writeMessage(this,H,z),H.finish()}toJson(U){const j=this.getType(),B=j.runtime.json,z=B.makeWriteOptions(U);return B.writeMessage(this,z)}toJsonString(U){var j;const B=this.toJson(U);return JSON.stringify(B,null,(j=U?.prettySpaces)!==null&&j!==void 0?j:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function makeMessageType(V,U,j,B){var z;const H=(z=B?.localName)!==null&&z!==void 0?z:U.substring(U.lastIndexOf(".")+1),G={[H]:function($){V.util.initFields(this),V.util.initPartial($,this)}}[H];return Object.setPrototypeOf(G.prototype,new Message),Object.assign(G,{runtime:V,typeName:U,fields:V.util.newFieldList(j),fromBinary($,Q){return new G().fromBinary($,Q)},fromJson($,Q){return new G().fromJson($,Q)},fromJsonString($,Q){return new G().fromJsonString($,Q)},equals($,Q){return V.util.equals(G,$,Q)}}),G}function varint64read(){let V=0,U=0;for(let B=0;B<28;B+=7){let z=this.buf[this.pos++];if(V|=(z&127)<<B,(z&128)==0)return this.assertBounds(),[V,U]}let j=this.buf[this.pos++];if(V|=(j&15)<<28,U=(j&112)>>4,(j&128)==0)return this.assertBounds(),[V,U];for(let B=3;B<=31;B+=7){let z=this.buf[this.pos++];if(U|=(z&127)<<B,(z&128)==0)return this.assertBounds(),[V,U]}throw new Error("invalid varint")}function varint64write(V,U,j){for(let H=0;H<28;H=H+7){const G=V>>>H,$=!(!(G>>>7)&&U==0),Q=($?G|128:G)&255;if(j.push(Q),!$)return}const B=V>>>28&15|(U&7)<<4,z=U>>3!=0;if(j.push((z?B|128:B)&255),!!z){for(let H=3;H<31;H=H+7){const G=U>>>H,$=!!(G>>>7),Q=($?G|128:G)&255;if(j.push(Q),!$)return}j.push(U>>>31&1)}}const TWO_PWR_32_DBL=4294967296;function int64FromString(V){const U=V[0]==="-";U&&(V=V.slice(1));const j=1e6;let B=0,z=0;function H(G,$){const Q=Number(V.slice(G,$));z*=j,B=B*j+Q,B>=TWO_PWR_32_DBL&&(z=z+(B/TWO_PWR_32_DBL|0),B=B%TWO_PWR_32_DBL)}return H(-24,-18),H(-18,-12),H(-12,-6),H(-6),U?negate(B,z):newBits(B,z)}function int64ToString(V,U){let j=newBits(V,U);const B=j.hi&2147483648;B&&(j=negate(j.lo,j.hi));const z=uInt64ToString(j.lo,j.hi);return B?"-"+z:z}function uInt64ToString(V,U){if({lo:V,hi:U}=toUnsigned(V,U),U<=2097151)return String(TWO_PWR_32_DBL*U+V);const j=V&16777215,B=(V>>>24|U<<8)&16777215,z=U>>16&65535;let H=j+B*6777216+z*6710656,G=B+z*8147497,$=z*2;const Q=1e7;return H>=Q&&(G+=Math.floor(H/Q),H%=Q),G>=Q&&($+=Math.floor(G/Q),G%=Q),$.toString()+decimalFrom1e7WithLeadingZeros(G)+decimalFrom1e7WithLeadingZeros(H)}function toUnsigned(V,U){return{lo:V>>>0,hi:U>>>0}}function newBits(V,U){return{lo:V|0,hi:U|0}}function negate(V,U){return U=~U,V?V=~V+1:U+=1,newBits(V,U)}const decimalFrom1e7WithLeadingZeros=V=>{const U=String(V);return"0000000".slice(U.length)+U};function varint32write(V,U){if(V>=0){for(;V>127;)U.push(V&127|128),V=V>>>7;U.push(V)}else{for(let j=0;j<9;j++)U.push(V&127|128),V=V>>7;U.push(1)}}function varint32read(){let V=this.buf[this.pos++],U=V&127;if((V&128)==0)return this.assertBounds(),U;if(V=this.buf[this.pos++],U|=(V&127)<<7,(V&128)==0)return this.assertBounds(),U;if(V=this.buf[this.pos++],U|=(V&127)<<14,(V&128)==0)return this.assertBounds(),U;if(V=this.buf[this.pos++],U|=(V&127)<<21,(V&128)==0)return this.assertBounds(),U;V=this.buf[this.pos++],U|=(V&15)<<28;for(let j=5;(V&128)!==0&&j<10;j++)V=this.buf[this.pos++];if((V&128)!=0)throw new Error("invalid varint");return this.assertBounds(),U>>>0}function makeInt64Support(){const V=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof V.getBigInt64=="function"&&typeof V.getBigUint64=="function"&&typeof V.setBigInt64=="function"&&typeof V.setBigUint64=="function"&&(typeof process!="object"||typeof define_process_env_default!="object"||define_process_env_default.BUF_BIGINT_DISABLE!=="1")){const z=BigInt("-9223372036854775808"),H=BigInt("9223372036854775807"),G=BigInt("0"),$=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(Q){const W=typeof Q=="bigint"?Q:BigInt(Q);if(W>H||W<z)throw new Error("int64 invalid: ".concat(Q));return W},uParse(Q){const W=typeof Q=="bigint"?Q:BigInt(Q);if(W>$||W<G)throw new Error("uint64 invalid: ".concat(Q));return W},enc(Q){return V.setBigInt64(0,this.parse(Q),!0),{lo:V.getInt32(0,!0),hi:V.getInt32(4,!0)}},uEnc(Q){return V.setBigInt64(0,this.uParse(Q),!0),{lo:V.getInt32(0,!0),hi:V.getInt32(4,!0)}},dec(Q,W){return V.setInt32(0,Q,!0),V.setInt32(4,W,!0),V.getBigInt64(0,!0)},uDec(Q,W){return V.setInt32(0,Q,!0),V.setInt32(4,W,!0),V.getBigUint64(0,!0)}}}const j=z=>assert(/^-?[0-9]+$/.test(z),"int64 invalid: ".concat(z)),B=z=>assert(/^[0-9]+$/.test(z),"uint64 invalid: ".concat(z));return{zero:"0",supported:!1,parse(z){return typeof z!="string"&&(z=z.toString()),j(z),z},uParse(z){return typeof z!="string"&&(z=z.toString()),B(z),z},enc(z){return typeof z!="string"&&(z=z.toString()),j(z),int64FromString(z)},uEnc(z){return typeof z!="string"&&(z=z.toString()),B(z),int64FromString(z)},dec(z,H){return int64ToString(z,H)},uDec(z,H){return uInt64ToString(z,H)}}}const protoInt64=makeInt64Support();var ScalarType;(function(V){V[V.DOUBLE=1]="DOUBLE",V[V.FLOAT=2]="FLOAT",V[V.INT64=3]="INT64",V[V.UINT64=4]="UINT64",V[V.INT32=5]="INT32",V[V.FIXED64=6]="FIXED64",V[V.FIXED32=7]="FIXED32",V[V.BOOL=8]="BOOL",V[V.STRING=9]="STRING",V[V.BYTES=12]="BYTES",V[V.UINT32=13]="UINT32",V[V.SFIXED32=15]="SFIXED32",V[V.SFIXED64=16]="SFIXED64",V[V.SINT32=17]="SINT32",V[V.SINT64=18]="SINT64"})(ScalarType||(ScalarType={}));var LongType;(function(V){V[V.BIGINT=0]="BIGINT",V[V.STRING=1]="STRING"})(LongType||(LongType={}));function scalarEquals(V,U,j){if(U===j)return!0;if(V==ScalarType.BYTES){if(!(U instanceof Uint8Array)||!(j instanceof Uint8Array)||U.length!==j.length)return!1;for(let B=0;B<U.length;B++)if(U[B]!==j[B])return!1;return!0}switch(V){case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return U==j}return!1}function scalarZeroValue(V,U){switch(V){case ScalarType.BOOL:return!1;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return U==0?protoInt64.zero:"0";case ScalarType.DOUBLE:case ScalarType.FLOAT:return 0;case ScalarType.BYTES:return new Uint8Array(0);case ScalarType.STRING:return"";default:return 0}}function isScalarZeroValue(V,U){switch(V){case ScalarType.BOOL:return U===!1;case ScalarType.STRING:return U==="";case ScalarType.BYTES:return U instanceof Uint8Array&&!U.byteLength;default:return U==0}}var WireType;(function(V){V[V.Varint=0]="Varint",V[V.Bit64=1]="Bit64",V[V.LengthDelimited=2]="LengthDelimited",V[V.StartGroup=3]="StartGroup",V[V.EndGroup=4]="EndGroup",V[V.Bit32=5]="Bit32"})(WireType||(WireType={}));class BinaryWriter{constructor(U){this.stack=[],this.textEncoder=U??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let U=0;for(let z=0;z<this.chunks.length;z++)U+=this.chunks[z].length;let j=new Uint8Array(U),B=0;for(let z=0;z<this.chunks.length;z++)j.set(this.chunks[z],B),B+=this.chunks[z].length;return this.chunks=[],j}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let U=this.finish(),j=this.stack.pop();if(!j)throw new Error("invalid state, fork stack empty");return this.chunks=j.chunks,this.buf=j.buf,this.uint32(U.byteLength),this.raw(U)}tag(U,j){return this.uint32((U<<3|j)>>>0)}raw(U){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(U),this}uint32(U){for(assertUInt32(U);U>127;)this.buf.push(U&127|128),U=U>>>7;return this.buf.push(U),this}int32(U){return assertInt32(U),varint32write(U,this.buf),this}bool(U){return this.buf.push(U?1:0),this}bytes(U){return this.uint32(U.byteLength),this.raw(U)}string(U){let j=this.textEncoder.encode(U);return this.uint32(j.byteLength),this.raw(j)}float(U){assertFloat32(U);let j=new Uint8Array(4);return new DataView(j.buffer).setFloat32(0,U,!0),this.raw(j)}double(U){let j=new Uint8Array(8);return new DataView(j.buffer).setFloat64(0,U,!0),this.raw(j)}fixed32(U){assertUInt32(U);let j=new Uint8Array(4);return new DataView(j.buffer).setUint32(0,U,!0),this.raw(j)}sfixed32(U){assertInt32(U);let j=new Uint8Array(4);return new DataView(j.buffer).setInt32(0,U,!0),this.raw(j)}sint32(U){return assertInt32(U),U=(U<<1^U>>31)>>>0,varint32write(U,this.buf),this}sfixed64(U){let j=new Uint8Array(8),B=new DataView(j.buffer),z=protoInt64.enc(U);return B.setInt32(0,z.lo,!0),B.setInt32(4,z.hi,!0),this.raw(j)}fixed64(U){let j=new Uint8Array(8),B=new DataView(j.buffer),z=protoInt64.uEnc(U);return B.setInt32(0,z.lo,!0),B.setInt32(4,z.hi,!0),this.raw(j)}int64(U){let j=protoInt64.enc(U);return varint64write(j.lo,j.hi,this.buf),this}sint64(U){let j=protoInt64.enc(U),B=j.hi>>31,z=j.lo<<1^B,H=(j.hi<<1|j.lo>>>31)^B;return varint64write(z,H,this.buf),this}uint64(U){let j=protoInt64.uEnc(U);return varint64write(j.lo,j.hi,this.buf),this}}class BinaryReader{constructor(U,j){this.varint64=varint64read,this.uint32=varint32read,this.buf=U,this.len=U.length,this.pos=0,this.view=new DataView(U.buffer,U.byteOffset,U.byteLength),this.textDecoder=j??new TextDecoder}tag(){let U=this.uint32(),j=U>>>3,B=U&7;if(j<=0||B<0||B>5)throw new Error("illegal tag: field no "+j+" wire type "+B);return[j,B]}skip(U,j){let B=this.pos;switch(U){case WireType.Varint:for(;this.buf[this.pos++]&128;);break;case WireType.Bit64:this.pos+=4;case WireType.Bit32:this.pos+=4;break;case WireType.LengthDelimited:let z=this.uint32();this.pos+=z;break;case WireType.StartGroup:for(;;){const[H,G]=this.tag();if(G===WireType.EndGroup){if(j!==void 0&&H!==j)throw new Error("invalid end group tag");break}this.skip(G,H)}break;default:throw new Error("cant skip wire type "+U)}return this.assertBounds(),this.buf.subarray(B,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let U=this.uint32();return U>>>1^-(U&1)}int64(){return protoInt64.dec(...this.varint64())}uint64(){return protoInt64.uDec(...this.varint64())}sint64(){let[U,j]=this.varint64(),B=-(U&1);return U=(U>>>1|(j&1)<<31)^B,j=j>>>1^B,protoInt64.dec(U,j)}bool(){let[U,j]=this.varint64();return U!==0||j!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return protoInt64.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return protoInt64.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let U=this.uint32(),j=this.pos;return this.pos+=U,this.assertBounds(),this.buf.subarray(j,j+U)}string(){return this.textDecoder.decode(this.bytes())}}function makeExtension(V,U,j,B){let z;return{typeName:U,extendee:j,get field(){if(!z){const H=typeof B=="function"?B():B;H.name=U.split(".").pop(),H.jsonName="[".concat(U,"]"),z=V.util.newFieldList([H]).list()[0]}return z},runtime:V}}function createExtensionContainer(V){const U=V.field.localName,j=Object.create(null);return j[U]=initExtensionField(V),[j,()=>j[U]]}function initExtensionField(V){const U=V.field;if(U.repeated)return[];if(U.default!==void 0)return U.default;switch(U.kind){case"enum":return U.T.values[0].no;case"scalar":return scalarZeroValue(U.T,U.L);case"message":const j=U.T,B=new j;return j.fieldWrapper?j.fieldWrapper.unwrapField(B):B;case"map":throw"map fields are not allowed to be extensions"}}function filterUnknownFields(V,U){if(!U.repeated&&(U.kind=="enum"||U.kind=="scalar")){for(let j=V.length-1;j>=0;--j)if(V[j].no==U.no)return[V[j]];return[]}return V.filter(j=>j.no===U.no)}let encTable="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),decTable=[];for(let V=0;V<encTable.length;V++)decTable[encTable[V].charCodeAt(0)]=V;decTable[45]=encTable.indexOf("+"),decTable[95]=encTable.indexOf("/");const protoBase64={dec(V){let U=V.length*3/4;V[V.length-2]=="="?U-=2:V[V.length-1]=="="&&(U-=1);let j=new Uint8Array(U),B=0,z=0,H,G=0;for(let $=0;$<V.length;$++){if(H=decTable[V.charCodeAt($)],H===void 0)switch(V[$]){case"=":z=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(z){case 0:G=H,z=1;break;case 1:j[B++]=G<<2|(H&48)>>4,G=H,z=2;break;case 2:j[B++]=(G&15)<<4|(H&60)>>2,G=H,z=3;break;case 3:j[B++]=(G&3)<<6|H,z=0;break}}if(z==1)throw Error("invalid base64 string.");return j.subarray(0,B)},enc(V){let U="",j=0,B,z=0;for(let H=0;H<V.length;H++)switch(B=V[H],j){case 0:U+=encTable[B>>2],z=(B&3)<<4,j=1;break;case 1:U+=encTable[z|B>>4],z=(B&15)<<2,j=2;break;case 2:U+=encTable[z|B>>6],U+=encTable[B&63],j=0;break}return j&&(U+=encTable[z],U+="=",j==1&&(U+="=")),U}};function getExtension(V,U,j){assertExtendee(U,V);const B=U.runtime.bin.makeReadOptions(j),z=filterUnknownFields(V.getType().runtime.bin.listUnknownFields(V),U.field),[H,G]=createExtensionContainer(U);for(const $ of z)U.runtime.bin.readField(H,B.readerFactory($.data),U.field,$.wireType,B);return G()}function setExtension(V,U,j,B){assertExtendee(U,V);const z=U.runtime.bin.makeReadOptions(B),H=U.runtime.bin.makeWriteOptions(B);if(hasExtension(V,U)){const W=V.getType().runtime.bin.listUnknownFields(V).filter(X=>X.no!=U.field.no);V.getType().runtime.bin.discardUnknownFields(V);for(const X of W)V.getType().runtime.bin.onUnknownField(V,X.no,X.wireType,X.data)}const G=H.writerFactory();let $=U.field;!$.opt&&!$.repeated&&($.kind=="enum"||$.kind=="scalar")&&($=Object.assign(Object.assign({},U.field),{opt:!0})),U.runtime.bin.writeField($,j,G,H);const Q=z.readerFactory(G.finish());for(;Q.pos<Q.len;){const[W,X]=Q.tag(),ee=Q.skip(X,W);V.getType().runtime.bin.onUnknownField(V,W,X,ee)}}function hasExtension(V,U){const j=V.getType();return U.extendee.typeName===j.typeName&&!!j.runtime.bin.listUnknownFields(V).find(B=>B.no==U.field.no)}function assertExtendee(V,U){assert(V.extendee.typeName==U.getType().typeName,"extension ".concat(V.typeName," can only be applied to message ").concat(V.extendee.typeName))}function isFieldSet(V,U){const j=V.localName;if(V.repeated)return U[j].length>0;if(V.oneof)return U[V.oneof.localName].case===j;switch(V.kind){case"enum":case"scalar":return V.opt||V.req?U[j]!==void 0:V.kind=="enum"?U[j]!==V.T.values[0].no:!isScalarZeroValue(V.T,U[j]);case"message":return U[j]!==void 0;case"map":return Object.keys(U[j]).length>0}}function clearField(V,U){const j=V.localName,B=!V.opt&&!V.req;if(V.repeated)U[j]=[];else if(V.oneof)U[V.oneof.localName]={case:void 0};else switch(V.kind){case"map":U[j]={};break;case"enum":U[j]=B?V.T.values[0].no:void 0;break;case"scalar":U[j]=B?scalarZeroValue(V.T,V.L):void 0;break;case"message":U[j]=void 0;break}}function isMessage(V,U){if(V===null||typeof V!="object"||!Object.getOwnPropertyNames(Message.prototype).every(B=>B in V&&typeof V[B]=="function"))return!1;const j=V.getType();return j===null||typeof j!="function"||!("typeName"in j)||typeof j.typeName!="string"?!1:U===void 0?!0:j.typeName==U.typeName}function wrapField(V,U){return isMessage(U)||!V.fieldWrapper?U:V.fieldWrapper.wrapField(U)}ScalarType.DOUBLE,ScalarType.FLOAT,ScalarType.INT64,ScalarType.UINT64,ScalarType.INT32,ScalarType.UINT32,ScalarType.BOOL,ScalarType.STRING,ScalarType.BYTES;const jsonReadDefaults={ignoreUnknownFields:!1},jsonWriteDefaults={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function makeReadOptions$1(V){return V?Object.assign(Object.assign({},jsonReadDefaults),V):jsonReadDefaults}function makeWriteOptions$1(V){return V?Object.assign(Object.assign({},jsonWriteDefaults),V):jsonWriteDefaults}const tokenNull=Symbol(),tokenIgnoredUnknownEnum=Symbol();function makeJsonFormat(){return{makeReadOptions:makeReadOptions$1,makeWriteOptions:makeWriteOptions$1,readMessage(V,U,j,B){if(U==null||Array.isArray(U)||typeof U!="object")throw new Error("cannot decode message ".concat(V.typeName," from JSON: ").concat(debugJsonValue(U)));B=B??new V;const z=new Map,H=j.typeRegistry;for(const[G,$]of Object.entries(U)){const Q=V.fields.findJsonName(G);if(Q){if(Q.oneof){if($===null&&Q.kind=="scalar")continue;const W=z.get(Q.oneof);if(W!==void 0)throw new Error("cannot decode message ".concat(V.typeName,' from JSON: multiple keys for oneof "').concat(Q.oneof.name,'" present: "').concat(W,'", "').concat(G,'"'));z.set(Q.oneof,G)}readField$1(B,$,Q,j,V)}else{let W=!1;if(H?.findExtension&&G.startsWith("[")&&G.endsWith("]")){const X=H.findExtension(G.substring(1,G.length-1));if(X&&X.extendee.typeName==V.typeName){W=!0;const[ee,ie]=createExtensionContainer(X);readField$1(ee,$,X.field,j,X),setExtension(B,X,ie(),j)}}if(!W&&!j.ignoreUnknownFields)throw new Error("cannot decode message ".concat(V.typeName,' from JSON: key "').concat(G,'" is unknown'))}}return B},writeMessage(V,U){const j=V.getType(),B={};let z;try{for(z of j.fields.byNumber()){if(!isFieldSet(z,V)){if(z.req)throw"required field not set";if(!U.emitDefaultValues||!canEmitFieldDefaultValue(z))continue}const G=z.oneof?V[z.oneof.localName].value:V[z.localName],$=writeField$1(z,G,U);$!==void 0&&(B[U.useProtoFieldName?z.name:z.jsonName]=$)}const H=U.typeRegistry;if(H?.findExtensionFor)for(const G of j.runtime.bin.listUnknownFields(V)){const $=H.findExtensionFor(j.typeName,G.no);if($&&hasExtension(V,$)){const Q=getExtension(V,$,U),W=writeField$1($.field,Q,U);W!==void 0&&(B[$.field.jsonName]=W)}}}catch(H){const G=z?"cannot encode field ".concat(j.typeName,".").concat(z.name," to JSON"):"cannot encode message ".concat(j.typeName," to JSON"),$=H instanceof Error?H.message:String(H);throw new Error(G+($.length>0?": ".concat($):""))}return B},readScalar(V,U,j){return readScalar$1(V,U,j??LongType.BIGINT,!0)},writeScalar(V,U,j){if(U!==void 0&&(j||isScalarZeroValue(V,U)))return writeScalar$1(V,U)},debug:debugJsonValue}}function debugJsonValue(V){if(V===null)return"null";switch(typeof V){case"object":return Array.isArray(V)?"array":"object";case"string":return V.length>100?"string":'"'.concat(V.split('"').join('\\"'),'"');default:return String(V)}}function readField$1(V,U,j,B,z){let H=j.localName;if(j.repeated){if(assert(j.kind!="map"),U===null)return;if(!Array.isArray(U))throw new Error("cannot decode field ".concat(z.typeName,".").concat(j.name," from JSON: ").concat(debugJsonValue(U)));const G=V[H];for(const $ of U){if($===null)throw new Error("cannot decode field ".concat(z.typeName,".").concat(j.name," from JSON: ").concat(debugJsonValue($)));switch(j.kind){case"message":G.push(j.T.fromJson($,B));break;case"enum":const Q=readEnum(j.T,$,B.ignoreUnknownFields,!0);Q!==tokenIgnoredUnknownEnum&&G.push(Q);break;case"scalar":try{G.push(readScalar$1(j.T,$,j.L,!0))}catch(W){let X="cannot decode field ".concat(z.typeName,".").concat(j.name," from JSON: ").concat(debugJsonValue($));throw W instanceof Error&&W.message.length>0&&(X+=": ".concat(W.message)),new Error(X)}break}}}else if(j.kind=="map"){if(U===null)return;if(typeof U!="object"||Array.isArray(U))throw new Error("cannot decode field ".concat(z.typeName,".").concat(j.name," from JSON: ").concat(debugJsonValue(U)));const G=V[H];for(const[$,Q]of Object.entries(U)){if(Q===null)throw new Error("cannot decode field ".concat(z.typeName,".").concat(j.name," from JSON: map value null"));let W;try{W=readMapKey(j.K,$)}catch(X){let ee="cannot decode map key for field ".concat(z.typeName,".").concat(j.name," from JSON: ").concat(debugJsonValue(U));throw X instanceof Error&&X.message.length>0&&(ee+=": ".concat(X.message)),new Error(ee)}switch(j.V.kind){case"message":G[W]=j.V.T.fromJson(Q,B);break;case"enum":const X=readEnum(j.V.T,Q,B.ignoreUnknownFields,!0);X!==tokenIgnoredUnknownEnum&&(G[W]=X);break;case"scalar":try{G[W]=readScalar$1(j.V.T,Q,LongType.BIGINT,!0)}catch(ee){let ie="cannot decode map value for field ".concat(z.typeName,".").concat(j.name," from JSON: ").concat(debugJsonValue(U));throw ee instanceof Error&&ee.message.length>0&&(ie+=": ".concat(ee.message)),new Error(ie)}break}}}else switch(j.oneof&&(V=V[j.oneof.localName]={case:H},H="value"),j.kind){case"message":const G=j.T;if(U===null&&G.typeName!="google.protobuf.Value")return;let $=V[H];isMessage($)?$.fromJson(U,B):(V[H]=$=G.fromJson(U,B),G.fieldWrapper&&!j.oneof&&(V[H]=G.fieldWrapper.unwrapField($)));break;case"enum":const Q=readEnum(j.T,U,B.ignoreUnknownFields,!1);switch(Q){case tokenNull:clearField(j,V);break;case tokenIgnoredUnknownEnum:break;default:V[H]=Q;break}break;case"scalar":try{const W=readScalar$1(j.T,U,j.L,!1);switch(W){case tokenNull:clearField(j,V);break;default:V[H]=W;break}}catch(W){let X="cannot decode field ".concat(z.typeName,".").concat(j.name," from JSON: ").concat(debugJsonValue(U));throw W instanceof Error&&W.message.length>0&&(X+=": ".concat(W.message)),new Error(X)}break}}function readMapKey(V,U){if(V===ScalarType.BOOL)switch(U){case"true":U=!0;break;case"false":U=!1;break}return readScalar$1(V,U,LongType.BIGINT,!0).toString()}function readScalar$1(V,U,j,B){if(U===null)return B?scalarZeroValue(V,j):tokenNull;switch(V){case ScalarType.DOUBLE:case ScalarType.FLOAT:if(U==="NaN")return Number.NaN;if(U==="Infinity")return Number.POSITIVE_INFINITY;if(U==="-Infinity")return Number.NEGATIVE_INFINITY;if(U===""||typeof U=="string"&&U.trim().length!==U.length||typeof U!="string"&&typeof U!="number")break;const z=Number(U);if(Number.isNaN(z)||!Number.isFinite(z))break;return V==ScalarType.FLOAT&&assertFloat32(z),z;case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.UINT32:let H;if(typeof U=="number"?H=U:typeof U=="string"&&U.length>0&&U.trim().length===U.length&&(H=Number(U)),H===void 0)break;return V==ScalarType.UINT32||V==ScalarType.FIXED32?assertUInt32(H):assertInt32(H),H;case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:if(typeof U!="number"&&typeof U!="string")break;const G=protoInt64.parse(U);return j?G.toString():G;case ScalarType.FIXED64:case ScalarType.UINT64:if(typeof U!="number"&&typeof U!="string")break;const $=protoInt64.uParse(U);return j?$.toString():$;case ScalarType.BOOL:if(typeof U!="boolean")break;return U;case ScalarType.STRING:if(typeof U!="string")break;try{encodeURIComponent(U)}catch{throw new Error("invalid UTF8")}return U;case ScalarType.BYTES:if(U==="")return new Uint8Array(0);if(typeof U!="string")break;return protoBase64.dec(U)}throw new Error}function readEnum(V,U,j,B){if(U===null)return V.typeName=="google.protobuf.NullValue"?0:B?V.values[0].no:tokenNull;switch(typeof U){case"number":if(Number.isInteger(U))return U;break;case"string":const z=V.findName(U);if(z!==void 0)return z.no;if(j)return tokenIgnoredUnknownEnum;break}throw new Error("cannot decode enum ".concat(V.typeName," from JSON: ").concat(debugJsonValue(U)))}function canEmitFieldDefaultValue(V){return V.repeated||V.kind=="map"?!0:!(V.oneof||V.kind=="message"||V.opt||V.req)}function writeField$1(V,U,j){if(V.kind=="map"){assert(typeof U=="object"&&U!=null);const B={},z=Object.entries(U);switch(V.V.kind){case"scalar":for(const[G,$]of z)B[G.toString()]=writeScalar$1(V.V.T,$);break;case"message":for(const[G,$]of z)B[G.toString()]=$.toJson(j);break;case"enum":const H=V.V.T;for(const[G,$]of z)B[G.toString()]=writeEnum(H,$,j.enumAsInteger);break}return j.emitDefaultValues||z.length>0?B:void 0}if(V.repeated){assert(Array.isArray(U));const B=[];switch(V.kind){case"scalar":for(let z=0;z<U.length;z++)B.push(writeScalar$1(V.T,U[z]));break;case"enum":for(let z=0;z<U.length;z++)B.push(writeEnum(V.T,U[z],j.enumAsInteger));break;case"message":for(let z=0;z<U.length;z++)B.push(U[z].toJson(j));break}return j.emitDefaultValues||B.length>0?B:void 0}switch(V.kind){case"scalar":return writeScalar$1(V.T,U);case"enum":return writeEnum(V.T,U,j.enumAsInteger);case"message":return wrapField(V.T,U).toJson(j)}}function writeEnum(V,U,j){var B;if(assert(typeof U=="number"),V.typeName=="google.protobuf.NullValue")return null;if(j)return U;const z=V.findNumber(U);return(B=z?.name)!==null&&B!==void 0?B:U}function writeScalar$1(V,U){switch(V){case ScalarType.INT32:case ScalarType.SFIXED32:case ScalarType.SINT32:case ScalarType.FIXED32:case ScalarType.UINT32:return assert(typeof U=="number"),U;case ScalarType.FLOAT:case ScalarType.DOUBLE:return assert(typeof U=="number"),Number.isNaN(U)?"NaN":U===Number.POSITIVE_INFINITY?"Infinity":U===Number.NEGATIVE_INFINITY?"-Infinity":U;case ScalarType.STRING:return assert(typeof U=="string"),U;case ScalarType.BOOL:return assert(typeof U=="boolean"),U;case ScalarType.UINT64:case ScalarType.FIXED64:case ScalarType.INT64:case ScalarType.SFIXED64:case ScalarType.SINT64:return assert(typeof U=="bigint"||typeof U=="string"||typeof U=="number"),U.toString();case ScalarType.BYTES:return assert(U instanceof Uint8Array),protoBase64.enc(U)}}const unknownFieldsSymbol=Symbol("@bufbuild/protobuf/unknown-fields"),readDefaults={readUnknownFields:!0,readerFactory:V=>new BinaryReader(V)},writeDefaults={writeUnknownFields:!0,writerFactory:()=>new BinaryWriter};function makeReadOptions(V){return V?Object.assign(Object.assign({},readDefaults),V):readDefaults}function makeWriteOptions(V){return V?Object.assign(Object.assign({},writeDefaults),V):writeDefaults}function makeBinaryFormat(){return{makeReadOptions,makeWriteOptions,listUnknownFields(V){var U;return(U=V[unknownFieldsSymbol])!==null&&U!==void 0?U:[]},discardUnknownFields(V){delete V[unknownFieldsSymbol]},writeUnknownFields(V,U){const B=V[unknownFieldsSymbol];if(B)for(const z of B)U.tag(z.no,z.wireType).raw(z.data)},onUnknownField(V,U,j,B){const z=V;Array.isArray(z[unknownFieldsSymbol])||(z[unknownFieldsSymbol]=[]),z[unknownFieldsSymbol].push({no:U,wireType:j,data:B})},readMessage(V,U,j,B,z){const H=V.getType(),G=z?U.len:U.pos+j;let $,Q;for(;U.pos<G&&([$,Q]=U.tag(),!(z===!0&&Q==WireType.EndGroup));){const W=H.fields.find($);if(!W){const X=U.skip(Q,$);B.readUnknownFields&&this.onUnknownField(V,$,Q,X);continue}readField(V,U,W,Q,B)}if(z&&(Q!=WireType.EndGroup||$!==j))throw new Error("invalid end group tag")},readField,writeMessage(V,U,j){const B=V.getType();for(const z of B.fields.byNumber()){if(!isFieldSet(z,V)){if(z.req)throw new Error("cannot encode field ".concat(B.typeName,".").concat(z.name," to binary: required field not set"));continue}const H=z.oneof?V[z.oneof.localName].value:V[z.localName];writeField(z,H,U,j)}return j.writeUnknownFields&&this.writeUnknownFields(V,U),U},writeField(V,U,j,B){U!==void 0&&writeField(V,U,j,B)}}}function readField(V,U,j,B,z){let{repeated:H,localName:G}=j;switch(j.oneof&&(V=V[j.oneof.localName],V.case!=G&&delete V.value,V.case=G,G="value"),j.kind){case"scalar":case"enum":const $=j.kind=="enum"?ScalarType.INT32:j.T;let Q=readScalar;if(j.kind=="scalar"&&j.L>0&&(Q=readScalarLTString),H){let ie=V[G];if(B==WireType.LengthDelimited&&$!=ScalarType.STRING&&$!=ScalarType.BYTES){let re=U.uint32()+U.pos;for(;U.pos<re;)ie.push(Q(U,$))}else ie.push(Q(U,$))}else V[G]=Q(U,$);break;case"message":const W=j.T;H?V[G].push(readMessageField(U,new W,z,j)):isMessage(V[G])?readMessageField(U,V[G],z,j):(V[G]=readMessageField(U,new W,z,j),W.fieldWrapper&&!j.oneof&&!j.repeated&&(V[G]=W.fieldWrapper.unwrapField(V[G])));break;case"map":let[X,ee]=readMapEntry(j,U,z);V[G][X]=ee;break}}function readMessageField(V,U,j,B){const z=U.getType().runtime.bin,H=B?.delimited;return z.readMessage(U,V,H?B.no:V.uint32(),j,H),U}function readMapEntry(V,U,j){const B=U.uint32(),z=U.pos+B;let H,G;for(;U.pos<z;){const[$]=U.tag();switch($){case 1:H=readScalar(U,V.K);break;case 2:switch(V.V.kind){case"scalar":G=readScalar(U,V.V.T);break;case"enum":G=U.int32();break;case"message":G=readMessageField(U,new V.V.T,j,void 0);break}break}}if(H===void 0&&(H=scalarZeroValue(V.K,LongType.BIGINT)),typeof H!="string"&&typeof H!="number"&&(H=H.toString()),G===void 0)switch(V.V.kind){case"scalar":G=scalarZeroValue(V.V.T,LongType.BIGINT);break;case"enum":G=V.V.T.values[0].no;break;case"message":G=new V.V.T;break}return[H,G]}function readScalarLTString(V,U){const j=readScalar(V,U);return typeof j=="bigint"?j.toString():j}function readScalar(V,U){switch(U){case ScalarType.STRING:return V.string();case ScalarType.BOOL:return V.bool();case ScalarType.DOUBLE:return V.double();case ScalarType.FLOAT:return V.float();case ScalarType.INT32:return V.int32();case ScalarType.INT64:return V.int64();case ScalarType.UINT64:return V.uint64();case ScalarType.FIXED64:return V.fixed64();case ScalarType.BYTES:return V.bytes();case ScalarType.FIXED32:return V.fixed32();case ScalarType.SFIXED32:return V.sfixed32();case ScalarType.SFIXED64:return V.sfixed64();case ScalarType.SINT64:return V.sint64();case ScalarType.UINT32:return V.uint32();case ScalarType.SINT32:return V.sint32()}}function writeField(V,U,j,B){assert(U!==void 0);const z=V.repeated;switch(V.kind){case"scalar":case"enum":let H=V.kind=="enum"?ScalarType.INT32:V.T;if(z)if(assert(Array.isArray(U)),V.packed)writePacked(j,H,V.no,U);else for(const G of U)writeScalar(j,H,V.no,G);else writeScalar(j,H,V.no,U);break;case"message":if(z){assert(Array.isArray(U));for(const G of U)writeMessageField(j,B,V,G)}else writeMessageField(j,B,V,U);break;case"map":assert(typeof U=="object"&&U!=null);for(const[G,$]of Object.entries(U))writeMapEntry(j,B,V,G,$);break}}function writeMapEntry(V,U,j,B,z){V.tag(j.no,WireType.LengthDelimited),V.fork();let H=B;switch(j.K){case ScalarType.INT32:case ScalarType.FIXED32:case ScalarType.UINT32:case ScalarType.SFIXED32:case ScalarType.SINT32:H=Number.parseInt(B);break;case ScalarType.BOOL:assert(B=="true"||B=="false"),H=B=="true";break}switch(writeScalar(V,j.K,1,H),j.V.kind){case"scalar":writeScalar(V,j.V.T,2,z);break;case"enum":writeScalar(V,ScalarType.INT32,2,z);break;case"message":assert(z!==void 0),V.tag(2,WireType.LengthDelimited).bytes(z.toBinary(U));break}V.join()}function writeMessageField(V,U,j,B){const z=wrapField(j.T,B);j.delimited?V.tag(j.no,WireType.StartGroup).raw(z.toBinary(U)).tag(j.no,WireType.EndGroup):V.tag(j.no,WireType.LengthDelimited).bytes(z.toBinary(U))}function writeScalar(V,U,j,B){assert(B!==void 0);let[z,H]=scalarTypeInfo(U);V.tag(j,z)[H](B)}function writePacked(V,U,j,B){if(!B.length)return;V.tag(j,WireType.LengthDelimited).fork();let[,z]=scalarTypeInfo(U);for(let H=0;H<B.length;H++)V[z](B[H]);V.join()}function scalarTypeInfo(V){let U=WireType.Varint;switch(V){case ScalarType.BYTES:case ScalarType.STRING:U=WireType.LengthDelimited;break;case ScalarType.DOUBLE:case ScalarType.FIXED64:case ScalarType.SFIXED64:U=WireType.Bit64;break;case ScalarType.FIXED32:case ScalarType.SFIXED32:case ScalarType.FLOAT:U=WireType.Bit32;break}const j=ScalarType[V].toLowerCase();return[U,j]}function makeUtilCommon(){return{setEnumType,initPartial(V,U){if(V===void 0)return;const j=U.getType();for(const B of j.fields.byMember()){const z=B.localName,H=U,G=V;if(G[z]!=null)switch(B.kind){case"oneof":const $=G[z].case;if($===void 0)continue;const Q=B.findField($);let W=G[z].value;Q&&Q.kind=="message"&&!isMessage(W,Q.T)?W=new Q.T(W):Q&&Q.kind==="scalar"&&Q.T===ScalarType.BYTES&&(W=toU8Arr(W)),H[z]={case:$,value:W};break;case"scalar":case"enum":let X=G[z];B.T===ScalarType.BYTES&&(X=B.repeated?X.map(toU8Arr):toU8Arr(X)),H[z]=X;break;case"map":switch(B.V.kind){case"scalar":case"enum":if(B.V.T===ScalarType.BYTES)for(const[ne,re]of Object.entries(G[z]))H[z][ne]=toU8Arr(re);else Object.assign(H[z],G[z]);break;case"message":const ie=B.V.T;for(const ne of Object.keys(G[z])){let re=G[z][ne];ie.fieldWrapper||(re=new ie(re)),H[z][ne]=re}break}break;case"message":const ee=B.T;if(B.repeated)H[z]=G[z].map(ie=>isMessage(ie,ee)?ie:new ee(ie));else{const ie=G[z];ee.fieldWrapper?ee.typeName==="google.protobuf.BytesValue"?H[z]=toU8Arr(ie):H[z]=ie:H[z]=isMessage(ie,ee)?ie:new ee(ie)}break}}},equals(V,U,j){return U===j?!0:!U||!j?!1:V.fields.byMember().every(B=>{const z=U[B.localName],H=j[B.localName];if(B.repeated){if(z.length!==H.length)return!1;switch(B.kind){case"message":return z.every((G,$)=>B.T.equals(G,H[$]));case"scalar":return z.every((G,$)=>scalarEquals(B.T,G,H[$]));case"enum":return z.every((G,$)=>scalarEquals(ScalarType.INT32,G,H[$]))}throw new Error("repeated cannot contain ".concat(B.kind))}switch(B.kind){case"message":let G=z,$=H;return B.T.fieldWrapper&&(G!==void 0&&!isMessage(G)&&(G=B.T.fieldWrapper.wrapField(G)),$!==void 0&&!isMessage($)&&($=B.T.fieldWrapper.wrapField($))),B.T.equals(G,$);case"enum":return scalarEquals(ScalarType.INT32,z,H);case"scalar":return scalarEquals(B.T,z,H);case"oneof":if(z.case!==H.case)return!1;const Q=B.findField(z.case);if(Q===void 0)return!0;switch(Q.kind){case"message":return Q.T.equals(z.value,H.value);case"enum":return scalarEquals(ScalarType.INT32,z.value,H.value);case"scalar":return scalarEquals(Q.T,z.value,H.value)}throw new Error("oneof cannot contain ".concat(Q.kind));case"map":const W=Object.keys(z).concat(Object.keys(H));switch(B.V.kind){case"message":const X=B.V.T;return W.every(ie=>X.equals(z[ie],H[ie]));case"enum":return W.every(ie=>scalarEquals(ScalarType.INT32,z[ie],H[ie]));case"scalar":const ee=B.V.T;return W.every(ie=>scalarEquals(ee,z[ie],H[ie]))}break}})},clone(V){const U=V.getType(),j=new U,B=j;for(const z of U.fields.byMember()){const H=V[z.localName];let G;if(z.repeated)G=H.map(cloneSingularField);else if(z.kind=="map"){G=B[z.localName];for(const[$,Q]of Object.entries(H))G[$]=cloneSingularField(Q)}else z.kind=="oneof"?G=z.findField(H.case)?{case:H.case,value:cloneSingularField(H.value)}:{case:void 0}:G=cloneSingularField(H);B[z.localName]=G}for(const z of U.runtime.bin.listUnknownFields(V))U.runtime.bin.onUnknownField(B,z.no,z.wireType,z.data);return j}}}function cloneSingularField(V){if(V===void 0)return V;if(isMessage(V))return V.clone();if(V instanceof Uint8Array){const U=new Uint8Array(V.byteLength);return U.set(V),U}return V}function toU8Arr(V){return V instanceof Uint8Array?V:new Uint8Array(V)}function makeProtoRuntime(V,U,j){return{syntax:V,json:makeJsonFormat(),bin:makeBinaryFormat(),util:Object.assign(Object.assign({},makeUtilCommon()),{newFieldList:U,initFields:j}),makeMessageType(B,z,H){return makeMessageType(this,B,z,H)},makeEnum,makeEnumType,getEnumType,makeExtension(B,z,H){return makeExtension(this,B,z,H)}}}class InternalFieldList{constructor(U,j){this._fields=U,this._normalizer=j}findJsonName(U){if(!this.jsonNames){const j={};for(const B of this.list())j[B.jsonName]=j[B.name]=B;this.jsonNames=j}return this.jsonNames[U]}find(U){if(!this.numbers){const j={};for(const B of this.list())j[B.no]=B;this.numbers=j}return this.numbers[U]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((U,j)=>U.no-j.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const U=this.members;let j;for(const B of this.list())B.oneof?B.oneof!==j&&(j=B.oneof,U.push(j)):U.push(B)}return this.members}}function localFieldName(V,U){const j=protoCamelCase(V);return U?j:safeObjectProperty(safeMessageProperty(j))}function localOneofName(V){return localFieldName(V,!1)}const fieldJsonName=protoCamelCase;function protoCamelCase(V){let U=!1;const j=[];for(let B=0;B<V.length;B++){let z=V.charAt(B);switch(z){case"_":U=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":j.push(z),U=!1;break;default:U&&(U=!1,z=z.toUpperCase()),j.push(z);break}}return j.join("")}const reservedObjectProperties=new Set(["constructor","toString","toJSON","valueOf"]),reservedMessageProperties=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),fallback=V=>"".concat(V,"$"),safeMessageProperty=V=>reservedMessageProperties.has(V)?fallback(V):V,safeObjectProperty=V=>reservedObjectProperties.has(V)?fallback(V):V;class InternalOneofInfo{constructor(U){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=U,this.localName=localOneofName(U)}addField(U){assert(U.oneof===this,"field ".concat(U.name," not one of ").concat(this.name)),this.fields.push(U)}findField(U){if(!this._lookup){this._lookup=Object.create(null);for(let j=0;j<this.fields.length;j++)this._lookup[this.fields[j].localName]=this.fields[j]}return this._lookup[U]}}function normalizeFieldInfos(V,U){var j,B,z,H,G,$;const Q=[];let W;for(const X of typeof V=="function"?V():V){const ee=X;if(ee.localName=localFieldName(X.name,X.oneof!==void 0),ee.jsonName=(j=X.jsonName)!==null&&j!==void 0?j:fieldJsonName(X.name),ee.repeated=(B=X.repeated)!==null&&B!==void 0?B:!1,X.kind=="scalar"&&(ee.L=(z=X.L)!==null&&z!==void 0?z:LongType.BIGINT),ee.delimited=(H=X.delimited)!==null&&H!==void 0?H:!1,ee.req=(G=X.req)!==null&&G!==void 0?G:!1,ee.opt=($=X.opt)!==null&&$!==void 0?$:!1,X.packed===void 0&&(ee.packed=X.kind=="enum"||X.kind=="scalar"&&X.T!=ScalarType.BYTES&&X.T!=ScalarType.STRING),X.oneof!==void 0){const ie=typeof X.oneof=="string"?X.oneof:X.oneof.name;(!W||W.name!=ie)&&(W=new InternalOneofInfo(ie)),ee.oneof=W,W.addField(ee)}Q.push(ee)}return Q}const proto3=makeProtoRuntime("proto3",V=>new InternalFieldList(V,U=>normalizeFieldInfos(U)),V=>{for(const U of V.getType().fields.byMember()){if(U.opt)continue;const j=U.localName,B=V;if(U.repeated){B[j]=[];continue}switch(U.kind){case"oneof":B[j]={case:void 0};break;case"enum":B[j]=0;break;case"map":B[j]={};break;case"scalar":B[j]=scalarZeroValue(U.T,U.L);break}}});class Timestamp extends Message{constructor(U){super(),this.seconds=protoInt64.zero,this.nanos=0,proto3.util.initPartial(U,this)}fromJson(U,j){if(typeof U!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(proto3.json.debug(U)));const B=U.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!B)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const z=Date.parse(B[1]+"-"+B[2]+"-"+B[3]+"T"+B[4]+":"+B[5]+":"+B[6]+(B[8]?B[8]:"Z"));if(Number.isNaN(z))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(z<Date.parse("0001-01-01T00:00:00Z")||z>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=protoInt64.parse(z/1e3),this.nanos=0,B[7]&&(this.nanos=parseInt("1"+B[7]+"0".repeat(9-B[7].length))-1e9),this}toJson(U){const j=Number(this.seconds)*1e3;if(j<Date.parse("0001-01-01T00:00:00Z")||j>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let B="Z";if(this.nanos>0){const z=(this.nanos+1e9).toString().substring(1);z.substring(3)==="000000"?B="."+z.substring(0,3)+"Z":z.substring(6)==="000"?B="."+z.substring(0,6)+"Z":B="."+z+"Z"}return new Date(j).toISOString().replace(".000Z",B)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Timestamp.fromDate(new Date)}static fromDate(U){const j=U.getTime();return new Timestamp({seconds:protoInt64.parse(Math.floor(j/1e3)),nanos:j%1e3*1e6})}static fromBinary(U,j){return new Timestamp().fromBinary(U,j)}static fromJson(U,j){return new Timestamp().fromJson(U,j)}static fromJsonString(U,j){return new Timestamp().fromJsonString(U,j)}static equals(U,j){return proto3.util.equals(Timestamp,U,j)}}Timestamp.runtime=proto3,Timestamp.typeName="google.protobuf.Timestamp",Timestamp.fields=proto3.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const MetricsBatch=proto3.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Timestamp},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:TimeSeriesMetric,repeated:!0},{no:5,name:"events",kind:"message",T:EventMetric,repeated:!0}]),TimeSeriesMetric=proto3.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:MetricSample,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),MetricSample=proto3.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Timestamp},{no:3,name:"value",kind:"scalar",T:2}]),EventMetric=proto3.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Timestamp},{no:7,name:"normalized_end_timestamp",kind:"message",T:Timestamp,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),BackupCodecPolicy$1=proto3.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),TrackType=proto3.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),TrackSource=proto3.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),VideoQuality$1=proto3.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),ConnectionQuality$1=proto3.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),ClientConfigSetting=proto3.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),DisconnectReason=proto3.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),ReconnectReason=proto3.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),SubscriptionError=proto3.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),AudioTrackFeature=proto3.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Room$1=proto3.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Codec,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:TimedVersion}]),Codec=proto3.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),ParticipantPermission=proto3.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:proto3.getEnumType(TrackSource),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),ParticipantInfo=proto3.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(ParticipantInfo_State)},{no:4,name:"tracks",kind:"message",T:TrackInfo,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ParticipantPermission},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:proto3.getEnumType(ParticipantInfo_Kind)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:proto3.getEnumType(DisconnectReason)},{no:18,name:"kind_details",kind:"enum",T:proto3.getEnumType(ParticipantInfo_KindDetail),repeated:!0}]),ParticipantInfo_State=proto3.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ParticipantInfo_Kind=proto3.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),ParticipantInfo_KindDetail=proto3.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Encryption_Type=proto3.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),SimulcastCodecInfo=proto3.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]),TrackInfo=proto3.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:proto3.getEnumType(TrackType)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource)},{no:10,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:SimulcastCodecInfo,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:TimedVersion},{no:19,name:"audio_features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:proto3.getEnumType(BackupCodecPolicy$1)}]),VideoLayer=proto3.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),DataPacket=proto3.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:proto3.getEnumType(DataPacket_Kind)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:UserPacket,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ActiveSpeakerUpdate,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:SipDTMF,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Transcription,oneof:"value"},{no:8,name:"metrics",kind:"message",T:MetricsBatch,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:ChatMessage,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:RpcRequest,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:RpcAck,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:RpcResponse,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:DataStream_Header,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:DataStream_Chunk,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:DataStream_Trailer,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),DataPacket_Kind=proto3.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),ActiveSpeakerUpdate=proto3.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]),SpeakerInfo=proto3.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),UserPacket=proto3.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),SipDTMF=proto3.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Transcription=proto3.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:TranscriptionSegment,repeated:!0}]),TranscriptionSegment=proto3.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),ChatMessage=proto3.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),RpcRequest=proto3.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),RpcAck=proto3.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),RpcResponse=proto3.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:RpcError$1,oneof:"value"}]),RpcError$1=proto3.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),ParticipantTracks=proto3.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),ServerInfo=proto3.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:proto3.getEnumType(ServerInfo_Edition)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),ServerInfo_Edition=proto3.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),ClientInfo=proto3.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:proto3.getEnumType(ClientInfo_SDK)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),ClientInfo_SDK=proto3.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),ClientConfiguration=proto3.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:VideoConfiguration},{no:2,name:"screen",kind:"message",T:VideoConfiguration},{no:3,name:"resume_connection",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)},{no:4,name:"disabled_codecs",kind:"message",T:DisabledCodecs},{no:5,name:"force_relay",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)}]),VideoConfiguration=proto3.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:proto3.getEnumType(ClientConfigSetting)}]),DisabledCodecs=proto3.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Codec,repeated:!0},{no:2,name:"publish",kind:"message",T:Codec,repeated:!0}]),TimedVersion=proto3.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),DataStream_OperationType=proto3.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),DataStream_TextHeader=proto3.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:proto3.getEnumType(DataStream_OperationType)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),DataStream_ByteHeader=proto3.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),DataStream_Header=proto3.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:DataStream_TextHeader,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:DataStream_ByteHeader,oneof:"content_header"}],{localName:"DataStream_Header"}),DataStream_Chunk=proto3.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),DataStream_Trailer=proto3.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),SignalTarget=proto3.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),StreamState=proto3.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),CandidateProtocol=proto3.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),SignalRequest=proto3.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:4,name:"add_track",kind:"message",T:AddTrackRequest,oneof:"message"},{no:5,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:6,name:"subscription",kind:"message",T:UpdateSubscription,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:UpdateTrackSettings,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:UpdateVideoLayers,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:SubscriptionPermission,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:SyncState,oneof:"message"},{no:13,name:"simulate",kind:"message",T:SimulateScenario,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:UpdateParticipantMetadata,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ping,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:UpdateLocalAudioTrack,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:UpdateLocalVideoTrack,oneof:"message"}]),SignalResponse=proto3.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:JoinResponse,oneof:"message"},{no:2,name:"answer",kind:"message",T:SessionDescription,oneof:"message"},{no:3,name:"offer",kind:"message",T:SessionDescription,oneof:"message"},{no:4,name:"trickle",kind:"message",T:TrickleRequest,oneof:"message"},{no:5,name:"update",kind:"message",T:ParticipantUpdate,oneof:"message"},{no:6,name:"track_published",kind:"message",T:TrackPublishedResponse,oneof:"message"},{no:8,name:"leave",kind:"message",T:LeaveRequest,oneof:"message"},{no:9,name:"mute",kind:"message",T:MuteTrackRequest,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:SpeakersChanged,oneof:"message"},{no:11,name:"room_update",kind:"message",T:RoomUpdate,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:ConnectionQualityUpdate,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:StreamStateUpdate,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:SubscribedQualityUpdate,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:SubscriptionPermissionUpdate,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:TrackUnpublishedResponse,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:ReconnectResponse,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Pong,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:SubscriptionResponse,oneof:"message"},{no:22,name:"request_response",kind:"message",T:RequestResponse,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:TrackSubscribed,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:RoomMovedResponse,oneof:"message"}]),SimulcastCodec=proto3.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),AddTrackRequest=proto3.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:proto3.getEnumType(TrackType)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:proto3.getEnumType(TrackSource)},{no:9,name:"layers",kind:"message",T:VideoLayer,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:SimulcastCodec,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:proto3.getEnumType(Encryption_Type)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:proto3.getEnumType(BackupCodecPolicy$1)},{no:17,name:"audio_features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0}]),TrickleRequest=proto3.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)},{no:3,name:"final",kind:"scalar",T:8}]),MuteTrackRequest=proto3.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),JoinResponse=proto3.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Room$1},{no:2,name:"participant",kind:"message",T:ParticipantInfo},{no:3,name:"other_participants",kind:"message",T:ParticipantInfo,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:ClientConfiguration},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:ServerInfo},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Codec,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),ReconnectResponse=proto3.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:ICEServer,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:ClientConfiguration},{no:3,name:"server_info",kind:"message",T:ServerInfo},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),TrackPublishedResponse=proto3.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:TrackInfo}]),TrackUnpublishedResponse=proto3.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),SessionDescription=proto3.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),ParticipantUpdate=proto3.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:ParticipantInfo,repeated:!0}]),UpdateSubscription=proto3.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:ParticipantTracks,repeated:!0}]),UpdateTrackSettings=proto3.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),UpdateLocalAudioTrack=proto3.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:proto3.getEnumType(AudioTrackFeature),repeated:!0}]),UpdateLocalVideoTrack=proto3.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),LeaveRequest=proto3.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(DisconnectReason)},{no:3,name:"action",kind:"enum",T:proto3.getEnumType(LeaveRequest_Action)},{no:4,name:"regions",kind:"message",T:RegionSettings}]),LeaveRequest_Action=proto3.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),UpdateVideoLayers=proto3.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:VideoLayer,repeated:!0}]),UpdateParticipantMetadata=proto3.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),ICEServer=proto3.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),SpeakersChanged=proto3.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:SpeakerInfo,repeated:!0}]),RoomUpdate=proto3.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Room$1}]),ConnectionQualityInfo=proto3.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:proto3.getEnumType(ConnectionQuality$1)},{no:3,name:"score",kind:"scalar",T:2}]),ConnectionQualityUpdate=proto3.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:ConnectionQualityInfo,repeated:!0}]),StreamStateInfo=proto3.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:proto3.getEnumType(StreamState)}]),StreamStateUpdate=proto3.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:StreamStateInfo,repeated:!0}]),SubscribedQuality=proto3.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:proto3.getEnumType(VideoQuality$1)},{no:2,name:"enabled",kind:"scalar",T:8}]),SubscribedCodec=proto3.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:SubscribedQuality,repeated:!0}]),SubscribedQualityUpdate=proto3.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:SubscribedQuality,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:SubscribedCodec,repeated:!0}]),TrackPermission=proto3.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),SubscriptionPermission=proto3.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:TrackPermission,repeated:!0}]),SubscriptionPermissionUpdate=proto3.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),RoomMovedResponse=proto3.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Room$1},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:ParticipantInfo},{no:4,name:"other_participants",kind:"message",T:ParticipantInfo,repeated:!0}]),SyncState=proto3.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:SessionDescription},{no:2,name:"subscription",kind:"message",T:UpdateSubscription},{no:3,name:"publish_tracks",kind:"message",T:TrackPublishedResponse,repeated:!0},{no:4,name:"data_channels",kind:"message",T:DataChannelInfo,repeated:!0},{no:5,name:"offer",kind:"message",T:SessionDescription},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:DataChannelReceiveState,repeated:!0}]),DataChannelReceiveState=proto3.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),DataChannelInfo=proto3.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:proto3.getEnumType(SignalTarget)}]),SimulateScenario=proto3.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:proto3.getEnumType(CandidateProtocol),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Ping=proto3.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Pong=proto3.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),RegionSettings=proto3.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:RegionInfo,repeated:!0}]),RegionInfo=proto3.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),SubscriptionResponse=proto3.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:proto3.getEnumType(SubscriptionError)}]),RequestResponse=proto3.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:proto3.getEnumType(RequestResponse_Reason)},{no:3,name:"message",kind:"scalar",T:9}]),RequestResponse_Reason=proto3.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),TrackSubscribed=proto3.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function getDefaultExportFromCjs(V){return V&&V.__esModule&&Object.prototype.hasOwnProperty.call(V,"default")?V.default:V}var loglevel$1={exports:{}},loglevel=loglevel$1.exports,hasRequiredLoglevel;function requireLoglevel(){return hasRequiredLoglevel||(hasRequiredLoglevel=1,function(V){(function(U,j){V.exports?V.exports=j():U.log=j()})(loglevel,function(){var U=function(){},j="undefined",B=typeof window!==j&&typeof window.navigator!==j&&/Trident\/|MSIE /.test(window.navigator.userAgent),z=["trace","debug","info","warn","error"],H={},G=null;function $(se,de){var oe=se[de];if(typeof oe.bind=="function")return oe.bind(se);try{return Function.prototype.bind.call(oe,se)}catch{return function(){return Function.prototype.apply.apply(oe,[se,arguments])}}}function Q(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function W(se){return se==="debug"&&(se="log"),typeof console===j?!1:se==="trace"&&B?Q:console[se]!==void 0?$(console,se):console.log!==void 0?$(console,"log"):U}function X(){for(var se=this.getLevel(),de=0;de<z.length;de++){var oe=z[de];this[oe]=de<se?U:this.methodFactory(oe,se,this.name)}if(this.log=this.debug,typeof console===j&&se<this.levels.SILENT)return"No console available for logging"}function ee(se){return function(){typeof console!==j&&(X.call(this),this[se].apply(this,arguments))}}function ie(se,de,oe){return W(se)||ee.apply(this,arguments)}function ne(se,de){var oe=this,le,ue,fe,he="loglevel";typeof se=="string"?he+=":"+se:typeof se=="symbol"&&(he=void 0);function ge(Ce){var ze=(z[Ce]||"silent").toUpperCase();if(!(typeof window===j||!he)){try{window.localStorage[he]=ze;return}catch{}try{window.document.cookie=encodeURIComponent(he)+"="+ze+";"}catch{}}}function Ae(){var Ce;if(!(typeof window===j||!he)){try{Ce=window.localStorage[he]}catch{}if(typeof Ce===j)try{var ze=window.document.cookie,$e=encodeURIComponent(he),Fe=ze.indexOf($e+"=");Fe!==-1&&(Ce=/^([^;]+)/.exec(ze.slice(Fe+$e.length+1))[1])}catch{}return oe.levels[Ce]===void 0&&(Ce=void 0),Ce}}function _e(){if(!(typeof window===j||!he)){try{window.localStorage.removeItem(he)}catch{}try{window.document.cookie=encodeURIComponent(he)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function Pe(Ce){var ze=Ce;if(typeof ze=="string"&&oe.levels[ze.toUpperCase()]!==void 0&&(ze=oe.levels[ze.toUpperCase()]),typeof ze=="number"&&ze>=0&&ze<=oe.levels.SILENT)return ze;throw new TypeError("log.setLevel() called with invalid level: "+Ce)}oe.name=se,oe.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},oe.methodFactory=de||ie,oe.getLevel=function(){return fe??ue??le},oe.setLevel=function(Ce,ze){return fe=Pe(Ce),ze!==!1&&ge(fe),X.call(oe)},oe.setDefaultLevel=function(Ce){ue=Pe(Ce),Ae()||oe.setLevel(Ce,!1)},oe.resetLevel=function(){fe=null,_e(),X.call(oe)},oe.enableAll=function(Ce){oe.setLevel(oe.levels.TRACE,Ce)},oe.disableAll=function(Ce){oe.setLevel(oe.levels.SILENT,Ce)},oe.rebuild=function(){if(G!==oe&&(le=Pe(G.getLevel())),X.call(oe),G===oe)for(var Ce in H)H[Ce].rebuild()},le=Pe(G?G.getLevel():"WARN");var xe=Ae();xe!=null&&(fe=Pe(xe)),X.call(oe)}G=new ne,G.getLogger=function(de){if(typeof de!="symbol"&&typeof de!="string"||de==="")throw new TypeError("You must supply a name when creating a logger.");var oe=H[de];return oe||(oe=H[de]=new ne(de,G.methodFactory)),oe};var re=typeof window!==j?window.log:void 0;return G.noConflict=function(){return typeof window!==j&&window.log===G&&(window.log=re),G},G.getLoggers=function(){return H},G.default=G,G})}(loglevel$1)),loglevel$1.exports}var loglevelExports=requireLoglevel(),LogLevel;(function(V){V[V.trace=0]="trace",V[V.debug=1]="debug",V[V.info=2]="info",V[V.warn=3]="warn",V[V.error=4]="error",V[V.silent=5]="silent"})(LogLevel||(LogLevel={}));var LoggerNames;(function(V){V.Default="livekit",V.Room="livekit-room",V.Participant="livekit-participant",V.Track="livekit-track",V.Publication="livekit-track-publication",V.Engine="livekit-engine",V.Signal="livekit-signal",V.PCManager="livekit-pc-manager",V.PCTransport="livekit-pc-transport",V.E2EE="lk-e2ee"})(LoggerNames||(LoggerNames={}));let livekitLogger=loglevelExports.getLogger("livekit");Object.values(LoggerNames).map(V=>loglevelExports.getLogger(V)),livekitLogger.setDefaultLevel(LogLevel.info);function getLogger(V){const U=loglevelExports.getLogger(V);return U.setDefaultLevel(livekitLogger.getLevel()),U}const workerLogger=loglevelExports.getLogger("lk-e2ee"),maxRetryDelay=7e3,DEFAULT_RETRY_DELAYS_IN_MS=[0,300,2*2*300,3*3*300,4*4*300,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay];class DefaultReconnectPolicy{constructor(U){this._retryDelays=U!==void 0?[...U]:DEFAULT_RETRY_DELAYS_IN_MS}nextRetryDelayInMs(U){if(U.retryCount>=this._retryDelays.length)return null;const j=this._retryDelays[U.retryCount];return U.retryCount<=1?j:j+Math.random()*1e3}}function __rest(V,U){var j={};for(var B in V)Object.prototype.hasOwnProperty.call(V,B)&&U.indexOf(B)<0&&(j[B]=V[B]);if(V!=null&&typeof Object.getOwnPropertySymbols=="function")for(var z=0,B=Object.getOwnPropertySymbols(V);z<B.length;z++)U.indexOf(B[z])<0&&Object.prototype.propertyIsEnumerable.call(V,B[z])&&(j[B[z]]=V[B[z]]);return j}function __awaiter$1(V,U,j,B){function z(H){return H instanceof j?H:new j(function(G){G(H)})}return new(j||(j=Promise))(function(H,G){function $(X){try{W(B.next(X))}catch(ee){G(ee)}}function Q(X){try{W(B.throw(X))}catch(ee){G(ee)}}function W(X){X.done?H(X.value):z(X.value).then($,Q)}W((B=B.apply(V,U||[])).next())})}function __values(V){var U=typeof Symbol=="function"&&Symbol.iterator,j=U&&V[U],B=0;if(j)return j.call(V);if(V&&typeof V.length=="number")return{next:function(){return V&&B>=V.length&&(V=void 0),{value:V&&V[B++],done:!V}}};throw new TypeError(U?"Object is not iterable.":"Symbol.iterator is not defined.")}function __asyncValues(V){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var U=V[Symbol.asyncIterator],j;return U?U.call(V):(V=typeof __values=="function"?__values(V):V[Symbol.iterator](),j={},B("next"),B("throw"),B("return"),j[Symbol.asyncIterator]=function(){return this},j);function B(H){j[H]=V[H]&&function(G){return new Promise(function($,Q){G=V[H](G),z($,Q,G.done,G.value)})}}function z(H,G,$,Q){Promise.resolve(Q).then(function(W){H({value:W,done:$})},G)}}typeof SuppressedError=="function"&&SuppressedError;var events={exports:{}},hasRequiredEvents;function requireEvents(){if(hasRequiredEvents)return events.exports;hasRequiredEvents=1;var V=typeof Reflect=="object"?Reflect:null,U=V&&typeof V.apply=="function"?V.apply:function(he,ge,Ae){return Function.prototype.apply.call(he,ge,Ae)},j;V&&typeof V.ownKeys=="function"?j=V.ownKeys:Object.getOwnPropertySymbols?j=function(he){return Object.getOwnPropertyNames(he).concat(Object.getOwnPropertySymbols(he))}:j=function(he){return Object.getOwnPropertyNames(he)};function B(fe){console&&console.warn&&console.warn(fe)}var z=Number.isNaN||function(he){return he!==he};function H(){H.init.call(this)}events.exports=H,events.exports.once=oe,H.EventEmitter=H,H.prototype._events=void 0,H.prototype._eventsCount=0,H.prototype._maxListeners=void 0;var G=10;function $(fe){if(typeof fe!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof fe)}Object.defineProperty(H,"defaultMaxListeners",{enumerable:!0,get:function(){return G},set:function(fe){if(typeof fe!="number"||fe<0||z(fe))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+fe+".");G=fe}}),H.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},H.prototype.setMaxListeners=function(he){if(typeof he!="number"||he<0||z(he))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+he+".");return this._maxListeners=he,this};function Q(fe){return fe._maxListeners===void 0?H.defaultMaxListeners:fe._maxListeners}H.prototype.getMaxListeners=function(){return Q(this)},H.prototype.emit=function(he){for(var ge=[],Ae=1;Ae<arguments.length;Ae++)ge.push(arguments[Ae]);var _e=he==="error",Pe=this._events;if(Pe!==void 0)_e=_e&&Pe.error===void 0;else if(!_e)return!1;if(_e){var xe;if(ge.length>0&&(xe=ge[0]),xe instanceof Error)throw xe;var Ce=new Error("Unhandled error."+(xe?" ("+xe.message+")":""));throw Ce.context=xe,Ce}var ze=Pe[he];if(ze===void 0)return!1;if(typeof ze=="function")U(ze,this,ge);else for(var $e=ze.length,Fe=re(ze,$e),Ae=0;Ae<$e;++Ae)U(Fe[Ae],this,ge);return!0};function W(fe,he,ge,Ae){var _e,Pe,xe;if($(ge),Pe=fe._events,Pe===void 0?(Pe=fe._events=Object.create(null),fe._eventsCount=0):(Pe.newListener!==void 0&&(fe.emit("newListener",he,ge.listener?ge.listener:ge),Pe=fe._events),xe=Pe[he]),xe===void 0)xe=Pe[he]=ge,++fe._eventsCount;else if(typeof xe=="function"?xe=Pe[he]=Ae?[ge,xe]:[xe,ge]:Ae?xe.unshift(ge):xe.push(ge),_e=Q(fe),_e>0&&xe.length>_e&&!xe.warned){xe.warned=!0;var Ce=new Error("Possible EventEmitter memory leak detected. "+xe.length+" "+String(he)+" listeners added. Use emitter.setMaxListeners() to increase limit");Ce.name="MaxListenersExceededWarning",Ce.emitter=fe,Ce.type=he,Ce.count=xe.length,B(Ce)}return fe}H.prototype.addListener=function(he,ge){return W(this,he,ge,!1)},H.prototype.on=H.prototype.addListener,H.prototype.prependListener=function(he,ge){return W(this,he,ge,!0)};function X(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ee(fe,he,ge){var Ae={fired:!1,wrapFn:void 0,target:fe,type:he,listener:ge},_e=X.bind(Ae);return _e.listener=ge,Ae.wrapFn=_e,_e}H.prototype.once=function(he,ge){return $(ge),this.on(he,ee(this,he,ge)),this},H.prototype.prependOnceListener=function(he,ge){return $(ge),this.prependListener(he,ee(this,he,ge)),this},H.prototype.removeListener=function(he,ge){var Ae,_e,Pe,xe,Ce;if($(ge),_e=this._events,_e===void 0)return this;if(Ae=_e[he],Ae===void 0)return this;if(Ae===ge||Ae.listener===ge)--this._eventsCount===0?this._events=Object.create(null):(delete _e[he],_e.removeListener&&this.emit("removeListener",he,Ae.listener||ge));else if(typeof Ae!="function"){for(Pe=-1,xe=Ae.length-1;xe>=0;xe--)if(Ae[xe]===ge||Ae[xe].listener===ge){Ce=Ae[xe].listener,Pe=xe;break}if(Pe<0)return this;Pe===0?Ae.shift():se(Ae,Pe),Ae.length===1&&(_e[he]=Ae[0]),_e.removeListener!==void 0&&this.emit("removeListener",he,Ce||ge)}return this},H.prototype.off=H.prototype.removeListener,H.prototype.removeAllListeners=function(he){var ge,Ae,_e;if(Ae=this._events,Ae===void 0)return this;if(Ae.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Ae[he]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Ae[he]),this;if(arguments.length===0){var Pe=Object.keys(Ae),xe;for(_e=0;_e<Pe.length;++_e)xe=Pe[_e],xe!=="removeListener"&&this.removeAllListeners(xe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(ge=Ae[he],typeof ge=="function")this.removeListener(he,ge);else if(ge!==void 0)for(_e=ge.length-1;_e>=0;_e--)this.removeListener(he,ge[_e]);return this};function ie(fe,he,ge){var Ae=fe._events;if(Ae===void 0)return[];var _e=Ae[he];return _e===void 0?[]:typeof _e=="function"?ge?[_e.listener||_e]:[_e]:ge?de(_e):re(_e,_e.length)}H.prototype.listeners=function(he){return ie(this,he,!0)},H.prototype.rawListeners=function(he){return ie(this,he,!1)},H.listenerCount=function(fe,he){return typeof fe.listenerCount=="function"?fe.listenerCount(he):ne.call(fe,he)},H.prototype.listenerCount=ne;function ne(fe){var he=this._events;if(he!==void 0){var ge=he[fe];if(typeof ge=="function")return 1;if(ge!==void 0)return ge.length}return 0}H.prototype.eventNames=function(){return this._eventsCount>0?j(this._events):[]};function re(fe,he){for(var ge=new Array(he),Ae=0;Ae<he;++Ae)ge[Ae]=fe[Ae];return ge}function se(fe,he){for(;he+1<fe.length;he++)fe[he]=fe[he+1];fe.pop()}function de(fe){for(var he=new Array(fe.length),ge=0;ge<he.length;++ge)he[ge]=fe[ge].listener||fe[ge];return he}function oe(fe,he){return new Promise(function(ge,Ae){function _e(xe){fe.removeListener(he,Pe),Ae(xe)}function Pe(){typeof fe.removeListener=="function"&&fe.removeListener("error",_e),ge([].slice.call(arguments))}ue(fe,he,Pe,{once:!0}),he!=="error"&&le(fe,_e,{once:!0})})}function le(fe,he,ge){typeof fe.on=="function"&&ue(fe,"error",he,ge)}function ue(fe,he,ge,Ae){if(typeof fe.on=="function")Ae.once?fe.once(he,ge):fe.on(he,ge);else if(typeof fe.addEventListener=="function")fe.addEventListener(he,function _e(Pe){Ae.once&&fe.removeEventListener(he,_e),ge(Pe)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof fe)}return events.exports}var eventsExports=requireEvents();let logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(V,U,j){const B=V.match(U);return B&&B.length>=j&&parseFloat(B[j],10)}function wrapPeerConnectionEvent(V,U,j){if(!V.RTCPeerConnection)return;const B=V.RTCPeerConnection.prototype,z=B.addEventListener;B.addEventListener=function(G,$){if(G!==U)return z.apply(this,arguments);const Q=W=>{const X=j(W);X&&($.handleEvent?$.handleEvent(X):$(X))};return this._eventMap=this._eventMap||{},this._eventMap[U]||(this._eventMap[U]=new Map),this._eventMap[U].set($,Q),z.apply(this,[G,Q])};const H=B.removeEventListener;B.removeEventListener=function(G,$){if(G!==U||!this._eventMap||!this._eventMap[U])return H.apply(this,arguments);if(!this._eventMap[U].has($))return H.apply(this,arguments);const Q=this._eventMap[U].get($);return this._eventMap[U].delete($),this._eventMap[U].size===0&&delete this._eventMap[U],Object.keys(this._eventMap).length===0&&delete this._eventMap,H.apply(this,[G,Q])},Object.defineProperty(B,"on"+U,{get(){return this["_on"+U]},set(G){this["_on"+U]&&(this.removeEventListener(U,this["_on"+U]),delete this["_on"+U]),G&&this.addEventListener(U,this["_on"+U]=G)},enumerable:!0,configurable:!0})}function disableLog(V){return typeof V!="boolean"?new Error("Argument type: "+typeof V+". Please use a boolean."):(logDisabled_=V,V?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(V){return typeof V!="boolean"?new Error("Argument type: "+typeof V+". Please use a boolean."):(deprecationWarnings_=!V,"adapter.js deprecation warnings "+(V?"disabled":"enabled"))}function log(){if(typeof window=="object"){if(logDisabled_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function deprecated(V,U){deprecationWarnings_&&console.warn(V+" is deprecated, please use "+U+" instead.")}function detectBrowser(V){const U={browser:null,version:null};if(typeof V>"u"||!V.navigator||!V.navigator.userAgent)return U.browser="Not a browser.",U;const{navigator:j}=V;if(j.userAgentData&&j.userAgentData.brands){const B=j.userAgentData.brands.find(z=>z.brand==="Chromium");if(B)return{browser:"chrome",version:parseInt(B.version,10)}}if(j.mozGetUserMedia)U.browser="firefox",U.version=parseInt(extractVersion(j.userAgent,/Firefox\/(\d+)\./,1));else if(j.webkitGetUserMedia||V.isSecureContext===!1&&V.webkitRTCPeerConnection)U.browser="chrome",U.version=parseInt(extractVersion(j.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(V.RTCPeerConnection&&j.userAgent.match(/AppleWebKit\/(\d+)\./))U.browser="safari",U.version=parseInt(extractVersion(j.userAgent,/AppleWebKit\/(\d+)\./,1)),U.supportsUnifiedPlan=V.RTCRtpTransceiver&&"currentDirection"in V.RTCRtpTransceiver.prototype,U._safariVersion=extractVersion(j.userAgent,/Version\/(\d+(\.?\d+))/,1);else return U.browser="Not a supported browser.",U;return U}function isObject(V){return Object.prototype.toString.call(V)==="[object Object]"}function compactObject(V){return isObject(V)?Object.keys(V).reduce(function(U,j){const B=isObject(V[j]),z=B?compactObject(V[j]):V[j],H=B&&!Object.keys(z).length;return z===void 0||H?U:Object.assign(U,{[j]:z})},{}):V}function walkStats(V,U,j){!U||j.has(U.id)||(j.set(U.id,U),Object.keys(U).forEach(B=>{B.endsWith("Id")?walkStats(V,V.get(U[B]),j):B.endsWith("Ids")&&U[B].forEach(z=>{walkStats(V,V.get(z),j)})}))}function filterStats(V,U,j){const B=j?"outbound-rtp":"inbound-rtp",z=new Map;if(U===null)return z;const H=[];return V.forEach(G=>{G.type==="track"&&G.trackIdentifier===U.id&&H.push(G)}),H.forEach(G=>{V.forEach($=>{$.type===B&&$.trackId===G.id&&walkStats(V,$,z)})}),z}const logging=log;function shimGetUserMedia$2(V,U){const j=V&&V.navigator;if(!j.mediaDevices)return;const B=function($){if(typeof $!="object"||$.mandatory||$.optional)return $;const Q={};return Object.keys($).forEach(W=>{if(W==="require"||W==="advanced"||W==="mediaSource")return;const X=typeof $[W]=="object"?$[W]:{ideal:$[W]};X.exact!==void 0&&typeof X.exact=="number"&&(X.min=X.max=X.exact);const ee=function(ie,ne){return ie?ie+ne.charAt(0).toUpperCase()+ne.slice(1):ne==="deviceId"?"sourceId":ne};if(X.ideal!==void 0){Q.optional=Q.optional||[];let ie={};typeof X.ideal=="number"?(ie[ee("min",W)]=X.ideal,Q.optional.push(ie),ie={},ie[ee("max",W)]=X.ideal,Q.optional.push(ie)):(ie[ee("",W)]=X.ideal,Q.optional.push(ie))}X.exact!==void 0&&typeof X.exact!="number"?(Q.mandatory=Q.mandatory||{},Q.mandatory[ee("",W)]=X.exact):["min","max"].forEach(ie=>{X[ie]!==void 0&&(Q.mandatory=Q.mandatory||{},Q.mandatory[ee(ie,W)]=X[ie])})}),$.advanced&&(Q.optional=(Q.optional||[]).concat($.advanced)),Q},z=function($,Q){if(U.version>=61)return Q($);if($=JSON.parse(JSON.stringify($)),$&&typeof $.audio=="object"){const W=function(X,ee,ie){ee in X&&!(ie in X)&&(X[ie]=X[ee],delete X[ee])};$=JSON.parse(JSON.stringify($)),W($.audio,"autoGainControl","googAutoGainControl"),W($.audio,"noiseSuppression","googNoiseSuppression"),$.audio=B($.audio)}if($&&typeof $.video=="object"){let W=$.video.facingMode;W=W&&(typeof W=="object"?W:{ideal:W});const X=U.version<66;if(W&&(W.exact==="user"||W.exact==="environment"||W.ideal==="user"||W.ideal==="environment")&&!(j.mediaDevices.getSupportedConstraints&&j.mediaDevices.getSupportedConstraints().facingMode&&!X)){delete $.video.facingMode;let ee;if(W.exact==="environment"||W.ideal==="environment"?ee=["back","rear"]:(W.exact==="user"||W.ideal==="user")&&(ee=["front"]),ee)return j.mediaDevices.enumerateDevices().then(ie=>{ie=ie.filter(re=>re.kind==="videoinput");let ne=ie.find(re=>ee.some(se=>re.label.toLowerCase().includes(se)));return!ne&&ie.length&&ee.includes("back")&&(ne=ie[ie.length-1]),ne&&($.video.deviceId=W.exact?{exact:ne.deviceId}:{ideal:ne.deviceId}),$.video=B($.video),logging("chrome: "+JSON.stringify($)),Q($)})}$.video=B($.video)}return logging("chrome: "+JSON.stringify($)),Q($)},H=function($){return U.version>=64?$:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[$.name]||$.name,message:$.message,constraint:$.constraint||$.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},G=function($,Q,W){z($,X=>{j.webkitGetUserMedia(X,Q,ee=>{W&&W(H(ee))})})};if(j.getUserMedia=G.bind(j),j.mediaDevices.getUserMedia){const $=j.mediaDevices.getUserMedia.bind(j.mediaDevices);j.mediaDevices.getUserMedia=function(Q){return z(Q,W=>$(W).then(X=>{if(W.audio&&!X.getAudioTracks().length||W.video&&!X.getVideoTracks().length)throw X.getTracks().forEach(ee=>{ee.stop()}),new DOMException("","NotFoundError");return X},X=>Promise.reject(H(X))))}}}function shimMediaStream(V){V.MediaStream=V.MediaStream||V.webkitMediaStream}function shimOnTrack$1(V){if(typeof V=="object"&&V.RTCPeerConnection&&!("ontrack"in V.RTCPeerConnection.prototype)){Object.defineProperty(V.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(j){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=j)},enumerable:!0,configurable:!0});const U=V.RTCPeerConnection.prototype.setRemoteDescription;V.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=B=>{B.stream.addEventListener("addtrack",z=>{let H;V.RTCPeerConnection.prototype.getReceivers?H=this.getReceivers().find($=>$.track&&$.track.id===z.track.id):H={track:z.track};const G=new Event("track");G.track=z.track,G.receiver=H,G.transceiver={receiver:H},G.streams=[B.stream],this.dispatchEvent(G)}),B.stream.getTracks().forEach(z=>{let H;V.RTCPeerConnection.prototype.getReceivers?H=this.getReceivers().find($=>$.track&&$.track.id===z.id):H={track:z};const G=new Event("track");G.track=z,G.receiver=H,G.transceiver={receiver:H},G.streams=[B.stream],this.dispatchEvent(G)})},this.addEventListener("addstream",this._ontrackpoly)),U.apply(this,arguments)}}else wrapPeerConnectionEvent(V,"track",U=>(U.transceiver||Object.defineProperty(U,"transceiver",{value:{receiver:U.receiver}}),U))}function shimGetSendersWithDtmf(V){if(typeof V=="object"&&V.RTCPeerConnection&&!("getSenders"in V.RTCPeerConnection.prototype)&&"createDTMFSender"in V.RTCPeerConnection.prototype){const U=function(z,H){return{track:H,get dtmf(){return this._dtmf===void 0&&(H.kind==="audio"?this._dtmf=z.createDTMFSender(H):this._dtmf=null),this._dtmf},_pc:z}};if(!V.RTCPeerConnection.prototype.getSenders){V.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const z=V.RTCPeerConnection.prototype.addTrack;V.RTCPeerConnection.prototype.addTrack=function($,Q){let W=z.apply(this,arguments);return W||(W=U(this,$),this._senders.push(W)),W};const H=V.RTCPeerConnection.prototype.removeTrack;V.RTCPeerConnection.prototype.removeTrack=function($){H.apply(this,arguments);const Q=this._senders.indexOf($);Q!==-1&&this._senders.splice(Q,1)}}const j=V.RTCPeerConnection.prototype.addStream;V.RTCPeerConnection.prototype.addStream=function(H){this._senders=this._senders||[],j.apply(this,[H]),H.getTracks().forEach(G=>{this._senders.push(U(this,G))})};const B=V.RTCPeerConnection.prototype.removeStream;V.RTCPeerConnection.prototype.removeStream=function(H){this._senders=this._senders||[],B.apply(this,[H]),H.getTracks().forEach(G=>{const $=this._senders.find(Q=>Q.track===G);$&&this._senders.splice(this._senders.indexOf($),1)})}}else if(typeof V=="object"&&V.RTCPeerConnection&&"getSenders"in V.RTCPeerConnection.prototype&&"createDTMFSender"in V.RTCPeerConnection.prototype&&V.RTCRtpSender&&!("dtmf"in V.RTCRtpSender.prototype)){const U=V.RTCPeerConnection.prototype.getSenders;V.RTCPeerConnection.prototype.getSenders=function(){const B=U.apply(this,[]);return B.forEach(z=>z._pc=this),B},Object.defineProperty(V.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimSenderReceiverGetStats(V){if(!(typeof V=="object"&&V.RTCPeerConnection&&V.RTCRtpSender&&V.RTCRtpReceiver))return;if(!("getStats"in V.RTCRtpSender.prototype)){const j=V.RTCPeerConnection.prototype.getSenders;j&&(V.RTCPeerConnection.prototype.getSenders=function(){const H=j.apply(this,[]);return H.forEach(G=>G._pc=this),H});const B=V.RTCPeerConnection.prototype.addTrack;B&&(V.RTCPeerConnection.prototype.addTrack=function(){const H=B.apply(this,arguments);return H._pc=this,H}),V.RTCRtpSender.prototype.getStats=function(){const H=this;return this._pc.getStats().then(G=>filterStats(G,H.track,!0))}}if(!("getStats"in V.RTCRtpReceiver.prototype)){const j=V.RTCPeerConnection.prototype.getReceivers;j&&(V.RTCPeerConnection.prototype.getReceivers=function(){const z=j.apply(this,[]);return z.forEach(H=>H._pc=this),z}),wrapPeerConnectionEvent(V,"track",B=>(B.receiver._pc=B.srcElement,B)),V.RTCRtpReceiver.prototype.getStats=function(){const z=this;return this._pc.getStats().then(H=>filterStats(H,z.track,!1))}}if(!("getStats"in V.RTCRtpSender.prototype&&"getStats"in V.RTCRtpReceiver.prototype))return;const U=V.RTCPeerConnection.prototype.getStats;V.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof V.MediaStreamTrack){const B=arguments[0];let z,H,G;return this.getSenders().forEach($=>{$.track===B&&(z?G=!0:z=$)}),this.getReceivers().forEach($=>($.track===B&&(H?G=!0:H=$),$.track===B)),G||z&&H?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):z?z.getStats():H?H.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return U.apply(this,arguments)}}function shimAddTrackRemoveTrackWithNative(V){V.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(G=>this._shimmedLocalStreams[G][0])};const U=V.RTCPeerConnection.prototype.addTrack;V.RTCPeerConnection.prototype.addTrack=function(G,$){if(!$)return U.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const Q=U.apply(this,arguments);return this._shimmedLocalStreams[$.id]?this._shimmedLocalStreams[$.id].indexOf(Q)===-1&&this._shimmedLocalStreams[$.id].push(Q):this._shimmedLocalStreams[$.id]=[$,Q],Q};const j=V.RTCPeerConnection.prototype.addStream;V.RTCPeerConnection.prototype.addStream=function(G){this._shimmedLocalStreams=this._shimmedLocalStreams||{},G.getTracks().forEach(W=>{if(this.getSenders().find(ee=>ee.track===W))throw new DOMException("Track already exists.","InvalidAccessError")});const $=this.getSenders();j.apply(this,arguments);const Q=this.getSenders().filter(W=>$.indexOf(W)===-1);this._shimmedLocalStreams[G.id]=[G].concat(Q)};const B=V.RTCPeerConnection.prototype.removeStream;V.RTCPeerConnection.prototype.removeStream=function(G){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[G.id],B.apply(this,arguments)};const z=V.RTCPeerConnection.prototype.removeTrack;V.RTCPeerConnection.prototype.removeTrack=function(G){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},G&&Object.keys(this._shimmedLocalStreams).forEach($=>{const Q=this._shimmedLocalStreams[$].indexOf(G);Q!==-1&&this._shimmedLocalStreams[$].splice(Q,1),this._shimmedLocalStreams[$].length===1&&delete this._shimmedLocalStreams[$]}),z.apply(this,arguments)}}function shimAddTrackRemoveTrack(V,U){if(!V.RTCPeerConnection)return;if(V.RTCPeerConnection.prototype.addTrack&&U.version>=65)return shimAddTrackRemoveTrackWithNative(V);const j=V.RTCPeerConnection.prototype.getLocalStreams;V.RTCPeerConnection.prototype.getLocalStreams=function(){const X=j.apply(this);return this._reverseStreams=this._reverseStreams||{},X.map(ee=>this._reverseStreams[ee.id])};const B=V.RTCPeerConnection.prototype.addStream;V.RTCPeerConnection.prototype.addStream=function(X){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},X.getTracks().forEach(ee=>{if(this.getSenders().find(ne=>ne.track===ee))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[X.id]){const ee=new V.MediaStream(X.getTracks());this._streams[X.id]=ee,this._reverseStreams[ee.id]=X,X=ee}B.apply(this,[X])};const z=V.RTCPeerConnection.prototype.removeStream;V.RTCPeerConnection.prototype.removeStream=function(X){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},z.apply(this,[this._streams[X.id]||X]),delete this._reverseStreams[this._streams[X.id]?this._streams[X.id].id:X.id],delete this._streams[X.id]},V.RTCPeerConnection.prototype.addTrack=function(X,ee){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const ie=[].slice.call(arguments,1);if(ie.length!==1||!ie[0].getTracks().find(se=>se===X))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(se=>se.track===X))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const re=this._streams[ee.id];if(re)re.addTrack(X),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const se=new V.MediaStream([X]);this._streams[ee.id]=se,this._reverseStreams[se.id]=ee,this.addStream(se)}return this.getSenders().find(se=>se.track===X)};function H(W,X){let ee=X.sdp;return Object.keys(W._reverseStreams||[]).forEach(ie=>{const ne=W._reverseStreams[ie],re=W._streams[ne.id];ee=ee.replace(new RegExp(re.id,"g"),ne.id)}),new RTCSessionDescription({type:X.type,sdp:ee})}function G(W,X){let ee=X.sdp;return Object.keys(W._reverseStreams||[]).forEach(ie=>{const ne=W._reverseStreams[ie],re=W._streams[ne.id];ee=ee.replace(new RegExp(ne.id,"g"),re.id)}),new RTCSessionDescription({type:X.type,sdp:ee})}["createOffer","createAnswer"].forEach(function(W){const X=V.RTCPeerConnection.prototype[W],ee={[W](){const ie=arguments;return arguments.length&&typeof arguments[0]=="function"?X.apply(this,[re=>{const se=H(this,re);ie[0].apply(null,[se])},re=>{ie[1]&&ie[1].apply(null,re)},arguments[2]]):X.apply(this,arguments).then(re=>H(this,re))}};V.RTCPeerConnection.prototype[W]=ee[W]});const $=V.RTCPeerConnection.prototype.setLocalDescription;V.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?$.apply(this,arguments):(arguments[0]=G(this,arguments[0]),$.apply(this,arguments))};const Q=Object.getOwnPropertyDescriptor(V.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(V.RTCPeerConnection.prototype,"localDescription",{get(){const W=Q.get.apply(this);return W.type===""?W:H(this,W)}}),V.RTCPeerConnection.prototype.removeTrack=function(X){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!X._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(X._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let ie;Object.keys(this._streams).forEach(ne=>{this._streams[ne].getTracks().find(se=>X.track===se)&&(ie=this._streams[ne])}),ie&&(ie.getTracks().length===1?this.removeStream(this._reverseStreams[ie.id]):ie.removeTrack(X.track),this.dispatchEvent(new Event("negotiationneeded")))}}function shimPeerConnection$1(V,U){!V.RTCPeerConnection&&V.webkitRTCPeerConnection&&(V.RTCPeerConnection=V.webkitRTCPeerConnection),V.RTCPeerConnection&&U.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(j){const B=V.RTCPeerConnection.prototype[j],z={[j](){return arguments[0]=new(j==="addIceCandidate"?V.RTCIceCandidate:V.RTCSessionDescription)(arguments[0]),B.apply(this,arguments)}};V.RTCPeerConnection.prototype[j]=z[j]})}function fixNegotiationNeeded(V,U){wrapPeerConnectionEvent(V,"negotiationneeded",j=>{const B=j.target;if(!((U.version<72||B.getConfiguration&&B.getConfiguration().sdpSemantics==="plan-b")&&B.signalingState!=="stable"))return j})}var chromeShim=Object.freeze({__proto__:null,fixNegotiationNeeded,shimAddTrackRemoveTrack,shimAddTrackRemoveTrackWithNative,shimGetSendersWithDtmf,shimGetUserMedia:shimGetUserMedia$2,shimMediaStream,shimOnTrack:shimOnTrack$1,shimPeerConnection:shimPeerConnection$1,shimSenderReceiverGetStats});function shimGetUserMedia$1(V,U){const j=V&&V.navigator,B=V&&V.MediaStreamTrack;if(j.getUserMedia=function(z,H,G){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),j.mediaDevices.getUserMedia(z).then(H,G)},!(U.version>55&&"autoGainControl"in j.mediaDevices.getSupportedConstraints())){const z=function(G,$,Q){$ in G&&!(Q in G)&&(G[Q]=G[$],delete G[$])},H=j.mediaDevices.getUserMedia.bind(j.mediaDevices);if(j.mediaDevices.getUserMedia=function(G){return typeof G=="object"&&typeof G.audio=="object"&&(G=JSON.parse(JSON.stringify(G)),z(G.audio,"autoGainControl","mozAutoGainControl"),z(G.audio,"noiseSuppression","mozNoiseSuppression")),H(G)},B&&B.prototype.getSettings){const G=B.prototype.getSettings;B.prototype.getSettings=function(){const $=G.apply(this,arguments);return z($,"mozAutoGainControl","autoGainControl"),z($,"mozNoiseSuppression","noiseSuppression"),$}}if(B&&B.prototype.applyConstraints){const G=B.prototype.applyConstraints;B.prototype.applyConstraints=function($){return this.kind==="audio"&&typeof $=="object"&&($=JSON.parse(JSON.stringify($)),z($,"autoGainControl","mozAutoGainControl"),z($,"noiseSuppression","mozNoiseSuppression")),G.apply(this,[$])}}}}function shimGetDisplayMedia(V,U){V.navigator.mediaDevices&&"getDisplayMedia"in V.navigator.mediaDevices||V.navigator.mediaDevices&&(V.navigator.mediaDevices.getDisplayMedia=function(B){if(!(B&&B.video)){const z=new DOMException("getDisplayMedia without video constraints is undefined");return z.name="NotFoundError",z.code=8,Promise.reject(z)}return B.video===!0?B.video={mediaSource:U}:B.video.mediaSource=U,V.navigator.mediaDevices.getUserMedia(B)})}function shimOnTrack(V){typeof V=="object"&&V.RTCTrackEvent&&"receiver"in V.RTCTrackEvent.prototype&&!("transceiver"in V.RTCTrackEvent.prototype)&&Object.defineProperty(V.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimPeerConnection(V,U){if(typeof V!="object"||!(V.RTCPeerConnection||V.mozRTCPeerConnection))return;!V.RTCPeerConnection&&V.mozRTCPeerConnection&&(V.RTCPeerConnection=V.mozRTCPeerConnection),U.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(z){const H=V.RTCPeerConnection.prototype[z],G={[z](){return arguments[0]=new(z==="addIceCandidate"?V.RTCIceCandidate:V.RTCSessionDescription)(arguments[0]),H.apply(this,arguments)}};V.RTCPeerConnection.prototype[z]=G[z]});const j={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},B=V.RTCPeerConnection.prototype.getStats;V.RTCPeerConnection.prototype.getStats=function(){const[H,G,$]=arguments;return B.apply(this,[H||null]).then(Q=>{if(U.version<53&&!G)try{Q.forEach(W=>{W.type=j[W.type]||W.type})}catch(W){if(W.name!=="TypeError")throw W;Q.forEach((X,ee)=>{Q.set(ee,Object.assign({},X,{type:j[X.type]||X.type}))})}return Q}).then(G,$)}}function shimSenderGetStats(V){if(!(typeof V=="object"&&V.RTCPeerConnection&&V.RTCRtpSender)||V.RTCRtpSender&&"getStats"in V.RTCRtpSender.prototype)return;const U=V.RTCPeerConnection.prototype.getSenders;U&&(V.RTCPeerConnection.prototype.getSenders=function(){const z=U.apply(this,[]);return z.forEach(H=>H._pc=this),z});const j=V.RTCPeerConnection.prototype.addTrack;j&&(V.RTCPeerConnection.prototype.addTrack=function(){const z=j.apply(this,arguments);return z._pc=this,z}),V.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function shimReceiverGetStats(V){if(!(typeof V=="object"&&V.RTCPeerConnection&&V.RTCRtpSender)||V.RTCRtpSender&&"getStats"in V.RTCRtpReceiver.prototype)return;const U=V.RTCPeerConnection.prototype.getReceivers;U&&(V.RTCPeerConnection.prototype.getReceivers=function(){const B=U.apply(this,[]);return B.forEach(z=>z._pc=this),B}),wrapPeerConnectionEvent(V,"track",j=>(j.receiver._pc=j.srcElement,j)),V.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function shimRemoveStream(V){!V.RTCPeerConnection||"removeStream"in V.RTCPeerConnection.prototype||(V.RTCPeerConnection.prototype.removeStream=function(j){deprecated("removeStream","removeTrack"),this.getSenders().forEach(B=>{B.track&&j.getTracks().includes(B.track)&&this.removeTrack(B)})})}function shimRTCDataChannel(V){V.DataChannel&&!V.RTCDataChannel&&(V.RTCDataChannel=V.DataChannel)}function shimAddTransceiver(V){if(!(typeof V=="object"&&V.RTCPeerConnection))return;const U=V.RTCPeerConnection.prototype.addTransceiver;U&&(V.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let B=arguments[1]&&arguments[1].sendEncodings;B===void 0&&(B=[]),B=[...B];const z=B.length>0;z&&B.forEach(G=>{if("rid"in G&&!/^[a-z0-9]{0,16}$/i.test(G.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in G&&!(parseFloat(G.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in G&&!(parseFloat(G.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const H=U.apply(this,arguments);if(z){const{sender:G}=H,$=G.getParameters();(!("encodings"in $)||$.encodings.length===1&&Object.keys($.encodings[0]).length===0)&&($.encodings=B,G.sendEncodings=B,this.setParametersPromises.push(G.setParameters($).then(()=>{delete G.sendEncodings}).catch(()=>{delete G.sendEncodings})))}return H})}function shimGetParameters(V){if(!(typeof V=="object"&&V.RTCRtpSender))return;const U=V.RTCRtpSender.prototype.getParameters;U&&(V.RTCRtpSender.prototype.getParameters=function(){const B=U.apply(this,arguments);return"encodings"in B||(B.encodings=[].concat(this.sendEncodings||[{}])),B})}function shimCreateOffer(V){if(!(typeof V=="object"&&V.RTCPeerConnection))return;const U=V.RTCPeerConnection.prototype.createOffer;V.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>U.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):U.apply(this,arguments)}}function shimCreateAnswer(V){if(!(typeof V=="object"&&V.RTCPeerConnection))return;const U=V.RTCPeerConnection.prototype.createAnswer;V.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>U.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):U.apply(this,arguments)}}var firefoxShim=Object.freeze({__proto__:null,shimAddTransceiver,shimCreateAnswer,shimCreateOffer,shimGetDisplayMedia,shimGetParameters,shimGetUserMedia:shimGetUserMedia$1,shimOnTrack,shimPeerConnection,shimRTCDataChannel,shimReceiverGetStats,shimRemoveStream,shimSenderGetStats});function shimLocalStreamsAPI(V){if(!(typeof V!="object"||!V.RTCPeerConnection)){if("getLocalStreams"in V.RTCPeerConnection.prototype||(V.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in V.RTCPeerConnection.prototype)){const U=V.RTCPeerConnection.prototype.addTrack;V.RTCPeerConnection.prototype.addStream=function(B){this._localStreams||(this._localStreams=[]),this._localStreams.includes(B)||this._localStreams.push(B),B.getAudioTracks().forEach(z=>U.call(this,z,B)),B.getVideoTracks().forEach(z=>U.call(this,z,B))},V.RTCPeerConnection.prototype.addTrack=function(B){for(var z=arguments.length,H=new Array(z>1?z-1:0),G=1;G<z;G++)H[G-1]=arguments[G];return H&&H.forEach($=>{this._localStreams?this._localStreams.includes($)||this._localStreams.push($):this._localStreams=[$]}),U.apply(this,arguments)}}"removeStream"in V.RTCPeerConnection.prototype||(V.RTCPeerConnection.prototype.removeStream=function(j){this._localStreams||(this._localStreams=[]);const B=this._localStreams.indexOf(j);if(B===-1)return;this._localStreams.splice(B,1);const z=j.getTracks();this.getSenders().forEach(H=>{z.includes(H.track)&&this.removeTrack(H)})})}}function shimRemoteStreamsAPI(V){if(!(typeof V!="object"||!V.RTCPeerConnection)&&("getRemoteStreams"in V.RTCPeerConnection.prototype||(V.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in V.RTCPeerConnection.prototype))){Object.defineProperty(V.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(j){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=j),this.addEventListener("track",this._onaddstreampoly=B=>{B.streams.forEach(z=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(z))return;this._remoteStreams.push(z);const H=new Event("addstream");H.stream=z,this.dispatchEvent(H)})})}});const U=V.RTCPeerConnection.prototype.setRemoteDescription;V.RTCPeerConnection.prototype.setRemoteDescription=function(){const B=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(z){z.streams.forEach(H=>{if(B._remoteStreams||(B._remoteStreams=[]),B._remoteStreams.indexOf(H)>=0)return;B._remoteStreams.push(H);const G=new Event("addstream");G.stream=H,B.dispatchEvent(G)})}),U.apply(B,arguments)}}}function shimCallbacksAPI(V){if(typeof V!="object"||!V.RTCPeerConnection)return;const U=V.RTCPeerConnection.prototype,j=U.createOffer,B=U.createAnswer,z=U.setLocalDescription,H=U.setRemoteDescription,G=U.addIceCandidate;U.createOffer=function(W,X){const ee=arguments.length>=2?arguments[2]:arguments[0],ie=j.apply(this,[ee]);return X?(ie.then(W,X),Promise.resolve()):ie},U.createAnswer=function(W,X){const ee=arguments.length>=2?arguments[2]:arguments[0],ie=B.apply(this,[ee]);return X?(ie.then(W,X),Promise.resolve()):ie};let $=function(Q,W,X){const ee=z.apply(this,[Q]);return X?(ee.then(W,X),Promise.resolve()):ee};U.setLocalDescription=$,$=function(Q,W,X){const ee=H.apply(this,[Q]);return X?(ee.then(W,X),Promise.resolve()):ee},U.setRemoteDescription=$,$=function(Q,W,X){const ee=G.apply(this,[Q]);return X?(ee.then(W,X),Promise.resolve()):ee},U.addIceCandidate=$}function shimGetUserMedia(V){const U=V&&V.navigator;if(U.mediaDevices&&U.mediaDevices.getUserMedia){const j=U.mediaDevices,B=j.getUserMedia.bind(j);U.mediaDevices.getUserMedia=z=>B(shimConstraints(z))}!U.getUserMedia&&U.mediaDevices&&U.mediaDevices.getUserMedia&&(U.getUserMedia=(function(B,z,H){U.mediaDevices.getUserMedia(B).then(z,H)}).bind(U))}function shimConstraints(V){return V&&V.video!==void 0?Object.assign({},V,{video:compactObject(V.video)}):V}function shimRTCIceServerUrls(V){if(!V.RTCPeerConnection)return;const U=V.RTCPeerConnection;V.RTCPeerConnection=function(B,z){if(B&&B.iceServers){const H=[];for(let G=0;G<B.iceServers.length;G++){let $=B.iceServers[G];$.urls===void 0&&$.url?(deprecated("RTCIceServer.url","RTCIceServer.urls"),$=JSON.parse(JSON.stringify($)),$.urls=$.url,delete $.url,H.push($)):H.push(B.iceServers[G])}B.iceServers=H}return new U(B,z)},V.RTCPeerConnection.prototype=U.prototype,"generateCertificate"in U&&Object.defineProperty(V.RTCPeerConnection,"generateCertificate",{get(){return U.generateCertificate}})}function shimTrackEventTransceiver(V){typeof V=="object"&&V.RTCTrackEvent&&"receiver"in V.RTCTrackEvent.prototype&&!("transceiver"in V.RTCTrackEvent.prototype)&&Object.defineProperty(V.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(V){const U=V.RTCPeerConnection.prototype.createOffer;V.RTCPeerConnection.prototype.createOffer=function(B){if(B){typeof B.offerToReceiveAudio<"u"&&(B.offerToReceiveAudio=!!B.offerToReceiveAudio);const z=this.getTransceivers().find(G=>G.receiver.track.kind==="audio");B.offerToReceiveAudio===!1&&z?z.direction==="sendrecv"?z.setDirection?z.setDirection("sendonly"):z.direction="sendonly":z.direction==="recvonly"&&(z.setDirection?z.setDirection("inactive"):z.direction="inactive"):B.offerToReceiveAudio===!0&&!z&&this.addTransceiver("audio",{direction:"recvonly"}),typeof B.offerToReceiveVideo<"u"&&(B.offerToReceiveVideo=!!B.offerToReceiveVideo);const H=this.getTransceivers().find(G=>G.receiver.track.kind==="video");B.offerToReceiveVideo===!1&&H?H.direction==="sendrecv"?H.setDirection?H.setDirection("sendonly"):H.direction="sendonly":H.direction==="recvonly"&&(H.setDirection?H.setDirection("inactive"):H.direction="inactive"):B.offerToReceiveVideo===!0&&!H&&this.addTransceiver("video",{direction:"recvonly"})}return U.apply(this,arguments)}}function shimAudioContext(V){typeof V!="object"||V.AudioContext||(V.AudioContext=V.webkitAudioContext)}var safariShim=Object.freeze({__proto__:null,shimAudioContext,shimCallbacksAPI,shimConstraints,shimCreateOfferLegacy,shimGetUserMedia,shimLocalStreamsAPI,shimRTCIceServerUrls,shimRemoteStreamsAPI,shimTrackEventTransceiver}),sdp$1={exports:{}},hasRequiredSdp;function requireSdp(){return hasRequiredSdp||(hasRequiredSdp=1,function(V){const U={};U.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},U.localCName=U.generateIdentifier(),U.splitLines=function(j){return j.trim().split(`
`).map(B=>B.trim())},U.splitSections=function(j){return j.split(`
m=`).map((z,H)=>(H>0?"m="+z:z).trim()+`\r
`)},U.getDescription=function(j){const B=U.splitSections(j);return B&&B[0]},U.getMediaSections=function(j){const B=U.splitSections(j);return B.shift(),B},U.matchPrefix=function(j,B){return U.splitLines(j).filter(z=>z.indexOf(B)===0)},U.parseCandidate=function(j){let B;j.indexOf("a=candidate:")===0?B=j.substring(12).split(" "):B=j.substring(10).split(" ");const z={foundation:B[0],component:{1:"rtp",2:"rtcp"}[B[1]]||B[1],protocol:B[2].toLowerCase(),priority:parseInt(B[3],10),ip:B[4],address:B[4],port:parseInt(B[5],10),type:B[7]};for(let H=8;H<B.length;H+=2)switch(B[H]){case"raddr":z.relatedAddress=B[H+1];break;case"rport":z.relatedPort=parseInt(B[H+1],10);break;case"tcptype":z.tcpType=B[H+1];break;case"ufrag":z.ufrag=B[H+1],z.usernameFragment=B[H+1];break;default:z[B[H]]===void 0&&(z[B[H]]=B[H+1]);break}return z},U.writeCandidate=function(j){const B=[];B.push(j.foundation);const z=j.component;z==="rtp"?B.push(1):z==="rtcp"?B.push(2):B.push(z),B.push(j.protocol.toUpperCase()),B.push(j.priority),B.push(j.address||j.ip),B.push(j.port);const H=j.type;return B.push("typ"),B.push(H),H!=="host"&&j.relatedAddress&&j.relatedPort&&(B.push("raddr"),B.push(j.relatedAddress),B.push("rport"),B.push(j.relatedPort)),j.tcpType&&j.protocol.toLowerCase()==="tcp"&&(B.push("tcptype"),B.push(j.tcpType)),(j.usernameFragment||j.ufrag)&&(B.push("ufrag"),B.push(j.usernameFragment||j.ufrag)),"candidate:"+B.join(" ")},U.parseIceOptions=function(j){return j.substring(14).split(" ")},U.parseRtpMap=function(j){let B=j.substring(9).split(" ");const z={payloadType:parseInt(B.shift(),10)};return B=B[0].split("/"),z.name=B[0],z.clockRate=parseInt(B[1],10),z.channels=B.length===3?parseInt(B[2],10):1,z.numChannels=z.channels,z},U.writeRtpMap=function(j){let B=j.payloadType;j.preferredPayloadType!==void 0&&(B=j.preferredPayloadType);const z=j.channels||j.numChannels||1;return"a=rtpmap:"+B+" "+j.name+"/"+j.clockRate+(z!==1?"/"+z:"")+`\r
`},U.parseExtmap=function(j){const B=j.substring(9).split(" ");return{id:parseInt(B[0],10),direction:B[0].indexOf("/")>0?B[0].split("/")[1]:"sendrecv",uri:B[1],attributes:B.slice(2).join(" ")}},U.writeExtmap=function(j){return"a=extmap:"+(j.id||j.preferredId)+(j.direction&&j.direction!=="sendrecv"?"/"+j.direction:"")+" "+j.uri+(j.attributes?" "+j.attributes:"")+`\r
`},U.parseFmtp=function(j){const B={};let z;const H=j.substring(j.indexOf(" ")+1).split(";");for(let G=0;G<H.length;G++)z=H[G].trim().split("="),B[z[0].trim()]=z[1];return B},U.writeFmtp=function(j){let B="",z=j.payloadType;if(j.preferredPayloadType!==void 0&&(z=j.preferredPayloadType),j.parameters&&Object.keys(j.parameters).length){const H=[];Object.keys(j.parameters).forEach(G=>{j.parameters[G]!==void 0?H.push(G+"="+j.parameters[G]):H.push(G)}),B+="a=fmtp:"+z+" "+H.join(";")+`\r
`}return B},U.parseRtcpFb=function(j){const B=j.substring(j.indexOf(" ")+1).split(" ");return{type:B.shift(),parameter:B.join(" ")}},U.writeRtcpFb=function(j){let B="",z=j.payloadType;return j.preferredPayloadType!==void 0&&(z=j.preferredPayloadType),j.rtcpFeedback&&j.rtcpFeedback.length&&j.rtcpFeedback.forEach(H=>{B+="a=rtcp-fb:"+z+" "+H.type+(H.parameter&&H.parameter.length?" "+H.parameter:"")+`\r
`}),B},U.parseSsrcMedia=function(j){const B=j.indexOf(" "),z={ssrc:parseInt(j.substring(7,B),10)},H=j.indexOf(":",B);return H>-1?(z.attribute=j.substring(B+1,H),z.value=j.substring(H+1)):z.attribute=j.substring(B+1),z},U.parseSsrcGroup=function(j){const B=j.substring(13).split(" ");return{semantics:B.shift(),ssrcs:B.map(z=>parseInt(z,10))}},U.getMid=function(j){const B=U.matchPrefix(j,"a=mid:")[0];if(B)return B.substring(6)},U.parseFingerprint=function(j){const B=j.substring(14).split(" ");return{algorithm:B[0].toLowerCase(),value:B[1].toUpperCase()}},U.getDtlsParameters=function(j,B){return{role:"auto",fingerprints:U.matchPrefix(j+B,"a=fingerprint:").map(U.parseFingerprint)}},U.writeDtlsParameters=function(j,B){let z="a=setup:"+B+`\r
`;return j.fingerprints.forEach(H=>{z+="a=fingerprint:"+H.algorithm+" "+H.value+`\r
`}),z},U.parseCryptoLine=function(j){const B=j.substring(9).split(" ");return{tag:parseInt(B[0],10),cryptoSuite:B[1],keyParams:B[2],sessionParams:B.slice(3)}},U.writeCryptoLine=function(j){return"a=crypto:"+j.tag+" "+j.cryptoSuite+" "+(typeof j.keyParams=="object"?U.writeCryptoKeyParams(j.keyParams):j.keyParams)+(j.sessionParams?" "+j.sessionParams.join(" "):"")+`\r
`},U.parseCryptoKeyParams=function(j){if(j.indexOf("inline:")!==0)return null;const B=j.substring(7).split("|");return{keyMethod:"inline",keySalt:B[0],lifeTime:B[1],mkiValue:B[2]?B[2].split(":")[0]:void 0,mkiLength:B[2]?B[2].split(":")[1]:void 0}},U.writeCryptoKeyParams=function(j){return j.keyMethod+":"+j.keySalt+(j.lifeTime?"|"+j.lifeTime:"")+(j.mkiValue&&j.mkiLength?"|"+j.mkiValue+":"+j.mkiLength:"")},U.getCryptoParameters=function(j,B){return U.matchPrefix(j+B,"a=crypto:").map(U.parseCryptoLine)},U.getIceParameters=function(j,B){const z=U.matchPrefix(j+B,"a=ice-ufrag:")[0],H=U.matchPrefix(j+B,"a=ice-pwd:")[0];return z&&H?{usernameFragment:z.substring(12),password:H.substring(10)}:null},U.writeIceParameters=function(j){let B="a=ice-ufrag:"+j.usernameFragment+`\r
a=ice-pwd:`+j.password+`\r
`;return j.iceLite&&(B+=`a=ice-lite\r
`),B},U.parseRtpParameters=function(j){const B={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},H=U.splitLines(j)[0].split(" ");B.profile=H[2];for(let $=3;$<H.length;$++){const Q=H[$],W=U.matchPrefix(j,"a=rtpmap:"+Q+" ")[0];if(W){const X=U.parseRtpMap(W),ee=U.matchPrefix(j,"a=fmtp:"+Q+" ");switch(X.parameters=ee.length?U.parseFmtp(ee[0]):{},X.rtcpFeedback=U.matchPrefix(j,"a=rtcp-fb:"+Q+" ").map(U.parseRtcpFb),B.codecs.push(X),X.name.toUpperCase()){case"RED":case"ULPFEC":B.fecMechanisms.push(X.name.toUpperCase());break}}}U.matchPrefix(j,"a=extmap:").forEach($=>{B.headerExtensions.push(U.parseExtmap($))});const G=U.matchPrefix(j,"a=rtcp-fb:* ").map(U.parseRtcpFb);return B.codecs.forEach($=>{G.forEach(Q=>{$.rtcpFeedback.find(X=>X.type===Q.type&&X.parameter===Q.parameter)||$.rtcpFeedback.push(Q)})}),B},U.writeRtpDescription=function(j,B){let z="";z+="m="+j+" ",z+=B.codecs.length>0?"9":"0",z+=" "+(B.profile||"UDP/TLS/RTP/SAVPF")+" ",z+=B.codecs.map(G=>G.preferredPayloadType!==void 0?G.preferredPayloadType:G.payloadType).join(" ")+`\r
`,z+=`c=IN IP4 0.0.0.0\r
`,z+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,B.codecs.forEach(G=>{z+=U.writeRtpMap(G),z+=U.writeFmtp(G),z+=U.writeRtcpFb(G)});let H=0;return B.codecs.forEach(G=>{G.maxptime>H&&(H=G.maxptime)}),H>0&&(z+="a=maxptime:"+H+`\r
`),B.headerExtensions&&B.headerExtensions.forEach(G=>{z+=U.writeExtmap(G)}),z},U.parseRtpEncodingParameters=function(j){const B=[],z=U.parseRtpParameters(j),H=z.fecMechanisms.indexOf("RED")!==-1,G=z.fecMechanisms.indexOf("ULPFEC")!==-1,$=U.matchPrefix(j,"a=ssrc:").map(ie=>U.parseSsrcMedia(ie)).filter(ie=>ie.attribute==="cname"),Q=$.length>0&&$[0].ssrc;let W;const X=U.matchPrefix(j,"a=ssrc-group:FID").map(ie=>ie.substring(17).split(" ").map(re=>parseInt(re,10)));X.length>0&&X[0].length>1&&X[0][0]===Q&&(W=X[0][1]),z.codecs.forEach(ie=>{if(ie.name.toUpperCase()==="RTX"&&ie.parameters.apt){let ne={ssrc:Q,codecPayloadType:parseInt(ie.parameters.apt,10)};Q&&W&&(ne.rtx={ssrc:W}),B.push(ne),H&&(ne=JSON.parse(JSON.stringify(ne)),ne.fec={ssrc:Q,mechanism:G?"red+ulpfec":"red"},B.push(ne))}}),B.length===0&&Q&&B.push({ssrc:Q});let ee=U.matchPrefix(j,"b=");return ee.length&&(ee[0].indexOf("b=TIAS:")===0?ee=parseInt(ee[0].substring(7),10):ee[0].indexOf("b=AS:")===0?ee=parseInt(ee[0].substring(5),10)*1e3*.95-50*40*8:ee=void 0,B.forEach(ie=>{ie.maxBitrate=ee})),B},U.parseRtcpParameters=function(j){const B={},z=U.matchPrefix(j,"a=ssrc:").map($=>U.parseSsrcMedia($)).filter($=>$.attribute==="cname")[0];z&&(B.cname=z.value,B.ssrc=z.ssrc);const H=U.matchPrefix(j,"a=rtcp-rsize");B.reducedSize=H.length>0,B.compound=H.length===0;const G=U.matchPrefix(j,"a=rtcp-mux");return B.mux=G.length>0,B},U.writeRtcpParameters=function(j){let B="";return j.reducedSize&&(B+=`a=rtcp-rsize\r
`),j.mux&&(B+=`a=rtcp-mux\r
`),j.ssrc!==void 0&&j.cname&&(B+="a=ssrc:"+j.ssrc+" cname:"+j.cname+`\r
`),B},U.parseMsid=function(j){let B;const z=U.matchPrefix(j,"a=msid:");if(z.length===1)return B=z[0].substring(7).split(" "),{stream:B[0],track:B[1]};const H=U.matchPrefix(j,"a=ssrc:").map(G=>U.parseSsrcMedia(G)).filter(G=>G.attribute==="msid");if(H.length>0)return B=H[0].value.split(" "),{stream:B[0],track:B[1]}},U.parseSctpDescription=function(j){const B=U.parseMLine(j),z=U.matchPrefix(j,"a=max-message-size:");let H;z.length>0&&(H=parseInt(z[0].substring(19),10)),isNaN(H)&&(H=65536);const G=U.matchPrefix(j,"a=sctp-port:");if(G.length>0)return{port:parseInt(G[0].substring(12),10),protocol:B.fmt,maxMessageSize:H};const $=U.matchPrefix(j,"a=sctpmap:");if($.length>0){const Q=$[0].substring(10).split(" ");return{port:parseInt(Q[0],10),protocol:Q[1],maxMessageSize:H}}},U.writeSctpDescription=function(j,B){let z=[];return j.protocol!=="DTLS/SCTP"?z=["m="+j.kind+" 9 "+j.protocol+" "+B.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+B.port+`\r
`]:z=["m="+j.kind+" 9 "+j.protocol+" "+B.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+B.port+" "+B.protocol+` 65535\r
`],B.maxMessageSize!==void 0&&z.push("a=max-message-size:"+B.maxMessageSize+`\r
`),z.join("")},U.generateSessionId=function(){return Math.random().toString().substr(2,22)},U.writeSessionBoilerplate=function(j,B,z){let H;const G=B!==void 0?B:2;return j?H=j:H=U.generateSessionId(),`v=0\r
o=`+(z||"thisisadapterortc")+" "+H+" "+G+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},U.getDirection=function(j,B){const z=U.splitLines(j);for(let H=0;H<z.length;H++)switch(z[H]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return z[H].substring(2)}return B?U.getDirection(B):"sendrecv"},U.getKind=function(j){return U.splitLines(j)[0].split(" ")[0].substring(2)},U.isRejected=function(j){return j.split(" ",2)[1]==="0"},U.parseMLine=function(j){const z=U.splitLines(j)[0].substring(2).split(" ");return{kind:z[0],port:parseInt(z[1],10),protocol:z[2],fmt:z.slice(3).join(" ")}},U.parseOLine=function(j){const z=U.matchPrefix(j,"o=")[0].substring(2).split(" ");return{username:z[0],sessionId:z[1],sessionVersion:parseInt(z[2],10),netType:z[3],addressType:z[4],address:z[5]}},U.isValidSDP=function(j){if(typeof j!="string"||j.length===0)return!1;const B=U.splitLines(j);for(let z=0;z<B.length;z++)if(B[z].length<2||B[z].charAt(1)!=="=")return!1;return!0},V.exports=U}(sdp$1)),sdp$1.exports}var sdpExports=requireSdp(),SDPUtils=getDefaultExportFromCjs(sdpExports),sdp=_mergeNamespaces$1({__proto__:null,default:SDPUtils},[sdpExports]);function shimRTCIceCandidate(V){if(!V.RTCIceCandidate||V.RTCIceCandidate&&"foundation"in V.RTCIceCandidate.prototype)return;const U=V.RTCIceCandidate;V.RTCIceCandidate=function(B){if(typeof B=="object"&&B.candidate&&B.candidate.indexOf("a=")===0&&(B=JSON.parse(JSON.stringify(B)),B.candidate=B.candidate.substring(2)),B.candidate&&B.candidate.length){const z=new U(B),H=SDPUtils.parseCandidate(B.candidate);for(const G in H)G in z||Object.defineProperty(z,G,{value:H[G]});return z.toJSON=function(){return{candidate:z.candidate,sdpMid:z.sdpMid,sdpMLineIndex:z.sdpMLineIndex,usernameFragment:z.usernameFragment}},z}return new U(B)},V.RTCIceCandidate.prototype=U.prototype,wrapPeerConnectionEvent(V,"icecandidate",j=>(j.candidate&&Object.defineProperty(j,"candidate",{value:new V.RTCIceCandidate(j.candidate),writable:"false"}),j))}function shimRTCIceCandidateRelayProtocol(V){!V.RTCIceCandidate||V.RTCIceCandidate&&"relayProtocol"in V.RTCIceCandidate.prototype||wrapPeerConnectionEvent(V,"icecandidate",U=>{if(U.candidate){const j=SDPUtils.parseCandidate(U.candidate.candidate);j.type==="relay"&&(U.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[j.priority>>24])}return U})}function shimMaxMessageSize(V,U){if(!V.RTCPeerConnection)return;"sctp"in V.RTCPeerConnection.prototype||Object.defineProperty(V.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const j=function($){if(!$||!$.sdp)return!1;const Q=SDPUtils.splitSections($.sdp);return Q.shift(),Q.some(W=>{const X=SDPUtils.parseMLine(W);return X&&X.kind==="application"&&X.protocol.indexOf("SCTP")!==-1})},B=function($){const Q=$.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(Q===null||Q.length<2)return-1;const W=parseInt(Q[1],10);return W!==W?-1:W},z=function($){let Q=65536;return U.browser==="firefox"&&(U.version<57?$===-1?Q=16384:Q=2147483637:U.version<60?Q=U.version===57?65535:65536:Q=2147483637),Q},H=function($,Q){let W=65536;U.browser==="firefox"&&U.version===57&&(W=65535);const X=SDPUtils.matchPrefix($.sdp,"a=max-message-size:");return X.length>0?W=parseInt(X[0].substring(19),10):U.browser==="firefox"&&Q!==-1&&(W=2147483637),W},G=V.RTCPeerConnection.prototype.setRemoteDescription;V.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,U.browser==="chrome"&&U.version>=76){const{sdpSemantics:Q}=this.getConfiguration();Q==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(j(arguments[0])){const Q=B(arguments[0]),W=z(Q),X=H(arguments[0],Q);let ee;W===0&&X===0?ee=Number.POSITIVE_INFINITY:W===0||X===0?ee=Math.max(W,X):ee=Math.min(W,X);const ie={};Object.defineProperty(ie,"maxMessageSize",{get(){return ee}}),this._sctp=ie}return G.apply(this,arguments)}}function shimSendThrowTypeError(V){if(!(V.RTCPeerConnection&&"createDataChannel"in V.RTCPeerConnection.prototype))return;function U(B,z){const H=B.send;B.send=function(){const $=arguments[0],Q=$.length||$.size||$.byteLength;if(B.readyState==="open"&&z.sctp&&Q>z.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+z.sctp.maxMessageSize+" bytes)");return H.apply(B,arguments)}}const j=V.RTCPeerConnection.prototype.createDataChannel;V.RTCPeerConnection.prototype.createDataChannel=function(){const z=j.apply(this,arguments);return U(z,this),z},wrapPeerConnectionEvent(V,"datachannel",B=>(U(B.channel,B.target),B))}function shimConnectionState(V){if(!V.RTCPeerConnection||"connectionState"in V.RTCPeerConnection.prototype)return;const U=V.RTCPeerConnection.prototype;Object.defineProperty(U,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(U,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(j){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),j&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=j)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(j=>{const B=U[j];U[j]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=z=>{const H=z.target;if(H._lastConnectionState!==H.connectionState){H._lastConnectionState=H.connectionState;const G=new Event("connectionstatechange",z);H.dispatchEvent(G)}return z},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),B.apply(this,arguments)}})}function removeExtmapAllowMixed(V,U){if(!V.RTCPeerConnection||U.browser==="chrome"&&U.version>=71||U.browser==="safari"&&U._safariVersion>=13.1)return;const j=V.RTCPeerConnection.prototype.setRemoteDescription;V.RTCPeerConnection.prototype.setRemoteDescription=function(z){if(z&&z.sdp&&z.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const H=z.sdp.split(`
`).filter(G=>G.trim()!=="a=extmap-allow-mixed").join(`
`);V.RTCSessionDescription&&z instanceof V.RTCSessionDescription?arguments[0]=new V.RTCSessionDescription({type:z.type,sdp:H}):z.sdp=H}return j.apply(this,arguments)}}function shimAddIceCandidateNullOrEmpty(V,U){if(!(V.RTCPeerConnection&&V.RTCPeerConnection.prototype))return;const j=V.RTCPeerConnection.prototype.addIceCandidate;!j||j.length===0||(V.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(U.browser==="chrome"&&U.version<78||U.browser==="firefox"&&U.version<68||U.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():j.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function shimParameterlessSetLocalDescription(V,U){if(!(V.RTCPeerConnection&&V.RTCPeerConnection.prototype))return;const j=V.RTCPeerConnection.prototype.setLocalDescription;!j||j.length===0||(V.RTCPeerConnection.prototype.setLocalDescription=function(){let z=arguments[0]||{};if(typeof z!="object"||z.type&&z.sdp)return j.apply(this,arguments);if(z={type:z.type,sdp:z.sdp},!z.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":z.type="offer";break;default:z.type="answer";break}return z.sdp||z.type!=="offer"&&z.type!=="answer"?j.apply(this,[z]):(z.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(G=>j.apply(this,[G]))})}var commonShim=Object.freeze({__proto__:null,removeExtmapAllowMixed,shimAddIceCandidateNullOrEmpty,shimConnectionState,shimMaxMessageSize,shimParameterlessSetLocalDescription,shimRTCIceCandidate,shimRTCIceCandidateRelayProtocol,shimSendThrowTypeError});function adapterFactory(){let{window:V}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const j=log,B=detectBrowser(V),z={browserDetails:B,commonShim,extractVersion,disableLog,disableWarnings,sdp};switch(B.browser){case"chrome":if(!chromeShim||!shimPeerConnection$1||!U.shimChrome)return j("Chrome shim is not included in this adapter release."),z;if(B.version===null)return j("Chrome shim can not determine version, not shimming."),z;j("adapter.js shimming chrome."),z.browserShim=chromeShim,shimAddIceCandidateNullOrEmpty(V,B),shimParameterlessSetLocalDescription(V),shimGetUserMedia$2(V,B),shimMediaStream(V),shimPeerConnection$1(V,B),shimOnTrack$1(V),shimAddTrackRemoveTrack(V,B),shimGetSendersWithDtmf(V),shimSenderReceiverGetStats(V),fixNegotiationNeeded(V,B),shimRTCIceCandidate(V),shimRTCIceCandidateRelayProtocol(V),shimConnectionState(V),shimMaxMessageSize(V,B),shimSendThrowTypeError(V),removeExtmapAllowMixed(V,B);break;case"firefox":if(!firefoxShim||!shimPeerConnection||!U.shimFirefox)return j("Firefox shim is not included in this adapter release."),z;j("adapter.js shimming firefox."),z.browserShim=firefoxShim,shimAddIceCandidateNullOrEmpty(V,B),shimParameterlessSetLocalDescription(V),shimGetUserMedia$1(V,B),shimPeerConnection(V,B),shimOnTrack(V),shimRemoveStream(V),shimSenderGetStats(V),shimReceiverGetStats(V),shimRTCDataChannel(V),shimAddTransceiver(V),shimGetParameters(V),shimCreateOffer(V),shimCreateAnswer(V),shimRTCIceCandidate(V),shimConnectionState(V),shimMaxMessageSize(V,B),shimSendThrowTypeError(V);break;case"safari":if(!safariShim||!U.shimSafari)return j("Safari shim is not included in this adapter release."),z;j("adapter.js shimming safari."),z.browserShim=safariShim,shimAddIceCandidateNullOrEmpty(V,B),shimParameterlessSetLocalDescription(V),shimRTCIceServerUrls(V),shimCreateOfferLegacy(V),shimCallbacksAPI(V),shimLocalStreamsAPI(V),shimRemoteStreamsAPI(V),shimTrackEventTransceiver(V),shimGetUserMedia(V),shimAudioContext(V),shimRTCIceCandidate(V),shimRTCIceCandidateRelayProtocol(V),shimMaxMessageSize(V,B),shimSendThrowTypeError(V),removeExtmapAllowMixed(V,B);break;default:j("Unsupported browser!");break}return z}adapterFactory({window:typeof window>"u"?void 0:window});const DECRYPTION_FAILURE_TOLERANCE=10,E2EE_FLAG="lk_e2ee",SALT="LKFrameEncryptionKey",KEY_PROVIDER_DEFAULTS={sharedKey:!1,ratchetSalt:SALT,ratchetWindowSize:8,failureTolerance:DECRYPTION_FAILURE_TOLERANCE,keyringSize:16};var KeyProviderEvent;(function(V){V.SetKey="setKey",V.RatchetRequest="ratchetRequest",V.KeyRatcheted="keyRatcheted"})(KeyProviderEvent||(KeyProviderEvent={}));var KeyHandlerEvent;(function(V){V.KeyRatcheted="keyRatcheted"})(KeyHandlerEvent||(KeyHandlerEvent={}));var EncryptionEvent;(function(V){V.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",V.EncryptionError="encryptionError"})(EncryptionEvent||(EncryptionEvent={}));var CryptorEvent;(function(V){V.Error="cryptorError"})(CryptorEvent||(CryptorEvent={}));function isE2EESupported(){return isInsertableStreamSupported()||isScriptTransformSupported()}function isScriptTransformSupported(){return typeof window.RTCRtpScriptTransform<"u"}function isInsertableStreamSupported(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class BaseKeyProvider extends eventsExports.EventEmitter{constructor(){let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(j,B,z)=>{livekitLogger.debug("key ratcheted event received",{ratchetResult:j,participantId:B,keyIndex:z})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},KEY_PROVIDER_DEFAULTS),U),this.on(KeyProviderEvent.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(U,j,B){const z={key:U,participantIdentity:j,keyIndex:B};if(!this.options.sharedKey&&!j)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(j??"shared","-").concat(B??0),z),this.emit(KeyProviderEvent.SetKey,z)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(U,j){this.emit(KeyProviderEvent.RatchetRequest,U,j)}}class LivekitError extends Error{constructor(U,j){super(j||"an error has occured"),this.name="LiveKitError",this.code=U}}var ConnectionErrorReason;(function(V){V[V.NotAllowed=0]="NotAllowed",V[V.ServerUnreachable=1]="ServerUnreachable",V[V.InternalError=2]="InternalError",V[V.Cancelled=3]="Cancelled",V[V.LeaveRequest=4]="LeaveRequest",V[V.Timeout=5]="Timeout"})(ConnectionErrorReason||(ConnectionErrorReason={}));class ConnectionError extends LivekitError{constructor(U,j,B,z){super(1,U),this.name="ConnectionError",this.status=B,this.reason=j,this.context=z,this.reasonName=ConnectionErrorReason[j]}}class DeviceUnsupportedError extends LivekitError{constructor(U){super(21,U??"device is unsupported"),this.name="DeviceUnsupportedError"}}class TrackInvalidError extends LivekitError{constructor(U){super(20,U??"track is invalid"),this.name="TrackInvalidError"}}class UnsupportedServer extends LivekitError{constructor(U){super(10,U??"unsupported server"),this.name="UnsupportedServer"}}class UnexpectedConnectionState extends LivekitError{constructor(U){super(12,U??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class NegotiationError extends LivekitError{constructor(U){super(13,U??"unable to negotiate"),this.name="NegotiationError"}}class PublishTrackError extends LivekitError{constructor(U,j){super(15,U),this.name="PublishTrackError",this.status=j}}class SignalRequestError extends LivekitError{constructor(U,j){super(15,U),this.reason=j,this.reasonName=typeof j=="string"?j:RequestResponse_Reason[j]}}var MediaDeviceFailure;(function(V){V.PermissionDenied="PermissionDenied",V.NotFound="NotFound",V.DeviceInUse="DeviceInUse",V.Other="Other"})(MediaDeviceFailure||(MediaDeviceFailure={})),function(V){function U(j){if(j&&"name"in j)return j.name==="NotFoundError"||j.name==="DevicesNotFoundError"?V.NotFound:j.name==="NotAllowedError"||j.name==="PermissionDeniedError"?V.PermissionDenied:j.name==="NotReadableError"||j.name==="TrackStartError"?V.DeviceInUse:V.Other}V.getFailure=U}(MediaDeviceFailure||(MediaDeviceFailure={}));var CryptorErrorReason;(function(V){V[V.InvalidKey=0]="InvalidKey",V[V.MissingKey=1]="MissingKey",V[V.InternalError=2]="InternalError"})(CryptorErrorReason||(CryptorErrorReason={}));var RoomEvent;(function(V){V.Connected="connected",V.Reconnecting="reconnecting",V.SignalReconnecting="signalReconnecting",V.Reconnected="reconnected",V.Disconnected="disconnected",V.ConnectionStateChanged="connectionStateChanged",V.Moved="moved",V.MediaDevicesChanged="mediaDevicesChanged",V.ParticipantConnected="participantConnected",V.ParticipantDisconnected="participantDisconnected",V.TrackPublished="trackPublished",V.TrackSubscribed="trackSubscribed",V.TrackSubscriptionFailed="trackSubscriptionFailed",V.TrackUnpublished="trackUnpublished",V.TrackUnsubscribed="trackUnsubscribed",V.TrackMuted="trackMuted",V.TrackUnmuted="trackUnmuted",V.LocalTrackPublished="localTrackPublished",V.LocalTrackUnpublished="localTrackUnpublished",V.LocalAudioSilenceDetected="localAudioSilenceDetected",V.ActiveSpeakersChanged="activeSpeakersChanged",V.ParticipantMetadataChanged="participantMetadataChanged",V.ParticipantNameChanged="participantNameChanged",V.ParticipantAttributesChanged="participantAttributesChanged",V.ParticipantActive="participantActive",V.RoomMetadataChanged="roomMetadataChanged",V.DataReceived="dataReceived",V.SipDTMFReceived="sipDTMFReceived",V.TranscriptionReceived="transcriptionReceived",V.ConnectionQualityChanged="connectionQualityChanged",V.TrackStreamStateChanged="trackStreamStateChanged",V.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",V.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",V.AudioPlaybackStatusChanged="audioPlaybackChanged",V.VideoPlaybackStatusChanged="videoPlaybackChanged",V.MediaDevicesError="mediaDevicesError",V.ParticipantPermissionsChanged="participantPermissionsChanged",V.SignalConnected="signalConnected",V.RecordingStatusChanged="recordingStatusChanged",V.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",V.EncryptionError="encryptionError",V.DCBufferStatusChanged="dcBufferStatusChanged",V.ActiveDeviceChanged="activeDeviceChanged",V.ChatMessage="chatMessage",V.LocalTrackSubscribed="localTrackSubscribed",V.MetricsReceived="metricsReceived"})(RoomEvent||(RoomEvent={}));var ParticipantEvent;(function(V){V.TrackPublished="trackPublished",V.TrackSubscribed="trackSubscribed",V.TrackSubscriptionFailed="trackSubscriptionFailed",V.TrackUnpublished="trackUnpublished",V.TrackUnsubscribed="trackUnsubscribed",V.TrackMuted="trackMuted",V.TrackUnmuted="trackUnmuted",V.LocalTrackPublished="localTrackPublished",V.LocalTrackUnpublished="localTrackUnpublished",V.LocalTrackCpuConstrained="localTrackCpuConstrained",V.LocalSenderCreated="localSenderCreated",V.ParticipantMetadataChanged="participantMetadataChanged",V.ParticipantNameChanged="participantNameChanged",V.DataReceived="dataReceived",V.SipDTMFReceived="sipDTMFReceived",V.TranscriptionReceived="transcriptionReceived",V.IsSpeakingChanged="isSpeakingChanged",V.ConnectionQualityChanged="connectionQualityChanged",V.TrackStreamStateChanged="trackStreamStateChanged",V.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",V.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",V.TrackCpuConstrained="trackCpuConstrained",V.MediaDevicesError="mediaDevicesError",V.AudioStreamAcquired="audioStreamAcquired",V.ParticipantPermissionsChanged="participantPermissionsChanged",V.PCTrackAdded="pcTrackAdded",V.AttributesChanged="attributesChanged",V.LocalTrackSubscribed="localTrackSubscribed",V.ChatMessage="chatMessage",V.Active="active"})(ParticipantEvent||(ParticipantEvent={}));var EngineEvent;(function(V){V.TransportsCreated="transportsCreated",V.Connected="connected",V.Disconnected="disconnected",V.Resuming="resuming",V.Resumed="resumed",V.Restarting="restarting",V.Restarted="restarted",V.SignalResumed="signalResumed",V.SignalRestarted="signalRestarted",V.Closing="closing",V.MediaTrackAdded="mediaTrackAdded",V.ActiveSpeakersUpdate="activeSpeakersUpdate",V.DataPacketReceived="dataPacketReceived",V.RTPVideoMapUpdate="rtpVideoMapUpdate",V.DCBufferStatusChanged="dcBufferStatusChanged",V.ParticipantUpdate="participantUpdate",V.RoomUpdate="roomUpdate",V.SpeakersChanged="speakersChanged",V.StreamStateChanged="streamStateChanged",V.ConnectionQualityUpdate="connectionQualityUpdate",V.SubscriptionError="subscriptionError",V.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",V.RemoteMute="remoteMute",V.SubscribedQualityUpdate="subscribedQualityUpdate",V.LocalTrackUnpublished="localTrackUnpublished",V.LocalTrackSubscribed="localTrackSubscribed",V.Offline="offline",V.SignalRequestResponse="signalRequestResponse",V.SignalConnected="signalConnected",V.RoomMoved="roomMoved"})(EngineEvent||(EngineEvent={}));var TrackEvent;(function(V){V.Message="message",V.Muted="muted",V.Unmuted="unmuted",V.Restarted="restarted",V.Ended="ended",V.Subscribed="subscribed",V.Unsubscribed="unsubscribed",V.CpuConstrained="cpuConstrained",V.UpdateSettings="updateSettings",V.UpdateSubscription="updateSubscription",V.AudioPlaybackStarted="audioPlaybackStarted",V.AudioPlaybackFailed="audioPlaybackFailed",V.AudioSilenceDetected="audioSilenceDetected",V.VisibilityChanged="visibilityChanged",V.VideoDimensionsChanged="videoDimensionsChanged",V.VideoPlaybackStarted="videoPlaybackStarted",V.VideoPlaybackFailed="videoPlaybackFailed",V.ElementAttached="elementAttached",V.ElementDetached="elementDetached",V.UpstreamPaused="upstreamPaused",V.UpstreamResumed="upstreamResumed",V.SubscriptionPermissionChanged="subscriptionPermissionChanged",V.SubscriptionStatusChanged="subscriptionStatusChanged",V.SubscriptionFailed="subscriptionFailed",V.TrackProcessorUpdate="trackProcessorUpdate",V.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",V.TranscriptionReceived="transcriptionReceived",V.TimeSyncUpdate="timeSyncUpdate",V.PreConnectBufferFlushed="preConnectBufferFlushed"})(TrackEvent||(TrackEvent={}));function cloneDeep(V){return typeof V>"u"?V:typeof structuredClone=="function"?typeof V=="object"&&V!==null?structuredClone(Object.assign({},V)):structuredClone(V):JSON.parse(JSON.stringify(V))}const commonVersionIdentifier=/version\/(\d+(\.?_?\d+)+)/i;let browserDetails;function getBrowser(V){let U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const j=navigator.userAgent.toLowerCase();if(browserDetails===void 0||U){const B=browsersList.find(z=>{let{test:H}=z;return H.test(j)});browserDetails=B?.describe(j)}return browserDetails}const browsersList=[{test:/firefox|iceweasel|fxios/i,describe(V){return{name:"Firefox",version:getMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,V),os:V.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:getOSVersion(V)}}},{test:/chrom|crios|crmo/i,describe(V){return{name:"Chrome",version:getMatch(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,V),os:V.toLowerCase().includes("crios")?"iOS":void 0,osVersion:getOSVersion(V)}}},{test:/safari|applewebkit/i,describe(V){return{name:"Safari",version:getMatch(commonVersionIdentifier,V),os:V.includes("mobile/")?"iOS":"macOS",osVersion:getOSVersion(V)}}}];function getMatch(V,U){let j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const B=U.match(V);return B&&B.length>=j&&B[j]||""}function getOSVersion(V){return V.includes("mac os")?getMatch(/\(.+?(\d+_\d+(:?_\d+)?)/,V,1).replace(/_/g,"."):void 0}var version$1="2.15.3";const version=version$1,protocolVersion=16;class CriticalTimers{}CriticalTimers.setTimeout=function(){return setTimeout(...arguments)},CriticalTimers.setInterval=function(){return setInterval(...arguments)},CriticalTimers.clearTimeout=function(){return clearTimeout(...arguments)},CriticalTimers.clearInterval=function(){return clearInterval(...arguments)};const BACKGROUND_REACTION_DELAY=5e3,recycledElements=[];var VideoQuality;(function(V){V[V.LOW=0]="LOW",V[V.MEDIUM=1]="MEDIUM",V[V.HIGH=2]="HIGH"})(VideoQuality||(VideoQuality={}));class Track extends eventsExports.EventEmitter{constructor(U,j){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var z;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Track.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=livekitLogger,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),BACKGROUND_REACTION_DELAY):this.handleAppVisibilityChanged()},this.log=getLogger((z=B.loggerName)!==null&&z!==void 0?z:LoggerNames.Track),this.loggerContextCb=B.loggerContextCb,this.setMaxListeners(100),this.kind=j,this._mediaStreamTrack=U,this._mediaStreamID=U.id,this.source=Track.Source.Unknown}get logContext(){var U;return Object.assign(Object.assign({},(U=this.loggerContextCb)===null||U===void 0?void 0:U.call(this)),getLogContextFromTrack(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(U){let j="audio";this.kind===Track.Kind.Video&&(j="video"),this.attachedElements.length===0&&this.kind===Track.Kind.Video&&this.addAppVisibilityListener(),U||(j==="audio"&&(recycledElements.forEach(H=>{H.parentElement===null&&!U&&(U=H)}),U&&recycledElements.splice(recycledElements.indexOf(U),1)),U||(U=document.createElement(j))),this.attachedElements.includes(U)||this.attachedElements.push(U),attachToElement(this.mediaStreamTrack,U);const B=U.srcObject.getTracks(),z=B.some(H=>H.kind==="audio");return U.play().then(()=>{this.emit(z?TrackEvent.AudioPlaybackStarted:TrackEvent.VideoPlaybackStarted)}).catch(H=>{H.name==="NotAllowedError"?this.emit(z?TrackEvent.AudioPlaybackFailed:TrackEvent.VideoPlaybackFailed,H):H.name==="AbortError"?livekitLogger.debug("".concat(z?"audio":"video"," playback aborted, likely due to new play request")):livekitLogger.warn("could not playback ".concat(z?"audio":"video"),H),z&&U&&B.some(G=>G.kind==="video")&&H.name==="NotAllowedError"&&(U.muted=!0,U.play().catch(()=>{}))}),this.emit(TrackEvent.ElementAttached,U),U}detach(U){try{if(U){detachTrack(this.mediaStreamTrack,U);const B=this.attachedElements.indexOf(U);return B>=0&&(this.attachedElements.splice(B,1),this.recycleElement(U),this.emit(TrackEvent.ElementDetached,U)),U}const j=[];return this.attachedElements.forEach(B=>{detachTrack(this.mediaStreamTrack,B),j.push(B),this.recycleElement(B),this.emit(TrackEvent.ElementDetached,B)}),this.attachedElements=[],j}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(U){U.loggerName&&(this.log=getLogger(U.loggerName)),U.loggerContextCb&&(this.loggerContextCb=U.loggerContextCb)}recycleElement(U){if(U instanceof HTMLAudioElement){let j=!0;U.pause(),recycledElements.forEach(B=>{B.parentElement||(j=!1)}),j&&recycledElements.push(U)}}handleAppVisibilityChanged(){return __awaiter$1(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===Track.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(U=>U.play().catch(()=>{})),0)})}addAppVisibilityListener(){isWeb()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){isWeb()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function attachToElement(V,U){let j;U.srcObject instanceof MediaStream?j=U.srcObject:j=new MediaStream;let B;V.kind==="audio"?B=j.getAudioTracks():B=j.getVideoTracks(),B.includes(V)||(B.forEach(z=>{j.removeTrack(z)}),j.addTrack(V)),(!isSafari()||!(U instanceof HTMLVideoElement))&&(U.autoplay=!0),U.muted=j.getAudioTracks().length===0,U instanceof HTMLVideoElement&&(U.playsInline=!0),U.srcObject!==j&&(U.srcObject=j,(isSafari()||isFireFox())&&U instanceof HTMLVideoElement&&setTimeout(()=>{U.srcObject=j,U.play().catch(()=>{})},0))}function detachTrack(V,U){if(U.srcObject instanceof MediaStream){const j=U.srcObject;j.removeTrack(V),j.getTracks().length>0?U.srcObject=j:U.srcObject=null}}(function(V){let U;(function(W){W.Audio="audio",W.Video="video",W.Unknown="unknown"})(U=V.Kind||(V.Kind={}));let j;(function(W){W.Camera="camera",W.Microphone="microphone",W.ScreenShare="screen_share",W.ScreenShareAudio="screen_share_audio",W.Unknown="unknown"})(j=V.Source||(V.Source={}));let B;(function(W){W.Active="active",W.Paused="paused",W.Unknown="unknown"})(B=V.StreamState||(V.StreamState={}));function z(W){switch(W){case U.Audio:return TrackType.AUDIO;case U.Video:return TrackType.VIDEO;default:return TrackType.DATA}}V.kindToProto=z;function H(W){switch(W){case TrackType.AUDIO:return U.Audio;case TrackType.VIDEO:return U.Video;default:return U.Unknown}}V.kindFromProto=H;function G(W){switch(W){case j.Camera:return TrackSource.CAMERA;case j.Microphone:return TrackSource.MICROPHONE;case j.ScreenShare:return TrackSource.SCREEN_SHARE;case j.ScreenShareAudio:return TrackSource.SCREEN_SHARE_AUDIO;default:return TrackSource.UNKNOWN}}V.sourceToProto=G;function $(W){switch(W){case TrackSource.CAMERA:return j.Camera;case TrackSource.MICROPHONE:return j.Microphone;case TrackSource.SCREEN_SHARE:return j.ScreenShare;case TrackSource.SCREEN_SHARE_AUDIO:return j.ScreenShareAudio;default:return j.Unknown}}V.sourceFromProto=$;function Q(W){switch(W){case StreamState.ACTIVE:return B.Active;case StreamState.PAUSED:return B.Paused;default:return B.Unknown}}V.streamStateFromProto=Q})(Track||(Track={}));class VideoPreset{constructor(U,j,B,z,H){if(typeof U=="object")this.width=U.width,this.height=U.height,this.aspectRatio=U.aspectRatio,this.encoding={maxBitrate:U.maxBitrate,maxFramerate:U.maxFramerate,priority:U.priority};else if(j!==void 0&&B!==void 0)this.width=U,this.height=j,this.aspectRatio=U/j,this.encoding={maxBitrate:B,maxFramerate:z,priority:H};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const backupCodecs=["vp8","h264"],videoCodecs=["vp8","h264","vp9","av1","h265"];function isBackupCodec(V){return!!backupCodecs.find(U=>U===V)}var BackupCodecPolicy;(function(V){V[V.PREFER_REGRESSION=0]="PREFER_REGRESSION",V[V.SIMULCAST=1]="SIMULCAST",V[V.REGRESSION=2]="REGRESSION"})(BackupCodecPolicy||(BackupCodecPolicy={}));var AudioPresets;(function(V){V.telephone={maxBitrate:12e3},V.speech={maxBitrate:24e3},V.music={maxBitrate:48e3},V.musicStereo={maxBitrate:64e3},V.musicHighQuality={maxBitrate:96e3},V.musicHighQualityStereo={maxBitrate:128e3}})(AudioPresets||(AudioPresets={}));const VideoPresets={h90:new VideoPreset(160,90,9e4,20),h180:new VideoPreset(320,180,16e4,20),h216:new VideoPreset(384,216,18e4,20),h360:new VideoPreset(640,360,45e4,20),h540:new VideoPreset(960,540,8e5,25),h720:new VideoPreset(1280,720,17e5,30),h1080:new VideoPreset(1920,1080,3e6,30),h1440:new VideoPreset(2560,1440,5e6,30),h2160:new VideoPreset(3840,2160,8e6,30)},VideoPresets43={h120:new VideoPreset(160,120,7e4,20),h180:new VideoPreset(240,180,125e3,20),h240:new VideoPreset(320,240,14e4,20),h360:new VideoPreset(480,360,33e4,20),h480:new VideoPreset(640,480,5e5,20),h540:new VideoPreset(720,540,6e5,25),h720:new VideoPreset(960,720,13e5,30),h1080:new VideoPreset(1440,1080,23e5,30),h1440:new VideoPreset(1920,1440,38e5,30)},ScreenSharePresets={h360fps3:new VideoPreset(640,360,2e5,3,"medium"),h360fps15:new VideoPreset(640,360,4e5,15,"medium"),h720fps5:new VideoPreset(1280,720,8e5,5,"medium"),h720fps15:new VideoPreset(1280,720,15e5,15,"medium"),h720fps30:new VideoPreset(1280,720,2e6,30,"medium"),h1080fps15:new VideoPreset(1920,1080,25e5,15,"medium"),h1080fps30:new VideoPreset(1920,1080,5e6,30,"medium"),original:new VideoPreset(0,0,7e6,30,"medium")},separator="|",ddExtensionURI="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function unpackStreamId(V){const U=V.split(separator);return U.length>1?[U[0],V.substr(U[0].length+1)]:[V,""]}function sleep$1(V){return __awaiter$1(this,void 0,void 0,function*(){return new Promise(U=>CriticalTimers.setTimeout(U,V))})}function supportsTransceiver(){return"addTransceiver"in RTCPeerConnection.prototype}function supportsAddTrack(){return"addTrack"in RTCPeerConnection.prototype}function supportsAV1(){if(!("getCapabilities"in RTCRtpSender)||isSafari())return!1;const V=RTCRtpSender.getCapabilities("video");let U=!1;if(V){for(const j of V.codecs)if(j.mimeType==="video/AV1"){U=!0;break}}return U}function supportsVP9(){if(!("getCapabilities"in RTCRtpSender)||isFireFox())return!1;if(isSafari()){const j=getBrowser();if(j?.version&&compareVersions(j.version,"16")<0||j?.os==="iOS"&&j?.osVersion&&compareVersions(j.osVersion,"16")<0)return!1}const V=RTCRtpSender.getCapabilities("video");let U=!1;if(V){for(const j of V.codecs)if(j.mimeType==="video/VP9"){U=!0;break}}return U}function isSVCCodec(V){return V==="av1"||V==="vp9"}function supportsSetSinkId(V){return document?(V||(V=document.createElement("audio")),"setSinkId"in V):!1}function isBrowserSupported(){return typeof RTCPeerConnection>"u"?!1:supportsTransceiver()||supportsAddTrack()}function isFireFox(){var V;return((V=getBrowser())===null||V===void 0?void 0:V.name)==="Firefox"}function isSafari(){var V;return((V=getBrowser())===null||V===void 0?void 0:V.name)==="Safari"}function isSafariBased(){const V=getBrowser();return V?.name==="Safari"||V?.os==="iOS"}function isSafari17Based(){const V=getBrowser();return V?.name==="Safari"&&V.version.startsWith("17.")||V?.os==="iOS"&&!!V?.osVersion&&compareVersions(V.osVersion,"17")>=0}function isSafariSvcApi(V){return V||(V=getBrowser()),V?.name==="Safari"&&compareVersions(V.version,"18.3")>0||V?.os==="iOS"&&!!V?.osVersion&&compareVersions(V.osVersion,"18.3")>0}function isMobile(){var V,U;return isWeb()?(U=(V=navigator.userAgentData)===null||V===void 0?void 0:V.mobile)!==null&&U!==void 0?U:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function isE2EESimulcastSupported(){const V=getBrowser(),U="17.2";if(V)return V.name!=="Safari"&&V.os!=="iOS"||V.os==="iOS"&&V.osVersion&&compareVersions(U,V.osVersion)>=0?!0:V.name==="Safari"&&compareVersions(U,V.version)>=0}function isWeb(){return typeof document<"u"}function isReactNative(){return navigator.product=="ReactNative"}function isCloud(V){return V.hostname.endsWith(".livekit.cloud")||V.hostname.endsWith(".livekit.run")}function getLKReactNativeInfo(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function getReactNativeOs(){if(!isReactNative())return;let V=getLKReactNativeInfo();if(V)return V.platform}function getDevicePixelRatio(){if(isWeb())return window.devicePixelRatio;if(isReactNative()){let V=getLKReactNativeInfo();if(V)return V.devicePixelRatio}return 1}function compareVersions(V,U){const j=V.split("."),B=U.split("."),z=Math.min(j.length,B.length);for(let H=0;H<z;++H){const G=parseInt(j[H],10),$=parseInt(B[H],10);if(G>$)return 1;if(G<$)return-1;if(H===z-1&&G===$)return 0}return V===""&&U!==""?-1:U===""?1:j.length==B.length?0:j.length<B.length?-1:1}function roDispatchCallback(V){for(const U of V)U.target.handleResize(U)}function ioDispatchCallback(V){for(const U of V)U.target.handleVisibilityChanged(U)}let resizeObserver=null;const getResizeObserver=()=>(resizeObserver||(resizeObserver=new ResizeObserver(roDispatchCallback)),resizeObserver);let intersectionObserver=null;const getIntersectionObserver=()=>(intersectionObserver||(intersectionObserver=new IntersectionObserver(ioDispatchCallback,{root:null,rootMargin:"0px"})),intersectionObserver);function getClientInfo(){var V;const U=new ClientInfo({sdk:ClientInfo_SDK.JS,protocol:protocolVersion,version});return isReactNative()&&(U.os=(V=getReactNativeOs())!==null&&V!==void 0?V:""),U}function createDummyVideoStreamTrack(){let V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const z=document.createElement("canvas");z.width=V,z.height=U;const H=z.getContext("2d");H?.fillRect(0,0,z.width,z.height),B&&H&&(H.beginPath(),H.arc(V/2,U/2,50,0,Math.PI*2,!0),H.closePath(),H.fillStyle="grey",H.fill());const G=z.captureStream(),[$]=G.getTracks();if(!$)throw Error("Could not get empty media stream video track");return $.enabled=j,$}let emptyAudioStreamTrack;function getEmptyAudioStreamTrack(){if(!emptyAudioStreamTrack){const V=new AudioContext,U=V.createOscillator(),j=V.createGain();j.gain.setValueAtTime(0,0);const B=V.createMediaStreamDestination();if(U.connect(j),j.connect(B),U.start(),[emptyAudioStreamTrack]=B.stream.getAudioTracks(),!emptyAudioStreamTrack)throw Error("Could not get empty media stream audio track");emptyAudioStreamTrack.enabled=!1}return emptyAudioStreamTrack.clone()}class Future{get isResolved(){return this._isResolved}constructor(U,j){this._isResolved=!1,this.onFinally=j,this.promise=new Promise((B,z)=>__awaiter$1(this,void 0,void 0,function*(){this.resolve=B,this.reject=z,U&&(yield U(B,z))})).finally(()=>{var B;this._isResolved=!0,(B=this.onFinally)===null||B===void 0||B.call(this)})}}function isVideoCodec(V){return videoCodecs.includes(V)}function unwrapConstraint(V){if(typeof V=="string"||typeof V=="number")return V;if(Array.isArray(V))return V[0];if(V.exact)return Array.isArray(V.exact)?V.exact[0]:V.exact;if(V.ideal)return Array.isArray(V.ideal)?V.ideal[0]:V.ideal;throw Error("could not unwrap constraint")}function toWebsocketUrl(V){return V.startsWith("http")?V.replace(/^(http)/,"ws"):V}function toHttpUrl(V){return V.startsWith("ws")?V.replace(/^(ws)/,"http"):V}function extractTranscriptionSegments(V,U){return V.segments.map(j=>{let{id:B,text:z,language:H,startTime:G,endTime:$,final:Q}=j;var W;const X=(W=U.get(B))!==null&&W!==void 0?W:Date.now(),ee=Date.now();return Q?U.delete(B):U.set(B,X),{id:B,text:z,startTime:Number.parseInt(G.toString()),endTime:Number.parseInt($.toString()),final:Q,language:H,firstReceivedTime:X,lastReceivedTime:ee}})}function extractChatMessage(V){const{id:U,timestamp:j,message:B,editTimestamp:z}=V;return{id:U,timestamp:Number.parseInt(j.toString()),editTimestamp:z?Number.parseInt(z.toString()):void 0,message:B}}function getDisconnectReasonFromConnectionError(V){switch(V.reason){case ConnectionErrorReason.LeaveRequest:return V.context;case ConnectionErrorReason.Cancelled:return DisconnectReason.CLIENT_INITIATED;case ConnectionErrorReason.NotAllowed:return DisconnectReason.USER_REJECTED;case ConnectionErrorReason.ServerUnreachable:return DisconnectReason.JOIN_FAILURE;default:return DisconnectReason.UNKNOWN_REASON}}function bigIntToNumber(V){return V!==void 0?Number(V):void 0}function numberToBigInt(V){return V!==void 0?BigInt(V):void 0}function isLocalTrack(V){return!!V&&!(V instanceof MediaStreamTrack)&&V.isLocal}function isAudioTrack(V){return!!V&&V.kind==Track.Kind.Audio}function isVideoTrack(V){return!!V&&V.kind==Track.Kind.Video}function isLocalVideoTrack(V){return isLocalTrack(V)&&isVideoTrack(V)}function isLocalAudioTrack(V){return isLocalTrack(V)&&isAudioTrack(V)}function isRemoteTrack(V){return!!V&&!V.isLocal}function isRemotePub(V){return!!V&&!V.isLocal}function isRemoteVideoTrack(V){return isRemoteTrack(V)&&isVideoTrack(V)}function isLocalParticipant(V){return V.isLocal}function splitUtf8(V,U){const j=[];let B=new TextEncoder().encode(V);for(;B.length>U;){let z=U;for(;z>0;){const H=B[z];if(H!==void 0&&(H&192)!==128)break;z--}j.push(B.slice(0,z)),B=B.slice(z)}return B.length>0&&j.push(B),j}function mergeDefaultOptions(V,U,j){var B,z,H,G;const{optionsWithoutProcessor:$,audioProcessor:Q,videoProcessor:W}=extractProcessorsFromOptions(V??{}),X=U?.processor,ee=j?.processor,ie=$??{};return ie.audio===!0&&(ie.audio={}),ie.video===!0&&(ie.video={}),ie.audio&&(mergeObjectWithoutOverwriting(ie.audio,U),(B=(H=ie.audio).deviceId)!==null&&B!==void 0||(H.deviceId={ideal:"default"}),(Q||X)&&(ie.audio.processor=Q??X)),ie.video&&(mergeObjectWithoutOverwriting(ie.video,j),(z=(G=ie.video).deviceId)!==null&&z!==void 0||(G.deviceId={ideal:"default"}),(W||ee)&&(ie.video.processor=W??ee)),ie}function mergeObjectWithoutOverwriting(V,U){return Object.keys(U).forEach(j=>{V[j]===void 0&&(V[j]=U[j])}),V}function constraintsForOptions(V){var U,j,B,z;const H={};if(V.video)if(typeof V.video=="object"){const G={},$=G,Q=V.video;Object.keys(Q).forEach(W=>{switch(W){case"resolution":mergeObjectWithoutOverwriting($,Q.resolution);break;default:$[W]=Q[W]}}),H.video=G,(U=(B=H.video).deviceId)!==null&&U!==void 0||(B.deviceId={ideal:"default"})}else H.video=V.video?{deviceId:{ideal:"default"}}:!1;else H.video=!1;return V.audio?typeof V.audio=="object"?(H.audio=V.audio,(j=(z=H.audio).deviceId)!==null&&j!==void 0||(z.deviceId={ideal:"default"})):H.audio={deviceId:{ideal:"default"}}:H.audio=!1,H}function detectSilence(V){return __awaiter$1(this,arguments,void 0,function(U){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const B=getNewAudioContext();if(B){const z=B.createAnalyser();z.fftSize=2048;const H=z.frequencyBinCount,G=new Uint8Array(H);B.createMediaStreamSource(new MediaStream([U.mediaStreamTrack])).connect(z),yield sleep$1(j),z.getByteTimeDomainData(G);const Q=G.some(W=>W!==128&&W!==0);return B.close(),!Q}return!1}()})}function getNewAudioContext(){var V;const U=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(U){const j=new U({latencyHint:"interactive"});if(j.state==="suspended"&&typeof window<"u"&&(!((V=window.document)===null||V===void 0)&&V.body)){const B=()=>__awaiter$1(this,void 0,void 0,function*(){var z;try{j.state==="suspended"&&(yield j.resume())}catch(H){console.warn("Error trying to auto-resume audio context",H)}(z=window.document.body)===null||z===void 0||z.removeEventListener("click",B)});window.document.body.addEventListener("click",B)}return j}}function kindToSource(V){return V==="audioinput"?Track.Source.Microphone:V==="videoinput"?Track.Source.Camera:Track.Source.Unknown}function sourceToKind(V){return V===Track.Source.Microphone?"audioinput":V===Track.Source.Camera?"videoinput":void 0}function screenCaptureToDisplayMediaStreamOptions(V){var U,j;let B=(U=V.video)!==null&&U!==void 0?U:!0;return V.resolution&&V.resolution.width>0&&V.resolution.height>0&&(B=typeof B=="boolean"?{}:B,isSafari()?B=Object.assign(Object.assign({},B),{width:{max:V.resolution.width},height:{max:V.resolution.height},frameRate:V.resolution.frameRate}):B=Object.assign(Object.assign({},B),{width:{ideal:V.resolution.width},height:{ideal:V.resolution.height},frameRate:V.resolution.frameRate})),{audio:(j=V.audio)!==null&&j!==void 0?j:!1,video:B,controller:V.controller,selfBrowserSurface:V.selfBrowserSurface,surfaceSwitching:V.surfaceSwitching,systemAudio:V.systemAudio,preferCurrentTab:V.preferCurrentTab}}function mimeTypeToVideoCodecString(V){return V.split("/")[1].toLowerCase()}function getTrackPublicationInfo(V){const U=[];return V.forEach(j=>{j.track!==void 0&&U.push(new TrackPublishedResponse({cid:j.track.mediaStreamID,track:j.trackInfo}))}),U}function getLogContextFromTrack(V){return"mediaStreamTrack"in V?{trackID:V.sid,source:V.source,muted:V.isMuted,enabled:V.mediaStreamTrack.enabled,kind:V.kind,streamID:V.mediaStreamID,streamTrackID:V.mediaStreamTrack.id}:{trackID:V.trackSid,enabled:V.isEnabled,muted:V.isMuted,trackInfo:Object.assign({mimeType:V.mimeType,name:V.trackName,encrypted:V.isEncrypted,kind:V.kind,source:V.source},V.track?getLogContextFromTrack(V.track):{})}}function supportsSynchronizationSources(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function diffAttributes(V,U){var j;V===void 0&&(V={}),U===void 0&&(U={});const B=[...Object.keys(U),...Object.keys(V)],z={};for(const H of B)V[H]!==U[H]&&(z[H]=(j=U[H])!==null&&j!==void 0?j:"");return z}function extractProcessorsFromOptions(V){const U=Object.assign({},V);let j,B;return typeof U.audio=="object"&&U.audio.processor&&(j=U.audio.processor,U.audio=Object.assign(Object.assign({},U.audio),{processor:void 0})),typeof U.video=="object"&&U.video.processor&&(B=U.video.processor,U.video=Object.assign(Object.assign({},U.video),{processor:void 0})),{audioProcessor:j,videoProcessor:B,optionsWithoutProcessor:cloneDeep(U)}}function getTrackSourceFromProto(V){switch(V){case TrackSource.CAMERA:return Track.Source.Camera;case TrackSource.MICROPHONE:return Track.Source.Microphone;case TrackSource.SCREEN_SHARE:return Track.Source.ScreenShare;case TrackSource.SCREEN_SHARE_AUDIO:return Track.Source.ScreenShareAudio;default:return Track.Source.Unknown}}function areDimensionsSmaller(V,U){return V.width*V.height<U.width*U.height}function layerDimensionsFor(V,U){var j;return(j=V.layers)===null||j===void 0?void 0:j.find(B=>B.quality===U)}class E2EEManager extends eventsExports.EventEmitter{constructor(U){super(),this.onWorkerMessage=j=>{var B,z;const{kind:H,data:G}=j.data;switch(H){case"error":livekitLogger.error(G.error.message),this.emit(EncryptionEvent.EncryptionError,G.error);break;case"initAck":G.enabled&&this.keyProvider.getKeys().forEach($=>{this.postKey($)});break;case"enable":if(G.enabled&&this.keyProvider.getKeys().forEach($=>{this.postKey($)}),this.encryptionEnabled!==G.enabled&&G.participantIdentity===((B=this.room)===null||B===void 0?void 0:B.localParticipant.identity))this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,G.enabled,this.room.localParticipant),this.encryptionEnabled=G.enabled;else if(G.participantIdentity){const $=(z=this.room)===null||z===void 0?void 0:z.getParticipantByIdentity(G.participantIdentity);if(!$)throw TypeError("couldn't set encryption status, participant not found".concat(G.participantIdentity));this.emit(EncryptionEvent.ParticipantEncryptionStatusChanged,G.enabled,$)}break;case"ratchetKey":this.keyProvider.emit(KeyProviderEvent.KeyRatcheted,G.ratchetResult,G.participantIdentity,G.keyIndex);break}},this.onWorkerError=j=>{livekitLogger.error("e2ee worker encountered an error:",{error:j.error}),this.emit(EncryptionEvent.EncryptionError,j.error)},this.keyProvider=U.keyProvider,this.worker=U.worker,this.encryptionEnabled=!1}setup(U){if(!isE2EESupported())throw new DeviceUnsupportedError("tried to setup end-to-end encryption on an unsupported browser");if(livekitLogger.info("setting up e2ee"),U!==this.room){this.room=U,this.setupEventListeners(U,this.keyProvider);const j={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:workerLogger.getLevel()}};this.worker&&(livekitLogger.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(j))}}setParticipantCryptorEnabled(U,j){livekitLogger.debug("set e2ee to ".concat(U," for participant ").concat(j)),this.postEnable(U,j)}setSifTrailer(U){!U||U.length===0?livekitLogger.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(U)}setupEngine(U){U.on(EngineEvent.RTPVideoMapUpdate,j=>{this.postRTPMap(j)})}setupEventListeners(U,j){U.on(RoomEvent.TrackPublished,(B,z)=>this.setParticipantCryptorEnabled(B.trackInfo.encryption!==Encryption_Type.NONE,z.identity)),U.on(RoomEvent.ConnectionStateChanged,B=>{B===ConnectionState.Connected&&U.remoteParticipants.forEach(z=>{z.trackPublications.forEach(H=>{this.setParticipantCryptorEnabled(H.trackInfo.encryption!==Encryption_Type.NONE,z.identity)})})}).on(RoomEvent.TrackUnsubscribed,(B,z,H)=>{var G;const $={kind:"removeTransform",data:{participantIdentity:H.identity,trackId:B.mediaStreamID}};(G=this.worker)===null||G===void 0||G.postMessage($)}).on(RoomEvent.TrackSubscribed,(B,z,H)=>{this.setupE2EEReceiver(B,H.identity,z.trackInfo)}).on(RoomEvent.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");j.getKeys().forEach(B=>{this.postKey(B)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),U.localParticipant.on(ParticipantEvent.LocalSenderCreated,(B,z)=>__awaiter$1(this,void 0,void 0,function*(){this.setupE2EESender(z,B)})),j.on(KeyProviderEvent.SetKey,B=>this.postKey(B)).on(KeyProviderEvent.RatchetRequest,(B,z)=>this.postRatchetRequest(B,z))}postRatchetRequest(U,j){if(!this.worker)throw Error("could not ratchet key, worker is missing");const B={kind:"ratchetRequest",data:{participantIdentity:U,keyIndex:j}};this.worker.postMessage(B)}postKey(U){let{key:j,participantIdentity:B,keyIndex:z}=U;var H;if(!this.worker)throw Error("could not set key, worker is missing");const G={kind:"setKey",data:{participantIdentity:B,isPublisher:B===((H=this.room)===null||H===void 0?void 0:H.localParticipant.identity),key:j,keyIndex:z}};this.worker.postMessage(G)}postEnable(U,j){if(this.worker){const B={kind:"enable",data:{enabled:U,participantIdentity:j}};this.worker.postMessage(B)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(U){var j;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((j=this.room)===null||j===void 0)&&j.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const B={kind:"setRTPMap",data:{map:U,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(B)}postSifTrailer(U){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const j={kind:"setSifTrailer",data:{trailer:U}};this.worker.postMessage(j)}setupE2EEReceiver(U,j,B){if(U.receiver){if(!B?.mimeType||B.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(U.receiver,U.mediaStreamID,j,U.kind==="video"?mimeTypeToVideoCodecString(B.mimeType):void 0)}}setupE2EESender(U,j){if(!isLocalTrack(U)||!j){j||livekitLogger.warn("early return because sender is not ready");return}this.handleSender(j,U.mediaStreamID,void 0)}handleReceiver(U,j,B,z){return __awaiter$1(this,void 0,void 0,function*(){if(this.worker){if(isScriptTransformSupported()){const H={kind:"decode",participantIdentity:B,trackId:j,codec:z};U.transform=new RTCRtpScriptTransform(this.worker,H)}else{if(E2EE_FLAG in U&&z){const Q={kind:"updateCodec",data:{trackId:j,codec:z,participantIdentity:B}};this.worker.postMessage(Q);return}let H=U.writableStream,G=U.readableStream;if(!H||!G){const Q=U.createEncodedStreams();U.writableStream=Q.writable,H=Q.writable,U.readableStream=Q.readable,G=Q.readable}const $={kind:"decode",data:{readableStream:G,writableStream:H,trackId:j,codec:z,participantIdentity:B,isReuse:E2EE_FLAG in U}};this.worker.postMessage($,[G,H])}U[E2EE_FLAG]=!0}})}handleSender(U,j,B){var z;if(!(E2EE_FLAG in U||!this.worker)){if(!(!((z=this.room)===null||z===void 0)&&z.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(isScriptTransformSupported()){livekitLogger.info("initialize script transform");const H={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:j,codec:B};U.transform=new RTCRtpScriptTransform(this.worker,H)}else{livekitLogger.info("initialize encoded streams");const H=U.createEncodedStreams(),G={kind:"encode",data:{readableStream:H.readable,writableStream:H.writable,codec:B,trackId:j,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(G,[H.readable,H.writable])}U[E2EE_FLAG]=!0}}}const defaultId="default";class DeviceManager{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new DeviceManager),this.instance}get previousDevices(){return this._previousDevices}getDevices(U){return __awaiter$1(this,arguments,void 0,function(j){var B=this;let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var H;if(((H=DeviceManager.userMediaPromiseMap)===null||H===void 0?void 0:H.size)>0){livekitLogger.debug("awaiting getUserMedia promise");try{j?yield DeviceManager.userMediaPromiseMap.get(j):yield Promise.all(DeviceManager.userMediaPromiseMap.values())}catch{livekitLogger.warn("error waiting for media permissons")}}let G=yield navigator.mediaDevices.enumerateDevices();if(z&&!(isSafari()&&B.hasDeviceInUse(j))&&(G.filter(Q=>Q.kind===j).length===0||G.some(Q=>{const W=Q.label==="",X=j?Q.kind===j:!0;return W&&X}))){const Q={video:j!=="audioinput"&&j!=="audiooutput",audio:j!=="videoinput"&&{deviceId:{ideal:"default"}}},W=yield navigator.mediaDevices.getUserMedia(Q);G=yield navigator.mediaDevices.enumerateDevices(),W.getTracks().forEach(X=>{X.stop()})}return B._previousDevices=G,j&&(G=G.filter($=>$.kind===j)),G}()})}normalizeDeviceId(U,j,B){return __awaiter$1(this,void 0,void 0,function*(){if(j!==defaultId)return j;const z=yield this.getDevices(U),H=z.find($=>$.deviceId===defaultId);if(!H){livekitLogger.warn("could not reliably determine default device");return}const G=z.find($=>$.deviceId!==defaultId&&$.groupId===(B??H.groupId));if(!G){livekitLogger.warn("could not reliably determine default device");return}return G?.deviceId})}hasDeviceInUse(U){return U?DeviceManager.userMediaPromiseMap.has(U):DeviceManager.userMediaPromiseMap.size>0}}DeviceManager.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],DeviceManager.userMediaPromiseMap=new Map;var QueueTaskStatus;(function(V){V[V.WAITING=0]="WAITING",V[V.RUNNING=1]="RUNNING",V[V.COMPLETED=2]="COMPLETED"})(QueueTaskStatus||(QueueTaskStatus={}));class AsyncQueue{constructor(){this.pendingTasks=new Map,this.taskMutex=new _$1,this.nextTaskIndex=0}run(U){return __awaiter$1(this,void 0,void 0,function*(){const j={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:QueueTaskStatus.WAITING};this.pendingTasks.set(j.id,j);const B=yield this.taskMutex.lock();try{return j.executedAt=Date.now(),j.status=QueueTaskStatus.RUNNING,yield U()}finally{j.status=QueueTaskStatus.COMPLETED,this.pendingTasks.delete(j.id),B()}})}flush(){return __awaiter$1(this,void 0,void 0,function*(){return this.run(()=>__awaiter$1(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function createRtcUrl(V,U){const j=new URL(toWebsocketUrl(V));return U.forEach((B,z)=>{j.searchParams.set(z,B)}),appendUrlPath(j,"rtc")}function createValidateUrl(V){const U=new URL(toHttpUrl(V));return appendUrlPath(U,"validate")}function ensureTrailingSlash(V){return V.endsWith("/")?V:"".concat(V,"/")}function appendUrlPath(V,U){return V.pathname="".concat(ensureTrailingSlash(V.pathname)).concat(U),V.toString()}const passThroughQueueSignals=["syncState","trickle","offer","answer","simulate","leave"];function canPassThroughQueue(V){const U=passThroughQueueSignals.indexOf(V.case)>=0;return livekitLogger.trace("request allowed to bypass queue:",{canPass:U,req:V}),U}var SignalConnectionState;(function(V){V[V.CONNECTING=0]="CONNECTING",V[V.CONNECTED=1]="CONNECTED",V[V.RECONNECTING=2]="RECONNECTING",V[V.DISCONNECTING=3]="DISCONNECTING",V[V.DISCONNECTED=4]="DISCONNECTED"})(SignalConnectionState||(SignalConnectionState={}));class SignalClient{get currentState(){return this.state}get isDisconnected(){return this.state===SignalConnectionState.DISCONNECTING||this.state===SignalConnectionState.DISCONNECTED}get isEstablishingConnection(){return this.state===SignalConnectionState.CONNECTING||this.state===SignalConnectionState.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var B;this.rtt=0,this.state=SignalConnectionState.DISCONNECTED,this.log=livekitLogger,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=getLogger((B=j.loggerName)!==null&&B!==void 0?B:LoggerNames.Signal),this.loggerContextCb=j.loggerContextCb,this.useJSON=U,this.requestQueue=new AsyncQueue,this.queuedRequests=[],this.closingLock=new _$1,this.connectionLock=new _$1,this.state=SignalConnectionState.DISCONNECTED}get logContext(){var U,j;return(j=(U=this.loggerContextCb)===null||U===void 0?void 0:U.call(this))!==null&&j!==void 0?j:{}}join(U,j,B,z){return __awaiter$1(this,void 0,void 0,function*(){return this.state=SignalConnectionState.CONNECTING,this.options=B,yield this.connect(U,j,B,z)})}reconnect(U,j,B,z){return __awaiter$1(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=SignalConnectionState.RECONNECTING,this.clearPingInterval(),yield this.connect(U,j,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:B,reconnectReason:z}))})}connect(U,j,B,z){this.connectOptions=B;const H=getClientInfo(),G=createConnectionParams(j,H,B),$=createRtcUrl(U,G),Q=createValidateUrl($);return new Promise((W,X)=>__awaiter$1(this,void 0,void 0,function*(){const ee=yield this.connectionLock.lock();try{const ie=()=>__awaiter$1(this,void 0,void 0,function*(){this.close(),clearTimeout(ne),X(new ConnectionError("room connection has been cancelled (signal)",ConnectionErrorReason.Cancelled))}),ne=setTimeout(()=>{this.close(),X(new ConnectionError("room connection has timed out (signal)",ConnectionErrorReason.ServerUnreachable))},B.websocketTimeout);z?.aborted&&ie(),z?.addEventListener("abort",ie);const re=new URL($);re.searchParams.has("access_token")&&re.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(re),Object.assign({reconnect:B.reconnect,reconnectReason:B.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket($),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(ne)},this.ws.onerror=se=>__awaiter$1(this,void 0,void 0,function*(){if(this.state!==SignalConnectionState.CONNECTED){this.state=SignalConnectionState.DISCONNECTED,clearTimeout(ne);try{const de=yield fetch(Q);if(de.status.toFixed(0).startsWith("4")){const oe=yield de.text();X(new ConnectionError(oe,ConnectionErrorReason.NotAllowed,de.status))}else X(new ConnectionError("Encountered unknown websocket error during connection: ".concat(se.toString()),ConnectionErrorReason.InternalError,de.status))}catch(de){X(new ConnectionError(de instanceof Error?de.message:"server was not reachable",ConnectionErrorReason.ServerUnreachable))}return}this.handleWSError(se)}),this.ws.onmessage=se=>__awaiter$1(this,void 0,void 0,function*(){var de,oe,le;let ue;if(typeof se.data=="string"){const fe=JSON.parse(se.data);ue=SignalResponse.fromJson(fe,{ignoreUnknownFields:!0})}else if(se.data instanceof ArrayBuffer)ue=SignalResponse.fromBinary(new Uint8Array(se.data));else{this.log.error("could not decode websocket message: ".concat(typeof se.data),this.logContext);return}if(this.state!==SignalConnectionState.CONNECTED){let fe=!1;if(((de=ue.message)===null||de===void 0?void 0:de.case)==="join"?(this.state=SignalConnectionState.CONNECTED,z?.removeEventListener("abort",ie),this.pingTimeoutDuration=ue.message.value.pingTimeout,this.pingIntervalDuration=ue.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),W(ue.message.value)):this.state===SignalConnectionState.RECONNECTING&&ue.message.case!=="leave"?(this.state=SignalConnectionState.CONNECTED,z?.removeEventListener("abort",ie),this.startPingInterval(),((oe=ue.message)===null||oe===void 0?void 0:oe.case)==="reconnect"?W(ue.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),W(void 0),fe=!0)):this.isEstablishingConnection&&ue.message.case==="leave"?X(new ConnectionError("Received leave request while trying to (re)connect",ConnectionErrorReason.LeaveRequest,void 0,ue.message.value.reason)):B.reconnect||X(new ConnectionError("did not receive join response, got ".concat((le=ue.message)===null||le===void 0?void 0:le.case," instead"),ConnectionErrorReason.InternalError)),!fe)return}this.signalLatency&&(yield sleep$1(this.signalLatency)),this.handleSignalResponse(ue)}),this.ws.onclose=se=>{this.isEstablishingConnection&&X(new ConnectionError("Websocket got closed during a (re)connection attempt",ConnectionErrorReason.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:se.reason,code:se.code,wasClean:se.wasClean,state:this.state})),this.handleOnClose(se.reason)}}finally{ee()}}))}close(){return __awaiter$1(this,arguments,void 0,function(){var U=this;let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const B=yield U.closingLock.lock();try{if(U.clearPingInterval(),j&&(U.state=SignalConnectionState.DISCONNECTING),U.ws){U.ws.onmessage=null,U.ws.onopen=null,U.ws.onclose=null;const z=new Promise(H=>{U.ws?U.ws.onclose=()=>{H()}:H()});U.ws.readyState<U.ws.CLOSING&&(U.ws.close(),yield Promise.race([z,sleep$1(250)])),U.ws=void 0}}finally{j&&(U.state=SignalConnectionState.DISCONNECTED),B()}}()})}sendOffer(U,j){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:U.sdp})),this.sendRequest({case:"offer",value:toProtoSessionDescription(U,j)})}sendAnswer(U,j){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:U.sdp})),this.sendRequest({case:"answer",value:toProtoSessionDescription(U,j)})}sendIceCandidate(U,j){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:U})),this.sendRequest({case:"trickle",value:new TrickleRequest({candidateInit:JSON.stringify(U),target:j})})}sendMuteTrack(U,j){return this.sendRequest({case:"mute",value:new MuteTrackRequest({sid:U,muted:j})})}sendAddTrack(U){return this.sendRequest({case:"addTrack",value:U})}sendUpdateLocalMetadata(U,j){return __awaiter$1(this,arguments,void 0,function(B,z){var H=this;let G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const $=H.getNextRequestId();return yield H.sendRequest({case:"updateMetadata",value:new UpdateParticipantMetadata({requestId:$,metadata:B,name:z,attributes:G})}),$}()})}sendUpdateTrackSettings(U){this.sendRequest({case:"trackSetting",value:U})}sendUpdateSubscription(U){return this.sendRequest({case:"subscription",value:U})}sendSyncState(U){return this.sendRequest({case:"syncState",value:U})}sendUpdateVideoLayers(U,j){return this.sendRequest({case:"updateLayers",value:new UpdateVideoLayers({trackSid:U,layers:j})})}sendUpdateSubscriptionPermissions(U,j){return this.sendRequest({case:"subscriptionPermission",value:new SubscriptionPermission({allParticipants:U,trackPermissions:j})})}sendSimulateScenario(U){return this.sendRequest({case:"simulate",value:U})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:protoInt64.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ping({timestamp:protoInt64.parse(Date.now()),rtt:protoInt64.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(U,j){return this.sendRequest({case:"updateAudioTrack",value:new UpdateLocalAudioTrack({trackSid:U,features:j})})}sendLeave(){return this.sendRequest({case:"leave",value:new LeaveRequest({reason:DisconnectReason.CLIENT_INITIATED,action:LeaveRequest_Action.DISCONNECT})})}sendRequest(U){return __awaiter$1(this,arguments,void 0,function(j){var B=this;let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!z&&!canPassThroughQueue(j)&&B.state===SignalConnectionState.RECONNECTING){B.queuedRequests.push(()=>__awaiter$1(B,void 0,void 0,function*(){yield this.sendRequest(j,!0)}));return}if(z||(yield B.requestQueue.flush()),B.signalLatency&&(yield sleep$1(B.signalLatency)),!B.ws||B.ws.readyState!==B.ws.OPEN){B.log.error("cannot send signal request before connected, type: ".concat(j?.case),B.logContext);return}const G=new SignalRequest({message:j});try{B.useJSON?B.ws.send(G.toJsonString()):B.ws.send(G.toBinary())}catch($){B.log.error("error sending signal message",Object.assign(Object.assign({},B.logContext),{error:$}))}}()})}handleSignalResponse(U){var j,B;const z=U.message;if(z==null){this.log.debug("received unsupported message",this.logContext);return}let H=!1;if(z.case==="answer"){const G=fromProtoSessionDescription(z.value);this.onAnswer&&this.onAnswer(G,z.value.id)}else if(z.case==="offer"){const G=fromProtoSessionDescription(z.value);this.onOffer&&this.onOffer(G,z.value.id)}else if(z.case==="trickle"){const G=JSON.parse(z.value.candidateInit);this.onTrickle&&this.onTrickle(G,z.value.target)}else z.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((j=z.value.participants)!==null&&j!==void 0?j:[]):z.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(z.value):z.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((B=z.value.speakers)!==null&&B!==void 0?B:[]):z.case==="leave"?this.onLeave&&this.onLeave(z.value):z.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(z.value.sid,z.value.muted):z.case==="roomUpdate"?this.onRoomUpdate&&z.value.room&&this.onRoomUpdate(z.value.room):z.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(z.value):z.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(z.value):z.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(z.value):z.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(z.value):z.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(z.value):z.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(z.value):z.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(z.value):z.case==="pong"||(z.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(z.value.lastPingTimestamp.toString()),this.resetPingTimeout(),H=!0):z.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(z.value):z.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(z.value.trackSid):z.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(z.value.token),this.onRoomMoved&&this.onRoomMoved(z.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:z.case})));H||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const U=this.queuedRequests.shift();U&&this.requestQueue.run(U)}}handleOnClose(U){return __awaiter$1(this,void 0,void 0,function*(){if(this.state===SignalConnectionState.DISCONNECTED)return;const j=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(U),Object.assign(Object.assign({},this.logContext),{reason:U})),j&&j(U)})}handleWSError(U){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:U}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=CriticalTimers.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&CriticalTimers.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=CriticalTimers.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&CriticalTimers.clearInterval(this.pingInterval)}}function fromProtoSessionDescription(V){const U={type:"offer",sdp:V.sdp};switch(V.type){case"answer":case"offer":case"pranswer":case"rollback":U.type=V.type;break}return U}function toProtoSessionDescription(V,U){return new SessionDescription({sdp:V.sdp,type:V.type,id:U})}function createConnectionParams(V,U,j){var B;const z=new URLSearchParams;return z.set("access_token",V),j.reconnect&&(z.set("reconnect","1"),j.sid&&z.set("sid",j.sid)),z.set("auto_subscribe",j.autoSubscribe?"1":"0"),z.set("sdk",isReactNative()?"reactnative":"js"),z.set("version",U.version),z.set("protocol",U.protocol.toString()),U.deviceModel&&z.set("device_model",U.deviceModel),U.os&&z.set("os",U.os),U.osVersion&&z.set("os_version",U.osVersion),U.browser&&z.set("browser",U.browser),U.browserVersion&&z.set("browser_version",U.browserVersion),j.adaptiveStream&&z.set("adaptive_stream","1"),j.reconnectReason&&z.set("reconnect_reason",j.reconnectReason.toString()),!((B=navigator.connection)===null||B===void 0)&&B.type&&z.set("network",navigator.connection.type),z}class DataPacketBuffer{constructor(){this.buffer=[],this._totalSize=0}push(U){this.buffer.push(U),this._totalSize+=U.data.byteLength}pop(){const U=this.buffer.shift();return U&&(this._totalSize-=U.data.byteLength),U}getAll(){return this.buffer.slice()}popToSequence(U){for(;this.buffer.length>0&&this.buffer[0].sequence<=U;)this.pop()}alignBufferedAmount(U){for(;this.buffer.length>0;){const j=this.buffer[0];if(this._totalSize-j.data.byteLength<=U)break;this.pop()}}get length(){return this.buffer.length}}class TTLMap{constructor(U){this._map=new Map,this._lastCleanup=0,this.ttl=U}set(U,j){const B=Date.now();B-this._lastCleanup>this.ttl/2&&this.cleanup();const z=B+this.ttl;return this._map.set(U,{value:j,expiresAt:z}),this}get(U){const j=this._map.get(U);if(j){if(j.expiresAt<Date.now()){this._map.delete(U);return}return j.value}}has(U){const j=this._map.get(U);return j?j.expiresAt<Date.now()?(this._map.delete(U),!1):!0:!1}delete(U){return this._map.delete(U)}clear(){this._map.clear()}cleanup(){const U=Date.now();for(const[j,B]of this._map.entries())B.expiresAt<U&&this._map.delete(j);this._lastCleanup=U}get size(){return this.cleanup(),this._map.size}forEach(U){this.cleanup();for(const[j,B]of this._map.entries())B.expiresAt>=Date.now()&&U(B.value,j,this.asValueMap())}map(U){this.cleanup();const j=[],B=this.asValueMap();for(const[z,H]of B.entries())j.push(U(H,z,B));return j}asValueMap(){const U=new Map;for(const[j,B]of this._map.entries())B.expiresAt>=Date.now()&&U.set(j,B.value);return U}}var lib={},parser={},grammar={exports:{}},hasRequiredGrammar;function requireGrammar(){if(hasRequiredGrammar)return grammar.exports;hasRequiredGrammar=1;var V=grammar.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(U){return U.encoding?"rtpmap:%d %s/%s/%s":U.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(U){return U.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(U){return U.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(U){return"extmap:%d"+(U.direction?"/%s":"%v")+(U["encrypt-uri"]?" %s":"%v")+" %s"+(U.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(U){return U.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(U){var j="candidate:%s %d %s %d %s %d typ %s";return j+=U.raddr!=null?" raddr %s rport %d":"%v%v",j+=U.tcptype!=null?" tcptype %s":"%v",U.generation!=null&&(j+=" generation %d"),j+=U["network-id"]!=null?" network-id %d":"%v",j+=U["network-cost"]!=null?" network-cost %d":"%v",j}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(U){var j="ssrc:%d";return U.attribute!=null&&(j+=" %s",U.value!=null&&(j+=":%s")),j}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(U){return U.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(U){return U.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(U){return"imageattr:%s %s %s"+(U.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(U){return"simulcast:%s %s"+(U.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(U){return"ts-refclk:%s"+(U.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(U){var j="mediaclk:";return j+=U.id!=null?"id=%s %s":"%v%s",j+=U.mediaClockValue!=null?"=%s":"",j+=U.rateNumerator!=null?" rate=%s":"",j+=U.rateDenominator!=null?"/%s":"",j}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(V).forEach(function(U){var j=V[U];j.forEach(function(B){B.reg||(B.reg=/(.*)/),B.format||(B.format="%s")})}),grammar.exports}var hasRequiredParser;function requireParser(){return hasRequiredParser||(hasRequiredParser=1,function(V){var U=function($){return String(Number($))===$?Number($):$},j=function($,Q,W,X){if(X&&!W)Q[X]=U($[1]);else for(var ee=0;ee<W.length;ee+=1)$[ee+1]!=null&&(Q[W[ee]]=U($[ee+1]))},B=function($,Q,W){var X=$.name&&$.names;$.push&&!Q[$.push]?Q[$.push]=[]:X&&!Q[$.name]&&(Q[$.name]={});var ee=$.push?{}:X?Q[$.name]:Q;j(W.match($.reg),ee,$.names,$.name),$.push&&Q[$.push].push(ee)},z=requireGrammar(),H=RegExp.prototype.test.bind(/^([a-z])=(.*)/);V.parse=function($){var Q={},W=[],X=Q;return $.split(/(\r\n|\r|\n)/).filter(H).forEach(function(ee){var ie=ee[0],ne=ee.slice(2);ie==="m"&&(W.push({rtp:[],fmtp:[]}),X=W[W.length-1]);for(var re=0;re<(z[ie]||[]).length;re+=1){var se=z[ie][re];if(se.reg.test(ne))return B(se,X,ne)}}),Q.media=W,Q};var G=function($,Q){var W=Q.split(/=(.+)/,2);return W.length===2?$[W[0]]=U(W[1]):W.length===1&&Q.length>1&&($[W[0]]=void 0),$};V.parseParams=function($){return $.split(/;\s?/).reduce(G,{})},V.parseFmtpConfig=V.parseParams,V.parsePayloads=function($){return $.toString().split(" ").map(Number)},V.parseRemoteCandidates=function($){for(var Q=[],W=$.split(" ").map(U),X=0;X<W.length;X+=3)Q.push({component:W[X],ip:W[X+1],port:W[X+2]});return Q},V.parseImageAttributes=function($){return $.split(" ").map(function(Q){return Q.substring(1,Q.length-1).split(",").reduce(G,{})})},V.parseSimulcastStreamList=function($){return $.split(";").map(function(Q){return Q.split(",").map(function(W){var X,ee=!1;return W[0]!=="~"?X=U(W):(X=U(W.substring(1,W.length)),ee=!0),{scid:X,paused:ee}})})}}(parser)),parser}var writer$1,hasRequiredWriter$1;function requireWriter$1(){if(hasRequiredWriter$1)return writer$1;hasRequiredWriter$1=1;var V=requireGrammar(),U=/%[sdv%]/g,j=function(G){var $=1,Q=arguments,W=Q.length;return G.replace(U,function(X){if($>=W)return X;var ee=Q[$];switch($+=1,X){case"%%":return"%";case"%s":return String(ee);case"%d":return Number(ee);case"%v":return""}})},B=function(G,$,Q){var W=$.format instanceof Function?$.format($.push?Q:Q[$.name]):$.format,X=[G+"="+W];if($.names)for(var ee=0;ee<$.names.length;ee+=1){var ie=$.names[ee];$.name?X.push(Q[$.name][ie]):X.push(Q[$.names[ee]])}else X.push(Q[$.name]);return j.apply(null,X)},z=["v","o","s","i","u","e","p","c","b","t","r","z","a"],H=["i","c","b","a"];return writer$1=function(G,$){$=$||{},G.version==null&&(G.version=0),G.name==null&&(G.name=" "),G.media.forEach(function(ee){ee.payloads==null&&(ee.payloads="")});var Q=$.outerOrder||z,W=$.innerOrder||H,X=[];return Q.forEach(function(ee){V[ee].forEach(function(ie){ie.name in G&&G[ie.name]!=null?X.push(B(ee,ie,G)):ie.push in G&&G[ie.push]!=null&&G[ie.push].forEach(function(ne){X.push(B(ee,ie,ne))})})}),G.media.forEach(function(ee){X.push(B("m",V.m[0],ee)),W.forEach(function(ie){V[ie].forEach(function(ne){ne.name in ee&&ee[ne.name]!=null?X.push(B(ie,ne,ee)):ne.push in ee&&ee[ne.push]!=null&&ee[ne.push].forEach(function(re){X.push(B(ie,ne,re))})})})}),X.join(`\r
`)+`\r
`},writer$1}var hasRequiredLib;function requireLib(){if(hasRequiredLib)return lib;hasRequiredLib=1;var V=requireParser(),U=requireWriter$1(),j=requireGrammar();return lib.grammar=j,lib.write=U,lib.parse=V.parse,lib.parseParams=V.parseParams,lib.parseFmtpConfig=V.parseFmtpConfig,lib.parsePayloads=V.parsePayloads,lib.parseRemoteCandidates=V.parseRemoteCandidates,lib.parseImageAttributes=V.parseImageAttributes,lib.parseSimulcastStreamList=V.parseSimulcastStreamList,lib}var libExports=requireLib();function r$1(V,U,j){var B,z,H;U===void 0&&(U=50),j===void 0&&(j={});var G=(B=j.isImmediate)!=null&&B,$=(z=j.callback)!=null&&z,Q=j.maxWait,W=Date.now(),X=[];function ee(){if(Q!==void 0){var ne=Date.now()-W;if(ne+U>=Q)return Q-ne}return U}var ie=function(){var ne=[].slice.call(arguments),re=this;return new Promise(function(se,de){var oe=G&&H===void 0;if(H!==void 0&&clearTimeout(H),H=setTimeout(function(){if(H=void 0,W=Date.now(),!G){var ue=V.apply(re,ne);$&&$(ue),X.forEach(function(fe){return(0,fe.resolve)(ue)}),X=[]}},ee()),oe){var le=V.apply(re,ne);return $&&$(le),se(le)}X.push({resolve:se,reject:de})})};return ie.cancel=function(ne){H!==void 0&&clearTimeout(H),X.forEach(function(re){return(0,re.reject)(ne)}),X=[]},ie}const startBitrateForSVC=.7,debounceInterval=20,PCEvents={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class PCTransport extends eventsExports.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(U){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var B;super(),this.log=livekitLogger,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=r$1(z=>__awaiter$1(this,void 0,void 0,function*(){this.emit(PCEvents.NegotiationStarted);try{yield this.createAndSendOffer()}catch(H){if(z)z(H);else throw H}}),debounceInterval),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=getLogger((B=j.loggerName)!==null&&B!==void 0?B:LoggerNames.PCTransport),this.loggerOptions=j,this.config=U,this._pc=this.createPC(),this.offerLock=new _$1}createPC(){const U=new RTCPeerConnection(this.config);return U.onicecandidate=j=>{var B;j.candidate&&((B=this.onIceCandidate)===null||B===void 0||B.call(this,j.candidate))},U.onicecandidateerror=j=>{var B;(B=this.onIceCandidateError)===null||B===void 0||B.call(this,j)},U.oniceconnectionstatechange=()=>{var j;(j=this.onIceConnectionStateChange)===null||j===void 0||j.call(this,U.iceConnectionState)},U.onsignalingstatechange=()=>{var j;(j=this.onSignalingStatechange)===null||j===void 0||j.call(this,U.signalingState)},U.onconnectionstatechange=()=>{var j;(j=this.onConnectionStateChange)===null||j===void 0||j.call(this,U.connectionState)},U.ondatachannel=j=>{var B;(B=this.onDataChannel)===null||B===void 0||B.call(this,j)},U.ontrack=j=>{var B;(B=this.onTrack)===null||B===void 0||B.call(this,j)},U}get logContext(){var U,j;return Object.assign({},(j=(U=this.loggerOptions).loggerContextCb)===null||j===void 0?void 0:j.call(U))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(U){return __awaiter$1(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(U);this.pendingCandidates.push(U)})}setRemoteDescription(U,j){return __awaiter$1(this,void 0,void 0,function*(){var B;if(U.type==="answer"&&this.latestOfferId>0&&j>0&&j!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:j,latestOfferId:this.latestOfferId})),!1;let z;if(U.type==="offer"){let{stereoMids:H,nackMids:G}=extractStereoAndNackAudioFromOffer(U);this.remoteStereoMids=H,this.remoteNackMids=G}else if(U.type==="answer"){const H=libExports.parse((B=U.sdp)!==null&&B!==void 0?B:"");H.media.forEach(G=>{G.type==="audio"&&this.trackBitrates.some($=>{if(!$.transceiver||G.mid!=$.transceiver.mid)return!1;let Q=0;if(G.rtp.some(X=>X.codec.toUpperCase()===$.codec.toUpperCase()?(Q=X.payload,!0):!1),Q===0)return!0;let W=!1;for(const X of G.fmtp)if(X.payload===Q){X.config=X.config.split(";").filter(ee=>!ee.includes("maxaveragebitrate")).join(";"),$.maxbr>0&&(X.config+=";maxaveragebitrate=".concat($.maxbr*1e3)),W=!0;break}return W||$.maxbr>0&&G.fmtp.push({payload:Q,config:"maxaveragebitrate=".concat($.maxbr*1e3)}),!0})}),z=libExports.write(H)}return yield this.setMungedSDP(U,z,!0),this.pendingCandidates.forEach(H=>{this.pc.addIceCandidate(H)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):U.type==="answer"&&(this.emit(PCEvents.NegotiationComplete),U.sdp&&libExports.parse(U.sdp).media.forEach(G=>{G.type==="video"&&this.emit(PCEvents.RTPVideoPayloadTypes,G.rtp)})),!0})}createAndSendOffer(U){return __awaiter$1(this,void 0,void 0,function*(){var j;const B=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(U?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const $=this._pc.remoteDescription;if(U?.iceRestart&&$)yield this._pc.setRemoteDescription($);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const z=this.latestOfferId+1;this.latestOfferId=z;const H=yield this.pc.createOffer(U);this.log.debug("original offer",Object.assign({sdp:H.sdp},this.logContext));const G=libExports.parse((j=H.sdp)!==null&&j!==void 0?j:"");if(G.media.forEach($=>{ensureIPAddrMatchVersion($),$.type==="audio"?ensureAudioNackAndStereo($,[],[]):$.type==="video"&&this.trackBitrates.some(Q=>{if(!$.msid||!Q.cid||!$.msid.includes(Q.cid))return!1;let W=0;if($.rtp.some(ee=>ee.codec.toUpperCase()===Q.codec.toUpperCase()?(W=ee.payload,!0):!1),W===0||(isSVCCodec(Q.codec)&&!isSafari()&&this.ensureVideoDDExtensionForSVC($,G),Q.codec!=="av1"))return!0;const X=Math.round(Q.maxbr*startBitrateForSVC);for(const ee of $.fmtp)if(ee.payload===W){ee.config.includes("x-google-start-bitrate")||(ee.config+=";x-google-start-bitrate=".concat(X));break}return!0})}),this.latestOfferId>z){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:z}));return}yield this.setMungedSDP(H,libExports.write(G)),this.onOffer(H,this.latestOfferId)}finally{B()}})}createAndSetAnswer(){return __awaiter$1(this,void 0,void 0,function*(){var U;const j=yield this.pc.createAnswer(),B=libExports.parse((U=j.sdp)!==null&&U!==void 0?U:"");return B.media.forEach(z=>{ensureIPAddrMatchVersion(z),z.type==="audio"&&ensureAudioNackAndStereo(z,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(j,libExports.write(B)),j})}createDataChannel(U,j){return this.pc.createDataChannel(U,j)}addTransceiver(U,j){return this.pc.addTransceiver(U,j)}addTrack(U){if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot add track");return this._pc.addTrack(U)}setTrackCodecBitrate(U){this.trackBitrates.push(U)}setConfiguration(U){var j;if(!this._pc)throw new UnexpectedConnectionState("PC closed, cannot configure");return(j=this._pc)===null||j===void 0?void 0:j.setConfiguration(U)}canRemoveTrack(){var U;return!!(!((U=this._pc)===null||U===void 0)&&U.removeTrack)}removeTrack(U){var j;return(j=this._pc)===null||j===void 0?void 0:j.removeTrack(U)}getConnectionState(){var U,j;return(j=(U=this._pc)===null||U===void 0?void 0:U.connectionState)!==null&&j!==void 0?j:"closed"}getICEConnectionState(){var U,j;return(j=(U=this._pc)===null||U===void 0?void 0:U.iceConnectionState)!==null&&j!==void 0?j:"closed"}getSignallingState(){var U,j;return(j=(U=this._pc)===null||U===void 0?void 0:U.signalingState)!==null&&j!==void 0?j:"closed"}getTransceivers(){var U,j;return(j=(U=this._pc)===null||U===void 0?void 0:U.getTransceivers())!==null&&j!==void 0?j:[]}getSenders(){var U,j;return(j=(U=this._pc)===null||U===void 0?void 0:U.getSenders())!==null&&j!==void 0?j:[]}getLocalDescription(){var U;return(U=this._pc)===null||U===void 0?void 0:U.localDescription}getRemoteDescription(){var U;return(U=this.pc)===null||U===void 0?void 0:U.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return __awaiter$1(this,void 0,void 0,function*(){var U;if(!this._pc)return;let j="";const B=new Map,z=new Map;if((yield this._pc.getStats()).forEach($=>{switch($.type){case"transport":j=$.selectedCandidatePairId;break;case"candidate-pair":j===""&&$.selected&&(j=$.id),B.set($.id,$);break;case"remote-candidate":z.set($.id,"".concat($.address,":").concat($.port));break}}),j==="")return;const G=(U=B.get(j))===null||U===void 0?void 0:U.remoteCandidateId;if(G!==void 0)return z.get(G)})}setMungedSDP(U,j,B){return __awaiter$1(this,void 0,void 0,function*(){if(j){const z=U.sdp;U.sdp=j;try{this.log.debug("setting munged ".concat(B?"remote":"local"," description"),this.logContext),B?yield this.pc.setRemoteDescription(U):yield this.pc.setLocalDescription(U);return}catch(H){this.log.warn("not able to set ".concat(U.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:H,sdp:j})),U.sdp=z}}try{B?yield this.pc.setRemoteDescription(U):yield this.pc.setLocalDescription(U)}catch(z){let H="unknown error";z instanceof Error?H=z.message:typeof z=="string"&&(H=z);const G={error:H,sdp:U.sdp};throw!B&&this.pc.remoteDescription&&(G.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(U.type),Object.assign(Object.assign({},this.logContext),{fields:G})),new NegotiationError(H)}})}ensureVideoDDExtensionForSVC(U,j){var B,z;if(!((B=U.ext)===null||B===void 0?void 0:B.some(G=>G.uri===ddExtensionURI))){if(this.ddExtID===0){let G=0;j.media.forEach($=>{var Q;$.type==="video"&&((Q=$.ext)===null||Q===void 0||Q.forEach(W=>{W.value>G&&(G=W.value)}))}),this.ddExtID=G+1}(z=U.ext)===null||z===void 0||z.push({value:this.ddExtID,uri:ddExtensionURI})}}}function ensureAudioNackAndStereo(V,U,j){let B=0;V.rtp.some(z=>z.codec==="opus"?(B=z.payload,!0):!1),B>0&&(V.rtcpFb||(V.rtcpFb=[]),j.includes(V.mid)&&!V.rtcpFb.some(z=>z.payload===B&&z.type==="nack")&&V.rtcpFb.push({payload:B,type:"nack"}),U.includes(V.mid)&&V.fmtp.some(z=>z.payload===B?(z.config.includes("stereo=1")||(z.config+=";stereo=1"),!0):!1))}function extractStereoAndNackAudioFromOffer(V){var U;const j=[],B=[],z=libExports.parse((U=V.sdp)!==null&&U!==void 0?U:"");let H=0;return z.media.forEach(G=>{var $;G.type==="audio"&&(G.rtp.some(Q=>Q.codec==="opus"?(H=Q.payload,!0):!1),!(($=G.rtcpFb)===null||$===void 0)&&$.some(Q=>Q.payload===H&&Q.type==="nack")&&B.push(G.mid),G.fmtp.some(Q=>Q.payload===H?(Q.config.includes("sprop-stereo=1")&&j.push(G.mid),!0):!1))}),{stereoMids:j,nackMids:B}}function ensureIPAddrMatchVersion(V){if(V.connection){const U=V.connection.ip.indexOf(":")>=0;(V.connection.version===4&&U||V.connection.version===6&&!U)&&(V.connection.ip="0.0.0.0",V.connection.version=4)}}const defaultVideoCodec="vp8",publishDefaults={audioPreset:AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ScreenSharePresets.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:defaultVideoCodec,backupCodec:!0,preConnectBuffer:!1},audioDefaults={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},videoDefaults={deviceId:{ideal:"default"},resolution:VideoPresets.h720.resolution},roomOptionDefaults={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new DefaultReconnectPolicy,disconnectOnPageLeave:!0,webAudioMix:!1},roomConnectOptionDefaults={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var PCTransportState;(function(V){V[V.NEW=0]="NEW",V[V.CONNECTING=1]="CONNECTING",V[V.CONNECTED=2]="CONNECTED",V[V.FAILED=3]="FAILED",V[V.CLOSING=4]="CLOSING",V[V.CLOSED=5]="CLOSED"})(PCTransportState||(PCTransportState={}));class PCTransportManager{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(U,j,B){var z;this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.log=livekitLogger,this.updateState=()=>{var H;const G=this.state,$=this.requiredTransports.map(Q=>Q.getConnectionState());$.every(Q=>Q==="connected")?this.state=PCTransportState.CONNECTED:$.some(Q=>Q==="failed")?this.state=PCTransportState.FAILED:$.some(Q=>Q==="connecting")?this.state=PCTransportState.CONNECTING:$.every(Q=>Q==="closed")?this.state=PCTransportState.CLOSED:$.some(Q=>Q==="closed")?this.state=PCTransportState.CLOSING:$.every(Q=>Q==="new")&&(this.state=PCTransportState.NEW),G!==this.state&&(this.log.debug("pc state change: from ".concat(PCTransportState[G]," to ").concat(PCTransportState[this.state]),this.logContext),(H=this.onStateChange)===null||H===void 0||H.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=getLogger((z=B.loggerName)!==null&&z!==void 0?z:LoggerNames.PCManager),this.loggerOptions=B,this.isPublisherConnectionRequired=!j,this.isSubscriberConnectionRequired=j,this.publisher=new PCTransport(U,B),this.subscriber=new PCTransport(U,B),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=H=>{var G;(G=this.onIceCandidate)===null||G===void 0||G.call(this,H,SignalTarget.PUBLISHER)},this.subscriber.onIceCandidate=H=>{var G;(G=this.onIceCandidate)===null||G===void 0||G.call(this,H,SignalTarget.SUBSCRIBER)},this.subscriber.onDataChannel=H=>{var G;(G=this.onDataChannel)===null||G===void 0||G.call(this,H)},this.subscriber.onTrack=H=>{var G;(G=this.onTrack)===null||G===void 0||G.call(this,H)},this.publisher.onOffer=(H,G)=>{var $;($=this.onPublisherOffer)===null||$===void 0||$.call(this,H,G)},this.state=PCTransportState.NEW,this.connectionLock=new _$1,this.remoteOfferLock=new _$1}get logContext(){var U,j;return Object.assign({},(j=(U=this.loggerOptions).loggerContextCb)===null||j===void 0?void 0:j.call(U))}requirePublisher(){let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=U,this.updateState()}requireSubscriber(){let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=U,this.updateState()}createAndSendPublisherOffer(U){return this.publisher.createAndSendOffer(U)}setPublisherAnswer(U,j){return this.publisher.setRemoteDescription(U,j)}removeTrack(U){return this.publisher.removeTrack(U)}close(){return __awaiter$1(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const U=this.publisher;for(const j of U.getSenders())try{U.canRemoveTrack()&&U.removeTrack(j)}catch(B){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:B}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return __awaiter$1(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(U,j){return __awaiter$1(this,void 0,void 0,function*(){j===SignalTarget.PUBLISHER?yield this.publisher.addIceCandidate(U):yield this.subscriber.addIceCandidate(U)})}createSubscriberAnswerFromOffer(U,j){return __awaiter$1(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:U.type,sdp:U.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const B=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(U,j))?yield this.subscriber.createAndSetAnswer():void 0}finally{B()}})}updateConfiguration(U,j){this.publisher.setConfiguration(U),this.subscriber.setConfiguration(U),j&&this.triggerIceRestart()}ensurePCTransportConnection(U,j){return __awaiter$1(this,void 0,void 0,function*(){var B;const z=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((B=this.requiredTransports)===null||B===void 0?void 0:B.map(H=>this.ensureTransportConnected(H,U,j)))}finally{z()}})}negotiate(U){return __awaiter$1(this,void 0,void 0,function*(){return new Promise((j,B)=>__awaiter$1(this,void 0,void 0,function*(){const z=setTimeout(()=>{B("negotiation timed out")},this.peerConnectionTimeout),H=()=>{clearTimeout(z),B("negotiation aborted")};U.signal.addEventListener("abort",H),this.publisher.once(PCEvents.NegotiationStarted,()=>{U.signal.aborted||this.publisher.once(PCEvents.NegotiationComplete,()=>{clearTimeout(z),j()})}),yield this.publisher.negotiate(G=>{clearTimeout(z),B(G)})}))})}addPublisherTransceiver(U,j){return this.publisher.addTransceiver(U,j)}addPublisherTrack(U){return this.publisher.addTrack(U)}createPublisherDataChannel(U,j){return this.publisher.createDataChannel(U,j)}getConnectedAddress(U){return U===SignalTarget.PUBLISHER?this.publisher.getConnectedAddress():U===SignalTarget.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const U=[];return this.isPublisherConnectionRequired&&U.push(this.publisher),this.isSubscriberConnectionRequired&&U.push(this.subscriber),U}ensureTransportConnected(U,j){return __awaiter$1(this,arguments,void 0,function(B,z){var H=this;let G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(B.getConnectionState()!=="connected")return new Promise((Q,W)=>__awaiter$1(H,void 0,void 0,function*(){const X=()=>{this.log.warn("abort transport connection",this.logContext),CriticalTimers.clearTimeout(ee),W(new ConnectionError("room connection has been cancelled",ConnectionErrorReason.Cancelled))};z?.signal.aborted&&X(),z?.signal.addEventListener("abort",X);const ee=CriticalTimers.setTimeout(()=>{z?.signal.removeEventListener("abort",X),W(new ConnectionError("could not establish pc connection",ConnectionErrorReason.InternalError))},G);for(;this.state!==PCTransportState.CONNECTED;)if(yield sleep$1(50),z?.signal.aborted){W(new ConnectionError("room connection has been cancelled",ConnectionErrorReason.Cancelled));return}CriticalTimers.clearTimeout(ee),z?.signal.removeEventListener("abort",X),Q()}))}()})}}class RpcError extends Error{constructor(U,j,B){super(j),this.code=U,this.message=truncateBytes(j,RpcError.MAX_MESSAGE_BYTES),this.data=B?truncateBytes(B,RpcError.MAX_DATA_BYTES):void 0}static fromProto(U){return new RpcError(U.code,U.message,U.data)}toProto(){return new RpcError$1({code:this.code,message:this.message,data:this.data})}static builtIn(U,j){return new RpcError(RpcError.ErrorCode[U],RpcError.ErrorMessage[U],j)}}RpcError.MAX_MESSAGE_BYTES=256,RpcError.MAX_DATA_BYTES=15360,RpcError.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},RpcError.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const MAX_PAYLOAD_BYTES=15360;function byteLength(V){return new TextEncoder().encode(V).length}function truncateBytes(V,U){if(byteLength(V)<=U)return V;let j=0,B=V.length;const z=new TextEncoder;for(;j<B;){const H=Math.floor((j+B+1)/2);z.encode(V.slice(0,H)).length<=U?j=H:B=H-1}return V.slice(0,j)}const monitorFrequency=2e3;function computeBitrate(V,U){if(!U)return 0;let j,B;return"bytesReceived"in V?(j=V.bytesReceived,B=U.bytesReceived):"bytesSent"in V&&(j=V.bytesSent,B=U.bytesSent),j===void 0||B===void 0||V.timestamp===void 0||U.timestamp===void 0?0:(j-B)*8*1e3/(V.timestamp-U.timestamp)}const isMediaRecorderAvailable=typeof MediaRecorder<"u";class FallbackRecorder{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const RecorderBase=isMediaRecorderAvailable?MediaRecorder:FallbackRecorder;class LocalTrackRecorder extends RecorderBase{constructor(U,j){if(!isMediaRecorderAvailable)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([U.mediaStreamTrack]),j);let B,z;const H=()=>z===void 0,G=()=>{this.removeEventListener("dataavailable",B),this.removeEventListener("stop",G),this.removeEventListener("error",$),z?.close(),z=void 0},$=Q=>{z?.error(Q),this.removeEventListener("dataavailable",B),this.removeEventListener("stop",G),this.removeEventListener("error",$),z=void 0};this.byteStream=new ReadableStream({start:Q=>{z=Q,B=W=>__awaiter$1(this,void 0,void 0,function*(){const X=yield W.data.arrayBuffer();H()||Q.enqueue(new Uint8Array(X))}),this.addEventListener("dataavailable",B)},cancel:()=>{G()}}),this.addEventListener("stop",G),this.addEventListener("error",$)}}function isRecordingSupported(){return isMediaRecorderAvailable}const DEFAULT_DIMENSIONS_TIMEOUT=1e3,PRE_CONNECT_BUFFER_TIMEOUT=1e4;class LocalTrack extends Track{get sender(){return this._sender}set sender(U){this._sender=U}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(U,j,B){let z=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,H=arguments.length>4?arguments[4]:void 0;super(U,j,H),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=r$1(()=>__awaiter$1(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>__awaiter$1(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(TrackEvent.Ended,this)},this.reacquireTrack=!1,this.providedByUser=z,this.muteLock=new _$1,this.pauseUpstreamLock=new _$1,this.processorLock=new _$1,this.restartLock=new _$1,this.setMediaStreamTrack(U,!0),this._constraints=U.getConstraints(),B&&(this._constraints=B)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Track.Kind.Video)return;const{width:U,height:j}=this._mediaStreamTrack.getSettings();if(U&&j)return{width:U,height:j}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var U,j;return(j=(U=this.processor)===null||U===void 0?void 0:U.processedTrack)!==null&&j!==void 0?j:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(U,j){return __awaiter$1(this,void 0,void 0,function*(){var B;if(U===this._mediaStreamTrack&&!j)return;this._mediaStreamTrack&&(this.attachedElements.forEach(H=>{detachTrack(this._mediaStreamTrack,H)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([U]),U&&(U.addEventListener("ended",this.handleEnded),U.addEventListener("mute",this.handleTrackMuteEvent),U.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=U.getConstraints());let z;if(this.processor&&U){const H=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(attachToElement(U,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:U,kind:this.kind,element:this.processorElement}),z=this.processor.processedTrack}finally{H()}}this.sender&&((B=this.sender.transport)===null||B===void 0?void 0:B.state)!=="closed"&&(yield this.sender.replaceTrack(z??U)),!this.providedByUser&&this._mediaStreamTrack!==U&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=U,U&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(H=>{attachToElement(z??U,H)}))})}waitForDimensions(){return __awaiter$1(this,arguments,void 0,function(){var U=this;let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DEFAULT_DIMENSIONS_TIMEOUT;return function*(){var B;if(U.kind===Track.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((B=getBrowser())===null||B===void 0?void 0:B.os)==="iOS"&&(yield sleep$1(10));const z=Date.now();for(;Date.now()-z<j;){const H=U.dimensions;if(H)return H;yield sleep$1(50)}throw new TrackInvalidError("unable to get track dimensions after timeout")}()})}setDeviceId(U){return __awaiter$1(this,void 0,void 0,function*(){return this._constraints.deviceId===U&&this._mediaStreamTrack.getSettings().deviceId===unwrapConstraint(U)||(this._constraints.deviceId=U,this.isMuted)?!0:(yield this.restartTrack(),unwrapConstraint(U)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return __awaiter$1(this,arguments,void 0,function(){var U=this;let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(U.source===Track.Source.ScreenShare)return;const{deviceId:B,groupId:z}=U._mediaStreamTrack.getSettings(),H=U.kind===Track.Kind.Audio?"audioinput":"videoinput";return j?DeviceManager.getInstance().normalizeDeviceId(H,B,z):B}()})}mute(){return __awaiter$1(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return __awaiter$1(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(U,j){return __awaiter$1(this,void 0,void 0,function*(){if(!this.sender)throw new TrackInvalidError("unable to replace an unpublished track");let B,z;return typeof j=="boolean"?B=j:j!==void 0&&(B=j.userProvidedTrack,z=j.stopProcessor),this.providedByUser=B??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(U),z&&this.processor&&(yield this.stopProcessor()),this})}restart(U){return __awaiter$1(this,void 0,void 0,function*(){this.manuallyStopped=!1;const j=yield this.restartLock.lock();try{U||(U=this._constraints);const{deviceId:B,facingMode:z}=U,H=__rest(U,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:U}));const G={audio:!1,video:!1};this.kind===Track.Kind.Video?G.video=B||z?{deviceId:B,facingMode:z}:!0:G.audio=B?{deviceId:B}:!0,this.attachedElements.forEach(W=>{detachTrack(this.mediaStreamTrack,W)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const Q=(yield navigator.mediaDevices.getUserMedia(G)).getTracks()[0];return yield Q.applyConstraints(H),Q.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(Q),this._constraints=U,this.emit(TrackEvent.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{j()}})}setTrackMuted(U){this.log.debug("setting ".concat(this.kind," track ").concat(U?"muted":"unmuted"),this.logContext),!(this.isMuted===U&&this._mediaStreamTrack.enabled!==U)&&(this.isMuted=U,this._mediaStreamTrack.enabled=!U,this.emit(U?TrackEvent.Muted:TrackEvent.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const U=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter$1(this,void 0,void 0,function*(){yield U.handleAppVisibilityChanged.call(this),isMobile()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var U;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(U=this.processor)===null||U===void 0||U.destroy(),this.processor=void 0}pauseUpstream(){return __awaiter$1(this,void 0,void 0,function*(){var U;const j=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(TrackEvent.UpstreamPaused,this);const B=getBrowser();if(B?.name==="Safari"&&compareVersions(B.version,"12.0")<0)throw new DeviceUnsupportedError("pauseUpstream is not supported on Safari < 12.");((U=this.sender.transport)===null||U===void 0?void 0:U.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{j()}})}resumeUpstream(){return __awaiter$1(this,void 0,void 0,function*(){var U;const j=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(TrackEvent.UpstreamResumed,this),((U=this.sender.transport)===null||U===void 0?void 0:U.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{j()}})}getRTCStatsReport(){return __awaiter$1(this,void 0,void 0,function*(){var U;return!((U=this.sender)===null||U===void 0)&&U.getStats?yield this.sender.getStats():void 0})}setProcessor(U){return __awaiter$1(this,arguments,void 0,function(j){var B=this;let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var H;const G=yield B.processorLock.lock();try{B.log.debug("setting up processor",B.logContext);const $=document.createElement(B.kind),Q={kind:B.kind,track:B._mediaStreamTrack,element:$,audioContext:B.audioContext};if(yield j.init(Q),B.log.debug("processor initialized",B.logContext),B.processor&&(yield B.stopProcessor()),B.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(attachToElement(B._mediaStreamTrack,$),$.muted=!0,$.play().catch(W=>{W instanceof DOMException&&W.name==="AbortError"?(B.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},B.logContext),{error:W})),setTimeout(()=>{$.play().catch(X=>{B.log.error("failed to play processor element",Object.assign(Object.assign({},B.logContext),{err:X}))})},100)):B.log.error("failed to play processor element",Object.assign(Object.assign({},B.logContext),{error:W}))}),B.processor=j,B.processorElement=$,B.processor.processedTrack){for(const W of B.attachedElements)W!==B.processorElement&&z&&(detachTrack(B._mediaStreamTrack,W),attachToElement(B.processor.processedTrack,W));yield(H=B.sender)===null||H===void 0?void 0:H.replaceTrack(B.processor.processedTrack)}B.emit(TrackEvent.TrackProcessorUpdate,B.processor)}finally{G()}}()})}getProcessor(){return this.processor}stopProcessor(){return __awaiter$1(this,arguments,void 0,function(){var U=this;let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var B,z;U.processor&&(U.log.debug("stopping processor",U.logContext),(B=U.processor.processedTrack)===null||B===void 0||B.stop(),yield U.processor.destroy(),U.processor=void 0,j||((z=U.processorElement)===null||z===void 0||z.remove(),U.processorElement=void 0),yield U._mediaStreamTrack.applyConstraints(U._constraints),yield U.setMediaStreamTrack(U._mediaStreamTrack,!0),U.emit(TrackEvent.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!isRecordingSupported()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(!this.localTrackRecorder)this.localTrackRecorder=new LocalTrackRecorder(this,{mimeType:"audio/webm;codecs=opus"});else{this.log.warn("preconnect buffer already started");return}this.localTrackRecorder.start(U),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},PRE_CONNECT_BUFFER_TIMEOUT)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var U;return(U=this.localTrackRecorder)===null||U===void 0?void 0:U.byteStream}}class LocalAudioTrack extends LocalTrack{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(U,j){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,z=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0;super(U,Track.Kind.Audio,j,B,H),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>__awaiter$1(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let G;try{G=yield this.getSenderStats()}catch($){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:$}));return}G&&this.prevStats&&(this._currentBitrate=computeBitrate(G,this.prevStats)),this.prevStats=G}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(TrackEvent.AudioTrackFeatureUpdate,this,AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(TrackEvent.AudioTrackFeatureUpdate,this,AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=z,this.checkForSilence()}mute(){const U=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter$1(this,void 0,void 0,function*(){const j=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Track.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield U.mute.call(this),this)}finally{j()}})}unmute(){const U=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter$1(this,void 0,void 0,function*(){const j=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const B=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==unwrapConstraint(this._constraints.deviceId);return this.source===Track.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||B)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield U.unmute.call(this),this}finally{j()}})}restartTrack(U){return __awaiter$1(this,void 0,void 0,function*(){let j;if(U){const B=constraintsForOptions({audio:U});typeof B.audio!="boolean"&&(j=B.audio)}yield this.restart(j)})}restart(U){const j=Object.create(null,{restart:{get:()=>super.restart}});return __awaiter$1(this,void 0,void 0,function*(){const B=yield j.restart.call(this,U);return this.checkForSilence(),B})}startMonitor(){isWeb()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency)))}setProcessor(U){return __awaiter$1(this,void 0,void 0,function*(){var j;const B=yield this.processorLock.lock();try{if(!isReactNative()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const z={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(U.name),this.logContext),yield U.init(z),this.processor=U,this.processor.processedTrack&&(yield(j=this.sender)===null||j===void 0?void 0:j.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(TrackEvent.TrackProcessorUpdate,this.processor)}finally{B()}})}setAudioContext(U){this.audioContext=U}getSenderStats(){return __awaiter$1(this,void 0,void 0,function*(){var U;if(!(!((U=this.sender)===null||U===void 0)&&U.getStats))return;const j=yield this.sender.getStats();let B;return j.forEach(z=>{z.type==="outbound-rtp"&&(B={type:"audio",streamId:z.id,packetsSent:z.packetsSent,packetsLost:z.packetsLost,bytesSent:z.bytesSent,timestamp:z.timestamp,roundTripTime:z.roundTripTime,jitter:z.jitter})}),B})}checkForSilence(){return __awaiter$1(this,void 0,void 0,function*(){const U=yield detectSilence(this);return U&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(TrackEvent.AudioSilenceDetected)),U})}}function mediaTrackToLocalTrack(V,U,j){switch(V.kind){case"audio":return new LocalAudioTrack(V,U,!1,void 0,j);case"video":return new LocalVideoTrack(V,U,!1,j);default:throw new TrackInvalidError("unsupported track type: ".concat(V.kind))}}const presets169=Object.values(VideoPresets),presets43=Object.values(VideoPresets43),presetsScreenShare=Object.values(ScreenSharePresets),defaultSimulcastPresets169=[VideoPresets.h180,VideoPresets.h360],defaultSimulcastPresets43=[VideoPresets43.h180,VideoPresets43.h360],computeDefaultScreenShareSimulcastPresets=V=>[{scaleResolutionDownBy:2,fps:V.encoding.maxFramerate}].map(j=>{var B,z;return new VideoPreset(Math.floor(V.width/j.scaleResolutionDownBy),Math.floor(V.height/j.scaleResolutionDownBy),Math.max(15e4,Math.floor(V.encoding.maxBitrate/(Math.pow(j.scaleResolutionDownBy,2)*(((B=V.encoding.maxFramerate)!==null&&B!==void 0?B:30)/((z=j.fps)!==null&&z!==void 0?z:30))))),j.fps,V.encoding.priority)}),videoRids=["q","h","f"];function computeVideoEncodings(V,U,j,B){var z,H;let G=B?.videoEncoding;V&&(G=B?.screenShareEncoding);const $=B?.simulcast,Q=B?.scalabilityMode,W=B?.videoCodec;if(!G&&!$&&!Q||!U||!j)return[{}];G||(G=determineAppropriateEncoding(V,U,j,W),livekitLogger.debug("using video encoding",G));const X=G.maxFramerate,ee=new VideoPreset(U,j,G.maxBitrate,G.maxFramerate,G.priority);if(Q&&isSVCCodec(W)){const re=new ScalabilityMode(Q),se=[];if(re.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(Q));const de=getBrowser();if(isSafariBased()||isReactNative()||de?.name==="Chrome"&&compareVersions(de?.version,"113")<0){const oe=re.suffix=="h"?2:3,le=isSafariSvcApi(de);for(let ue=0;ue<re.spatial;ue+=1)se.push({rid:videoRids[2-ue],maxBitrate:G.maxBitrate/Math.pow(oe,ue),maxFramerate:ee.encoding.maxFramerate,scaleResolutionDownBy:le?Math.pow(2,ue):void 0});se[0].scalabilityMode=Q}else se.push({maxBitrate:G.maxBitrate,maxFramerate:ee.encoding.maxFramerate,scalabilityMode:Q});return ee.encoding.priority&&(se[0].priority=ee.encoding.priority,se[0].networkPriority=ee.encoding.priority),livekitLogger.debug("using svc encoding",{encodings:se}),se}if(!$)return[G];let ie=[];V?ie=(z=sortPresets(B?.screenShareSimulcastLayers))!==null&&z!==void 0?z:defaultSimulcastLayers(V,ee):ie=(H=sortPresets(B?.videoSimulcastLayers))!==null&&H!==void 0?H:defaultSimulcastLayers(V,ee);let ne;if(ie.length>0){const re=ie[0];ie.length>1&&([,ne]=ie);const se=Math.max(U,j);if(se>=960&&ne)return encodingsFromPresets(U,j,[re,ne,ee],X);if(se>=480)return encodingsFromPresets(U,j,[re,ee],X)}return encodingsFromPresets(U,j,[ee])}function computeTrackBackupEncodings(V,U,j){var B,z,H,G;if(!j.backupCodec||j.backupCodec===!0||j.backupCodec.codec===j.videoCodec)return;U!==j.backupCodec.codec&&livekitLogger.warn("requested a different codec than specified as backup",{serverRequested:U,backup:j.backupCodec.codec}),j.videoCodec=U,j.videoEncoding=j.backupCodec.encoding;const $=V.mediaStreamTrack.getSettings(),Q=(B=$.width)!==null&&B!==void 0?B:(z=V.dimensions)===null||z===void 0?void 0:z.width,W=(H=$.height)!==null&&H!==void 0?H:(G=V.dimensions)===null||G===void 0?void 0:G.height;return V.source===Track.Source.ScreenShare&&j.simulcast&&(j.simulcast=!1),computeVideoEncodings(V.source===Track.Source.ScreenShare,Q,W,j)}function determineAppropriateEncoding(V,U,j,B){const z=presetsForResolution(V,U,j);let{encoding:H}=z[0];const G=Math.max(U,j);for(let $=0;$<z.length;$+=1){const Q=z[$];if(H=Q.encoding,Q.width>=G)break}if(B)switch(B){case"av1":case"h265":H=Object.assign({},H),H.maxBitrate=H.maxBitrate*.7;break;case"vp9":H=Object.assign({},H),H.maxBitrate=H.maxBitrate*.85;break}return H}function presetsForResolution(V,U,j){if(V)return presetsScreenShare;const B=U>j?U/j:j/U;return Math.abs(B-16/9)<Math.abs(B-4/3)?presets169:presets43}function defaultSimulcastLayers(V,U){if(V)return computeDefaultScreenShareSimulcastPresets(U);const{width:j,height:B}=U,z=j>B?j/B:B/j;return Math.abs(z-16/9)<Math.abs(z-4/3)?defaultSimulcastPresets169:defaultSimulcastPresets43}function encodingsFromPresets(V,U,j,B){const z=[];if(j.forEach((H,G)=>{if(G>=videoRids.length)return;const $=Math.min(V,U),W={rid:videoRids[G],scaleResolutionDownBy:Math.max(1,$/Math.min(H.width,H.height)),maxBitrate:H.encoding.maxBitrate},X=B&&H.encoding.maxFramerate?Math.min(B,H.encoding.maxFramerate):H.encoding.maxFramerate;X&&(W.maxFramerate=X);const ee=isFireFox()||G===0;H.encoding.priority&&ee&&(W.priority=H.encoding.priority,W.networkPriority=H.encoding.priority),z.push(W)}),isReactNative()&&getReactNativeOs()==="ios"){let H;z.forEach($=>{H?$.maxFramerate&&$.maxFramerate>H&&(H=$.maxFramerate):H=$.maxFramerate});let G=!0;z.forEach($=>{var Q;$.maxFramerate!=H&&(G&&(G=!1,livekitLogger.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),livekitLogger.info('Setting framerate of encoding "'.concat((Q=$.rid)!==null&&Q!==void 0?Q:"",'" to ').concat(H)),$.maxFramerate=H)})}return z}function sortPresets(V){if(V)return V.sort((U,j)=>{const{encoding:B}=U,{encoding:z}=j;return B.maxBitrate>z.maxBitrate?1:B.maxBitrate<z.maxBitrate?-1:B.maxBitrate===z.maxBitrate&&B.maxFramerate&&z.maxFramerate?B.maxFramerate>z.maxFramerate?1:-1:0})}class ScalabilityMode{constructor(U){const j=U.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!j)throw new Error("invalid scalability mode");if(this.spatial=parseInt(j[1]),this.temporal=parseInt(j[2]),j.length>3)switch(j[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=j[3]}}toString(){var U;return"L".concat(this.spatial,"T").concat(this.temporal).concat((U=this.suffix)!==null&&U!==void 0?U:"")}}function getDefaultDegradationPreference(V){return V.source===Track.Source.ScreenShare||V.constraints.height&&unwrapConstraint(V.constraints.height)>=1080?"maintain-resolution":"balanced"}const refreshSubscribedCodecAfterNewCodec=5e3;class LocalVideoTrack extends LocalTrack{get sender(){return this._sender}set sender(U){this._sender=U,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(U,j){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,z=arguments.length>3?arguments[3]:void 0;super(U,Track.Kind.Video,j,B,z),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>__awaiter$1(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let H;try{H=yield this.getSenderStats()}catch(Q){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:Q}));return}const G=new Map(H.map(Q=>[Q.rid,Q])),$=H.some(Q=>Q.qualityLimitationReason==="cpu");if($!==this.isCpuConstrained&&(this.isCpuConstrained=$,this.isCpuConstrained&&this.emit(TrackEvent.CpuConstrained)),this.prevStats){let Q=0;G.forEach((W,X)=>{var ee;const ie=(ee=this.prevStats)===null||ee===void 0?void 0:ee.get(X);Q+=computeBitrate(W,ie)}),this._currentBitrate=Q}this.prevStats=G}),this.senderLock=new _$1}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(U){var j;if(this.signalClient=U,!isWeb())return;const B=(j=this.sender)===null||j===void 0?void 0:j.getParameters();B&&(this.encodings=B.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(U=>{U.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const U=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return __awaiter$1(this,void 0,void 0,function*(){var j,B,z,H,G;yield U.pauseUpstream.call(this);try{for(var $=!0,Q=__asyncValues(this.simulcastCodecs.values()),W;W=yield Q.next(),j=W.done,!j;$=!0)H=W.value,$=!1,yield(G=H.sender)===null||G===void 0?void 0:G.replaceTrack(null)}catch(X){B={error:X}}finally{try{!$&&!j&&(z=Q.return)&&(yield z.call(Q))}finally{if(B)throw B.error}}})}resumeUpstream(){const U=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return __awaiter$1(this,void 0,void 0,function*(){var j,B,z,H,G;yield U.resumeUpstream.call(this);try{for(var $=!0,Q=__asyncValues(this.simulcastCodecs.values()),W;W=yield Q.next(),j=W.done,!j;$=!0){H=W.value,$=!1;const X=H;yield(G=X.sender)===null||G===void 0?void 0:G.replaceTrack(X.mediaStreamTrack)}}catch(X){B={error:X}}finally{try{!$&&!j&&(z=Q.return)&&(yield z.call(Q))}finally{if(B)throw B.error}}})}mute(){const U=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter$1(this,void 0,void 0,function*(){const j=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield U.mute.call(this),this)}finally{j()}})}unmute(){const U=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter$1(this,void 0,void 0,function*(){const j=yield this.muteLock.lock();try{return this.isMuted?(this.source===Track.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield U.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{j()}})}setTrackMuted(U){super.setTrackMuted(U);for(const j of this.simulcastCodecs.values())j.mediaStreamTrack.enabled=!U}getSenderStats(){return __awaiter$1(this,void 0,void 0,function*(){var U;if(!(!((U=this.sender)===null||U===void 0)&&U.getStats))return[];const j=[],B=yield this.sender.getStats();return B.forEach(z=>{var H;if(z.type==="outbound-rtp"){const G={type:"video",streamId:z.id,frameHeight:z.frameHeight,frameWidth:z.frameWidth,framesPerSecond:z.framesPerSecond,framesSent:z.framesSent,firCount:z.firCount,pliCount:z.pliCount,nackCount:z.nackCount,packetsSent:z.packetsSent,bytesSent:z.bytesSent,qualityLimitationReason:z.qualityLimitationReason,qualityLimitationDurations:z.qualityLimitationDurations,qualityLimitationResolutionChanges:z.qualityLimitationResolutionChanges,rid:(H=z.rid)!==null&&H!==void 0?H:z.id,retransmittedPacketsSent:z.retransmittedPacketsSent,targetBitrate:z.targetBitrate,timestamp:z.timestamp},$=B.get(z.remoteId);$&&(G.jitter=$.jitter,G.packetsLost=$.packetsLost,G.roundTripTime=$.roundTripTime),j.push(G)}}),j.sort((z,H)=>{var G,$;return((G=H.frameWidth)!==null&&G!==void 0?G:0)-(($=z.frameWidth)!==null&&$!==void 0?$:0)}),j})}setPublishingQuality(U){const j=[];for(let B=VideoQuality.LOW;B<=VideoQuality.HIGH;B+=1)j.push(new SubscribedQuality({quality:B,enabled:B<=U}));this.log.debug("setting publishing quality. max quality ".concat(U),this.logContext),this.setPublishingLayers(isSVCCodec(this.codec),j)}restartTrack(U){return __awaiter$1(this,void 0,void 0,function*(){var j,B,z,H,G;let $;if(U){const ee=constraintsForOptions({video:U});typeof ee.video!="boolean"&&($=ee.video)}yield this.restart($),this.isCpuConstrained=!1;try{for(var Q=!0,W=__asyncValues(this.simulcastCodecs.values()),X;X=yield W.next(),j=X.done,!j;Q=!0){H=X.value,Q=!1;const ee=H;ee.sender&&((G=ee.sender.transport)===null||G===void 0?void 0:G.state)!=="closed"&&(ee.mediaStreamTrack=this.mediaStreamTrack.clone(),yield ee.sender.replaceTrack(ee.mediaStreamTrack))}}catch(ee){B={error:ee}}finally{try{!Q&&!j&&(z=W.return)&&(yield z.call(W))}finally{if(B)throw B.error}}})}setProcessor(U){const j=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return __awaiter$1(this,arguments,void 0,function(B){var z=this;let H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var G,$,Q,W,X,ee;if(yield j.setProcessor.call(z,B,H),!((X=z.processor)===null||X===void 0)&&X.processedTrack)try{for(var ie=!0,ne=__asyncValues(z.simulcastCodecs.values()),re;re=yield ne.next(),G=re.done,!G;ie=!0)W=re.value,ie=!1,yield(ee=W.sender)===null||ee===void 0?void 0:ee.replaceTrack(z.processor.processedTrack)}catch(se){$={error:se}}finally{try{!ie&&!G&&(Q=ne.return)&&(yield Q.call(ne))}finally{if($)throw $.error}}}()})}setDegradationPreference(U){return __awaiter$1(this,void 0,void 0,function*(){if(this.degradationPreference=U,this.sender)try{this.log.debug("setting degradationPreference to ".concat(U),this.logContext);const j=this.sender.getParameters();j.degradationPreference=U,this.sender.setParameters(j)}catch(j){this.log.warn("failed to set degradationPreference",Object.assign({error:j},this.logContext))}})}addSimulcastTrack(U,j){if(this.simulcastCodecs.has(U)){this.log.error("".concat(U," already added, skipping adding simulcast codec"),this.logContext);return}const B={codec:U,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:j};return this.simulcastCodecs.set(U,B),B}setSimulcastTrackSender(U,j){const B=this.simulcastCodecs.get(U);B&&(B.sender=j,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},refreshSubscribedCodecAfterNewCodec))}setPublishingCodecs(U){return __awaiter$1(this,void 0,void 0,function*(){var j,B,z,H,G,$,Q;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:U,currentCodec:this.codec})),!this.codec&&U.length>0)return yield this.setPublishingLayers(isSVCCodec(U[0].codec),U[0].qualities),[];this.subscribedCodecs=U;const W=[];try{for(j=!0,B=__asyncValues(U);z=yield B.next(),H=z.done,!H;j=!0){Q=z.value,j=!1;const X=Q;if(!this.codec||this.codec===X.codec)yield this.setPublishingLayers(isSVCCodec(X.codec),X.qualities);else{const ee=this.simulcastCodecs.get(X.codec);if(this.log.debug("try setPublishingCodec for ".concat(X.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:ee})),!ee||!ee.sender){for(const ie of X.qualities)if(ie.enabled){W.push(X.codec);break}}else ee.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(X.codec),this.logContext),yield setPublishingLayersForSender(ee.sender,ee.encodings,X.qualities,this.senderLock,isSVCCodec(X.codec),this.log,this.logContext))}}}catch(X){G={error:X}}finally{try{!j&&!H&&($=B.return)&&(yield $.call(B))}finally{if(G)throw G.error}}return W})}setPublishingLayers(U,j){return __awaiter$1(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:j}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:j})),!(!this.sender||!this.encodings)&&(yield setPublishingLayersForSender(this.sender,this.encodings,j,this.senderLock,U,this.log,this.logContext))})}prioritizePerformance(){return __awaiter$1(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const U=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const j=this.sender.getParameters();j.encodings=j.encodings.map((B,z)=>{var H;return Object.assign(Object.assign({},B),{active:z===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((H=this.mediaStreamTrack.getSettings().height)!==null&&H!==void 0?H:360)/360)),scalabilityMode:z===0&&isSVCCodec(this.codec)?"L1T3":void 0,maxFramerate:z===0?15:0,maxBitrate:z===0?B.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:j.encodings})),this.encodings=j.encodings,yield this.sender.setParameters(j)}catch(j){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:j})),this.optimizeForPerformance=!1}finally{U()}})}handleAppVisibilityChanged(){const U=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter$1(this,void 0,void 0,function*(){yield U.handleAppVisibilityChanged.call(this),isMobile()&&this.isInBackground&&this.source===Track.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function setPublishingLayersForSender(V,U,j,B,z,H,G){return __awaiter$1(this,void 0,void 0,function*(){const $=yield B.lock();H.debug("setPublishingLayersForSender",Object.assign(Object.assign({},G),{sender:V,qualities:j,senderEncodings:U}));try{const Q=V.getParameters(),{encodings:W}=Q;if(!W)return;if(W.length!==U.length){H.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},G),{encodings:W,senderEncodings:U}));return}let X=!1;!1&&W[0].scalabilityMode||(z&&j.some(ne=>ne.enabled)&&j.forEach(ne=>ne.enabled=!0),W.forEach((ie,ne)=>{var re;let se=(re=ie.rid)!==null&&re!==void 0?re:"";se===""&&(se="q");const de=videoQualityForRid(se),oe=j.find(le=>le.quality===de);oe&&ie.active!==oe.enabled&&(X=!0,ie.active=oe.enabled,H.debug("setting layer ".concat(oe.quality," to ").concat(ie.active?"enabled":"disabled"),G),isFireFox()&&(oe.enabled?(ie.scaleResolutionDownBy=U[ne].scaleResolutionDownBy,ie.maxBitrate=U[ne].maxBitrate,ie.maxFrameRate=U[ne].maxFrameRate):(ie.scaleResolutionDownBy=4,ie.maxBitrate=10,ie.maxFrameRate=2)))})),X&&(Q.encodings=W,H.debug("setting encodings",Object.assign(Object.assign({},G),{encodings:Q.encodings})),yield V.setParameters(Q))}finally{$()}})}function videoQualityForRid(V){switch(V){case"f":return VideoQuality.HIGH;case"h":return VideoQuality.MEDIUM;case"q":return VideoQuality.LOW;default:return VideoQuality.HIGH}}function videoLayersFromEncodings(V,U,j,B){if(!j)return[new VideoLayer({quality:VideoQuality.HIGH,width:V,height:U,bitrate:0,ssrc:0})];if(B){const z=j[0].scalabilityMode,H=new ScalabilityMode(z),G=[],$=H.suffix=="h"?1.5:2,Q=H.suffix=="h"?2:3;for(let W=0;W<H.spatial;W+=1)G.push(new VideoLayer({quality:Math.min(VideoQuality.HIGH,H.spatial-1)-W,width:Math.ceil(V/Math.pow($,W)),height:Math.ceil(U/Math.pow($,W)),bitrate:j[0].maxBitrate?Math.ceil(j[0].maxBitrate/Math.pow(Q,W)):0,ssrc:0}));return G}return j.map(z=>{var H,G,$;const Q=(H=z.scaleResolutionDownBy)!==null&&H!==void 0?H:1;let W=videoQualityForRid((G=z.rid)!==null&&G!==void 0?G:"");return new VideoLayer({quality:W,width:Math.ceil(V/Q),height:Math.ceil(U/Q),bitrate:($=z.maxBitrate)!==null&&$!==void 0?$:0,ssrc:0})})}const lossyDataChannel="_lossy",reliableDataChannel="_reliable",minReconnectWait=2*1e3,leaveReconnect="leave-reconnect",reliabeReceiveStateTTL=3e4;var PCState;(function(V){V[V.New=0]="New",V[V.Connected=1]="Connected",V[V.Disconnected=2]="Disconnected",V[V.Reconnecting=3]="Reconnecting",V[V.Closed=4]="Closed"})(PCState||(PCState={}));class RTCEngine extends eventsExports.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(U){var j;super(),this.options=U,this.rtcConfig={},this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=PCState.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=livekitLogger,this.reliableDataSequence=1,this.reliableMessageBuffer=new DataPacketBuffer,this.reliableReceivedState=new TTLMap(reliabeReceiveStateTTL),this.handleDataChannel=B=>__awaiter$1(this,[B],void 0,function(z){var H=this;let{channel:G}=z;return function*(){if(G){if(G.label===reliableDataChannel)H.reliableDCSub=G;else if(G.label===lossyDataChannel)H.lossyDCSub=G;else return;H.log.debug("on data channel ".concat(G.id,", ").concat(G.label),H.logContext),G.onmessage=H.handleDataMessage}}()}),this.handleDataMessage=B=>__awaiter$1(this,void 0,void 0,function*(){var z,H;const G=yield this.dataProcessLock.lock();try{let $;if(B.data instanceof ArrayBuffer)$=B.data;else if(B.data instanceof Blob)$=yield B.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:B.data}));return}const Q=DataPacket.fromBinary(new Uint8Array($));if(Q.sequence>0&&Q.participantSid!==""){const W=this.reliableReceivedState.get(Q.participantSid);if(W&&Q.sequence<=W)return;this.reliableReceivedState.set(Q.participantSid,Q.sequence)}((z=Q.value)===null||z===void 0?void 0:z.case)==="speaker"?this.emit(EngineEvent.ActiveSpeakersUpdate,Q.value.value.speakers):(((H=Q.value)===null||H===void 0?void 0:H.case)==="user"&&applyUserDataCompat(Q,Q.value.value),this.emit(EngineEvent.DataPacketReceived,Q))}finally{G()}}),this.handleDataError=B=>{const H=B.currentTarget.maxRetransmits===0?"lossy":"reliable";if(B instanceof ErrorEvent&&B.error){const{error:G}=B.error;this.log.error("DataChannel error on ".concat(H,": ").concat(B.message),Object.assign(Object.assign({},this.logContext),{error:G}))}else this.log.error("Unknown DataChannel error on ".concat(H),Object.assign(Object.assign({},this.logContext),{event:B}))},this.handleBufferedAmountLow=B=>{const H=B.currentTarget.maxRetransmits===0?DataPacket_Kind.LOSSY:DataPacket_Kind.RELIABLE;this.updateAndEmitDCBufferStatus(H)},this.handleDisconnect=(B,z)=>{if(this._isClosed)return;this.log.warn("".concat(B," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const H=Q=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Q,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),this.close()},G=Date.now()-this.reconnectStart;let $=this.getNextRetryDelay({elapsedMs:G,retryCount:this.reconnectAttempts});if($===null){H(G);return}B===leaveReconnect&&($=0),this.log.debug("reconnecting in ".concat($,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=CriticalTimers.setTimeout(()=>this.attemptReconnect(z).finally(()=>this.reconnectTimeout=void 0),$)},this.waitForRestarted=()=>new Promise((B,z)=>{this.pcState===PCState.Connected&&B();const H=()=>{this.off(EngineEvent.Disconnected,G),B()},G=()=>{this.off(EngineEvent.Restarted,H),z()};this.once(EngineEvent.Restarted,H),this.once(EngineEvent.Disconnected,G)}),this.updateAndEmitDCBufferStatus=B=>{const z=this.isBufferStatusLow(B);typeof z<"u"&&z!==this.dcBufferStatus.get(B)&&(this.dcBufferStatus.set(B,z),this.emit(EngineEvent.DCBufferStatusChanged,z,B))},this.isBufferStatusLow=B=>{const z=this.dataChannelForKind(B);if(z)return B===DataPacket_Kind.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(z.bufferedAmount),z.bufferedAmount<=z.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===SignalConnectionState.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(ReconnectReason.RR_SIGNAL_DISCONNECTED))},this.log=getLogger((j=U.loggerName)!==null&&j!==void 0?j:LoggerNames.Engine),this.loggerOptions={loggerName:U.loggerName,loggerContextCb:()=>this.logContext},this.client=new SignalClient(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new _$1,this.dataProcessLock=new _$1,this.dcBufferStatus=new Map([[DataPacket_Kind.LOSSY,!0],[DataPacket_Kind.RELIABLE,!0]]),this.client.onParticipantUpdate=B=>this.emit(EngineEvent.ParticipantUpdate,B),this.client.onConnectionQuality=B=>this.emit(EngineEvent.ConnectionQualityUpdate,B),this.client.onRoomUpdate=B=>this.emit(EngineEvent.RoomUpdate,B),this.client.onSubscriptionError=B=>this.emit(EngineEvent.SubscriptionError,B),this.client.onSubscriptionPermissionUpdate=B=>this.emit(EngineEvent.SubscriptionPermissionUpdate,B),this.client.onSpeakersChanged=B=>this.emit(EngineEvent.SpeakersChanged,B),this.client.onStreamStateUpdate=B=>this.emit(EngineEvent.StreamStateChanged,B),this.client.onRequestResponse=B=>this.emit(EngineEvent.SignalRequestResponse,B)}get logContext(){var U,j,B,z,H,G;return{room:(j=(U=this.latestJoinResponse)===null||U===void 0?void 0:U.room)===null||j===void 0?void 0:j.name,roomID:(z=(B=this.latestJoinResponse)===null||B===void 0?void 0:B.room)===null||z===void 0?void 0:z.sid,participant:(G=(H=this.latestJoinResponse)===null||H===void 0?void 0:H.participant)===null||G===void 0?void 0:G.identity,pID:this.participantSid}}join(U,j,B,z){return __awaiter$1(this,void 0,void 0,function*(){this.url=U,this.token=j,this.signalOpts=B,this.maxJoinAttempts=B.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const H=yield this.client.join(U,j,B,z);return this._isClosed=!1,this.latestJoinResponse=H,this.subscriberPrimary=H.subscriberPrimary,this.pcManager||(yield this.configure(H)),(!this.subscriberPrimary||H.fastPublish)&&this.negotiate(),this.clientConfiguration=H.clientConfiguration,this.emit(EngineEvent.SignalConnected,H),H}catch(H){if(H instanceof ConnectionError&&H.reason===ConnectionErrorReason.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(U,j,B,z);throw H}})}close(){return __awaiter$1(this,void 0,void 0,function*(){const U=yield this.closingLock.lock();if(this.isClosed){U();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{U()}})}cleanupPeerConnections(){return __awaiter$1(this,void 0,void 0,function*(){var U;yield(U=this.pcManager)===null||U===void 0?void 0:U.close(),this.pcManager=void 0;const j=B=>{B&&(B.close(),B.onbufferedamountlow=null,B.onclose=null,B.onclosing=null,B.onerror=null,B.onmessage=null,B.onopen=null)};j(this.lossyDC),j(this.lossyDCSub),j(this.reliableDC),j(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new DataPacketBuffer,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return __awaiter$1(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(U){if(this.pendingTrackResolvers[U.cid])throw new TrackInvalidError("a track with the same ID has already been published");return new Promise((j,B)=>{const z=setTimeout(()=>{delete this.pendingTrackResolvers[U.cid],B(new ConnectionError("publication of local track timed out, no response from server",ConnectionErrorReason.Timeout))},1e4);this.pendingTrackResolvers[U.cid]={resolve:H=>{clearTimeout(z),j(H)},reject:()=>{clearTimeout(z),B(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(U)})}removeTrack(U){if(U.track&&this.pendingTrackResolvers[U.track.id]){const{reject:j}=this.pendingTrackResolvers[U.track.id];j&&j(),delete this.pendingTrackResolvers[U.track.id]}try{return this.pcManager.removeTrack(U),!0}catch(j){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:j}))}return!1}updateMuteStatus(U,j){this.client.sendMuteTrack(U,j)}get dataSubscriberReadyState(){var U;return(U=this.reliableDCSub)===null||U===void 0?void 0:U.readyState}getConnectedServerAddress(){return __awaiter$1(this,void 0,void 0,function*(){var U;return(U=this.pcManager)===null||U===void 0?void 0:U.getConnectedAddress()})}setRegionUrlProvider(U){this.regionUrlProvider=U}configure(U){return __awaiter$1(this,void 0,void 0,function*(){var j,B;if(this.pcManager&&this.pcManager.currentState!==PCTransportState.NEW)return;this.participantSid=(j=U.participant)===null||j===void 0?void 0:j.sid;const z=this.makeRTCConfiguration(U);this.pcManager=new PCTransportManager(z,U.subscriberPrimary,this.loggerOptions),this.emit(EngineEvent.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(H,G)=>{this.client.sendIceCandidate(H,G)},this.pcManager.onPublisherOffer=(H,G)=>{this.client.sendOffer(H,G)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(H,G,$)=>__awaiter$1(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(H),this.logContext),["closed","disconnected","failed"].includes(G)&&(this.publisherConnectionPromise=void 0),H===PCTransportState.CONNECTED){const X=this.pcState===PCState.New;this.pcState=PCState.Connected,X&&this.emit(EngineEvent.Connected,U)}else H===PCTransportState.FAILED&&this.pcState===PCState.Connected&&(this.pcState=PCState.Disconnected,this.handleDisconnect("peerconnection failed",$==="failed"?ReconnectReason.RR_SUBSCRIBER_FAILED:ReconnectReason.RR_PUBLISHER_FAILED));const Q=this.client.isDisconnected||this.client.currentState===SignalConnectionState.RECONNECTING,W=[PCTransportState.FAILED,PCTransportState.CLOSING,PCTransportState.CLOSED].includes(H);Q&&W&&!this._isClosed&&this.emit(EngineEvent.Offline)}),this.pcManager.onTrack=H=>{this.emit(EngineEvent.MediaTrackAdded,H.track,H.streams[0],H.receiver)},supportOptionalDatachannel((B=U.serverInfo)===null||B===void 0?void 0:B.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(U,j)=>__awaiter$1(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:U.type})),yield this.pcManager.setPublisherAnswer(U,j))}),this.client.onTrickle=(U,j)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:U,target:j})),this.pcManager.addIceCandidate(U,j))},this.client.onOffer=(U,j)=>__awaiter$1(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=j,!this.pcManager)return;const B=yield this.pcManager.createSubscriberAnswerFromOffer(U,j);B&&this.client.sendAnswer(B,j)}),this.client.onLocalTrackPublished=U=>{var j;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:U.cid,track:(j=U.track)===null||j===void 0?void 0:j.sid})),!this.pendingTrackResolvers[U.cid]){this.log.error("missing track resolver for ".concat(U.cid),Object.assign(Object.assign({},this.logContext),{cid:U.cid}));return}const{resolve:B}=this.pendingTrackResolvers[U.cid];delete this.pendingTrackResolvers[U.cid],B(U.track)},this.client.onLocalTrackUnpublished=U=>{this.emit(EngineEvent.LocalTrackUnpublished,U)},this.client.onLocalTrackSubscribed=U=>{this.emit(EngineEvent.LocalTrackSubscribed,U)},this.client.onTokenRefresh=U=>{this.token=U},this.client.onRemoteMuteChanged=(U,j)=>{this.emit(EngineEvent.RemoteMute,U,j)},this.client.onSubscribedQualityUpdate=U=>{this.emit(EngineEvent.SubscribedQualityUpdate,U)},this.client.onRoomMoved=U=>{var j;this.participantSid=(j=U.participant)===null||j===void 0?void 0:j.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=U.room),this.emit(EngineEvent.RoomMoved,U)},this.client.onClose=()=>{this.handleDisconnect("signal",ReconnectReason.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=U=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:U?.reason})),U.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(U.regions)),U.action){case LeaveRequest_Action.DISCONNECT:this.emit(EngineEvent.Disconnected,U?.reason),this.close();break;case LeaveRequest_Action.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(leaveReconnect);break;case LeaveRequest_Action.RESUME:this.handleDisconnect(leaveReconnect)}}}makeRTCConfiguration(U){var j;const B=Object.assign({},this.rtcConfig);if(!((j=this.signalOpts)===null||j===void 0)&&j.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),B.encodedInsertableStreams=!0),U.iceServers&&!B.iceServers){const z=[];U.iceServers.forEach(H=>{const G={urls:H.urls};H.username&&(G.username=H.username),H.credential&&(G.credential=H.credential),z.push(G)}),B.iceServers=z}return U.clientConfiguration&&U.clientConfiguration.forceRelay===ClientConfigSetting.ENABLED&&(B.iceTransportPolicy="relay"),B.sdpSemantics="unified-plan",B.continualGatheringPolicy="gather_continually",B}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(lossyDataChannel,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(reliableDataChannel,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(U,j,B){return __awaiter$1(this,void 0,void 0,function*(){if(supportsTransceiver())return yield this.createTransceiverRTCRtpSender(U,j,B);if(supportsAddTrack())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(U.mediaStreamTrack);throw new UnexpectedConnectionState("Required webRTC APIs not supported on this device")})}createSimulcastSender(U,j,B,z){return __awaiter$1(this,void 0,void 0,function*(){if(supportsTransceiver())return this.createSimulcastTransceiverSender(U,j,B,z);if(supportsAddTrack())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(U.mediaStreamTrack);throw new UnexpectedConnectionState("Cannot stream on this device")})}createTransceiverRTCRtpSender(U,j,B){return __awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const z=[];U.mediaStream&&z.push(U.mediaStream),isVideoTrack(U)&&(U.codec=j.videoCodec);const H={direction:"sendonly",streams:z};return B&&(H.sendEncodings=B),(yield this.pcManager.addPublisherTransceiver(U.mediaStreamTrack,H)).sender})}createSimulcastTransceiverSender(U,j,B,z){return __awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");const H={direction:"sendonly"};z&&(H.sendEncodings=z);const G=yield this.pcManager.addPublisherTransceiver(j.mediaStreamTrack,H);if(B.videoCodec)return U.setSimulcastTrackSender(B.videoCodec,G.sender),G.sender})}createRTCRtpSender(U){return __awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("publisher is closed");return this.pcManager.addPublisherTrack(U)})}attemptReconnect(U){return __awaiter$1(this,void 0,void 0,function*(){var j,B,z;if(!this._isClosed){if(this.attemptingReconnect){livekitLogger.warn("already attempting reconnect, returning early",this.logContext);return}(((j=this.clientConfiguration)===null||j===void 0?void 0:j.resumeConnection)===ClientConfigSetting.DISABLED||((z=(B=this.pcManager)===null||B===void 0?void 0:B.currentState)!==null&&z!==void 0?z:PCTransportState.NEW)===PCTransportState.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(U),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(H){this.reconnectAttempts+=1;let G=!0;H instanceof UnexpectedConnectionState?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:H})),G=!1):H instanceof SignalReconnectError||(this.fullReconnectOnNext=!0),G?this.handleDisconnect("reconnect",ReconnectReason.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(EngineEvent.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(U){try{return this.reconnectPolicy.nextRetryDelayInMs(U)}catch(j){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:j}))}return null}restartConnection(U){return __awaiter$1(this,void 0,void 0,function*(){var j,B,z;try{if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let H;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new SignalReconnectError;H=yield this.join(U??this.url,this.token,this.signalOpts)}catch(G){throw G instanceof ConnectionError&&G.reason===ConnectionErrorReason.NotAllowed?new UnexpectedConnectionState("could not reconnect, token might be expired"):new SignalReconnectError}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(EngineEvent.SignalRestarted,H),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");(j=this.regionUrlProvider)===null||j===void 0||j.resetAttempts(),this.emit(EngineEvent.Restarted)}catch(H){const G=yield(B=this.regionUrlProvider)===null||B===void 0?void 0:B.getNextBestRegionUrl();if(G){yield this.restartConnection(G);return}else throw(z=this.regionUrlProvider)===null||z===void 0||z.resetAttempts(),H}})}resumeConnection(U){return __awaiter$1(this,void 0,void 0,function*(){var j;if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");if(!this.pcManager)throw new UnexpectedConnectionState("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(EngineEvent.Resuming);let B;try{this.setupSignalClientCallbacks(),B=yield this.client.reconnect(this.url,this.token,this.participantSid,U)}catch(z){let H="";throw z instanceof Error&&(H=z.message,this.log.error(z.message,Object.assign(Object.assign({},this.logContext),{error:z}))),z instanceof ConnectionError&&z.reason===ConnectionErrorReason.NotAllowed?new UnexpectedConnectionState("could not reconnect, token might be expired"):z instanceof ConnectionError&&z.reason===ConnectionErrorReason.LeaveRequest?z:new SignalReconnectError(H)}if(this.emit(EngineEvent.SignalResumed),B){const z=this.makeRTCConfiguration(B);this.pcManager.updateConfiguration(z),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=B.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==SignalConnectionState.CONNECTED)throw new SignalReconnectError("Signal connection got severed during reconnect");this.client.setReconnected(),((j=this.reliableDC)===null||j===void 0?void 0:j.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),B?.lastMessageSeq&&this.resendReliableMessagesForResume(B.lastMessageSeq),this.emit(EngineEvent.Resumed)})}waitForPCInitialConnection(U,j){return __awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(j,U)})}waitForPCReconnected(){return __awaiter$1(this,void 0,void 0,function*(){this.pcState=PCState.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield sleep$1(minReconnectWait),!this.pcManager)throw new UnexpectedConnectionState("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=PCState.Connected}catch(U){throw this.pcState=PCState.Disconnected,new ConnectionError("could not establish PC connection, ".concat(U.message),ConnectionErrorReason.InternalError)}})}publishRpcResponse(U,j,B,z){return __awaiter$1(this,void 0,void 0,function*(){const H=new DataPacket({destinationIdentities:[U],kind:DataPacket_Kind.RELIABLE,value:{case:"rpcResponse",value:new RpcResponse({requestId:j,value:z?{case:"error",value:z.toProto()}:{case:"payload",value:B??""}})}});yield this.sendDataPacket(H,DataPacket_Kind.RELIABLE)})}publishRpcAck(U,j){return __awaiter$1(this,void 0,void 0,function*(){const B=new DataPacket({destinationIdentities:[U],kind:DataPacket_Kind.RELIABLE,value:{case:"rpcAck",value:new RpcAck({requestId:j})}});yield this.sendDataPacket(B,DataPacket_Kind.RELIABLE)})}sendDataPacket(U,j){return __awaiter$1(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(j),j===DataPacket_Kind.RELIABLE&&(U.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const B=U.toBinary(),z=this.dataChannelForKind(j);if(z){if(j===DataPacket_Kind.RELIABLE&&this.reliableMessageBuffer.push({data:B,sequence:U.sequence}),this.attemptingReconnect)return;z.send(B)}this.updateAndEmitDCBufferStatus(j)})}resendReliableMessagesForResume(U){return __awaiter$1(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(DataPacket_Kind.RELIABLE);const j=this.dataChannelForKind(DataPacket_Kind.RELIABLE);j&&(this.reliableMessageBuffer.popToSequence(U),this.reliableMessageBuffer.getAll().forEach(B=>{j.send(B.data)})),this.updateAndEmitDCBufferStatus(DataPacket_Kind.RELIABLE)})}waitForBufferStatusLow(U){return new Promise((j,B)=>__awaiter$1(this,void 0,void 0,function*(){if(this.isBufferStatusLow(U))j();else{const z=()=>B("Engine closed");for(this.once(EngineEvent.Closing,z);!this.dcBufferStatus.get(U);)yield sleep$1(10);this.off(EngineEvent.Closing,z),j()}}))}ensureDataTransportConnected(U){return __awaiter$1(this,arguments,void 0,function(j){var B=this;let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var H;if(!B.pcManager)throw new UnexpectedConnectionState("PC manager is closed");const G=z?B.pcManager.subscriber:B.pcManager.publisher,$=z?"Subscriber":"Publisher";if(!G)throw new ConnectionError("".concat($," connection not set"),ConnectionErrorReason.InternalError);let Q=!1;!z&&!B.dataChannelForKind(j,z)&&(B.createDataChannels(),Q=!0),!Q&&!z&&!B.pcManager.publisher.isICEConnected&&B.pcManager.publisher.getICEConnectionState()!=="checking"&&(Q=!0),Q&&B.negotiate();const W=B.dataChannelForKind(j,z);if(W?.readyState==="open")return;const X=new Date().getTime()+B.peerConnectionTimeout;for(;new Date().getTime()<X;){if(G.isICEConnected&&((H=B.dataChannelForKind(j,z))===null||H===void 0?void 0:H.readyState)==="open")return;yield sleep$1(50)}throw new ConnectionError("could not establish ".concat($," connection, state: ").concat(G.getICEConnectionState()),ConnectionErrorReason.InternalError)}()})}ensurePublisherConnected(U){return __awaiter$1(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(U,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==PCTransportState.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return __awaiter$1(this,void 0,void 0,function*(){return new Promise((U,j)=>__awaiter$1(this,void 0,void 0,function*(){if(!this.pcManager){j(new NegotiationError("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const B=new AbortController,z=()=>{B.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),U()};this.isClosed&&j("cannot negotiate on closed engine"),this.on(EngineEvent.Closing,z),this.pcManager.publisher.once(PCEvents.RTPVideoPayloadTypes,H=>{const G=new Map;H.forEach($=>{const Q=$.codec.toLowerCase();isVideoCodec(Q)&&G.set($.payload,Q)}),this.emit(EngineEvent.RTPVideoMapUpdate,G)});try{yield this.pcManager.negotiate(B),U()}catch(H){H instanceof NegotiationError&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ReconnectReason.RR_UNKNOWN),j(H)}finally{this.off(EngineEvent.Closing,z)}}))})}dataChannelForKind(U,j){if(j){if(U===DataPacket_Kind.LOSSY)return this.lossyDCSub;if(U===DataPacket_Kind.RELIABLE)return this.reliableDCSub}else{if(U===DataPacket_Kind.LOSSY)return this.lossyDC;if(U===DataPacket_Kind.RELIABLE)return this.reliableDC}}sendSyncState(U,j){var B,z;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const H=this.pcManager.subscriber.getLocalDescription(),G=this.pcManager.subscriber.getRemoteDescription(),$=(z=(B=this.signalOpts)===null||B===void 0?void 0:B.autoSubscribe)!==null&&z!==void 0?z:!0,Q=new Array,W=new Array;U.forEach(X=>{X.isDesired!==$&&Q.push(X.trackSid),X.isEnabled||W.push(X.trackSid)}),this.client.sendSyncState(new SyncState({answer:H?toProtoSessionDescription({sdp:H.sdp,type:H.type}):void 0,offer:G?toProtoSessionDescription({sdp:G.sdp,type:G.type}):void 0,subscription:new UpdateSubscription({trackSids:Q,subscribe:!$,participantTracks:[]}),publishTracks:getTrackPublicationInfo(j),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:W,datachannelReceiveStates:this.reliableReceivedState.map((X,ee)=>new DataChannelReceiveState({publisherSid:ee,lastSeq:X}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const U=[],j=(B,z)=>{B?.id!==void 0&&B.id!==null&&U.push(new DataChannelInfo({label:B.label,id:B.id,target:z}))};return j(this.dataChannelForKind(DataPacket_Kind.LOSSY),SignalTarget.PUBLISHER),j(this.dataChannelForKind(DataPacket_Kind.RELIABLE),SignalTarget.PUBLISHER),j(this.dataChannelForKind(DataPacket_Kind.LOSSY,!0),SignalTarget.SUBSCRIBER),j(this.dataChannelForKind(DataPacket_Kind.RELIABLE,!0),SignalTarget.SUBSCRIBER),U}clearReconnectTimeout(){this.reconnectTimeout&&CriticalTimers.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){isWeb()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){isWeb()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class SignalReconnectError extends Error{}function supportOptionalDatachannel(V){return V!==void 0&&V>13}function applyUserDataCompat(V,U){const j=V.participantIdentity?V.participantIdentity:U.participantIdentity;V.participantIdentity=j,U.participantIdentity=j;const B=V.destinationIdentities.length!==0?V.destinationIdentities:U.destinationIdentities;V.destinationIdentities=B,U.destinationIdentities=B}class RegionUrlProvider{constructor(U,j){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(U),this.token=j}updateToken(U){this.token=U}isCloud(){return isCloud(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(U){return __awaiter$1(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(U));const j=this.regionSettings.regions.filter(B=>!this.attemptedRegions.find(z=>z.url===B.url));if(j.length>0){const B=j[0];return this.attemptedRegions.push(B),livekitLogger.debug("next region: ".concat(B.region)),B.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(U){return __awaiter$1(this,void 0,void 0,function*(){const j=yield fetch("".concat(getCloudConfigUrl(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:U});if(j.ok){const B=yield j.json();return this.lastUpdateAt=Date.now(),B}else throw new ConnectionError("Could not fetch region settings: ".concat(j.statusText),j.status===401?ConnectionErrorReason.NotAllowed:ConnectionErrorReason.InternalError,j.status)})}setServerReportedRegions(U){this.regionSettings=U,this.lastUpdateAt=Date.now()}}function getCloudConfigUrl(V){return"".concat(V.protocol.replace("ws","http"),"//").concat(V.host,"/settings")}class BaseStreamReader{get info(){return this._info}constructor(U,j,B){this.reader=j,this.totalByteSize=B,this._info=U,this.bytesReceived=0}}class ByteStreamReader extends BaseStreamReader{handleChunkReceived(U){var j;this.bytesReceived+=U.content.byteLength;const B=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(j=this.onProgress)===null||j===void 0||j.call(this,B)}[Symbol.asyncIterator](){const U=this.reader.getReader();return{next:()=>__awaiter$1(this,void 0,void 0,function*(){try{const{done:j,value:B}=yield U.read();return j?{done:!0,value:void 0}:(this.handleChunkReceived(B),{done:!1,value:B.content})}catch{return{done:!0,value:void 0}}}),return(){return __awaiter$1(this,void 0,void 0,function*(){return U.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return __awaiter$1(this,void 0,void 0,function*(){var U,j,B,z;let H=new Set;try{for(var G=!0,$=__asyncValues(this),Q;Q=yield $.next(),U=Q.done,!U;G=!0){z=Q.value,G=!1;const W=z;H.add(W)}}catch(W){j={error:W}}finally{try{!G&&!U&&(B=$.return)&&(yield B.call($))}finally{if(j)throw j.error}}return Array.from(H)})}}class TextStreamReader extends BaseStreamReader{constructor(U,j,B){super(U,j,B),this.receivedChunks=new Map}handleChunkReceived(U){var j;const B=bigIntToNumber(U.chunkIndex),z=this.receivedChunks.get(B);if(z&&z.version>U.version)return;this.receivedChunks.set(B,U),this.bytesReceived+=U.content.byteLength;const H=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(j=this.onProgress)===null||j===void 0||j.call(this,H)}[Symbol.asyncIterator](){const U=this.reader.getReader(),j=new TextDecoder;return{next:()=>__awaiter$1(this,void 0,void 0,function*(){try{const{done:B,value:z}=yield U.read();return B?{done:!0,value:void 0}:(this.handleChunkReceived(z),{done:!1,value:j.decode(z.content)})}catch{return{done:!0,value:void 0}}}),return(){return __awaiter$1(this,void 0,void 0,function*(){return U.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return __awaiter$1(this,void 0,void 0,function*(){var U,j,B,z;let H="";try{for(var G=!0,$=__asyncValues(this),Q;Q=yield $.next(),U=Q.done,!U;G=!0)z=Q.value,G=!1,H+=z}catch(W){j={error:W}}finally{try{!G&&!U&&(B=$.return)&&(yield B.call($))}finally{if(j)throw j.error}}return H})}}class BaseStreamWriter{constructor(U,j,B){this.writableStream=U,this.defaultWriter=U.getWriter(),this.onClose=B,this.info=j}write(U){return this.defaultWriter.write(U)}close(){return __awaiter$1(this,void 0,void 0,function*(){var U;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(U=this.onClose)===null||U===void 0||U.call(this)})}}class TextStreamWriter extends BaseStreamWriter{}class ByteStreamWriter extends BaseStreamWriter{}class RemoteTrack extends Track{constructor(U,j,B,z,H){super(U,B,H),this.sid=j,this.receiver=z}get isLocal(){return!1}setMuted(U){this.isMuted!==U&&(this.isMuted=U,this._mediaStreamTrack.enabled=!U,this.emit(U?TrackEvent.Muted:TrackEvent.Unmuted,this))}setMediaStream(U){this.mediaStream=U;const j=B=>{B.track===this._mediaStreamTrack&&(U.removeEventListener("removetrack",j),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(TrackEvent.Ended,this))};U.addEventListener("removetrack",j)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return __awaiter$1(this,void 0,void 0,function*(){var U;return!((U=this.receiver)===null||U===void 0)&&U.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(U){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=U:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),monitorFrequency)),supportsSynchronizationSources()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const U=()=>{var j;this.timeSyncHandle=requestAnimationFrame(()=>U());const B=(j=this.receiver)===null||j===void 0?void 0:j.getSynchronizationSources()[0];if(B){const{timestamp:z,rtpTimestamp:H}=B;H&&this.rtpTimestamp!==H&&(this.emit(TrackEvent.TimeSyncUpdate,{timestamp:z,rtpTimestamp:H}),this.rtpTimestamp=H)}};U()}}class RemoteAudioTrack extends RemoteTrack{constructor(U,j,B,z,H,G){super(U,j,Track.Kind.Audio,B,G),this.monitorReceiver=()=>__awaiter$1(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const $=yield this.getReceiverStats();$&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate($,this.prevStats)),this.prevStats=$}),this.audioContext=z,this.webAudioPluginNodes=[],H&&(this.sinkId=H.deviceId)}setVolume(U){var j;for(const B of this.attachedElements)this.audioContext?(j=this.gainNode)===null||j===void 0||j.gain.setTargetAtTime(U,0,.1):B.volume=U;isReactNative()&&this._mediaStreamTrack._setVolume(U),this.elementVolume=U}getVolume(){if(this.elementVolume)return this.elementVolume;if(isReactNative())return 1;let U=0;return this.attachedElements.forEach(j=>{j.volume>U&&(U=j.volume)}),U}setSinkId(U){return __awaiter$1(this,void 0,void 0,function*(){this.sinkId=U,yield Promise.all(this.attachedElements.map(j=>{if(supportsSetSinkId(j))return j.setSinkId(U)}))})}attach(U){const j=this.attachedElements.length===0;return U?super.attach(U):U=super.attach(),this.sinkId&&supportsSetSinkId(U)&&U.setSinkId(this.sinkId).catch(B=>{this.log.error("Failed to set sink id on remote audio track",B,this.logContext)}),this.audioContext&&j&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,U),U.volume=0,U.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),U}detach(U){let j;return U?(j=super.detach(U),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(j=super.detach(),this.disconnectWebAudio()),j}setAudioContext(U){this.audioContext=U,U&&this.attachedElements.length>0?this.connectWebAudio(U,this.attachedElements[0]):U||this.disconnectWebAudio()}setWebAudioPlugins(U){this.webAudioPluginNodes=U,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(U,j){this.disconnectWebAudio(),this.sourceNode=U.createMediaStreamSource(j.srcObject);let B=this.sourceNode;this.webAudioPluginNodes.forEach(z=>{B.connect(z),B=z}),this.gainNode=U.createGain(),B.connect(this.gainNode),this.gainNode.connect(U.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),U.state!=="running"&&U.resume().then(()=>{U.state!=="running"&&this.emit(TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(z=>{this.emit(TrackEvent.AudioPlaybackFailed,z)})}disconnectWebAudio(){var U,j;(U=this.gainNode)===null||U===void 0||U.disconnect(),(j=this.sourceNode)===null||j===void 0||j.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return __awaiter$1(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const U=yield this.receiver.getStats();let j;return U.forEach(B=>{B.type==="inbound-rtp"&&(j={type:"audio",streamId:B.id,timestamp:B.timestamp,jitter:B.jitter,bytesReceived:B.bytesReceived,concealedSamples:B.concealedSamples,concealmentEvents:B.concealmentEvents,silentConcealedSamples:B.silentConcealedSamples,silentConcealmentEvents:B.silentConcealmentEvents,totalAudioEnergy:B.totalAudioEnergy,totalSamplesDuration:B.totalSamplesDuration})}),j})}}const REACTION_DELAY=100;class RemoteVideoTrack extends RemoteTrack{constructor(U,j,B,z,H){super(U,j,Track.Kind.Video,B,H),this.elementInfos=[],this.monitorReceiver=()=>__awaiter$1(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const G=yield this.getReceiverStats();G&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(G,this.prevStats)),this.prevStats=G}),this.debouncedHandleResize=r$1(()=>{this.updateDimensions()},REACTION_DELAY),this.adaptiveStreamSettings=z}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(U){super.setMuted(U),this.attachedElements.forEach(j=>{U?detachTrack(this._mediaStreamTrack,j):attachToElement(this._mediaStreamTrack,j)})}attach(U){if(U?super.attach(U):U=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(j=>j.element===U)===void 0){const j=new HTMLElementInfo(U);this.observeElementInfo(j)}return U}observeElementInfo(U){this.adaptiveStreamSettings&&this.elementInfos.find(j=>j===U)===void 0?(U.handleResize=()=>{this.debouncedHandleResize()},U.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(U),U.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(U){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const j=this.elementInfos.filter(B=>B===U);for(const B of j)B.stopObserving();this.elementInfos=this.elementInfos.filter(B=>B!==U),this.updateVisibility(),this.debouncedHandleResize()}detach(U){let j=[];if(U)return this.stopObservingElement(U),super.detach(U);j=super.detach();for(const B of j)this.stopObservingElement(B);return j}getDecoderImplementation(){var U;return(U=this.prevStats)===null||U===void 0?void 0:U.decoderImplementation}getReceiverStats(){return __awaiter$1(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const U=yield this.receiver.getStats();let j,B="",z=new Map;return U.forEach(H=>{H.type==="inbound-rtp"?(B=H.codecId,j={type:"video",streamId:H.id,framesDecoded:H.framesDecoded,framesDropped:H.framesDropped,framesReceived:H.framesReceived,packetsReceived:H.packetsReceived,packetsLost:H.packetsLost,frameWidth:H.frameWidth,frameHeight:H.frameHeight,pliCount:H.pliCount,firCount:H.firCount,nackCount:H.nackCount,jitter:H.jitter,timestamp:H.timestamp,bytesReceived:H.bytesReceived,decoderImplementation:H.decoderImplementation}):H.type==="codec"&&z.set(H.id,H)}),j&&B!==""&&z.get(B)&&(j.mimeType=z.get(B).mimeType),j})}stopObservingElement(U){const j=this.elementInfos.filter(B=>B.element===U);for(const B of j)this.stopObservingElementInfo(B)}handleAppVisibilityChanged(){const U=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return __awaiter$1(this,void 0,void 0,function*(){yield U.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var U,j;const B=this.elementInfos.reduce(($,Q)=>Math.max($,Q.visibilityChangedAt||0),0),z=!((j=(U=this.adaptiveStreamSettings)===null||U===void 0?void 0:U.pauseVideoInBackground)!==null&&j!==void 0)||j?this.isInBackground:!1,H=this.elementInfos.some($=>$.pictureInPicture),G=this.elementInfos.some($=>$.visible)&&!z||H;if(this.lastVisible!==G){if(!G&&Date.now()-B<REACTION_DELAY){CriticalTimers.setTimeout(()=>{this.updateVisibility()},REACTION_DELAY);return}this.lastVisible=G,this.emit(TrackEvent.VisibilityChanged,G,this)}}updateDimensions(){var U,j;let B=0,z=0;const H=this.getPixelDensity();for(const G of this.elementInfos){const $=G.width()*H,Q=G.height()*H;$+Q>B+z&&(B=$,z=Q)}((U=this.lastDimensions)===null||U===void 0?void 0:U.width)===B&&((j=this.lastDimensions)===null||j===void 0?void 0:j.height)===z||(this.lastDimensions={width:B,height:z},this.emit(TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var U;const j=(U=this.adaptiveStreamSettings)===null||U===void 0?void 0:U.pixelDensity;return j==="screen"?getDevicePixelRatio():j||(getDevicePixelRatio()>2?2:1)}}class HTMLElementInfo{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(U,j){this.onVisibilityChanged=B=>{var z;const{target:H,isIntersecting:G}=B;H===this.element&&(this.isIntersecting=G,this.isPiP=isElementInPiP(this.element),this.visibilityChangedAt=Date.now(),(z=this.handleVisibilityChanged)===null||z===void 0||z.call(this))},this.onEnterPiP=()=>{var B,z,H;(z=(B=window.documentPictureInPicture)===null||B===void 0?void 0:B.window)===null||z===void 0||z.addEventListener("pagehide",this.onLeavePiP),this.isPiP=isElementInPiP(this.element),(H=this.handleVisibilityChanged)===null||H===void 0||H.call(this)},this.onLeavePiP=()=>{var B;this.isPiP=isElementInPiP(this.element),(B=this.handleVisibilityChanged)===null||B===void 0||B.call(this)},this.element=U,this.isIntersecting=j??isElementInViewport(U),this.isPiP=isWeb()&&isElementInPiP(U),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var U,j,B;this.isIntersecting=isElementInViewport(this.element),this.isPiP=isElementInPiP(this.element),this.element.handleResize=()=>{var z;(z=this.handleResize)===null||z===void 0||z.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,getIntersectionObserver().observe(this.element),getResizeObserver().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(U=window.documentPictureInPicture)===null||U===void 0||U.addEventListener("enter",this.onEnterPiP),(B=(j=window.documentPictureInPicture)===null||j===void 0?void 0:j.window)===null||B===void 0||B.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var U,j,B,z,H;(U=getIntersectionObserver())===null||U===void 0||U.unobserve(this.element),(j=getResizeObserver())===null||j===void 0||j.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(B=window.documentPictureInPicture)===null||B===void 0||B.removeEventListener("enter",this.onEnterPiP),(H=(z=window.documentPictureInPicture)===null||z===void 0?void 0:z.window)===null||H===void 0||H.removeEventListener("pagehide",this.onLeavePiP)}}function isElementInPiP(V){var U,j;return document.pictureInPictureElement===V?!0:!((U=window.documentPictureInPicture)===null||U===void 0)&&U.window?isElementInViewport(V,(j=window.documentPictureInPicture)===null||j===void 0?void 0:j.window):!1}function isElementInViewport(V,U){const j=U||window;let B=V.offsetTop,z=V.offsetLeft;const H=V.offsetWidth,G=V.offsetHeight,{hidden:$}=V,{display:Q}=getComputedStyle(V);for(;V.offsetParent;)V=V.offsetParent,B+=V.offsetTop,z+=V.offsetLeft;return B<j.pageYOffset+j.innerHeight&&z<j.pageXOffset+j.innerWidth&&B+G>j.pageYOffset&&z+H>j.pageXOffset&&!$&&Q!=="none"}class TrackPublication extends eventsExports.EventEmitter{constructor(U,j,B,z){var H;super(),this.metadataMuted=!1,this.encryption=Encryption_Type.NONE,this.log=livekitLogger,this.handleMuted=()=>{this.emit(TrackEvent.Muted)},this.handleUnmuted=()=>{this.emit(TrackEvent.Unmuted)},this.log=getLogger((H=z?.loggerName)!==null&&H!==void 0?H:LoggerNames.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=U,this.trackSid=j,this.trackName=B,this.source=Track.Source.Unknown}setTrack(U){this.track&&(this.track.off(TrackEvent.Muted,this.handleMuted),this.track.off(TrackEvent.Unmuted,this.handleUnmuted)),this.track=U,U&&(U.on(TrackEvent.Muted,this.handleMuted),U.on(TrackEvent.Unmuted,this.handleUnmuted))}get logContext(){var U;return Object.assign(Object.assign({},(U=this.loggerContextCb)===null||U===void 0?void 0:U.call(this)),getLogContextFromTrack(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Encryption_Type.NONE}get audioTrack(){if(isAudioTrack(this.track))return this.track}get videoTrack(){if(isVideoTrack(this.track))return this.track}updateInfo(U){this.trackSid=U.sid,this.trackName=U.name,this.source=Track.sourceFromProto(U.source),this.mimeType=U.mimeType,this.kind===Track.Kind.Video&&U.width>0&&(this.dimensions={width:U.width,height:U.height},this.simulcasted=U.simulcast),this.encryption=U.encryption,this.trackInfo=U,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:U}))}}(function(V){(function(U){U.Desired="desired",U.Subscribed="subscribed",U.Unsubscribed="unsubscribed"})(V.SubscriptionStatus||(V.SubscriptionStatus={})),function(U){U.Allowed="allowed",U.NotAllowed="not_allowed"}(V.PermissionStatus||(V.PermissionStatus={}))})(TrackPublication||(TrackPublication={}));class LocalTrackPublication extends TrackPublication{get isUpstreamPaused(){var U;return(U=this.track)===null||U===void 0?void 0:U.isUpstreamPaused}constructor(U,j,B,z){super(U,j.sid,j.name,z),this.track=void 0,this.handleTrackEnded=()=>{this.emit(TrackEvent.Ended)},this.handleCpuConstrained=()=>{this.track&&isVideoTrack(this.track)&&this.emit(TrackEvent.CpuConstrained,this.track)},this.updateInfo(j),this.setTrack(B)}setTrack(U){this.track&&(this.track.off(TrackEvent.Ended,this.handleTrackEnded),this.track.off(TrackEvent.CpuConstrained,this.handleCpuConstrained)),super.setTrack(U),U&&(U.on(TrackEvent.Ended,this.handleTrackEnded),U.on(TrackEvent.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return __awaiter$1(this,void 0,void 0,function*(){var U;return(U=this.track)===null||U===void 0?void 0:U.mute()})}unmute(){return __awaiter$1(this,void 0,void 0,function*(){var U;return(U=this.track)===null||U===void 0?void 0:U.unmute()})}pauseUpstream(){return __awaiter$1(this,void 0,void 0,function*(){var U;yield(U=this.track)===null||U===void 0?void 0:U.pauseUpstream()})}resumeUpstream(){return __awaiter$1(this,void 0,void 0,function*(){var U;yield(U=this.track)===null||U===void 0?void 0:U.resumeUpstream()})}getTrackFeatures(){var U;if(isAudioTrack(this.track)){const j=this.track.getSourceTrackSettings(),B=new Set;return j.autoGainControl&&B.add(AudioTrackFeature.TF_AUTO_GAIN_CONTROL),j.echoCancellation&&B.add(AudioTrackFeature.TF_ECHO_CANCELLATION),j.noiseSuppression&&B.add(AudioTrackFeature.TF_NOISE_SUPPRESSION),j.channelCount&&j.channelCount>1&&B.add(AudioTrackFeature.TF_STEREO),!((U=this.options)===null||U===void 0)&&U.dtx||B.add(AudioTrackFeature.TF_NO_DTX),this.track.enhancedNoiseCancellation&&B.add(AudioTrackFeature.TF_ENHANCED_NOISE_CANCELLATION),Array.from(B.values())}else return[]}}function createLocalTracks(V,U){return __awaiter$1(this,void 0,void 0,function*(){V??(V={});let j=!1;const{audioProcessor:B,videoProcessor:z,optionsWithoutProcessor:H}=extractProcessorsFromOptions(V);let G=H.audio,$=H.video;if(B&&typeof H.audio=="object"&&(H.audio.processor=B),z&&typeof H.video=="object"&&(H.video.processor=z),V.audio&&typeof H.audio=="object"&&typeof H.audio.deviceId=="string"){const ee=H.audio.deviceId;H.audio.deviceId={exact:ee},j=!0,G=Object.assign(Object.assign({},H.audio),{deviceId:{ideal:ee}})}if(H.video&&typeof H.video=="object"&&typeof H.video.deviceId=="string"){const ee=H.video.deviceId;H.video.deviceId={exact:ee},j=!0,$=Object.assign(Object.assign({},H.video),{deviceId:{ideal:ee}})}(H.audio===!0||typeof H.audio=="object"&&!H.audio.deviceId)&&(H.audio={deviceId:"default"}),H.video===!0?H.video={deviceId:"default"}:typeof H.video=="object"&&!H.video.deviceId&&(H.video.deviceId="default");const Q=mergeDefaultOptions(H,audioDefaults,videoDefaults),W=constraintsForOptions(Q),X=navigator.mediaDevices.getUserMedia(W);H.audio&&(DeviceManager.userMediaPromiseMap.set("audioinput",X),X.catch(()=>DeviceManager.userMediaPromiseMap.delete("audioinput"))),H.video&&(DeviceManager.userMediaPromiseMap.set("videoinput",X),X.catch(()=>DeviceManager.userMediaPromiseMap.delete("videoinput")));try{const ee=yield X;return yield Promise.all(ee.getTracks().map(ie=>__awaiter$1(this,void 0,void 0,function*(){const ne=ie.kind==="audio";let re=ne?Q.audio:Q.video;(typeof re=="boolean"||!re)&&(re={});let se;const de=ne?W.audio:W.video;typeof de!="boolean"&&(se=de);const oe=ie.getSettings().deviceId;se?.deviceId&&unwrapConstraint(se.deviceId)!==oe?se.deviceId=oe:se||(se={deviceId:oe});const le=mediaTrackToLocalTrack(ie,se,U);return le.kind===Track.Kind.Video?le.source=Track.Source.Camera:le.kind===Track.Kind.Audio&&(le.source=Track.Source.Microphone),le.mediaStream=ee,isAudioTrack(le)&&B?yield le.setProcessor(B):isVideoTrack(le)&&z&&(yield le.setProcessor(z)),le})))}catch(ee){if(!j)throw ee;return createLocalTracks(Object.assign(Object.assign({},V),{audio:G,video:$}),U)}})}function createLocalVideoTrack(V){return __awaiter$1(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:!1,video:!0}))[0]})}function createLocalAudioTrack(V){return __awaiter$1(this,void 0,void 0,function*(){return(yield createLocalTracks({audio:V??!0,video:!1}))[0]})}var ConnectionQuality$2;(function(V){V.Excellent="excellent",V.Good="good",V.Poor="poor",V.Lost="lost",V.Unknown="unknown"})(ConnectionQuality$2||(ConnectionQuality$2={}));function qualityFromProto(V){switch(V){case ConnectionQuality$1.EXCELLENT:return ConnectionQuality$2.Excellent;case ConnectionQuality$1.GOOD:return ConnectionQuality$2.Good;case ConnectionQuality$1.POOR:return ConnectionQuality$2.Poor;case ConnectionQuality$1.LOST:return ConnectionQuality$2.Lost;default:return ConnectionQuality$2.Unknown}}class Participant extends eventsExports.EventEmitter{get logContext(){var U,j;return Object.assign({},(j=(U=this.loggerOptions)===null||U===void 0?void 0:U.loggerContextCb)===null||j===void 0?void 0:j.call(U))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(U=>U.isEncrypted)}get isAgent(){var U;return((U=this.permissions)===null||U===void 0?void 0:U.agent)||this.kind===ParticipantInfo_Kind.AGENT}get isActive(){var U;return((U=this.participantInfo)===null||U===void 0?void 0:U.state)===ParticipantInfo_State.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(U,j,B,z,H,G){let $=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ParticipantInfo_Kind.STANDARD;var Q;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ConnectionQuality$2.Unknown,this.log=livekitLogger,this.log=getLogger((Q=G?.loggerName)!==null&&Q!==void 0?Q:LoggerNames.Participant),this.loggerOptions=G,this.setMaxListeners(100),this.sid=U,this.identity=j,this.name=B,this.metadata=z,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=$,this._attributes=H??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(U){for(const[,j]of this.trackPublications)if(j.source===U)return j}getTrackPublicationByName(U){for(const[,j]of this.trackPublications)if(j.trackName===U)return j}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Future,this.once(ParticipantEvent.Active,()=>{var U,j;(j=(U=this.activeFuture)===null||U===void 0?void 0:U.resolve)===null||j===void 0||j.call(U),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var U;const j=this.getTrackPublication(Track.Source.Camera);return!(!((U=j?.isMuted)!==null&&U!==void 0)||U)}get isMicrophoneEnabled(){var U;const j=this.getTrackPublication(Track.Source.Microphone);return!(!((U=j?.isMuted)!==null&&U!==void 0)||U)}get isScreenShareEnabled(){return!!this.getTrackPublication(Track.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(U){var j;return this.participantInfo&&this.participantInfo.sid===U.sid&&this.participantInfo.version>U.version?!1:(this.identity=U.identity,this.sid=U.sid,this._setName(U.name),this._setMetadata(U.metadata),this._setAttributes(U.attributes),U.state===ParticipantInfo_State.ACTIVE&&((j=this.participantInfo)===null||j===void 0?void 0:j.state)!==ParticipantInfo_State.ACTIVE&&this.emit(ParticipantEvent.Active),U.permission&&this.setPermissions(U.permission),this.participantInfo=U,!0)}_setMetadata(U){const j=this.metadata!==U,B=this.metadata;this.metadata=U,j&&this.emit(ParticipantEvent.ParticipantMetadataChanged,B)}_setName(U){const j=this.name!==U;this.name=U,j&&this.emit(ParticipantEvent.ParticipantNameChanged,U)}_setAttributes(U){const j=diffAttributes(this.attributes,U);this._attributes=U,Object.keys(j).length>0&&this.emit(ParticipantEvent.AttributesChanged,j)}setPermissions(U){var j,B,z,H,G,$;const Q=this.permissions,W=U.canPublish!==((j=this.permissions)===null||j===void 0?void 0:j.canPublish)||U.canSubscribe!==((B=this.permissions)===null||B===void 0?void 0:B.canSubscribe)||U.canPublishData!==((z=this.permissions)===null||z===void 0?void 0:z.canPublishData)||U.hidden!==((H=this.permissions)===null||H===void 0?void 0:H.hidden)||U.recorder!==((G=this.permissions)===null||G===void 0?void 0:G.recorder)||U.canPublishSources.length!==this.permissions.canPublishSources.length||U.canPublishSources.some((X,ee)=>{var ie;return X!==((ie=this.permissions)===null||ie===void 0?void 0:ie.canPublishSources[ee])})||U.canSubscribeMetrics!==(($=this.permissions)===null||$===void 0?void 0:$.canSubscribeMetrics);return this.permissions=U,W&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,Q),W}setIsSpeaking(U){U!==this.isSpeaking&&(this.isSpeaking=U,U&&(this.lastSpokeAt=new Date),this.emit(ParticipantEvent.IsSpeakingChanged,U))}setConnectionQuality(U){const j=this._connectionQuality;this._connectionQuality=qualityFromProto(U),j!==this._connectionQuality&&this.emit(ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var U,j;this.activeFuture&&((j=(U=this.activeFuture).reject)===null||j===void 0||j.call(U,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(U){this.audioContext=U,this.audioTrackPublications.forEach(j=>isAudioTrack(j.track)&&j.track.setAudioContext(U))}addTrackPublication(U){U.on(TrackEvent.Muted,()=>{this.emit(ParticipantEvent.TrackMuted,U)}),U.on(TrackEvent.Unmuted,()=>{this.emit(ParticipantEvent.TrackUnmuted,U)});const j=U;switch(j.track&&(j.track.sid=U.trackSid),this.trackPublications.set(U.trackSid,U),U.kind){case Track.Kind.Audio:this.audioTrackPublications.set(U.trackSid,U);break;case Track.Kind.Video:this.videoTrackPublications.set(U.trackSid,U);break}}}function trackPermissionToProto(V){var U,j,B;if(!V.participantSid&&!V.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new TrackPermission({participantIdentity:(U=V.participantIdentity)!==null&&U!==void 0?U:"",participantSid:(j=V.participantSid)!==null&&j!==void 0?j:"",allTracks:(B=V.allowAll)!==null&&B!==void 0?B:!1,trackSids:V.allowedTrackSids||[]})}const STREAM_CHUNK_SIZE=15e3;class LocalParticipant extends Participant{constructor(U,j,B,z,H){super(U,j,void 0,void 0,void 0,{loggerName:z.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Encryption_Type.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Future)},this.handleReconnected=()=>{var G,$;($=(G=this.reconnectFuture)===null||G===void 0?void 0:G.resolve)===null||$===void 0||$.call(G),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var G,$,Q,W,X,ee;this.reconnectFuture&&(this.reconnectFuture.promise.catch(ie=>this.log.warn(ie.message,this.logContext)),($=(G=this.reconnectFuture)===null||G===void 0?void 0:G.reject)===null||$===void 0||$.call(G,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((W=(Q=this.signalConnectedFuture).reject)===null||W===void 0||W.call(Q,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(ee=(X=this.activeAgentFuture)===null||X===void 0?void 0:X.reject)===null||ee===void 0||ee.call(X,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=G=>{var $,Q;G.participant&&this.updateInfo(G.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Future),(Q=($=this.signalConnectedFuture).resolve)===null||Q===void 0||Q.call($)},this.handleSignalRequestResponse=G=>{const{requestId:$,reason:Q,message:W}=G,X=this.pendingSignalRequests.get($);X&&(Q!==RequestResponse_Reason.OK&&X.reject(new SignalRequestError(W,Q)),this.pendingSignalRequests.delete($))},this.handleDataPacket=G=>{switch(G.value.case){case"rpcResponse":let $=G.value.value,Q=null,W=null;$.value.case==="payload"?Q=$.value.value:$.value.case==="error"&&(W=RpcError.fromProto($.value.value)),this.handleIncomingRpcResponse($.requestId,Q,W);break;case"rpcAck":let X=G.value.value;this.handleIncomingRpcAck(X.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(G=>trackPermissionToProto(G)))},this.onTrackUnmuted=G=>{this.onTrackMuted(G,G.isUpstreamPaused)},this.onTrackMuted=(G,$)=>{if($===void 0&&($=!0),!G.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(G)));return}this.engine.updateMuteStatus(G.sid,$)},this.onTrackUpstreamPaused=G=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(G))),this.onTrackMuted(G,!0)},this.onTrackUpstreamResumed=G=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(G))),this.onTrackMuted(G,G.isMuted)},this.onTrackFeatureUpdate=G=>{const $=this.audioTrackPublications.get(G.sid);if(!$){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(G.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack($.trackSid,$.getTrackFeatures())},this.onTrackCpuConstrained=(G,$)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack($))),this.emit(ParticipantEvent.LocalTrackCpuConstrained,G,$)},this.handleSubscribedQualityUpdate=G=>__awaiter$1(this,void 0,void 0,function*(){var $,Q,W,X,ee;if(!(!((ee=this.roomOptions)===null||ee===void 0)&&ee.dynacast))return;const ie=this.videoTrackPublications.get(G.trackSid);if(!ie){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:G.trackSid}));return}if(!ie.videoTrack)return;const ne=yield ie.videoTrack.setPublishingCodecs(G.subscribedCodecs);try{for(var re=!0,se=__asyncValues(ne),de;de=yield se.next(),$=de.done,!$;re=!0){X=de.value,re=!1;const oe=X;isBackupCodec(oe)&&(this.log.debug("publish ".concat(oe," for ").concat(ie.videoTrack.sid),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(ie))),yield this.publishAdditionalCodecForTrack(ie.videoTrack,oe,ie.options))}}catch(oe){Q={error:oe}}finally{try{!re&&!$&&(W=se.return)&&(yield W.call(se))}finally{if(Q)throw Q.error}}}),this.handleLocalTrackUnpublished=G=>{const $=this.trackPublications.get(G.trackSid);if(!$){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:G.trackSid}));return}this.unpublishTrack($.track)},this.handleTrackEnded=G=>__awaiter$1(this,void 0,void 0,function*(){if(G.source===Track.Source.ScreenShare||G.source===Track.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(G))),this.unpublishTrack(G);else if(G.isUserProvided)yield G.mute();else if(isLocalAudioTrack(G)||isLocalVideoTrack(G))try{if(isWeb())try{const $=yield navigator?.permissions.query({name:G.source===Track.Source.Camera?"camera":"microphone"});if($&&$.state==="denied")throw this.log.warn("user has revoked access to ".concat(G.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(G))),$.onchange=()=>{$.state!=="denied"&&(G.isMuted||G.restartTrack(),$.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}G.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(G))),isLocalAudioTrack(G)?yield G.restartTrack({deviceId:"default"}):yield G.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(G))),yield G.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=B,this.roomOptions=z,this.setupEngine(B),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=H}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Encryption_Type.NONE}getTrackPublication(U){const j=super.getTrackPublication(U);if(j)return j}getTrackPublicationByName(U){const j=super.getTrackPublicationByName(U);if(j)return j}setupEngine(U){var j;this.engine=U,this.engine.on(EngineEvent.RemoteMute,(B,z)=>{const H=this.trackPublications.get(B);!H||!H.track||(z?H.mute():H.unmute())}),!((j=this.signalConnectedFuture)===null||j===void 0)&&j.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(EngineEvent.Connected,this.handleReconnected).on(EngineEvent.SignalConnected,this.handleSignalConnected).on(EngineEvent.SignalRestarted,this.handleReconnected).on(EngineEvent.SignalResumed,this.handleReconnected).on(EngineEvent.Restarting,this.handleReconnecting).on(EngineEvent.Resuming,this.handleReconnecting).on(EngineEvent.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(EngineEvent.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(EngineEvent.Disconnected,this.handleDisconnected).on(EngineEvent.SignalRequestResponse,this.handleSignalRequestResponse).on(EngineEvent.DataPacketReceived,this.handleDataPacket)}setMetadata(U){return __awaiter$1(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:U})})}setName(U){return __awaiter$1(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:U})})}setAttributes(U){return __awaiter$1(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:U})})}requestMetadataUpdate(U){return __awaiter$1(this,arguments,void 0,function(j){var B=this;let{metadata:z,name:H,attributes:G}=j;return function*(){return new Promise(($,Q)=>__awaiter$1(B,void 0,void 0,function*(){var W,X;try{let ee=!1;const ie=yield this.engine.client.sendUpdateLocalMetadata((W=z??this.metadata)!==null&&W!==void 0?W:"",(X=H??this.name)!==null&&X!==void 0?X:"",G),ne=performance.now();for(this.pendingSignalRequests.set(ie,{resolve:$,reject:re=>{Q(re),ee=!0},values:{name:H,metadata:z,attributes:G}});performance.now()-ne<5e3&&!ee;){if((!H||this.name===H)&&(!z||this.metadata===z)&&(!G||Object.entries(G).every(re=>{let[se,de]=re;return this.attributes[se]===de||de===""&&!this.attributes[se]}))){this.pendingSignalRequests.delete(ie),$();return}yield sleep$1(50)}Q(new SignalRequestError("Request to update local metadata timed out","TimeoutError"))}catch(ee){ee instanceof Error&&Q(ee)}}))}()})}setCameraEnabled(U,j,B){return this.setTrackEnabled(Track.Source.Camera,U,j,B)}setMicrophoneEnabled(U,j,B){return this.setTrackEnabled(Track.Source.Microphone,U,j,B)}setScreenShareEnabled(U,j,B){return this.setTrackEnabled(Track.Source.ScreenShare,U,j,B)}setPermissions(U){const j=this.permissions,B=super.setPermissions(U);return B&&j&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,j),B}setE2EEEnabled(U){return __awaiter$1(this,void 0,void 0,function*(){this.encryptionType=U?Encryption_Type.GCM:Encryption_Type.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(U,j,B,z){return __awaiter$1(this,void 0,void 0,function*(){var H,G;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:U,enabled:j})),this.republishPromise&&(yield this.republishPromise);let $=this.getTrackPublication(U);if(j)if($)yield $.unmute();else{let Q;if(this.pendingPublishing.has(U)){const W=yield this.waitForPendingPublicationOfSource(U);return W||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:U})),yield W?.unmute(),W}this.pendingPublishing.add(U);try{switch(U){case Track.Source.Camera:Q=yield this.createTracks({video:(H=B)!==null&&H!==void 0?H:!0});break;case Track.Source.Microphone:Q=yield this.createTracks({audio:(G=B)!==null&&G!==void 0?G:!0});break;case Track.Source.ScreenShare:Q=yield this.createScreenTracks(Object.assign({},B));break;default:throw new TrackInvalidError(U)}}catch(W){throw Q?.forEach(X=>{X.stop()}),W instanceof Error&&this.emit(ParticipantEvent.MediaDevicesError,W,sourceToKind(U)),this.pendingPublishing.delete(U),W}for(const W of Q)U===Track.Source.Microphone&&isAudioTrack(W)&&z?.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),W.startPreConnectBuffer());try{const W=[];for(const ee of Q)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(ee))),W.push(this.publishTrack(ee,z));[$]=yield Promise.all(W)}catch(W){throw Q?.forEach(X=>{X.stop()}),W}finally{this.pendingPublishing.delete(U)}}else if(!$?.track&&this.pendingPublishing.has(U)&&($=yield this.waitForPendingPublicationOfSource(U),$||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:U}))),$&&$.track)if(U===Track.Source.ScreenShare){$=yield this.unpublishTrack($.track);const Q=this.getTrackPublication(Track.Source.ScreenShareAudio);Q&&Q.track&&this.unpublishTrack(Q.track)}else yield $.mute();return $})}enableCameraAndMicrophone(){return __awaiter$1(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(Track.Source.Camera)||this.pendingPublishing.has(Track.Source.Microphone))){this.pendingPublishing.add(Track.Source.Camera),this.pendingPublishing.add(Track.Source.Microphone);try{const U=yield this.createTracks({audio:!0,video:!0});yield Promise.all(U.map(j=>this.publishTrack(j)))}finally{this.pendingPublishing.delete(Track.Source.Camera),this.pendingPublishing.delete(Track.Source.Microphone)}}})}createTracks(U){return __awaiter$1(this,void 0,void 0,function*(){var j,B;U??(U={});const z=mergeDefaultOptions(U,(j=this.roomOptions)===null||j===void 0?void 0:j.audioCaptureDefaults,(B=this.roomOptions)===null||B===void 0?void 0:B.videoCaptureDefaults);try{return(yield createLocalTracks(z,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map($=>(isAudioTrack($)&&(this.microphoneError=void 0,$.setAudioContext(this.audioContext),$.source=Track.Source.Microphone,this.emit(ParticipantEvent.AudioStreamAcquired)),isVideoTrack($)&&(this.cameraError=void 0,$.source=Track.Source.Camera),$))}catch(H){throw H instanceof Error&&(U.audio&&(this.microphoneError=H),U.video&&(this.cameraError=H)),H}})}createScreenTracks(U){return __awaiter$1(this,void 0,void 0,function*(){if(U===void 0&&(U={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new DeviceUnsupportedError("getDisplayMedia not supported");U.resolution===void 0&&!isSafari17Based()&&(U.resolution=ScreenSharePresets.h1080fps30.resolution);const j=screenCaptureToDisplayMediaStreamOptions(U),B=yield navigator.mediaDevices.getDisplayMedia(j),z=B.getVideoTracks();if(z.length===0)throw new TrackInvalidError("no video track found");const H=new LocalVideoTrack(z[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});H.source=Track.Source.ScreenShare,U.contentHint&&(H.mediaStreamTrack.contentHint=U.contentHint);const G=[H];if(B.getAudioTracks().length>0){this.emit(ParticipantEvent.AudioStreamAcquired);const $=new LocalAudioTrack(B.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});$.source=Track.Source.ScreenShareAudio,G.push($)}return G})}publishTrack(U,j){return __awaiter$1(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(U,j)})}publishOrRepublishTrack(U,j){return __awaiter$1(this,arguments,void 0,function(B,z){var H=this;let G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var $,Q,W,X;isLocalAudioTrack(B)&&B.setAudioContext(H.audioContext),yield($=H.reconnectFuture)===null||$===void 0?void 0:$.promise,H.republishPromise&&!G&&(yield H.republishPromise),isLocalTrack(B)&&H.pendingPublishPromises.has(B)&&(yield H.pendingPublishPromises.get(B));let ee;if(B instanceof MediaStreamTrack)ee=B.getConstraints();else{ee=B.constraints;let oe;switch(B.source){case Track.Source.Microphone:oe="audioinput";break;case Track.Source.Camera:oe="videoinput"}oe&&H.activeDeviceMap.has(oe)&&(ee=Object.assign(Object.assign({},ee),{deviceId:H.activeDeviceMap.get(oe)}))}if(B instanceof MediaStreamTrack)switch(B.kind){case"audio":B=new LocalAudioTrack(B,ee,!0,H.audioContext,{loggerName:H.roomOptions.loggerName,loggerContextCb:()=>H.logContext});break;case"video":B=new LocalVideoTrack(B,ee,!0,{loggerName:H.roomOptions.loggerName,loggerContextCb:()=>H.logContext});break;default:throw new TrackInvalidError("unsupported MediaStreamTrack kind ".concat(B.kind))}else B.updateLoggerOptions({loggerName:H.roomOptions.loggerName,loggerContextCb:()=>H.logContext});let ie;if(H.trackPublications.forEach(oe=>{oe.track&&oe.track===B&&(ie=oe)}),ie)return H.log.warn("track has already been published, skipping",Object.assign(Object.assign({},H.logContext),getLogContextFromTrack(ie))),ie;const ne="channelCount"in B.mediaStreamTrack.getSettings()&&B.mediaStreamTrack.getSettings().channelCount===2||B.mediaStreamTrack.getConstraints().channelCount===2,re=(Q=z?.forceStereo)!==null&&Q!==void 0?Q:ne;re&&(z||(z={}),z.dtx===void 0&&H.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},H.logContext),getLogContextFromTrack(B))),z.red===void 0&&H.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(W=z.dtx)!==null&&W!==void 0||(z.dtx=!1),(X=z.red)!==null&&X!==void 0||(z.red=!1));const se=Object.assign(Object.assign({},H.roomOptions.publishDefaults),z);!isE2EESimulcastSupported()&&H.roomOptions.e2ee&&(H.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},H.logContext)),se.simulcast=!1),se.source&&(B.source=se.source);const de=new Promise((oe,le)=>__awaiter$1(H,void 0,void 0,function*(){try{if(this.engine.client.currentState!==SignalConnectionState.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:getLogContextFromTrack(B)}));const ue=setTimeout(()=>{le(new PublishTrackError("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(ue);const fe=yield this.publish(B,se,re);oe(fe)}else try{const ue=yield this.publish(B,se,re);oe(ue)}catch(ue){le(ue)}}catch(ue){le(ue)}}));H.pendingPublishPromises.set(B,de);try{return yield de}catch(oe){throw oe}finally{H.pendingPublishPromises.delete(B)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Future),this.signalConnectedFuture.promise}hasPermissionsToPublish(U){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U))),!1;const{canPublish:j,canPublishSources:B}=this.permissions;return j&&(B.length===0||B.map(z=>getTrackSourceFromProto(z)).includes(U.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U))),!1)}publish(U,j,B){return __awaiter$1(this,void 0,void 0,function*(){var z,H,G,$,Q,W,X,ee,ie,ne;if(!this.hasPermissionsToPublish(U))throw new PublishTrackError("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(Pe=>isLocalTrack(U)&&Pe.source===U.source)&&U.source!==Track.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(U.source),Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U))),j.stopMicTrackOnMute&&isAudioTrack(U)&&(U.stopOnMute=!0),U.source===Track.Source.ScreenShare&&isFireFox()&&(j.simulcast=!1),j.videoCodec==="av1"&&!supportsAV1()&&(j.videoCodec=void 0),j.videoCodec==="vp9"&&!supportsVP9()&&(j.videoCodec=void 0),j.videoCodec===void 0&&(j.videoCodec=defaultVideoCodec),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(Pe=>j.videoCodec===mimeTypeToVideoCodecString(Pe.mime))||(j.videoCodec=mimeTypeToVideoCodecString(this.enabledPublishVideoCodecs[0].mime)));const se=j.videoCodec;U.on(TrackEvent.Muted,this.onTrackMuted),U.on(TrackEvent.Unmuted,this.onTrackUnmuted),U.on(TrackEvent.Ended,this.handleTrackEnded),U.on(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),U.on(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),U.on(TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const de=[],oe=!(!((z=j.dtx)!==null&&z!==void 0)||z),le=U.getSourceTrackSettings();le.autoGainControl&&de.push(AudioTrackFeature.TF_AUTO_GAIN_CONTROL),le.echoCancellation&&de.push(AudioTrackFeature.TF_ECHO_CANCELLATION),le.noiseSuppression&&de.push(AudioTrackFeature.TF_NOISE_SUPPRESSION),le.channelCount&&le.channelCount>1&&de.push(AudioTrackFeature.TF_STEREO),oe&&de.push(AudioTrackFeature.TF_NO_DTX),isLocalAudioTrack(U)&&U.hasPreConnectBuffer&&de.push(AudioTrackFeature.TF_PRECONNECT_BUFFER);const ue=new AddTrackRequest({cid:U.mediaStreamTrack.id,name:j.name,type:Track.kindToProto(U.kind),muted:U.isMuted,source:Track.sourceToProto(U.source),disableDtx:oe,encryption:this.encryptionType,stereo:B,disableRed:this.isE2EEEnabled||!(!((H=j.red)!==null&&H!==void 0)||H),stream:j?.stream,backupCodecPolicy:j?.backupCodecPolicy,audioFeatures:de});let fe;if(U.kind===Track.Kind.Video){let Pe={width:0,height:0};try{Pe=yield U.waitForDimensions()}catch{const Ce=($=(G=this.roomOptions.videoCaptureDefaults)===null||G===void 0?void 0:G.resolution)!==null&&$!==void 0?$:VideoPresets.h720.resolution;Pe={width:Ce.width,height:Ce.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U)),{dims:Pe}))}ue.width=Pe.width,ue.height=Pe.height,isLocalVideoTrack(U)&&(isSVCCodec(se)&&(U.source===Track.Source.ScreenShare&&(j.scalabilityMode="L1T3","contentHint"in U.mediaStreamTrack&&(U.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U))))),j.scalabilityMode=(Q=j.scalabilityMode)!==null&&Q!==void 0?Q:"L3T3_KEY"),ue.simulcastCodecs=[new SimulcastCodec({codec:se,cid:U.mediaStreamTrack.id})],j.backupCodec===!0&&(j.backupCodec={codec:defaultVideoCodec}),j.backupCodec&&se!==j.backupCodec.codec&&ue.encryption===Encryption_Type.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),ue.simulcastCodecs.push(new SimulcastCodec({codec:j.backupCodec.codec,cid:""})))),fe=computeVideoEncodings(U.source===Track.Source.ScreenShare,ue.width,ue.height,j),ue.layers=videoLayersFromEncodings(ue.width,ue.height,fe,isSVCCodec(j.videoCodec))}else U.kind===Track.Kind.Audio&&(fe=[{maxBitrate:(W=j.audioPreset)===null||W===void 0?void 0:W.maxBitrate,priority:(ee=(X=j.audioPreset)===null||X===void 0?void 0:X.priority)!==null&&ee!==void 0?ee:"high",networkPriority:(ne=(ie=j.audioPreset)===null||ie===void 0?void 0:ie.priority)!==null&&ne!==void 0?ne:"high"}]);if(!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const he=()=>__awaiter$1(this,void 0,void 0,function*(){var Pe,xe,Ce;if(!this.engine.pcManager)throw new UnexpectedConnectionState("pcManager is not ready");if(U.sender=yield this.engine.createSender(U,j,fe),this.emit(ParticipantEvent.LocalSenderCreated,U.sender,U),isLocalVideoTrack(U)&&((Pe=j.degradationPreference)!==null&&Pe!==void 0||(j.degradationPreference=getDefaultDegradationPreference(U)),U.setDegradationPreference(j.degradationPreference)),fe)if(isFireFox()&&U.kind===Track.Kind.Audio){let ze;for(const $e of this.engine.pcManager.publisher.getTransceivers())if($e.sender===U.sender){ze=$e;break}ze&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:ze,codec:"opus",maxbr:!((xe=fe[0])===null||xe===void 0)&&xe.maxBitrate?fe[0].maxBitrate/1e3:0})}else U.codec&&isSVCCodec(U.codec)&&(!((Ce=fe[0])===null||Ce===void 0)&&Ce.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:ue.cid,codec:U.codec,maxbr:fe[0].maxBitrate/1e3});yield this.engine.negotiate()});let ge;const Ae=new Promise((Pe,xe)=>__awaiter$1(this,void 0,void 0,function*(){var Ce;try{ge=yield this.engine.addTrack(ue),Pe(ge)}catch(ze){U.sender&&(!((Ce=this.engine.pcManager)===null||Ce===void 0)&&Ce.publisher)&&(this.engine.pcManager.publisher.removeTrack(U.sender),yield this.engine.negotiate().catch($e=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U)),{error:$e}))})),xe(ze)}}));if(this.enabledPublishVideoCodecs.length>0)ge=(yield Promise.all([Ae,he()]))[0];else{ge=yield Ae;let Pe;if(ge.codecs.forEach(xe=>{Pe===void 0&&(Pe=xe.mimeType)}),Pe&&U.kind===Track.Kind.Video){const xe=mimeTypeToVideoCodecString(Pe);xe!==se&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U)),{codec:xe})),j.videoCodec=xe,fe=computeVideoEncodings(U.source===Track.Source.ScreenShare,ue.width,ue.height,j))}yield he()}const _e=new LocalTrackPublication(U.kind,ge,U,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(_e.on(TrackEvent.CpuConstrained,Pe=>this.onTrackCpuConstrained(Pe,_e)),_e.options=j,U.sid=ge.sid,this.log.debug("publishing ".concat(U.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:fe,trackInfo:ge})),isLocalVideoTrack(U)?U.startMonitor(this.engine.client):isLocalAudioTrack(U)&&U.startMonitor(),this.addTrackPublication(_e),this.emit(ParticipantEvent.LocalTrackPublished,_e),isLocalAudioTrack(U)&&ge.audioFeatures.includes(AudioTrackFeature.TF_PRECONNECT_BUFFER)){const Pe=U.getPreConnectBuffer();this.on(ParticipantEvent.LocalTrackSubscribed,xe=>{if(xe.trackSid===ge.sid){if(!U.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U))),U.stopPreConnectBuffer()}}),Pe&&new Promise((Ce,ze)=>__awaiter$1(this,void 0,void 0,function*(){var $e,Fe,qe,be,Re,Be;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U)));const je=setTimeout(()=>{ze(new Error("agent not active within 10 seconds"))},1e4),Ue=yield this.waitUntilActiveAgentPresent();clearTimeout(je),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U)));const Ge=yield this.streamBytes({name:"preconnect-buffer",mimeType:"audio/opus",topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[Ue.identity],attributes:{trackId:_e.trackSid,sampleRate:String((Re=le.sampleRate)!==null&&Re!==void 0?Re:"48000"),channels:String((Be=le.channelCount)!==null&&Be!==void 0?Be:"1")}});try{for(var We=!0,pe=__asyncValues(Pe),we;we=yield pe.next(),$e=we.done,!$e;We=!0){be=we.value,We=!1;const He=be;yield Ge.write(He)}}catch(He){Fe={error:He}}finally{try{!We&&!$e&&(qe=pe.return)&&(yield qe.call(pe))}finally{if(Fe)throw Fe.error}}yield Ge.close(),Ce()}catch(je){ze(je)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U)))}).catch(Ce=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U)),{error:Ce}))})}return _e})}get isLocal(){return!0}publishAdditionalCodecForTrack(U,j,B){return __awaiter$1(this,void 0,void 0,function*(){var z;if(this.encryptionType!==Encryption_Type.NONE)return;let H;if(this.trackPublications.forEach(ne=>{ne.track&&ne.track===U&&(H=ne)}),!H)throw new TrackInvalidError("track is not published");if(!isLocalVideoTrack(U))throw new TrackInvalidError("track is not a video track");const G=Object.assign(Object.assign({},(z=this.roomOptions)===null||z===void 0?void 0:z.publishDefaults),B),$=computeTrackBackupEncodings(U,j,G);if(!$){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U)));return}const Q=U.addSimulcastTrack(j,$);if(!Q)return;const W=new AddTrackRequest({cid:Q.mediaStreamTrack.id,type:Track.kindToProto(U.kind),muted:U.isMuted,source:Track.sourceToProto(U.source),sid:U.sid,simulcastCodecs:[{codec:G.videoCodec,cid:Q.mediaStreamTrack.id}]});if(W.layers=videoLayersFromEncodings(W.width,W.height,$),!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const X=()=>__awaiter$1(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(U,Q,G,$),yield this.engine.negotiate()}),ie=(yield Promise.all([this.engine.addTrack(W),X()]))[0];this.log.debug("published ".concat(j," for track ").concat(U.sid),Object.assign(Object.assign({},this.logContext),{encodings:$,trackInfo:ie}))})}unpublishTrack(U,j){return __awaiter$1(this,void 0,void 0,function*(){var B,z;if(isLocalTrack(U)){const W=this.pendingPublishPromises.get(U);W&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U))),yield W)}const H=this.getPublicationForTrack(U),G=H?getLogContextFromTrack(H):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),G)),!H||!H.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),G));return}U=H.track,U.off(TrackEvent.Muted,this.onTrackMuted),U.off(TrackEvent.Unmuted,this.onTrackUnmuted),U.off(TrackEvent.Ended,this.handleTrackEnded),U.off(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),U.off(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),U.off(TrackEvent.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),j===void 0&&(j=(z=(B=this.roomOptions)===null||B===void 0?void 0:B.stopLocalTrackOnUnpublish)!==null&&z!==void 0?z:!0),j?U.stop():U.stopMonitor();let $=!1;const Q=U.sender;if(U.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<PCTransportState.FAILED&&Q)try{for(const W of this.engine.pcManager.publisher.getTransceivers())W.sender===Q&&(W.direction="inactive",$=!0);if(this.engine.removeTrack(Q)&&($=!0),isLocalVideoTrack(U)){for(const[,W]of U.simulcastCodecs)W.sender&&(this.engine.removeTrack(W.sender)&&($=!0),W.sender=void 0);U.simulcastCodecs.clear()}}catch(W){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),G),{error:W}))}switch(this.trackPublications.delete(H.trackSid),H.kind){case Track.Kind.Audio:this.audioTrackPublications.delete(H.trackSid);break;case Track.Kind.Video:this.videoTrackPublications.delete(H.trackSid);break}return this.emit(ParticipantEvent.LocalTrackUnpublished,H),H.setTrack(void 0),$&&(yield this.engine.negotiate()),H})}unpublishTracks(U){return __awaiter$1(this,void 0,void 0,function*(){return(yield Promise.all(U.map(B=>this.unpublishTrack(B)))).filter(B=>!!B)})}republishAllTracks(U){return __awaiter$1(this,arguments,void 0,function(j){var B=this;let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){B.republishPromise&&(yield B.republishPromise),B.republishPromise=new Promise((H,G)=>__awaiter$1(B,void 0,void 0,function*(){try{const $=[];this.trackPublications.forEach(Q=>{Q.track&&(j&&(Q.options=Object.assign(Object.assign({},Q.options),j)),$.push(Q))}),yield Promise.all($.map(Q=>__awaiter$1(this,void 0,void 0,function*(){const W=Q.track;yield this.unpublishTrack(W,!1),z&&!W.isMuted&&W.source!==Track.Source.ScreenShare&&W.source!==Track.Source.ScreenShareAudio&&(isLocalAudioTrack(W)||isLocalVideoTrack(W))&&!W.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:Q.trackSid})),yield W.restartTrack()),yield this.publishOrRepublishTrack(W,Q.options,!0)}))),H()}catch($){G($)}finally{this.republishPromise=void 0}})),yield B.republishPromise}()})}publishData(U){return __awaiter$1(this,arguments,void 0,function(j){var B=this;let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const H=z.reliable?DataPacket_Kind.RELIABLE:DataPacket_Kind.LOSSY,G=z.destinationIdentities,$=z.topic,Q=new DataPacket({kind:H,value:{case:"user",value:new UserPacket({participantIdentity:B.identity,payload:j,destinationIdentities:G,topic:$})}});yield B.engine.sendDataPacket(Q,H)}()})}publishDtmf(U,j){return __awaiter$1(this,void 0,void 0,function*(){const B=new DataPacket({kind:DataPacket_Kind.RELIABLE,value:{case:"sipDtmf",value:new SipDTMF({code:U,digit:j})}});yield this.engine.sendDataPacket(B,DataPacket_Kind.RELIABLE)})}sendChatMessage(U,j){return __awaiter$1(this,void 0,void 0,function*(){const B={id:crypto.randomUUID(),message:U,timestamp:Date.now(),attachedFiles:j?.attachments},z=new DataPacket({value:{case:"chatMessage",value:new ChatMessage(Object.assign(Object.assign({},B),{timestamp:protoInt64.parse(B.timestamp)}))}});return yield this.engine.sendDataPacket(z,DataPacket_Kind.RELIABLE),this.emit(ParticipantEvent.ChatMessage,B),B})}editChatMessage(U,j){return __awaiter$1(this,void 0,void 0,function*(){const B=Object.assign(Object.assign({},j),{message:U,editTimestamp:Date.now()}),z=new DataPacket({value:{case:"chatMessage",value:new ChatMessage(Object.assign(Object.assign({},B),{timestamp:protoInt64.parse(B.timestamp),editTimestamp:protoInt64.parse(B.editTimestamp)}))}});return yield this.engine.sendDataPacket(z,DataPacket_Kind.RELIABLE),this.emit(ParticipantEvent.ChatMessage,B),B})}sendText(U,j){return __awaiter$1(this,void 0,void 0,function*(){var B;const z=crypto.randomUUID(),G=new TextEncoder().encode(U).byteLength,$=(B=j?.attachments)===null||B===void 0?void 0:B.map(()=>crypto.randomUUID()),Q=new Array($?$.length+1:1).fill(0),W=(ee,ie)=>{var ne;Q[ie]=ee;const re=Q.reduce((se,de)=>se+de,0);(ne=j?.onProgress)===null||ne===void 0||ne.call(j,re)},X=yield this.streamText({streamId:z,totalSize:G,destinationIdentities:j?.destinationIdentities,topic:j?.topic,attachedStreamIds:$,attributes:j?.attributes});return yield X.write(U),W(1,0),yield X.close(),j?.attachments&&$&&(yield Promise.all(j.attachments.map((ee,ie)=>__awaiter$1(this,void 0,void 0,function*(){return this._sendFile($[ie],ee,{topic:j.topic,mimeType:ee.type,onProgress:ne=>{W(ne,ie+1)}})})))),X.info})}streamText(U){return __awaiter$1(this,void 0,void 0,function*(){var j,B;const z=(j=U?.streamId)!==null&&j!==void 0?j:crypto.randomUUID(),H={id:z,mimeType:"text/plain",timestamp:Date.now(),topic:(B=U?.topic)!==null&&B!==void 0?B:"",size:U?.totalSize,attributes:U?.attributes},G=new DataStream_Header({streamId:z,mimeType:H.mimeType,topic:H.topic,timestamp:numberToBigInt(H.timestamp),totalLength:numberToBigInt(U?.totalSize),attributes:H.attributes,contentHeader:{case:"textHeader",value:new DataStream_TextHeader({version:U?.version,attachedStreamIds:U?.attachedStreamIds,replyToStreamId:U?.replyToStreamId,operationType:U?.type==="update"?DataStream_OperationType.UPDATE:DataStream_OperationType.CREATE})}}),$=U?.destinationIdentities,Q=new DataPacket({destinationIdentities:$,value:{case:"streamHeader",value:G}});yield this.engine.sendDataPacket(Q,DataPacket_Kind.RELIABLE);let W=0;const X=this,ee=new WritableStream({write(re){return __awaiter$1(this,void 0,void 0,function*(){for(const se of splitUtf8(re,STREAM_CHUNK_SIZE)){yield X.engine.waitForBufferStatusLow(DataPacket_Kind.RELIABLE);const de=new DataStream_Chunk({content:se,streamId:z,chunkIndex:numberToBigInt(W)}),oe=new DataPacket({destinationIdentities:$,value:{case:"streamChunk",value:de}});yield X.engine.sendDataPacket(oe,DataPacket_Kind.RELIABLE),W+=1}})},close(){return __awaiter$1(this,void 0,void 0,function*(){const re=new DataStream_Trailer({streamId:z}),se=new DataPacket({destinationIdentities:$,value:{case:"streamTrailer",value:re}});yield X.engine.sendDataPacket(se,DataPacket_Kind.RELIABLE)})},abort(re){console.log("Sink error:",re)}});let ie=()=>__awaiter$1(this,void 0,void 0,function*(){yield ne.close()});X.engine.once(EngineEvent.Closing,ie);const ne=new TextStreamWriter(ee,H,()=>this.engine.off(EngineEvent.Closing,ie));return ne})}sendFile(U,j){return __awaiter$1(this,void 0,void 0,function*(){const B=crypto.randomUUID();return yield this._sendFile(B,U,j),{id:B}})}_sendFile(U,j,B){return __awaiter$1(this,void 0,void 0,function*(){var z;const H=yield this.streamBytes({streamId:U,totalSize:j.size,name:j.name,mimeType:(z=B?.mimeType)!==null&&z!==void 0?z:j.type,topic:B?.topic,destinationIdentities:B?.destinationIdentities}),G=j.stream().getReader();for(;;){const{done:$,value:Q}=yield G.read();if($)break;yield H.write(Q)}return yield H.close(),H.info})}streamBytes(U){return __awaiter$1(this,void 0,void 0,function*(){var j,B,z,H,G;const $=(j=U?.streamId)!==null&&j!==void 0?j:crypto.randomUUID(),Q=U?.destinationIdentities,W={id:$,mimeType:(B=U?.mimeType)!==null&&B!==void 0?B:"application/octet-stream",topic:(z=U?.topic)!==null&&z!==void 0?z:"",timestamp:Date.now(),attributes:U?.attributes,size:U?.totalSize,name:(H=U?.name)!==null&&H!==void 0?H:"unknown"},X=new DataStream_Header({totalLength:numberToBigInt((G=W.size)!==null&&G!==void 0?G:0),mimeType:W.mimeType,streamId:$,topic:W.topic,timestamp:numberToBigInt(Date.now()),attributes:W.attributes,contentHeader:{case:"byteHeader",value:new DataStream_ByteHeader({name:W.name})}}),ee=new DataPacket({destinationIdentities:Q,value:{case:"streamHeader",value:X}});yield this.engine.sendDataPacket(ee,DataPacket_Kind.RELIABLE);let ie=0;const ne=new _$1,re=this.engine,se=this.log,de=new WritableStream({write(le){return __awaiter$1(this,void 0,void 0,function*(){const ue=yield ne.lock();let fe=0;try{for(;fe<le.byteLength;){const he=le.slice(fe,fe+STREAM_CHUNK_SIZE);yield re.waitForBufferStatusLow(DataPacket_Kind.RELIABLE);const ge=new DataPacket({destinationIdentities:Q,value:{case:"streamChunk",value:new DataStream_Chunk({content:he,streamId:$,chunkIndex:numberToBigInt(ie)})}});yield re.sendDataPacket(ge,DataPacket_Kind.RELIABLE),ie+=1,fe+=he.byteLength}}finally{ue()}})},close(){return __awaiter$1(this,void 0,void 0,function*(){const le=new DataStream_Trailer({streamId:$}),ue=new DataPacket({destinationIdentities:Q,value:{case:"streamTrailer",value:le}});yield re.sendDataPacket(ue,DataPacket_Kind.RELIABLE)})},abort(le){se.error("Sink error:",le)}});return new ByteStreamWriter(de,W)})}performRpc(U){return __awaiter$1(this,arguments,void 0,function(j){var B=this;let{destinationIdentity:z,method:H,payload:G,responseTimeout:$=1e4}=j;return function*(){return new Promise((W,X)=>__awaiter$1(B,void 0,void 0,function*(){var ee,ie,ne,re;if(byteLength(G)>MAX_PAYLOAD_BYTES){X(RpcError.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((ie=(ee=this.engine.latestJoinResponse)===null||ee===void 0?void 0:ee.serverInfo)===null||ie===void 0)&&ie.version&&compareVersions((re=(ne=this.engine.latestJoinResponse)===null||ne===void 0?void 0:ne.serverInfo)===null||re===void 0?void 0:re.version,"1.8.0")<0){X(RpcError.builtIn("UNSUPPORTED_SERVER"));return}const se=crypto.randomUUID();yield this.publishRpcRequest(z,se,H,G,$-2e3);const de=setTimeout(()=>{this.pendingAcks.delete(se),X(RpcError.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(se),clearTimeout(oe)},2e3);this.pendingAcks.set(se,{resolve:()=>{clearTimeout(de)},participantIdentity:z});const oe=setTimeout(()=>{this.pendingResponses.delete(se),X(RpcError.builtIn("RESPONSE_TIMEOUT"))},$);this.pendingResponses.set(se,{resolve:(le,ue)=>{clearTimeout(oe),this.pendingAcks.has(se)&&(console.warn("RPC response received before ack",se),this.pendingAcks.delete(se),clearTimeout(de)),ue?X(ue):W(le??"")},participantIdentity:z})}))}()})}registerRpcMethod(U,j){this.rpcHandlers.has(U)&&this.log.warn("you're overriding the RPC handler for method ".concat(U,", in the future this will throw an error")),this.rpcHandlers.set(U,j)}unregisterRpcMethod(U){this.rpcHandlers.delete(U)}setTrackSubscriptionPermissions(U){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=j,this.allParticipantsAllowedToSubscribe=U,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(U){const j=this.pendingAcks.get(U);j?(j.resolve(),this.pendingAcks.delete(U)):console.error("Ack received for unexpected RPC request",U)}handleIncomingRpcResponse(U,j,B){const z=this.pendingResponses.get(U);z?(z.resolve(j,B),this.pendingResponses.delete(U)):console.error("Response received for unexpected RPC request",U)}publishRpcRequest(U,j,B,z,H){return __awaiter$1(this,void 0,void 0,function*(){const G=new DataPacket({destinationIdentities:[U],kind:DataPacket_Kind.RELIABLE,value:{case:"rpcRequest",value:new RpcRequest({id:j,method:B,payload:z,responseTimeoutMs:H,version:1})}});yield this.engine.sendDataPacket(G,DataPacket_Kind.RELIABLE)})}handleParticipantDisconnected(U){for(const[j,{participantIdentity:B}]of this.pendingAcks)B===U&&this.pendingAcks.delete(j);for(const[j,{participantIdentity:B,resolve:z}]of this.pendingResponses)B===U&&(z(null,RpcError.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(j))}setEnabledPublishCodecs(U){this.enabledPublishVideoCodecs=U.filter(j=>j.mime.split("/")[0].toLowerCase()==="video")}updateInfo(U){return super.updateInfo(U)?(U.tracks.forEach(j=>{var B,z;const H=this.trackPublications.get(j.sid);if(H){const G=H.isMuted||((z=(B=H.track)===null||B===void 0?void 0:B.isUpstreamPaused)!==null&&z!==void 0?z:!1);G!==j.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(H)),{mutedOnServer:G})),this.engine.client.sendMuteTrack(j.sid,G))}}),!0):!1}setActiveAgent(U){var j,B,z,H;this.firstActiveAgent=U,U&&!this.firstActiveAgent&&(this.firstActiveAgent=U),U?(B=(j=this.activeAgentFuture)===null||j===void 0?void 0:j.resolve)===null||B===void 0||B.call(j,U):(H=(z=this.activeAgentFuture)===null||z===void 0?void 0:z.reject)===null||H===void 0||H.call(z,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Future),this.activeAgentFuture.promise)}getPublicationForTrack(U){let j;return this.trackPublications.forEach(B=>{const z=B.track;z&&(U instanceof MediaStreamTrack?(isLocalAudioTrack(z)||isLocalVideoTrack(z))&&z.mediaStreamTrack===U&&(j=B):U===z&&(j=B))}),j}waitForPendingPublicationOfSource(U){return __awaiter$1(this,void 0,void 0,function*(){const B=Date.now();for(;Date.now()<B+1e4;){const z=Array.from(this.pendingPublishPromises.entries()).find(H=>{let[G]=H;return G.source===U});if(z)return z[1];yield sleep$1(20)}})}}class RemoteTrackPublication extends TrackPublication{constructor(U,j,B,z){super(U,j.sid,j.name,z),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=H=>{this.setTrack(void 0),this.emit(TrackEvent.Ended,H)},this.handleVisibilityChange=H=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(H),this.logContext),this.visible=H,this.emitTrackUpdate()},this.handleVideoDimensionsChange=H=>{this.log.debug("adaptivestream video dimensions ".concat(H.width,"x").concat(H.height),this.logContext),this.videoDimensionsAdaptiveStream=H,this.emitTrackUpdate()},this.subscribed=B,this.updateInfo(j)}setSubscribed(U){const j=this.subscriptionStatus,B=this.permissionStatus;this.subscribed=U,U&&(this.allowed=!0);const z=new UpdateSubscription({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new ParticipantTracks({participantSid:"",trackSids:[this.trackSid]})]});this.emit(TrackEvent.UpdateSubscription,z),this.emitSubscriptionUpdateIfChanged(j),this.emitPermissionUpdateIfChanged(B)}get subscriptionStatus(){return this.subscribed===!1?TrackPublication.SubscriptionStatus.Unsubscribed:super.isSubscribed?TrackPublication.SubscriptionStatus.Subscribed:TrackPublication.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?TrackPublication.PermissionStatus.Allowed:TrackPublication.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(U){!this.isManualOperationAllowed()||this.requestedDisabled===!U||(this.requestedDisabled=!U,this.emitTrackUpdate())}setVideoQuality(U){!this.isManualOperationAllowed()||this.requestedMaxQuality===U||(this.requestedMaxQuality=U,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(U){var j,B;this.isManualOperationAllowed()&&(((j=this.requestedVideoDimensions)===null||j===void 0?void 0:j.width)===U.width&&((B=this.requestedVideoDimensions)===null||B===void 0?void 0:B.height)===U.height||(isRemoteVideoTrack(this.track)&&(this.requestedVideoDimensions=U),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(U){this.isManualOperationAllowed()&&isRemoteVideoTrack(this.track)&&this.fps!==U&&(this.fps=U,this.emitTrackUpdate())}get videoQuality(){var U;return(U=this.requestedMaxQuality)!==null&&U!==void 0?U:VideoQuality.HIGH}setTrack(U){const j=this.subscriptionStatus,B=this.permissionStatus,z=this.track;z!==U&&(z&&(z.off(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),z.off(TrackEvent.VisibilityChanged,this.handleVisibilityChange),z.off(TrackEvent.Ended,this.handleEnded),z.detach(),z.stopMonitor(),this.emit(TrackEvent.Unsubscribed,z)),super.setTrack(U),U&&(U.sid=this.trackSid,U.on(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),U.on(TrackEvent.VisibilityChanged,this.handleVisibilityChange),U.on(TrackEvent.Ended,this.handleEnded),this.emit(TrackEvent.Subscribed,U)),this.emitPermissionUpdateIfChanged(B),this.emitSubscriptionUpdateIfChanged(j))}setAllowed(U){const j=this.subscriptionStatus,B=this.permissionStatus;this.allowed=U,this.emitPermissionUpdateIfChanged(B),this.emitSubscriptionUpdateIfChanged(j)}setSubscriptionError(U){this.emit(TrackEvent.SubscriptionFailed,U)}updateInfo(U){super.updateInfo(U);const j=this.metadataMuted;this.metadataMuted=U.muted,this.track?this.track.setMuted(U.muted):j!==U.muted&&this.emit(U.muted?TrackEvent.Muted:TrackEvent.Unmuted)}emitSubscriptionUpdateIfChanged(U){const j=this.subscriptionStatus;U!==j&&this.emit(TrackEvent.SubscriptionStatusChanged,j,U)}emitPermissionUpdateIfChanged(U){this.permissionStatus!==U&&this.emit(TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,U)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return isRemoteVideoTrack(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const U=new UpdateTrackSettings({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===Track.Kind.Video){let j=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(j)areDimensionsSmaller(this.videoDimensionsAdaptiveStream,j)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),j=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const B=layerDimensionsFor(this.trackInfo,this.requestedMaxQuality);B&&areDimensionsSmaller(this.videoDimensionsAdaptiveStream,B)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),j=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),j=this.videoDimensionsAdaptiveStream;j?(U.width=Math.ceil(j.width),U.height=Math.ceil(j.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),U.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:VideoQuality.HIGH})),U.quality=VideoQuality.HIGH)}this.emit(TrackEvent.UpdateSettings,U)}}class RemoteParticipant extends Participant{static fromParticipantInfo(U,j,B){return new RemoteParticipant(U,j.sid,j.identity,j.name,j.metadata,j.attributes,B,j.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(U,j,B,z,H,G,$){let Q=arguments.length>7&&arguments[7]!==void 0?arguments[7]:ParticipantInfo_Kind.STANDARD;super(j,B||"",z,H,G,$,Q),this.signalClient=U,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(U){super.addTrackPublication(U),U.on(TrackEvent.UpdateSettings,j=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(U)),{settings:j})),this.signalClient.sendUpdateTrackSettings(j)}),U.on(TrackEvent.UpdateSubscription,j=>{j.participantTracks.forEach(B=>{B.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(j)}),U.on(TrackEvent.SubscriptionPermissionChanged,j=>{this.emit(ParticipantEvent.TrackSubscriptionPermissionChanged,U,j)}),U.on(TrackEvent.SubscriptionStatusChanged,j=>{this.emit(ParticipantEvent.TrackSubscriptionStatusChanged,U,j)}),U.on(TrackEvent.Subscribed,j=>{this.emit(ParticipantEvent.TrackSubscribed,j,U)}),U.on(TrackEvent.Unsubscribed,j=>{this.emit(ParticipantEvent.TrackUnsubscribed,j,U)}),U.on(TrackEvent.SubscriptionFailed,j=>{this.emit(ParticipantEvent.TrackSubscriptionFailed,U.trackSid,j)})}getTrackPublication(U){const j=super.getTrackPublication(U);if(j)return j}getTrackPublicationByName(U){const j=super.getTrackPublicationByName(U);if(j)return j}setVolume(U){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Track.Source.Microphone;this.volumeMap.set(j,U);const B=this.getTrackPublication(j);B&&B.track&&B.track.setVolume(U)}getVolume(){let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Track.Source.Microphone;const j=this.getTrackPublication(U);return j&&j.track?j.track.getVolume():this.volumeMap.get(U)}addSubscribedMediaTrack(U,j,B,z,H,G){let $=this.getTrackPublicationBySid(j);if($||j.startsWith("TR")||this.trackPublications.forEach(X=>{!$&&U.kind===X.kind.toString()&&($=X)}),!$){if(G===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:j})),this.emit(ParticipantEvent.TrackSubscriptionFailed,j);return}G===void 0&&(G=20),setTimeout(()=>{this.addSubscribedMediaTrack(U,j,B,z,H,G-1)},150);return}if(U.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack($))),this.emit(ParticipantEvent.TrackSubscriptionFailed,j);return}const Q=U.kind==="video";let W;return Q?W=new RemoteVideoTrack(U,j,z,H):W=new RemoteAudioTrack(U,j,z,this.audioContext,this.audioOutput),W.source=$.source,W.isMuted=$.isMuted,W.setMediaStream(B),W.start(),$.setTrack(W),this.volumeMap.has($.source)&&isRemoteTrack(W)&&isAudioTrack(W)&&W.setVolume(this.volumeMap.get($.source)),$}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(U){return this.trackPublications.get(U)}updateInfo(U){if(!super.updateInfo(U))return!1;const j=new Map,B=new Map;return U.tracks.forEach(z=>{var H,G;let $=this.getTrackPublicationBySid(z.sid);if($)$.updateInfo(z);else{const Q=Track.kindFromProto(z.type);if(!Q)return;$=new RemoteTrackPublication(Q,z,(H=this.signalClient.connectOptions)===null||H===void 0?void 0:H.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(G=this.loggerOptions)===null||G===void 0?void 0:G.loggerName}),$.updateInfo(z),B.set(z.sid,$);const W=Array.from(this.trackPublications.values()).find(X=>X.source===$?.source);W&&$.source!==Track.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat($.source),Object.assign(Object.assign({},this.logContext),{oldTrack:getLogContextFromTrack(W),newTrack:getLogContextFromTrack($)})),this.addTrackPublication($)}j.set(z.sid,$)}),this.trackPublications.forEach(z=>{j.has(z.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),getLogContextFromTrack(z))),this.unpublishTrack(z.trackSid,!0))}),B.forEach(z=>{this.emit(ParticipantEvent.TrackPublished,z)}),!0}unpublishTrack(U,j){const B=this.trackPublications.get(U);if(!B)return;const{track:z}=B;switch(z&&(z.stop(),B.setTrack(void 0)),this.trackPublications.delete(U),B.kind){case Track.Kind.Audio:this.audioTrackPublications.delete(U);break;case Track.Kind.Video:this.videoTrackPublications.delete(U);break}j&&this.emit(ParticipantEvent.TrackUnpublished,B)}setAudioOutput(U){return __awaiter$1(this,void 0,void 0,function*(){this.audioOutput=U;const j=[];this.audioTrackPublications.forEach(B=>{var z;isAudioTrack(B.track)&&isRemoteTrack(B.track)&&j.push(B.track.setSinkId((z=U.deviceId)!==null&&z!==void 0?z:"default"))}),yield Promise.all(j)})}emit(U){for(var j=arguments.length,B=new Array(j>1?j-1:0),z=1;z<j;z++)B[z-1]=arguments[z];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:U,args:B})),super.emit(U,...B)}}var ConnectionState;(function(V){V.Disconnected="disconnected",V.Connecting="connecting",V.Connected="connected",V.Reconnecting="reconnecting",V.SignalReconnecting="signalReconnecting"})(ConnectionState||(ConnectionState={}));const connectionReconcileFrequency=4*1e3;class Room extends eventsExports.EventEmitter{constructor(U){var j,B,z,H;if(super(),j=this,this.state=ConnectionState.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=livekitLogger,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(G,$,Q)=>__awaiter$1(this,void 0,void 0,function*(){var W;if(!isBrowserSupported())throw isReactNative()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const X=yield this.disconnectLock.lock();if(this.state===ConnectionState.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),X(),Promise.resolve();if(this.connectFuture)return X(),this.connectFuture.promise;this.setAndEmitConnectionState(ConnectionState.Connecting),((W=this.regionUrlProvider)===null||W===void 0?void 0:W.getServerUrl().toString())!==G&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),isCloud(new URL(G))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new RegionUrlProvider(G,$):this.regionUrlProvider.updateToken($),this.regionUrlProvider.fetchRegionSettings().then(ne=>{var re;(re=this.regionUrlProvider)===null||re===void 0||re.setServerReportedRegions(ne)}).catch(ne=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:ne}))}));const ee=(ne,re,se)=>__awaiter$1(this,void 0,void 0,function*(){var de,oe;this.abortController&&this.abortController.abort();const le=new AbortController;this.abortController=le,X?.();try{yield this.attemptConnection(se??G,$,Q,le),this.abortController=void 0,ne()}catch(ue){if(this.regionUrlProvider&&ue instanceof ConnectionError&&ue.reason!==ConnectionErrorReason.Cancelled&&ue.reason!==ConnectionErrorReason.NotAllowed){let fe=null;try{fe=yield this.regionUrlProvider.getNextBestRegionUrl((de=this.abortController)===null||de===void 0?void 0:de.signal)}catch(he){if(he instanceof ConnectionError&&(he.status===401||he.reason===ConnectionErrorReason.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),re(he);return}}fe&&!(!((oe=this.abortController)===null||oe===void 0)&&oe.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(ue.message,". Retrying with another region: ").concat(fe),this.logContext),this.recreateEngine(),yield ee(ne,re,fe)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,getDisconnectReasonFromConnectionError(ue)),re(ue))}else{let fe=DisconnectReason.UNKNOWN_REASON;ue instanceof ConnectionError&&(fe=getDisconnectReasonFromConnectionError(ue)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,fe),re(ue)}}}),ie=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Future((ne,re)=>{ee(ne,re,ie)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(G,$,Q,W,X,ee)=>__awaiter$1(this,void 0,void 0,function*(){var ie,ne,re;const se=yield Q.join(G,$,{autoSubscribe:W.autoSubscribe,adaptiveStream:typeof X.adaptiveStream=="object"?!0:X.adaptiveStream,maxRetries:W.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:W.websocketTimeout},ee.signal);let de=se.serverInfo;if(de||(de={version:se.serverVersion,region:se.serverRegion}),this.serverInfo=de,this.log.debug("connected to Livekit Server ".concat(Object.entries(de).map(oe=>{let[le,ue]=oe;return"".concat(le,": ").concat(ue)}).join(", ")),{room:(ie=se.room)===null||ie===void 0?void 0:ie.name,roomSid:(ne=se.room)===null||ne===void 0?void 0:ne.sid,identity:(re=se.participant)===null||re===void 0?void 0:re.identity}),!de.version)throw new UnsupportedServer("unknown server version");return de.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),X.dynacast=!1),se}),this.applyJoinResponse=G=>{const $=G.participant;if(this.localParticipant.sid=$.sid,this.localParticipant.identity=$.identity,this.localParticipant.setEnabledPublishCodecs(G.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(G.sifTrailer)}catch(Q){this.log.error(Q instanceof Error?Q.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:Q}))}this.handleParticipantUpdates([$,...G.otherParticipants]),G.room&&this.handleRoomUpdate(G.room)},this.attemptConnection=(G,$,Q,W)=>__awaiter$1(this,void 0,void 0,function*(){var X,ee;this.state===ConnectionState.Reconnecting||this.isResuming||!((X=this.engine)===null||X===void 0)&&X.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((ee=this.regionUrlProvider)===null||ee===void 0)&&ee.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},roomConnectOptionDefaults),Q),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const ie=yield this.connectSignal(G,$,this.engine,this.connOptions,this.options,W);this.applyJoinResponse(ie),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected)}catch(ie){yield this.engine.close(),this.recreateEngine();const ne=new ConnectionError("could not establish signal connection",ConnectionErrorReason.ServerUnreachable);throw ie instanceof Error&&(ne.message="".concat(ne.message,": ").concat(ie.message)),ie instanceof ConnectionError&&(ne.reason=ie.reason,ne.status=ie.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:ie})),ne}if(W.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new ConnectionError("Connection attempt aborted",ConnectionErrorReason.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,W)}catch(ie){throw yield this.engine.close(),this.recreateEngine(),ie}isWeb()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),isWeb()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var G=arguments.length,$=new Array(G),Q=0;Q<G;Q++)$[Q]=arguments[Q];return __awaiter$1(j,[...$],void 0,function(){var W=this;let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var ee,ie,ne,re;const se=yield W.disconnectLock.lock();try{if(W.state===ConnectionState.Disconnected){W.log.debug("already disconnected",W.logContext);return}W.log.info("disconnect from room",Object.assign({},W.logContext)),(W.state===ConnectionState.Connecting||W.state===ConnectionState.Reconnecting||W.isResuming)&&(W.log.warn("abort connection attempt",W.logContext),(ee=W.abortController)===null||ee===void 0||ee.abort(),(ne=(ie=W.connectFuture)===null||ie===void 0?void 0:ie.reject)===null||ne===void 0||ne.call(ie,new ConnectionError("Client initiated disconnect",ConnectionErrorReason.Cancelled)),W.connectFuture=void 0),!((re=W.engine)===null||re===void 0)&&re.client.isDisconnected||(yield W.engine.client.sendLeave()),W.engine&&(yield W.engine.close()),W.handleDisconnect(X,DisconnectReason.CLIENT_INITIATED),W.engine=void 0}finally{se()}}()})},this.onPageLeave=()=>__awaiter$1(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>__awaiter$1(this,void 0,void 0,function*(){const G=[],$=getBrowser();if($&&$.os==="iOS"){const Q="livekit-dummy-audio-el";let W=document.getElementById(Q);if(!W){W=document.createElement("audio"),W.id=Q,W.autoplay=!0,W.hidden=!0;const X=getEmptyAudioStreamTrack();X.enabled=!0;const ee=new MediaStream([X]);W.srcObject=ee,document.addEventListener("visibilitychange",()=>{W&&(W.srcObject=document.hidden?null:ee,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(W),this.once(RoomEvent.Disconnected,()=>{W?.remove(),W=null})}G.push(W)}this.remoteParticipants.forEach(Q=>{Q.audioTrackPublications.forEach(W=>{W.track&&W.track.attachedElements.forEach(X=>{G.push(X)})})});try{yield Promise.all([this.acquireAudioContext(),...G.map(Q=>(Q.muted=!1,Q.play()))]),this.handleAudioPlaybackStarted()}catch(Q){throw this.handleAudioPlaybackFailed(Q),Q}}),this.startVideo=()=>__awaiter$1(this,void 0,void 0,function*(){const G=[];for(const $ of this.remoteParticipants.values())$.videoTrackPublications.forEach(Q=>{var W;(W=Q.track)===null||W===void 0||W.attachedElements.forEach(X=>{G.includes(X)||G.push(X)})});yield Promise.all(G.map($=>$.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch($=>{$.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const G of this.remoteParticipants.values())this.handleParticipantDisconnected(G.identity,G);this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)},this.handleSignalRestarted=G=>__awaiter$1(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(G.serverRegion),Object.assign(Object.assign({},this.logContext),{region:G.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(G);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch($){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:$}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:G.serverRegion}))}catch{return}this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=G=>{G.forEach($=>{var Q;if($.identity===this.localParticipant.identity){this.localParticipant.updateInfo($);return}$.identity===""&&($.identity=(Q=this.sidToIdentity.get($.sid))!==null&&Q!==void 0?Q:"");let W=this.remoteParticipants.get($.identity);$.state===ParticipantInfo_State.DISCONNECTED?this.handleParticipantDisconnected($.identity,W):W=this.getOrCreateParticipant($.identity,$)})},this.handleActiveSpeakersUpdate=G=>{const $=[],Q={};G.forEach(W=>{if(Q[W.sid]=!0,W.sid===this.localParticipant.sid)this.localParticipant.audioLevel=W.level,this.localParticipant.setIsSpeaking(!0),$.push(this.localParticipant);else{const X=this.getRemoteParticipantBySid(W.sid);X&&(X.audioLevel=W.level,X.setIsSpeaking(!0),$.push(X))}}),Q[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(W=>{Q[W.sid]||(W.audioLevel=0,W.setIsSpeaking(!1))}),this.activeSpeakers=$,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,$)},this.handleSpeakersChanged=G=>{const $=new Map;this.activeSpeakers.forEach(W=>{const X=this.remoteParticipants.get(W.identity);X&&X.sid!==W.sid||$.set(W.sid,W)}),G.forEach(W=>{let X=this.getRemoteParticipantBySid(W.sid);W.sid===this.localParticipant.sid&&(X=this.localParticipant),X&&(X.audioLevel=W.level,X.setIsSpeaking(W.active),W.active?$.set(W.sid,X):$.delete(W.sid))});const Q=Array.from($.values());Q.sort((W,X)=>X.audioLevel-W.audioLevel),this.activeSpeakers=Q,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,Q)},this.handleStreamStateUpdate=G=>{G.streamStates.forEach($=>{const Q=this.getRemoteParticipantBySid($.participantSid);if(!Q)return;const W=Q.getTrackPublicationBySid($.trackSid);if(!W||!W.track)return;const X=Track.streamStateFromProto($.state);X!==W.track.streamState&&(W.track.streamState=X,Q.emit(ParticipantEvent.TrackStreamStateChanged,W,W.track.streamState),this.emitWhenConnected(RoomEvent.TrackStreamStateChanged,W,W.track.streamState,Q))})},this.handleSubscriptionPermissionUpdate=G=>{const $=this.getRemoteParticipantBySid(G.participantSid);if(!$)return;const Q=$.getTrackPublicationBySid(G.trackSid);Q&&Q.setAllowed(G.allowed)},this.handleSubscriptionError=G=>{const $=Array.from(this.remoteParticipants.values()).find(W=>W.trackPublications.has(G.trackSid));if(!$)return;const Q=$.getTrackPublicationBySid(G.trackSid);Q&&Q.setSubscriptionError(G.err)},this.handleDataPacket=G=>{const $=this.remoteParticipants.get(G.participantIdentity);if(G.value.case==="user")this.handleUserPacket($,G.value.value,G.kind);else if(G.value.case==="transcription")this.handleTranscription($,G.value.value);else if(G.value.case==="sipDtmf")this.handleSipDtmf($,G.value.value);else if(G.value.case==="chatMessage")this.handleChatMessage($,G.value.value);else if(G.value.case==="metrics")this.handleMetrics(G.value.value,$);else if(G.value.case==="streamHeader")this.handleStreamHeader(G.value.value,G.participantIdentity);else if(G.value.case==="streamChunk")this.handleStreamChunk(G.value.value);else if(G.value.case==="streamTrailer")this.handleStreamTrailer(G.value.value);else if(G.value.case==="rpcRequest"){const Q=G.value.value;this.handleIncomingRpcRequest(G.participantIdentity,Q.id,Q.method,Q.payload,Q.responseTimeoutMs,Q.version)}},this.handleUserPacket=(G,$,Q)=>{this.emit(RoomEvent.DataReceived,$.payload,G,Q,$.topic),G?.emit(ParticipantEvent.DataReceived,$.payload,Q)},this.handleSipDtmf=(G,$)=>{this.emit(RoomEvent.SipDTMFReceived,$,G),G?.emit(ParticipantEvent.SipDTMFReceived,$)},this.bufferedSegments=new Map,this.handleTranscription=(G,$)=>{const Q=$.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity($.transcribedParticipantIdentity),W=Q?.trackPublications.get($.trackId),X=extractTranscriptionSegments($,this.transcriptionReceivedTimes);W?.emit(TrackEvent.TranscriptionReceived,X),Q?.emit(ParticipantEvent.TranscriptionReceived,X,W),this.emit(RoomEvent.TranscriptionReceived,X,Q,W)},this.handleChatMessage=(G,$)=>{const Q=extractChatMessage($);this.emit(RoomEvent.ChatMessage,Q,G)},this.handleMetrics=(G,$)=>{this.emit(RoomEvent.MetricsReceived,G,$)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(RoomEvent.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=G=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:G})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(RoomEvent.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(RoomEvent.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(RoomEvent.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>__awaiter$1(this,void 0,void 0,function*(){var G;((G=getBrowser())===null||G===void 0?void 0:G.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(RoomEvent.MediaDevicesChanged)}),this.handleRoomUpdate=G=>{const $=this.roomInfo;this.roomInfo=G,$&&$.metadata!==G.metadata&&this.emitWhenConnected(RoomEvent.RoomMetadataChanged,G.metadata),$?.activeRecording!==G.activeRecording&&this.emitWhenConnected(RoomEvent.RecordingStatusChanged,G.activeRecording)},this.handleConnectionQualityUpdate=G=>{G.updates.forEach($=>{if($.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality($.quality);return}const Q=this.getRemoteParticipantBySid($.participantSid);Q&&Q.setConnectionQuality($.quality)})},this.onLocalParticipantMetadataChanged=G=>{this.emit(RoomEvent.ParticipantMetadataChanged,G,this.localParticipant)},this.onLocalParticipantNameChanged=G=>{this.emit(RoomEvent.ParticipantNameChanged,G,this.localParticipant)},this.onLocalAttributesChanged=G=>{this.emit(RoomEvent.ParticipantAttributesChanged,G,this.localParticipant)},this.onLocalTrackMuted=G=>{this.emit(RoomEvent.TrackMuted,G,this.localParticipant)},this.onLocalTrackUnmuted=G=>{this.emit(RoomEvent.TrackUnmuted,G,this.localParticipant)},this.onTrackProcessorUpdate=G=>{var $;($=G?.onPublish)===null||$===void 0||$.call(G,this)},this.onLocalTrackPublished=G=>__awaiter$1(this,void 0,void 0,function*(){var $,Q,W,X,ee,ie;($=G.track)===null||$===void 0||$.on(TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),(Q=G.track)===null||Q===void 0||Q.on(TrackEvent.Restarted,this.onLocalTrackRestarted),(ee=(X=(W=G.track)===null||W===void 0?void 0:W.getProcessor())===null||X===void 0?void 0:X.onPublish)===null||ee===void 0||ee.call(X,this),this.emit(RoomEvent.LocalTrackPublished,G,this.localParticipant),isLocalAudioTrack(G.track)&&(yield G.track.checkForSilence())&&this.emit(RoomEvent.LocalAudioSilenceDetected,G);const ne=yield(ie=G.track)===null||ie===void 0?void 0:ie.getDeviceId(!1),re=sourceToKind(G.source);re&&ne&&ne!==this.localParticipant.activeDeviceMap.get(re)&&(this.localParticipant.activeDeviceMap.set(re,ne),this.emit(RoomEvent.ActiveDeviceChanged,re,ne))}),this.onLocalTrackUnpublished=G=>{var $,Q;($=G.track)===null||$===void 0||$.off(TrackEvent.TrackProcessorUpdate,this.onTrackProcessorUpdate),(Q=G.track)===null||Q===void 0||Q.off(TrackEvent.Restarted,this.onLocalTrackRestarted),this.emit(RoomEvent.LocalTrackUnpublished,G,this.localParticipant)},this.onLocalTrackRestarted=G=>__awaiter$1(this,void 0,void 0,function*(){const $=yield G.getDeviceId(!1),Q=sourceToKind(G.source);Q&&$&&$!==this.localParticipant.activeDeviceMap.get(Q)&&(this.log.debug("local track restarted, setting ".concat(Q," ").concat($," active"),this.logContext),this.localParticipant.activeDeviceMap.set(Q,$),this.emit(RoomEvent.ActiveDeviceChanged,Q,$))}),this.onLocalConnectionQualityChanged=G=>{this.emit(RoomEvent.ConnectionQualityChanged,G,this.localParticipant)},this.onMediaDevicesError=(G,$)=>{this.emit(RoomEvent.MediaDevicesError,G,$)},this.onLocalParticipantPermissionsChanged=G=>{this.emit(RoomEvent.ParticipantPermissionsChanged,G,this.localParticipant)},this.onLocalChatMessageSent=G=>{this.emit(RoomEvent.ChatMessage,G,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},roomOptionDefaults),U),this.log=getLogger((B=this.options.loggerName)!==null&&B!==void 0?B:LoggerNames.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},audioDefaults),U?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},videoDefaults),U?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},publishDefaults),U?.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new _$1,this.localParticipant=new LocalParticipant("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",unwrapConstraint(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",unwrapConstraint(this.options.audioCaptureDefaults.deviceId)),!((z=this.options.audioOutput)===null||z===void 0)&&z.deviceId&&this.switchActiveDevice("audiooutput",unwrapConstraint(this.options.audioOutput.deviceId)).catch(G=>this.log.warn("Could not set audio output: ".concat(G.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),isWeb()){const G=new AbortController;(H=navigator.mediaDevices)===null||H===void 0||H.addEventListener("devicechange",this.handleDeviceChange,{signal:G.signal}),Room.cleanupRegistry&&Room.cleanupRegistry.register(this,()=>{G.abort()})}}registerTextStreamHandler(U,j){if(this.textStreamHandlers.has(U))throw new TypeError('A text stream handler for topic "'.concat(U,'" has already been set.'));this.textStreamHandlers.set(U,j)}unregisterTextStreamHandler(U){this.textStreamHandlers.delete(U)}registerByteStreamHandler(U,j){if(this.byteStreamHandlers.has(U))throw new TypeError('A byte stream handler for topic "'.concat(U,'" has already been set.'));this.byteStreamHandlers.set(U,j)}unregisterByteStreamHandler(U){this.byteStreamHandlers.delete(U)}registerRpcMethod(U,j){if(this.rpcHandlers.has(U))throw Error("RPC handler already registered for method ".concat(U,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(U,j)}unregisterRpcMethod(U){this.rpcHandlers.delete(U)}handleIncomingRpcRequest(U,j,B,z,H,G){return __awaiter$1(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(U,j),G!==1){yield this.engine.publishRpcResponse(U,j,null,RpcError.builtIn("UNSUPPORTED_VERSION"));return}const $=this.rpcHandlers.get(B);if(!$){yield this.engine.publishRpcResponse(U,j,null,RpcError.builtIn("UNSUPPORTED_METHOD"));return}let Q=null,W=null;try{const X=yield $({requestId:j,callerIdentity:U,payload:z,responseTimeout:H});byteLength(X)>MAX_PAYLOAD_BYTES?(Q=RpcError.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(B))):W=X}catch(X){X instanceof RpcError?Q=X:(console.warn("Uncaught error returned by RPC handler for ".concat(B,". Returning APPLICATION_ERROR instead."),X),Q=RpcError.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(U,j,W,Q)})}setE2EEEnabled(U){return __awaiter$1(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(U)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(U,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var U;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new E2EEManager(this.options.e2ee),this.e2eeManager.on(EncryptionEvent.ParticipantEncryptionStatusChanged,(j,B)=>{isLocalParticipant(B)&&(this.isE2EEEnabled=j),this.emit(RoomEvent.ParticipantEncryptionStatusChanged,j,B)}),this.e2eeManager.on(EncryptionEvent.EncryptionError,j=>this.emit(RoomEvent.EncryptionError,j)),(U=this.e2eeManager)===null||U===void 0||U.setup(this))}get logContext(){var U;return{room:this.name,roomID:(U=this.roomInfo)===null||U===void 0?void 0:U.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var U,j;return(j=(U=this.roomInfo)===null||U===void 0?void 0:U.activeRecording)!==null&&j!==void 0?j:!1}getSid(){return __awaiter$1(this,void 0,void 0,function*(){return this.state===ConnectionState.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((U,j)=>{const B=z=>{z.sid!==""&&(this.engine.off(EngineEvent.RoomUpdate,B),U(z.sid))};this.engine.on(EngineEvent.RoomUpdate,B),this.once(RoomEvent.Disconnected,()=>{this.engine.off(EngineEvent.RoomUpdate,B),j("Room disconnected before room server id was available")})})})}get name(){var U,j;return(j=(U=this.roomInfo)===null||U===void 0?void 0:U.name)!==null&&j!==void 0?j:""}get metadata(){var U;return(U=this.roomInfo)===null||U===void 0?void 0:U.metadata}get numParticipants(){var U,j;return(j=(U=this.roomInfo)===null||U===void 0?void 0:U.numParticipants)!==null&&j!==void 0?j:0}get numPublishers(){var U,j;return(j=(U=this.roomInfo)===null||U===void 0?void 0:U.numPublishers)!==null&&j!==void 0?j:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new RTCEngine(this.options),this.engine.on(EngineEvent.ParticipantUpdate,this.handleParticipantUpdates).on(EngineEvent.RoomUpdate,this.handleRoomUpdate).on(EngineEvent.SpeakersChanged,this.handleSpeakersChanged).on(EngineEvent.StreamStateChanged,this.handleStreamStateUpdate).on(EngineEvent.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(EngineEvent.SubscriptionError,this.handleSubscriptionError).on(EngineEvent.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(EngineEvent.MediaTrackAdded,(U,j,B)=>{this.onTrackAdded(U,j,B)}).on(EngineEvent.Disconnected,U=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,U)}).on(EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(EngineEvent.DataPacketReceived,this.handleDataPacket).on(EngineEvent.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ConnectionState.SignalReconnecting)&&this.emit(RoomEvent.SignalReconnecting)}).on(EngineEvent.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ConnectionState.Connected)&&this.emit(RoomEvent.Reconnected)}).on(EngineEvent.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ConnectionState.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(EngineEvent.Restarting,this.handleRestarting).on(EngineEvent.SignalRestarted,this.handleSignalRestarted).on(EngineEvent.Offline,()=>{this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)}).on(EngineEvent.DCBufferStatusChanged,(U,j)=>{this.emit(RoomEvent.DCBufferStatusChanged,U,j)}).on(EngineEvent.LocalTrackSubscribed,U=>{const j=this.localParticipant.getTrackPublications().find(B=>{let{trackSid:z}=B;return z===U});if(!j){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ParticipantEvent.LocalTrackSubscribed,j),this.emitWhenConnected(RoomEvent.LocalTrackSubscribed,j,this.localParticipant)}).on(EngineEvent.RoomMoved,U=>{this.log.debug("room moved",U),U.room&&this.handleRoomUpdate(U.room),this.remoteParticipants.forEach((j,B)=>{this.handleParticipantDisconnected(B,j)}),this.emit(RoomEvent.Moved,U.room.name),U.participant?this.handleParticipantUpdates([U.participant,...U.otherParticipants]):this.handleParticipantUpdates(U.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(U){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return DeviceManager.getInstance().getDevices(U,j)}prepareConnection(U,j){return __awaiter$1(this,void 0,void 0,function*(){if(this.state===ConnectionState.Disconnected){this.log.debug("prepareConnection to ".concat(U),this.logContext);try{if(isCloud(new URL(U))&&j){this.regionUrlProvider=new RegionUrlProvider(U,j);const B=yield this.regionUrlProvider.getNextBestRegionUrl();B&&this.state===ConnectionState.Disconnected&&(this.regionUrl=B,yield fetch(toHttpUrl(B),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(B),this.logContext))}else yield fetch(toHttpUrl(U),{method:"HEAD"})}catch(B){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:B}))}}})}getParticipantByIdentity(U){return this.localParticipant.identity===U?this.localParticipant:this.remoteParticipants.get(U)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(U,j){return __awaiter$1(this,void 0,void 0,function*(){let B=()=>{},z;switch(U){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":z=new SimulateScenario({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":z=new SimulateScenario({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":z=new SimulateScenario({scenario:{case:"serverLeave",value:!0}});break;case"migration":z=new SimulateScenario({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":B=()=>__awaiter$1(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),z=new SimulateScenario({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":B=()=>__awaiter$1(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),z=new SimulateScenario({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":z=new SimulateScenario({scenario:{case:"switchCandidateProtocol",value:U==="force-tls"?2:1}}),B=()=>__awaiter$1(this,void 0,void 0,function*(){const H=this.engine.client.onLeave;H&&H(new LeaveRequest({reason:DisconnectReason.CLIENT_INITIATED,action:LeaveRequest_Action.RECONNECT}))});break;case"subscriber-bandwidth":if(j===void 0||typeof j!="number")throw new Error("subscriber-bandwidth requires a number as argument");z=new SimulateScenario({scenario:{case:"subscriberBandwidth",value:numberToBigInt(j)}});break;case"leave-full-reconnect":z=new SimulateScenario({scenario:{case:"leaveRequestFullReconnect",value:!0}})}z&&(yield this.engine.client.sendSimulateScenario(z),yield B())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(U){return this.localParticipant.activeDeviceMap.get(U)}switchActiveDevice(U,j){return __awaiter$1(this,arguments,void 0,function(B,z){var H=this;let G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var $,Q,W,X,ee,ie,ne;let re=!0,se=!1;const de=G?{exact:z}:z;if(B==="audioinput"){se=H.localParticipant.audioTrackPublications.size===0;const oe=($=H.getActiveDevice(B))!==null&&$!==void 0?$:H.options.audioCaptureDefaults.deviceId;H.options.audioCaptureDefaults.deviceId=de;const le=Array.from(H.localParticipant.audioTrackPublications.values()).filter(fe=>fe.source===Track.Source.Microphone);try{re=(yield Promise.all(le.map(fe=>{var he;return(he=fe.audioTrack)===null||he===void 0?void 0:he.setDeviceId(de)}))).every(fe=>fe===!0)}catch(fe){throw H.options.audioCaptureDefaults.deviceId=oe,fe}const ue=le.some(fe=>{var he,ge;return(ge=(he=fe.track)===null||he===void 0?void 0:he.isMuted)!==null&&ge!==void 0?ge:!1});re&&ue&&(se=!0)}else if(B==="videoinput"){se=H.localParticipant.videoTrackPublications.size===0;const oe=(Q=H.getActiveDevice(B))!==null&&Q!==void 0?Q:H.options.videoCaptureDefaults.deviceId;H.options.videoCaptureDefaults.deviceId=de;const le=Array.from(H.localParticipant.videoTrackPublications.values()).filter(fe=>fe.source===Track.Source.Camera);try{re=(yield Promise.all(le.map(fe=>{var he;return(he=fe.videoTrack)===null||he===void 0?void 0:he.setDeviceId(de)}))).every(fe=>fe===!0)}catch(fe){throw H.options.videoCaptureDefaults.deviceId=oe,fe}const ue=le.some(fe=>{var he,ge;return(ge=(he=fe.track)===null||he===void 0?void 0:he.isMuted)!==null&&ge!==void 0?ge:!1});re&&ue&&(se=!0)}else if(B==="audiooutput"){if(se=!0,!supportsSetSinkId()&&!H.options.webAudioMix||H.options.webAudioMix&&H.audioContext&&!("setSinkId"in H.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");H.options.webAudioMix&&(z=(W=yield DeviceManager.getInstance().normalizeDeviceId("audiooutput",z))!==null&&W!==void 0?W:""),(X=(ne=H.options).audioOutput)!==null&&X!==void 0||(ne.audioOutput={});const oe=(ee=H.getActiveDevice(B))!==null&&ee!==void 0?ee:H.options.audioOutput.deviceId;H.options.audioOutput.deviceId=z;try{H.options.webAudioMix&&((ie=H.audioContext)===null||ie===void 0||ie.setSinkId(z)),yield Promise.all(Array.from(H.remoteParticipants.values()).map(le=>le.setAudioOutput({deviceId:z})))}catch(le){throw H.options.audioOutput.deviceId=oe,le}}return se&&(H.localParticipant.activeDeviceMap.set(B,z),H.emit(RoomEvent.ActiveDeviceChanged,B,z)),re}()})}setupLocalParticipantEvents(){this.localParticipant.on(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).on(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(ParticipantEvent.AudioStreamAcquired,this.startAudio).on(ParticipantEvent.ChatMessage,this.onLocalChatMessageSent).on(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var U;(U=this.engine)===null||U===void 0||U.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(U,j,B){if(this.state===ConnectionState.Connecting||this.state===ConnectionState.Reconnecting){const X=()=>{this.onTrackAdded(U,j,B),ee()},ee=()=>{this.off(RoomEvent.Reconnected,X),this.off(RoomEvent.Connected,X),this.off(RoomEvent.Disconnected,ee)};this.once(RoomEvent.Reconnected,X),this.once(RoomEvent.Connected,X),this.once(RoomEvent.Disconnected,ee);return}if(this.state===ConnectionState.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(U.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const z=unpackStreamId(j.id),H=z[0];let G=z[1],$=U.id;if(G&&G.startsWith("TR")&&($=G),H===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const Q=Array.from(this.remoteParticipants.values()).find(X=>X.sid===H);if(!Q){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(H),this.logContext);return}let W;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?W=this.options.adaptiveStream:W={}),Q.addSubscribedMediaTrack(U,$,j,B,W)}handleDisconnect(){let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,j=arguments.length>1?arguments[1]:void 0;var B;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==ConnectionState.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(z=>{z.trackPublications.forEach(H=>{z.unpublishTrack(H.trackSid)})}),this.localParticipant.trackPublications.forEach(z=>{var H,G,$;z.track&&this.localParticipant.unpublishTrack(z.track,U),U?((H=z.track)===null||H===void 0||H.detach(),(G=z.track)===null||G===void 0||G.stop()):($=z.track)===null||$===void 0||$.stopMonitor()}),this.localParticipant.off(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ParticipantEvent.AttributesChanged,this.onLocalAttributesChanged).off(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(ParticipantEvent.AudioStreamAcquired,this.startAudio).off(ParticipantEvent.ChatMessage,this.onLocalChatMessageSent).off(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),isWeb()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(B=navigator.mediaDevices)===null||B===void 0||B.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ConnectionState.Disconnected),this.emit(RoomEvent.Disconnected,j)}}}handleParticipantDisconnected(U,j){var B;this.remoteParticipants.delete(U),j&&(j.trackPublications.forEach(z=>{j.unpublishTrack(z.trackSid,!0)}),this.emit(RoomEvent.ParticipantDisconnected,j),j.setDisconnected(),(B=this.localParticipant)===null||B===void 0||B.handleParticipantDisconnected(j.identity))}handleStreamHeader(U,j){return __awaiter$1(this,void 0,void 0,function*(){var B;if(U.contentHeader.case==="byteHeader"){const z=this.byteStreamHandlers.get(U.topic);if(!z){this.log.debug("ignoring incoming byte stream due to no handler for topic",U.topic);return}let H;const G={id:U.streamId,name:(B=U.contentHeader.value.name)!==null&&B!==void 0?B:"unknown",mimeType:U.mimeType,size:U.totalLength?Number(U.totalLength):void 0,topic:U.topic,timestamp:bigIntToNumber(U.timestamp),attributes:U.attributes},$=new ReadableStream({start:Q=>{H=Q,this.byteStreamControllers.set(U.streamId,{info:G,controller:H,startTime:Date.now()})}});z(new ByteStreamReader(G,$,bigIntToNumber(U.totalLength)),{identity:j})}else if(U.contentHeader.case==="textHeader"){const z=this.textStreamHandlers.get(U.topic);if(!z){this.log.debug("ignoring incoming text stream due to no handler for topic",U.topic);return}let H;const G={id:U.streamId,mimeType:U.mimeType,size:U.totalLength?Number(U.totalLength):void 0,topic:U.topic,timestamp:Number(U.timestamp),attributes:U.attributes},$=new ReadableStream({start:Q=>{H=Q,this.textStreamControllers.set(U.streamId,{info:G,controller:H,startTime:Date.now()})}});z(new TextStreamReader(G,$,bigIntToNumber(U.totalLength)),{identity:j})}})}handleStreamChunk(U){const j=this.byteStreamControllers.get(U.streamId);j&&U.content.length>0&&j.controller.enqueue(U);const B=this.textStreamControllers.get(U.streamId);B&&U.content.length>0&&B.controller.enqueue(U)}handleStreamTrailer(U){const j=this.textStreamControllers.get(U.streamId);j&&(j.info.attributes=Object.assign(Object.assign({},j.info.attributes),U.attributes),j.controller.close(),this.textStreamControllers.delete(U.streamId));const B=this.byteStreamControllers.get(U.streamId);B&&(B.info.attributes=Object.assign(Object.assign({},B.info.attributes),U.attributes),B.controller.close(),this.byteStreamControllers.delete(U.streamId))}selectDefaultDevices(){return __awaiter$1(this,void 0,void 0,function*(){var U,j,B;const z=DeviceManager.getInstance().previousDevices,H=yield DeviceManager.getInstance().getDevices(void 0,!1),G=getBrowser();if(G?.name==="Chrome"&&G.os!=="iOS")for(let Q of H){const W=z.find(X=>X.deviceId===Q.deviceId);W&&W.label!==""&&W.kind===Q.kind&&W.label!==Q.label&&this.getActiveDevice(Q.kind)==="default"&&this.emit(RoomEvent.ActiveDeviceChanged,Q.kind,Q.deviceId)}const $=["audiooutput","audioinput","videoinput"];for(let Q of $){const W=kindToSource(Q),X=this.localParticipant.getTrackPublication(W);if(X&&(!((U=X.track)===null||U===void 0)&&U.isUserProvided))continue;const ee=H.filter(ne=>ne.kind===Q),ie=this.getActiveDevice(Q);if(ie===((j=z.filter(ne=>ne.kind===Q)[0])===null||j===void 0?void 0:j.deviceId)&&ee.length>0&&((B=ee[0])===null||B===void 0?void 0:B.deviceId)!==ie){yield this.switchActiveDevice(Q,ee[0].deviceId);continue}Q==="audioinput"&&!isSafariBased()||Q==="videoinput"||ee.length>0&&!ee.find(ne=>ne.deviceId===this.getActiveDevice(Q))&&(Q!=="audiooutput"||!isSafariBased())&&(yield this.switchActiveDevice(Q,ee[0].deviceId))}})}acquireAudioContext(){return __awaiter$1(this,void 0,void 0,function*(){var U,j;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(U=getNewAudioContext())!==null&&U!==void 0?U:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(z=>z.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),sleep$1(200)])}catch(z){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:z}))}const B=((j=this.audioContext)===null||j===void 0?void 0:j.state)==="running";B!==this.canPlaybackAudio&&(this.audioEnabled=B,this.emit(RoomEvent.AudioPlaybackStatusChanged,B))})}createParticipant(U,j){var B;let z;return j?z=RemoteParticipant.fromParticipantInfo(this.engine.client,j,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):z=new RemoteParticipant(this.engine.client,"",U,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&z.setAudioContext(this.audioContext),!((B=this.options.audioOutput)===null||B===void 0)&&B.deviceId&&z.setAudioOutput(this.options.audioOutput).catch(H=>this.log.warn("Could not set audio output: ".concat(H.message),this.logContext)),z}getOrCreateParticipant(U,j){if(this.remoteParticipants.has(U)){const z=this.remoteParticipants.get(U);return j&&z.updateInfo(j)&&this.sidToIdentity.set(j.sid,j.identity),z}const B=this.createParticipant(U,j);return this.remoteParticipants.set(U,B),this.sidToIdentity.set(j.sid,j.identity),this.emitWhenConnected(RoomEvent.ParticipantConnected,B),B.on(ParticipantEvent.TrackPublished,z=>{this.emitWhenConnected(RoomEvent.TrackPublished,z,B)}).on(ParticipantEvent.TrackSubscribed,(z,H)=>{z.kind===Track.Kind.Audio?(z.on(TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),z.on(TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):z.kind===Track.Kind.Video&&(z.on(TrackEvent.VideoPlaybackFailed,this.handleVideoPlaybackFailed),z.on(TrackEvent.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(RoomEvent.TrackSubscribed,z,H,B)}).on(ParticipantEvent.TrackUnpublished,z=>{this.emit(RoomEvent.TrackUnpublished,z,B)}).on(ParticipantEvent.TrackUnsubscribed,(z,H)=>{this.emit(RoomEvent.TrackUnsubscribed,z,H,B)}).on(ParticipantEvent.TrackMuted,z=>{this.emitWhenConnected(RoomEvent.TrackMuted,z,B)}).on(ParticipantEvent.TrackUnmuted,z=>{this.emitWhenConnected(RoomEvent.TrackUnmuted,z,B)}).on(ParticipantEvent.ParticipantMetadataChanged,z=>{this.emitWhenConnected(RoomEvent.ParticipantMetadataChanged,z,B)}).on(ParticipantEvent.ParticipantNameChanged,z=>{this.emitWhenConnected(RoomEvent.ParticipantNameChanged,z,B)}).on(ParticipantEvent.AttributesChanged,z=>{this.emitWhenConnected(RoomEvent.ParticipantAttributesChanged,z,B)}).on(ParticipantEvent.ConnectionQualityChanged,z=>{this.emitWhenConnected(RoomEvent.ConnectionQualityChanged,z,B)}).on(ParticipantEvent.ParticipantPermissionsChanged,z=>{this.emitWhenConnected(RoomEvent.ParticipantPermissionsChanged,z,B)}).on(ParticipantEvent.TrackSubscriptionStatusChanged,(z,H)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionStatusChanged,z,H,B)}).on(ParticipantEvent.TrackSubscriptionFailed,(z,H)=>{this.emit(RoomEvent.TrackSubscriptionFailed,z,B,H)}).on(ParticipantEvent.TrackSubscriptionPermissionChanged,(z,H)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionPermissionChanged,z,H,B)}).on(ParticipantEvent.Active,()=>{this.emitWhenConnected(RoomEvent.ParticipantActive,B),B.kind===ParticipantInfo_Kind.AGENT&&this.localParticipant.setActiveAgent(B)}),j&&B.updateInfo(j),B}sendSyncState(){const U=Array.from(this.remoteParticipants.values()).reduce((B,z)=>(B.push(...z.getTrackPublications()),B),[]),j=this.localParticipant.getTrackPublications();this.engine.sendSyncState(U,j)}updateSubscriptions(){for(const U of this.remoteParticipants.values())for(const j of U.videoTrackPublications.values())j.isSubscribed&&isRemotePub(j)&&j.emitTrackUpdate()}getRemoteParticipantBySid(U){const j=this.sidToIdentity.get(U);if(j)return this.remoteParticipants.get(j)}registerConnectionReconcile(){this.clearConnectionReconcile();let U=0;this.connectionReconcileInterval=CriticalTimers.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(U++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:U,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),U>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,DisconnectReason.STATE_MISMATCH))):U=0},connectionReconcileFrequency)}clearConnectionReconcile(){this.connectionReconcileInterval&&CriticalTimers.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(U){return U===this.state?!1:(this.state=U,this.emit(RoomEvent.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(U=>{let[j,B]=U;this.emit(j,...B)}),this.bufferedEvents=[]}emitWhenConnected(U){for(var j=arguments.length,B=new Array(j>1?j-1:0),z=1;z<j;z++)B[z-1]=arguments[z];if(this.state===ConnectionState.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([U,B]);else if(this.state===ConnectionState.Connected)return this.emit(U,...B);return!1}simulateParticipants(U){return __awaiter$1(this,void 0,void 0,function*(){var j,B;const z=Object.assign({audio:!0,video:!0,useRealTracks:!1},U.publish),H=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},U.participants);if(this.handleDisconnect(),this.roomInfo=new Room$1({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:protoInt64.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new ParticipantInfo({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected),this.emit(RoomEvent.Connected),this.setAndEmitConnectionState(ConnectionState.Connected),z.video){const G=new LocalTrackPublication(Track.Kind.Video,new TrackInfo({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO,name:"video-dummy"}),new LocalVideoTrack(z.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:createDummyVideoStreamTrack(160*((j=H.aspectRatios[0])!==null&&j!==void 0?j:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(G),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,G)}if(z.audio){const G=new LocalTrackPublication(Track.Kind.Audio,new TrackInfo({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO}),new LocalAudioTrack(z.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:getEmptyAudioStreamTrack(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(G),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,G)}for(let G=0;G<H.count-1;G+=1){let $=new ParticipantInfo({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(G),state:ParticipantInfo_State.ACTIVE,tracks:[],joinedAt:protoInt64.parse(Date.now())});const Q=this.getOrCreateParticipant($.identity,$);if(H.video){const W=createDummyVideoStreamTrack(160*((B=H.aspectRatios[G%H.aspectRatios.length])!==null&&B!==void 0?B:1),160,!1,!0),X=new TrackInfo({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});Q.addSubscribedMediaTrack(W,X.sid,new MediaStream([W]),new RTCRtpReceiver),$.tracks=[...$.tracks,X]}if(H.audio){const W=getEmptyAudioStreamTrack(),X=new TrackInfo({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});Q.addSubscribedMediaTrack(W,X.sid,new MediaStream([W]),new RTCRtpReceiver),$.tracks=[...$.tracks,X]}Q.updateInfo($)}})}emit(U){for(var j=arguments.length,B=new Array(j>1?j-1:0),z=1;z<j;z++)B[z-1]=arguments[z];if(U!==RoomEvent.ActiveSpeakersChanged&&U!==RoomEvent.TranscriptionReceived){const H=mapArgs(B).filter(G=>G!==void 0);this.log.debug("room event ".concat(U),Object.assign(Object.assign({},this.logContext),{event:U,args:H}))}return super.emit(U,...B)}}Room.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(V=>{V()});function mapArgs(V){return V.map(U=>{if(U)return Array.isArray(U)?mapArgs(U):typeof U=="object"?"logContext"in U?U.logContext:void 0:U})}var CheckStatus;(function(V){V[V.IDLE=0]="IDLE",V[V.RUNNING=1]="RUNNING",V[V.SKIPPED=2]="SKIPPED",V[V.SUCCESS=3]="SUCCESS",V[V.FAILED=4]="FAILED"})(CheckStatus||(CheckStatus={}));class Checker extends eventsExports.EventEmitter{constructor(U,j){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=CheckStatus.IDLE,this.logs=[],this.options={},this.url=U,this.token=j,this.name=this.constructor.name,this.room=new Room(B.roomOptions),this.connectOptions=B.connectOptions,this.options=B}run(U){return __awaiter$1(this,void 0,void 0,function*(){if(this.status!==CheckStatus.IDLE)throw Error("check is running already");this.setStatus(CheckStatus.RUNNING);try{yield this.perform()}catch(j){j instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(j.message):this.appendError(j.message))}return yield this.disconnect(),yield new Promise(j=>setTimeout(j,500)),this.status!==CheckStatus.SKIPPED&&this.setStatus(this.isSuccess()?CheckStatus.SUCCESS:CheckStatus.FAILED),U&&U(),this.getInfo()})}isSuccess(){return!this.logs.some(U=>U.level==="error")}connect(U){return __awaiter$1(this,void 0,void 0,function*(){return this.room.state===ConnectionState.Connected?this.room:(U||(U=this.url),yield this.room.connect(U,this.token,this.connectOptions),this.room)})}disconnect(){return __awaiter$1(this,void 0,void 0,function*(){this.room&&this.room.state!==ConnectionState.Disconnected&&(yield this.room.disconnect(),yield new Promise(U=>setTimeout(U,500)))})}skip(){this.setStatus(CheckStatus.SKIPPED)}switchProtocol(U){return __awaiter$1(this,void 0,void 0,function*(){let j=!1,B=!1;if(this.room.on(RoomEvent.Reconnecting,()=>{j=!0}),this.room.once(RoomEvent.Reconnected,()=>{B=!0}),this.room.simulateScenario("force-".concat(U)),yield new Promise(H=>setTimeout(H,1e3)),!j)return;const z=Date.now()+1e4;for(;Date.now()<z;){if(B)return;yield sleep$1(100)}throw new Error("Could not reconnect using ".concat(U," protocol after 10 seconds"))})}appendMessage(U){this.logs.push({level:"info",message:U}),this.emit("update",this.getInfo())}appendWarning(U){this.logs.push({level:"warning",message:U}),this.emit("update",this.getInfo())}appendError(U){this.logs.push({level:"error",message:U}),this.emit("update",this.getInfo())}setStatus(U){this.status=U,this.emit("update",this.getInfo())}get engine(){var U;return(U=this.room)===null||U===void 0?void 0:U.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class CloudRegionCheck extends Checker{get description(){return"Cloud regions"}perform(){return __awaiter$1(this,void 0,void 0,function*(){const U=new RegionUrlProvider(this.url,this.token);if(!U.isCloud()){this.skip();return}const j=[],B=new Set;for(let H=0;H<3;H++){const G=yield U.getNextBestRegionUrl();if(!G)break;if(B.has(G))continue;B.add(G);const $=yield this.checkCloudRegion(G);this.appendMessage("".concat($.region," RTT: ").concat($.rtt,"ms, duration: ").concat($.duration,"ms")),j.push($)}j.sort((H,G)=>(H.duration-G.duration)*.5+(H.rtt-G.rtt)*.5);const z=j[0];this.bestStats=z,this.appendMessage("best Cloud region: ".concat(z.region))})}getInfo(){const U=super.getInfo();return U.data=this.bestStats,U}checkCloudRegion(U){return __awaiter$1(this,void 0,void 0,function*(){var j,B;yield this.connect(U),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const z=(j=this.room.serverInfo)===null||j===void 0?void 0:j.region;if(!z)throw new Error("Region not found");const H=yield this.room.localParticipant.streamText({topic:"test"}),G=1e3,Q=1e6/G,W="A".repeat(G),X=Date.now();for(let re=0;re<Q;re++)yield H.write(W);yield H.close();const ee=Date.now(),ie=yield(B=this.room.engine.pcManager)===null||B===void 0?void 0:B.publisher.getStats(),ne={region:z,rtt:1e4,duration:ee-X};return ie?.forEach(re=>{re.type==="candidate-pair"&&re.nominated&&(ne.rtt=re.currentRoundTripTime*1e3)}),yield this.disconnect(),ne})}}const TEST_DURATION=1e4;class ConnectionProtocolCheck extends Checker{get description(){return"Connection via UDP vs TCP"}perform(){return __awaiter$1(this,void 0,void 0,function*(){const U=yield this.checkConnectionProtocol("udp"),j=yield this.checkConnectionProtocol("tcp");this.bestStats=U,U.qualityLimitationDurations.bandwidth-j.qualityLimitationDurations.bandwidth>.5||(U.packetsLost-j.packetsLost)/U.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=j):this.appendMessage("best connection quality via udp");const B=this.bestStats;this.appendMessage("upstream bitrate: ".concat((B.bitrateTotal/B.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((B.rttTotal/B.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((B.jitterTotal/B.count*1e3).toFixed(2)," ms")),B.packetsLost>0&&this.appendWarning("packets lost: ".concat((B.packetsLost/B.packetsSent*100).toFixed(2),"%")),B.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((B.qualityLimitationDurations.bandwidth/(TEST_DURATION/1e3)*100).toFixed(2),"%")),B.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((B.qualityLimitationDurations.cpu/(TEST_DURATION/1e3)*100).toFixed(2),"%"))})}getInfo(){const U=super.getInfo();return U.data=this.bestStats,U}checkConnectionProtocol(U){return __awaiter$1(this,void 0,void 0,function*(){yield this.connect(),U==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const j=document.createElement("canvas");j.width=1280,j.height=720;const B=j.getContext("2d");if(!B)throw new Error("Could not get canvas context");let z=0;const H=()=>{z=(z+1)%360,B.fillStyle="hsl(".concat(z,", 100%, 50%)"),B.fillRect(0,0,j.width,j.height),requestAnimationFrame(H)};H();const $=j.captureStream(30).getVideoTracks()[0],W=(yield this.room.localParticipant.publishTrack($,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,X={protocol:U,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},ee=setInterval(()=>__awaiter$1(this,void 0,void 0,function*(){const ie=yield W.getRTCStatsReport();ie?.forEach(ne=>{ne.type==="outbound-rtp"?(X.packetsSent=ne.packetsSent,X.qualityLimitationDurations=ne.qualityLimitationDurations,X.bitrateTotal+=ne.targetBitrate,X.count++):ne.type==="remote-inbound-rtp"&&(X.packetsLost=ne.packetsLost,X.rttTotal+=ne.roundTripTime,X.jitterTotal+=ne.jitter)})}),1e3);return yield new Promise(ie=>setTimeout(ie,TEST_DURATION)),clearInterval(ee),$.stop(),j.remove(),yield this.disconnect(),X})}}class PublishAudioCheck extends Checker{get description(){return"Can publish audio"}perform(){return __awaiter$1(this,void 0,void 0,function*(){var U;const j=yield this.connect(),B=yield createLocalAudioTrack();if(yield detectSilence(B,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),j.localParticipant.publishTrack(B),yield new Promise($=>setTimeout($,3e3));const H=yield(U=B.sender)===null||U===void 0?void 0:U.getStats();if(!H)throw new Error("Could not get RTCStats");let G=0;if(H.forEach($=>{$.type==="outbound-rtp"&&($.kind==="audio"||!$.kind&&$.mediaType==="audio")&&(G=$.packetsSent)}),G===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(G," audio packets"))})}}class PublishVideoCheck extends Checker{get description(){return"Can publish video"}perform(){return __awaiter$1(this,void 0,void 0,function*(){var U;const j=yield this.connect(),B=yield createLocalVideoTrack();yield this.checkForVideo(B.mediaStreamTrack),j.localParticipant.publishTrack(B),yield new Promise(G=>setTimeout(G,5e3));const z=yield(U=B.sender)===null||U===void 0?void 0:U.getStats();if(!z)throw new Error("Could not get RTCStats");let H=0;if(z.forEach(G=>{G.type==="outbound-rtp"&&(G.kind==="video"||!G.kind&&G.mediaType==="video")&&(H+=G.packetsSent)}),H===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(H," video packets"))})}checkForVideo(U){return __awaiter$1(this,void 0,void 0,function*(){const j=new MediaStream;j.addTrack(U.clone());const B=document.createElement("video");B.srcObject=j,B.muted=!0,yield new Promise(z=>{B.onplay=()=>{setTimeout(()=>{var H,G,$,Q;const W=document.createElement("canvas"),X=U.getSettings(),ee=(G=(H=X.width)!==null&&H!==void 0?H:B.videoWidth)!==null&&G!==void 0?G:1280,ie=(Q=($=X.height)!==null&&$!==void 0?$:B.videoHeight)!==null&&Q!==void 0?Q:720;W.width=ee,W.height=ie;const ne=W.getContext("2d");ne.drawImage(B,0,0);const se=ne.getImageData(0,0,W.width,W.height).data;let de=!0;for(let oe=0;oe<se.length;oe+=4)if(se[oe]!==0||se[oe+1]!==0||se[oe+2]!==0){de=!1;break}de?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),z()},1e3)},B.play()}),j.getTracks().forEach(z=>z.stop()),B.remove()})}}class ReconnectCheck extends Checker{get description(){return"Resuming connection after interruption"}perform(){return __awaiter$1(this,void 0,void 0,function*(){var U;const j=yield this.connect();let B=!1,z=!1,H;const G=new Promise(W=>{setTimeout(W,5e3),H=W}),$=()=>{B=!0};j.on(RoomEvent.SignalReconnecting,$).on(RoomEvent.Reconnecting,$).on(RoomEvent.Reconnected,()=>{z=!0,H(!0)}),(U=j.engine.client.ws)===null||U===void 0||U.close();const Q=j.engine.client.onClose;if(Q&&Q(""),yield G,B){if(!z||j.state!==ConnectionState.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class TURNCheck extends Checker{get description(){return"Can connect via TURN"}perform(){return __awaiter$1(this,void 0,void 0,function*(){var U,j;const B=new SignalClient,z=yield B.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let H=!1,G=!1,$=!1;for(let Q of z.iceServers)for(let W of Q.urls)W.startsWith("turn:")?(G=!0,$=!0):W.startsWith("turns:")&&(G=!0,$=!0,H=!0),W.startsWith("stun:")&&($=!0);$?G&&!H&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield B.close(),!((j=(U=this.connectOptions)===null||U===void 0?void 0:U.rtcConfig)===null||j===void 0)&&j.iceServers||G?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(Q=>setTimeout(Q,0)))})}}class WebRTCCheck extends Checker{get description(){return"Establishing WebRTC connection"}perform(){return __awaiter$1(this,void 0,void 0,function*(){let U=!1,j=!1;this.room.on(RoomEvent.SignalConnected,()=>{const B=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(z,H)=>{if(z.candidate){const G=new RTCIceCandidate(z);let $="".concat(G.protocol," ").concat(G.address,":").concat(G.port," ").concat(G.type);G.address&&(isIPPrivate(G.address)?$+=" (private)":G.protocol==="tcp"&&G.tcpType==="passive"?(U=!0,$+=" (passive)"):G.protocol==="udp"&&(j=!0)),this.appendMessage($)}B&&B(z,H)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=z=>{z instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(z.errorCode," ").concat(z.errorText," ").concat(z.url))})});try{yield this.connect(),livekitLogger.info("now the room is connected")}catch(B){throw this.appendWarning("ports need to be open on firewall in order to connect."),B}U||this.appendWarning("Server is not configured for ICE/TCP"),j||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function isIPPrivate(V){const U=V.split(".");if(U.length===4){if(U[0]==="10")return!0;if(U[0]==="192"&&U[1]==="168")return!0;if(U[0]==="172"){const j=parseInt(U[1],10);if(j>=16&&j<=31)return!0}}return!1}class WebSocketCheck extends Checker{get description(){return"Connecting to signal connection via WebSocket"}perform(){return __awaiter$1(this,void 0,void 0,function*(){var U,j,B;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let z=new SignalClient;const H=yield z.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(H.serverVersion,".")),((U=H.serverInfo)===null||U===void 0?void 0:U.edition)===ServerInfo_Edition.Cloud&&(!((j=H.serverInfo)===null||j===void 0)&&j.region)&&this.appendMessage("LiveKit Cloud: ".concat((B=H.serverInfo)===null||B===void 0?void 0:B.region)),yield z.close()})}}class ConnectionCheck extends eventsExports.EventEmitter{constructor(U,j){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=U,this.token=j,this.options=B}getNextCheckId(){const U=this.checkResults.size;return this.checkResults.set(U,{logs:[],status:CheckStatus.IDLE,name:"",description:""}),U}updateCheck(U,j){this.checkResults.set(U,j),this.emit("checkUpdate",U,j)}isSuccess(){return Array.from(this.checkResults.values()).every(U=>U.status!==CheckStatus.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(U){return __awaiter$1(this,void 0,void 0,function*(){const j=this.getNextCheckId(),B=new U(this.url,this.token,this.options),z=G=>{this.updateCheck(j,G)};B.on("update",z);const H=yield B.run();return B.off("update",z),H})}checkWebsocket(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(WebSocketCheck)})}checkWebRTC(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(WebRTCCheck)})}checkTURN(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(TURNCheck)})}checkReconnect(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(ReconnectCheck)})}checkPublishAudio(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishAudioCheck)})}checkPublishVideo(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(PublishVideoCheck)})}checkConnectionProtocol(){return __awaiter$1(this,void 0,void 0,function*(){const U=yield this.createAndRunCheck(ConnectionProtocolCheck);if(U.data&&"protocol"in U.data){const j=U.data;this.options.protocol=j.protocol}return U})}checkCloudRegion(){return __awaiter$1(this,void 0,void 0,function*(){return this.createAndRunCheck(CloudRegionCheck)})}}var src={exports:{}},indexLight={exports:{}},indexMinimal={},minimal={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;hasRequiredAspromise=1,aspromise=V;function V(U,j){for(var B=new Array(arguments.length-1),z=0,H=2,G=!0;H<arguments.length;)B[z++]=arguments[H++];return new Promise(function(Q,W){B[z]=function(ee){if(G)if(G=!1,ee)W(ee);else{for(var ie=new Array(arguments.length-1),ne=0;ne<ie.length;)ie[ne++]=arguments[ne];Q.apply(null,ie)}};try{U.apply(j||null,B)}catch(X){G&&(G=!1,W(X))}})}return aspromise}var base64={},hasRequiredBase64;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(V){var U=V;U.length=function($){var Q=$.length;if(!Q)return 0;for(var W=0;--Q%4>1&&$.charAt(Q)==="=";)++W;return Math.ceil($.length*3)/4-W};for(var j=new Array(64),B=new Array(123),z=0;z<64;)B[j[z]=z<26?z+65:z<52?z+71:z<62?z-4:z-59|43]=z++;U.encode=function($,Q,W){for(var X=null,ee=[],ie=0,ne=0,re;Q<W;){var se=$[Q++];switch(ne){case 0:ee[ie++]=j[se>>2],re=(se&3)<<4,ne=1;break;case 1:ee[ie++]=j[re|se>>4],re=(se&15)<<2,ne=2;break;case 2:ee[ie++]=j[re|se>>6],ee[ie++]=j[se&63],ne=0;break}ie>8191&&((X||(X=[])).push(String.fromCharCode.apply(String,ee)),ie=0)}return ne&&(ee[ie++]=j[re],ee[ie++]=61,ne===1&&(ee[ie++]=61)),X?(ie&&X.push(String.fromCharCode.apply(String,ee.slice(0,ie))),X.join("")):String.fromCharCode.apply(String,ee.slice(0,ie))};var H="invalid encoding";U.decode=function($,Q,W){for(var X=W,ee=0,ie,ne=0;ne<$.length;){var re=$.charCodeAt(ne++);if(re===61&&ee>1)break;if((re=B[re])===void 0)throw Error(H);switch(ee){case 0:ie=re,ee=1;break;case 1:Q[W++]=ie<<2|(re&48)>>4,ie=re,ee=2;break;case 2:Q[W++]=(ie&15)<<4|(re&60)>>2,ie=re,ee=3;break;case 3:Q[W++]=(ie&3)<<6|re,ee=0;break}}if(ee===1)throw Error(H);return W-X},U.test=function($){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test($)}}(base64)),base64}var eventemitter,hasRequiredEventemitter;function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;hasRequiredEventemitter=1,eventemitter=V;function V(){this._listeners={}}return V.prototype.on=function(j,B,z){return(this._listeners[j]||(this._listeners[j]=[])).push({fn:B,ctx:z||this}),this},V.prototype.off=function(j,B){if(j===void 0)this._listeners={};else if(B===void 0)this._listeners[j]=[];else for(var z=this._listeners[j],H=0;H<z.length;)z[H].fn===B?z.splice(H,1):++H;return this},V.prototype.emit=function(j){var B=this._listeners[j];if(B){for(var z=[],H=1;H<arguments.length;)z.push(arguments[H++]);for(H=0;H<B.length;)B[H].fn.apply(B[H++].ctx,z)}return this},eventemitter}var float,hasRequiredFloat;function requireFloat(){if(hasRequiredFloat)return float;hasRequiredFloat=1,float=V(V);function V(H){return typeof Float32Array<"u"?function(){var G=new Float32Array([-0]),$=new Uint8Array(G.buffer),Q=$[3]===128;function W(ne,re,se){G[0]=ne,re[se]=$[0],re[se+1]=$[1],re[se+2]=$[2],re[se+3]=$[3]}function X(ne,re,se){G[0]=ne,re[se]=$[3],re[se+1]=$[2],re[se+2]=$[1],re[se+3]=$[0]}H.writeFloatLE=Q?W:X,H.writeFloatBE=Q?X:W;function ee(ne,re){return $[0]=ne[re],$[1]=ne[re+1],$[2]=ne[re+2],$[3]=ne[re+3],G[0]}function ie(ne,re){return $[3]=ne[re],$[2]=ne[re+1],$[1]=ne[re+2],$[0]=ne[re+3],G[0]}H.readFloatLE=Q?ee:ie,H.readFloatBE=Q?ie:ee}():function(){function G(Q,W,X,ee){var ie=W<0?1:0;if(ie&&(W=-W),W===0)Q(1/W>0?0:2147483648,X,ee);else if(isNaN(W))Q(2143289344,X,ee);else if(W>34028234663852886e22)Q((ie<<31|2139095040)>>>0,X,ee);else if(W<11754943508222875e-54)Q((ie<<31|Math.round(W/1401298464324817e-60))>>>0,X,ee);else{var ne=Math.floor(Math.log(W)/Math.LN2),re=Math.round(W*Math.pow(2,-ne)*8388608)&8388607;Q((ie<<31|ne+127<<23|re)>>>0,X,ee)}}H.writeFloatLE=G.bind(null,U),H.writeFloatBE=G.bind(null,j);function $(Q,W,X){var ee=Q(W,X),ie=(ee>>31)*2+1,ne=ee>>>23&255,re=ee&8388607;return ne===255?re?NaN:ie*(1/0):ne===0?ie*1401298464324817e-60*re:ie*Math.pow(2,ne-150)*(re+8388608)}H.readFloatLE=$.bind(null,B),H.readFloatBE=$.bind(null,z)}(),typeof Float64Array<"u"?function(){var G=new Float64Array([-0]),$=new Uint8Array(G.buffer),Q=$[7]===128;function W(ne,re,se){G[0]=ne,re[se]=$[0],re[se+1]=$[1],re[se+2]=$[2],re[se+3]=$[3],re[se+4]=$[4],re[se+5]=$[5],re[se+6]=$[6],re[se+7]=$[7]}function X(ne,re,se){G[0]=ne,re[se]=$[7],re[se+1]=$[6],re[se+2]=$[5],re[se+3]=$[4],re[se+4]=$[3],re[se+5]=$[2],re[se+6]=$[1],re[se+7]=$[0]}H.writeDoubleLE=Q?W:X,H.writeDoubleBE=Q?X:W;function ee(ne,re){return $[0]=ne[re],$[1]=ne[re+1],$[2]=ne[re+2],$[3]=ne[re+3],$[4]=ne[re+4],$[5]=ne[re+5],$[6]=ne[re+6],$[7]=ne[re+7],G[0]}function ie(ne,re){return $[7]=ne[re],$[6]=ne[re+1],$[5]=ne[re+2],$[4]=ne[re+3],$[3]=ne[re+4],$[2]=ne[re+5],$[1]=ne[re+6],$[0]=ne[re+7],G[0]}H.readDoubleLE=Q?ee:ie,H.readDoubleBE=Q?ie:ee}():function(){function G(Q,W,X,ee,ie,ne){var re=ee<0?1:0;if(re&&(ee=-ee),ee===0)Q(0,ie,ne+W),Q(1/ee>0?0:2147483648,ie,ne+X);else if(isNaN(ee))Q(0,ie,ne+W),Q(2146959360,ie,ne+X);else if(ee>17976931348623157e292)Q(0,ie,ne+W),Q((re<<31|2146435072)>>>0,ie,ne+X);else{var se;if(ee<22250738585072014e-324)se=ee/5e-324,Q(se>>>0,ie,ne+W),Q((re<<31|se/4294967296)>>>0,ie,ne+X);else{var de=Math.floor(Math.log(ee)/Math.LN2);de===1024&&(de=1023),se=ee*Math.pow(2,-de),Q(se*4503599627370496>>>0,ie,ne+W),Q((re<<31|de+1023<<20|se*1048576&1048575)>>>0,ie,ne+X)}}}H.writeDoubleLE=G.bind(null,U,0,4),H.writeDoubleBE=G.bind(null,j,4,0);function $(Q,W,X,ee,ie){var ne=Q(ee,ie+W),re=Q(ee,ie+X),se=(re>>31)*2+1,de=re>>>20&2047,oe=4294967296*(re&1048575)+ne;return de===2047?oe?NaN:se*(1/0):de===0?se*5e-324*oe:se*Math.pow(2,de-1075)*(oe+4503599627370496)}H.readDoubleLE=$.bind(null,B,0,4),H.readDoubleBE=$.bind(null,z,4,0)}(),H}function U(H,G,$){G[$]=H&255,G[$+1]=H>>>8&255,G[$+2]=H>>>16&255,G[$+3]=H>>>24}function j(H,G,$){G[$]=H>>>24,G[$+1]=H>>>16&255,G[$+2]=H>>>8&255,G[$+3]=H&255}function B(H,G){return(H[G]|H[G+1]<<8|H[G+2]<<16|H[G+3]<<24)>>>0}function z(H,G){return(H[G]<<24|H[G+1]<<16|H[G+2]<<8|H[G+3])>>>0}return float}var inquire_1,hasRequiredInquire;function requireInquire(){if(hasRequiredInquire)return inquire_1;hasRequiredInquire=1,inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(V){}return null}return inquire_1}var utf8={},hasRequiredUtf8;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(V){var U=V;U.length=function(B){for(var z=0,H=0,G=0;G<B.length;++G)H=B.charCodeAt(G),H<128?z+=1:H<2048?z+=2:(H&64512)===55296&&(B.charCodeAt(G+1)&64512)===56320?(++G,z+=4):z+=3;return z},U.read=function(B,z,H){var G=H-z;if(G<1)return"";for(var $=null,Q=[],W=0,X;z<H;)X=B[z++],X<128?Q[W++]=X:X>191&&X<224?Q[W++]=(X&31)<<6|B[z++]&63:X>239&&X<365?(X=((X&7)<<18|(B[z++]&63)<<12|(B[z++]&63)<<6|B[z++]&63)-65536,Q[W++]=55296+(X>>10),Q[W++]=56320+(X&1023)):Q[W++]=(X&15)<<12|(B[z++]&63)<<6|B[z++]&63,W>8191&&(($||($=[])).push(String.fromCharCode.apply(String,Q)),W=0);return $?(W&&$.push(String.fromCharCode.apply(String,Q.slice(0,W))),$.join("")):String.fromCharCode.apply(String,Q.slice(0,W))},U.write=function(B,z,H){for(var G=H,$,Q,W=0;W<B.length;++W)$=B.charCodeAt(W),$<128?z[H++]=$:$<2048?(z[H++]=$>>6|192,z[H++]=$&63|128):($&64512)===55296&&((Q=B.charCodeAt(W+1))&64512)===56320?($=65536+(($&1023)<<10)+(Q&1023),++W,z[H++]=$>>18|240,z[H++]=$>>12&63|128,z[H++]=$>>6&63|128,z[H++]=$&63|128):(z[H++]=$>>12|224,z[H++]=$>>6&63|128,z[H++]=$&63|128);return H-G}}(utf8)),utf8}var pool_1,hasRequiredPool;function requirePool(){if(hasRequiredPool)return pool_1;hasRequiredPool=1,pool_1=V;function V(U,j,B){var z=B||8192,H=z>>>1,G=null,$=z;return function(W){if(W<1||W>H)return U(W);$+W>z&&(G=U(z),$=0);var X=j.call(G,$,$+=W);return $&7&&($=($|7)+1),X}}return pool_1}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=U;var V=requireMinimal();function U(H,G){this.lo=H>>>0,this.hi=G>>>0}var j=U.zero=new U(0,0);j.toNumber=function(){return 0},j.zzEncode=j.zzDecode=function(){return this},j.length=function(){return 1};var B=U.zeroHash="\0\0\0\0\0\0\0\0";U.fromNumber=function(G){if(G===0)return j;var $=G<0;$&&(G=-G);var Q=G>>>0,W=(G-Q)/4294967296>>>0;return $&&(W=~W>>>0,Q=~Q>>>0,++Q>4294967295&&(Q=0,++W>4294967295&&(W=0))),new U(Q,W)},U.from=function(G){if(typeof G=="number")return U.fromNumber(G);if(V.isString(G))if(V.Long)G=V.Long.fromString(G);else return U.fromNumber(parseInt(G,10));return G.low||G.high?new U(G.low>>>0,G.high>>>0):j},U.prototype.toNumber=function(G){if(!G&&this.hi>>>31){var $=~this.lo+1>>>0,Q=~this.hi>>>0;return $||(Q=Q+1>>>0),-($+Q*4294967296)}return this.lo+this.hi*4294967296},U.prototype.toLong=function(G){return V.Long?new V.Long(this.lo|0,this.hi|0,!!G):{low:this.lo|0,high:this.hi|0,unsigned:!!G}};var z=String.prototype.charCodeAt;return U.fromHash=function(G){return G===B?j:new U((z.call(G,0)|z.call(G,1)<<8|z.call(G,2)<<16|z.call(G,3)<<24)>>>0,(z.call(G,4)|z.call(G,5)<<8|z.call(G,6)<<16|z.call(G,7)<<24)>>>0)},U.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},U.prototype.zzEncode=function(){var G=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^G)>>>0,this.lo=(this.lo<<1^G)>>>0,this},U.prototype.zzDecode=function(){var G=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^G)>>>0,this.hi=(this.hi>>>1^G)>>>0,this},U.prototype.length=function(){var G=this.lo,$=(this.lo>>>28|this.hi<<4)>>>0,Q=this.hi>>>24;return Q===0?$===0?G<16384?G<128?1:2:G<2097152?3:4:$<16384?$<128?5:6:$<2097152?7:8:Q<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(V){var U=V;U.asPromise=requireAspromise(),U.base64=requireBase64(),U.EventEmitter=requireEventemitter(),U.float=requireFloat(),U.inquire=requireInquire(),U.utf8=requireUtf8(),U.pool=requirePool(),U.LongBits=requireLongbits(),U.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),U.global=U.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||minimal,U.emptyArray=Object.freeze?Object.freeze([]):[],U.emptyObject=Object.freeze?Object.freeze({}):{},U.isInteger=Number.isInteger||function(H){return typeof H=="number"&&isFinite(H)&&Math.floor(H)===H},U.isString=function(H){return typeof H=="string"||H instanceof String},U.isObject=function(H){return H&&typeof H=="object"},U.isset=U.isSet=function(H,G){var $=H[G];return $!=null&&H.hasOwnProperty(G)?typeof $!="object"||(Array.isArray($)?$.length:Object.keys($).length)>0:!1},U.Buffer=function(){try{var z=U.inquire("buffer").Buffer;return z.prototype.utf8Write?z:null}catch{return null}}(),U._Buffer_from=null,U._Buffer_allocUnsafe=null,U.newBuffer=function(H){return typeof H=="number"?U.Buffer?U._Buffer_allocUnsafe(H):new U.Array(H):U.Buffer?U._Buffer_from(H):typeof Uint8Array>"u"?H:new Uint8Array(H)},U.Array=typeof Uint8Array<"u"?Uint8Array:Array,U.Long=U.global.dcodeIO&&U.global.dcodeIO.Long||U.global.Long||U.inquire("long"),U.key2Re=/^true|false|0|1$/,U.key32Re=/^-?(?:0|[1-9][0-9]*)$/,U.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,U.longToHash=function(H){return H?U.LongBits.from(H).toHash():U.LongBits.zeroHash},U.longFromHash=function(H,G){var $=U.LongBits.fromHash(H);return U.Long?U.Long.fromBits($.lo,$.hi,G):$.toNumber(!!G)};function j(z,H,G){for(var $=Object.keys(H),Q=0;Q<$.length;++Q)(z[$[Q]]===void 0||!G)&&(z[$[Q]]=H[$[Q]]);return z}U.merge=j,U.lcFirst=function(H){return H.charAt(0).toLowerCase()+H.substring(1)};function B(z){function H(G,$){if(!(this instanceof H))return new H(G,$);Object.defineProperty(this,"message",{get:function(){return G}}),Error.captureStackTrace?Error.captureStackTrace(this,H):Object.defineProperty(this,"stack",{value:new Error().stack||""}),$&&j(this,$)}return H.prototype=Object.create(Error.prototype,{constructor:{value:H,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return z},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),H}U.newError=B,U.ProtocolError=B("ProtocolError"),U.oneOfGetter=function(H){for(var G={},$=0;$<H.length;++$)G[H[$]]=1;return function(){for(var Q=Object.keys(this),W=Q.length-1;W>-1;--W)if(G[Q[W]]===1&&this[Q[W]]!==void 0&&this[Q[W]]!==null)return Q[W]}},U.oneOfSetter=function(H){return function(G){for(var $=0;$<H.length;++$)H[$]!==G&&delete this[H[$]]}},U.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},U._configure=function(){var z=U.Buffer;if(!z){U._Buffer_from=U._Buffer_allocUnsafe=null;return}U._Buffer_from=z.from!==Uint8Array.from&&z.from||function(G,$){return new z(G,$)},U._Buffer_allocUnsafe=z.allocUnsafe||function(G){return new z(G)}}}(minimal)),minimal}var writer,hasRequiredWriter;function requireWriter(){if(hasRequiredWriter)return writer;hasRequiredWriter=1,writer=Q;var V=requireMinimal(),U,j=V.LongBits,B=V.base64,z=V.utf8;function H(de,oe,le){this.fn=de,this.len=oe,this.next=void 0,this.val=le}function G(){}function $(de){this.head=de.head,this.tail=de.tail,this.len=de.len,this.next=de.states}function Q(){this.len=0,this.head=new H(G,0,0),this.tail=this.head,this.states=null}var W=function(){return V.Buffer?function(){return(Q.create=function(){return new U})()}:function(){return new Q}};Q.create=W(),Q.alloc=function(oe){return new V.Array(oe)},V.Array!==Array&&(Q.alloc=V.pool(Q.alloc,V.Array.prototype.subarray)),Q.prototype._push=function(oe,le,ue){return this.tail=this.tail.next=new H(oe,le,ue),this.len+=le,this};function X(de,oe,le){oe[le]=de&255}function ee(de,oe,le){for(;de>127;)oe[le++]=de&127|128,de>>>=7;oe[le]=de}function ie(de,oe){this.len=de,this.next=void 0,this.val=oe}ie.prototype=Object.create(H.prototype),ie.prototype.fn=ee,Q.prototype.uint32=function(oe){return this.len+=(this.tail=this.tail.next=new ie((oe=oe>>>0)<128?1:oe<16384?2:oe<2097152?3:oe<268435456?4:5,oe)).len,this},Q.prototype.int32=function(oe){return oe<0?this._push(ne,10,j.fromNumber(oe)):this.uint32(oe)},Q.prototype.sint32=function(oe){return this.uint32((oe<<1^oe>>31)>>>0)};function ne(de,oe,le){for(;de.hi;)oe[le++]=de.lo&127|128,de.lo=(de.lo>>>7|de.hi<<25)>>>0,de.hi>>>=7;for(;de.lo>127;)oe[le++]=de.lo&127|128,de.lo=de.lo>>>7;oe[le++]=de.lo}Q.prototype.uint64=function(oe){var le=j.from(oe);return this._push(ne,le.length(),le)},Q.prototype.int64=Q.prototype.uint64,Q.prototype.sint64=function(oe){var le=j.from(oe).zzEncode();return this._push(ne,le.length(),le)},Q.prototype.bool=function(oe){return this._push(X,1,oe?1:0)};function re(de,oe,le){oe[le]=de&255,oe[le+1]=de>>>8&255,oe[le+2]=de>>>16&255,oe[le+3]=de>>>24}Q.prototype.fixed32=function(oe){return this._push(re,4,oe>>>0)},Q.prototype.sfixed32=Q.prototype.fixed32,Q.prototype.fixed64=function(oe){var le=j.from(oe);return this._push(re,4,le.lo)._push(re,4,le.hi)},Q.prototype.sfixed64=Q.prototype.fixed64,Q.prototype.float=function(oe){return this._push(V.float.writeFloatLE,4,oe)},Q.prototype.double=function(oe){return this._push(V.float.writeDoubleLE,8,oe)};var se=V.Array.prototype.set?function(oe,le,ue){le.set(oe,ue)}:function(oe,le,ue){for(var fe=0;fe<oe.length;++fe)le[ue+fe]=oe[fe]};return Q.prototype.bytes=function(oe){var le=oe.length>>>0;if(!le)return this._push(X,1,0);if(V.isString(oe)){var ue=Q.alloc(le=B.length(oe));B.decode(oe,ue,0),oe=ue}return this.uint32(le)._push(se,le,oe)},Q.prototype.string=function(oe){var le=z.length(oe);return le?this.uint32(le)._push(z.write,le,oe):this._push(X,1,0)},Q.prototype.fork=function(){return this.states=new $(this),this.head=this.tail=new H(G,0,0),this.len=0,this},Q.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new H(G,0,0),this.len=0),this},Q.prototype.ldelim=function(){var oe=this.head,le=this.tail,ue=this.len;return this.reset().uint32(ue),ue&&(this.tail.next=oe.next,this.tail=le,this.len+=ue),this},Q.prototype.finish=function(){for(var oe=this.head.next,le=this.constructor.alloc(this.len),ue=0;oe;)oe.fn(oe.val,le,ue),ue+=oe.len,oe=oe.next;return le},Q._configure=function(de){U=de,Q.create=W(),U._configure()},writer}var writer_buffer,hasRequiredWriter_buffer;function requireWriter_buffer(){if(hasRequiredWriter_buffer)return writer_buffer;hasRequiredWriter_buffer=1,writer_buffer=j;var V=requireWriter();(j.prototype=Object.create(V.prototype)).constructor=j;var U=requireMinimal();function j(){V.call(this)}j._configure=function(){j.alloc=U._Buffer_allocUnsafe,j.writeBytesBuffer=U.Buffer&&U.Buffer.prototype instanceof Uint8Array&&U.Buffer.prototype.set.name==="set"?function(H,G,$){G.set(H,$)}:function(H,G,$){if(H.copy)H.copy(G,$,0,H.length);else for(var Q=0;Q<H.length;)G[$++]=H[Q++]}},j.prototype.bytes=function(H){U.isString(H)&&(H=U._Buffer_from(H,"base64"));var G=H.length>>>0;return this.uint32(G),G&&this._push(j.writeBytesBuffer,G,H),this};function B(z,H,G){z.length<40?U.utf8.write(z,H,G):H.utf8Write?H.utf8Write(z,G):H.write(z,G)}return j.prototype.string=function(H){var G=U.Buffer.byteLength(H);return this.uint32(G),G&&this._push(B,G,H),this},j._configure(),writer_buffer}var reader,hasRequiredReader;function requireReader(){if(hasRequiredReader)return reader;hasRequiredReader=1,reader=H;var V=requireMinimal(),U,j=V.LongBits,B=V.utf8;function z(ee,ie){return RangeError("index out of range: "+ee.pos+" + "+(ie||1)+" > "+ee.len)}function H(ee){this.buf=ee,this.pos=0,this.len=ee.length}var G=typeof Uint8Array<"u"?function(ie){if(ie instanceof Uint8Array||Array.isArray(ie))return new H(ie);throw Error("illegal buffer")}:function(ie){if(Array.isArray(ie))return new H(ie);throw Error("illegal buffer")},$=function(){return V.Buffer?function(ne){return(H.create=function(se){return V.Buffer.isBuffer(se)?new U(se):G(se)})(ne)}:G};H.create=$(),H.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,H.prototype.uint32=function(){var ie=4294967295;return function(){if(ie=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(ie=(ie|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(ie=(ie|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(ie=(ie|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(ie=(ie|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return ie;if((this.pos+=5)>this.len)throw this.pos=this.len,z(this,10);return ie}}(),H.prototype.int32=function(){return this.uint32()|0},H.prototype.sint32=function(){var ie=this.uint32();return ie>>>1^-(ie&1)|0};function Q(){var ee=new j(0,0),ie=0;if(this.len-this.pos>4){for(;ie<4;++ie)if(ee.lo=(ee.lo|(this.buf[this.pos]&127)<<ie*7)>>>0,this.buf[this.pos++]<128)return ee;if(ee.lo=(ee.lo|(this.buf[this.pos]&127)<<28)>>>0,ee.hi=(ee.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return ee;ie=0}else{for(;ie<3;++ie){if(this.pos>=this.len)throw z(this);if(ee.lo=(ee.lo|(this.buf[this.pos]&127)<<ie*7)>>>0,this.buf[this.pos++]<128)return ee}return ee.lo=(ee.lo|(this.buf[this.pos++]&127)<<ie*7)>>>0,ee}if(this.len-this.pos>4){for(;ie<5;++ie)if(ee.hi=(ee.hi|(this.buf[this.pos]&127)<<ie*7+3)>>>0,this.buf[this.pos++]<128)return ee}else for(;ie<5;++ie){if(this.pos>=this.len)throw z(this);if(ee.hi=(ee.hi|(this.buf[this.pos]&127)<<ie*7+3)>>>0,this.buf[this.pos++]<128)return ee}throw Error("invalid varint encoding")}H.prototype.bool=function(){return this.uint32()!==0};function W(ee,ie){return(ee[ie-4]|ee[ie-3]<<8|ee[ie-2]<<16|ee[ie-1]<<24)>>>0}H.prototype.fixed32=function(){if(this.pos+4>this.len)throw z(this,4);return W(this.buf,this.pos+=4)},H.prototype.sfixed32=function(){if(this.pos+4>this.len)throw z(this,4);return W(this.buf,this.pos+=4)|0};function X(){if(this.pos+8>this.len)throw z(this,8);return new j(W(this.buf,this.pos+=4),W(this.buf,this.pos+=4))}return H.prototype.float=function(){if(this.pos+4>this.len)throw z(this,4);var ie=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,ie},H.prototype.double=function(){if(this.pos+8>this.len)throw z(this,4);var ie=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,ie},H.prototype.bytes=function(){var ie=this.uint32(),ne=this.pos,re=this.pos+ie;if(re>this.len)throw z(this,ie);if(this.pos+=ie,Array.isArray(this.buf))return this.buf.slice(ne,re);if(ne===re){var se=V.Buffer;return se?se.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,ne,re)},H.prototype.string=function(){var ie=this.bytes();return B.read(ie,0,ie.length)},H.prototype.skip=function(ie){if(typeof ie=="number"){if(this.pos+ie>this.len)throw z(this,ie);this.pos+=ie}else do if(this.pos>=this.len)throw z(this);while(this.buf[this.pos++]&128);return this},H.prototype.skipType=function(ee){switch(ee){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(ee=this.uint32()&7)!==4;)this.skipType(ee);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+ee+" at offset "+this.pos)}return this},H._configure=function(ee){U=ee,H.create=$(),U._configure();var ie=V.Long?"toLong":"toNumber";V.merge(H.prototype,{int64:function(){return Q.call(this)[ie](!1)},uint64:function(){return Q.call(this)[ie](!0)},sint64:function(){return Q.call(this).zzDecode()[ie](!1)},fixed64:function(){return X.call(this)[ie](!0)},sfixed64:function(){return X.call(this)[ie](!1)}})},reader}var reader_buffer,hasRequiredReader_buffer;function requireReader_buffer(){if(hasRequiredReader_buffer)return reader_buffer;hasRequiredReader_buffer=1,reader_buffer=j;var V=requireReader();(j.prototype=Object.create(V.prototype)).constructor=j;var U=requireMinimal();function j(B){V.call(this,B)}return j._configure=function(){U.Buffer&&(j.prototype._slice=U.Buffer.prototype.slice)},j.prototype.string=function(){var z=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+z,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+z,this.len))},j._configure(),reader_buffer}var rpc={},service$1,hasRequiredService$1;function requireService$1(){if(hasRequiredService$1)return service$1;hasRequiredService$1=1,service$1=U;var V=requireMinimal();(U.prototype=Object.create(V.EventEmitter.prototype)).constructor=U;function U(j,B,z){if(typeof j!="function")throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=j,this.requestDelimited=!!B,this.responseDelimited=!!z}return U.prototype.rpcCall=function j(B,z,H,G,$){if(!G)throw TypeError("request must be specified");var Q=this;if(!$)return V.asPromise(j,Q,B,z,H,G);if(!Q.rpcImpl){setTimeout(function(){$(Error("already ended"))},0);return}try{return Q.rpcImpl(B,z[Q.requestDelimited?"encodeDelimited":"encode"](G).finish(),function(X,ee){if(X)return Q.emit("error",X,B),$(X);if(ee===null){Q.end(!0);return}if(!(ee instanceof H))try{ee=H[Q.responseDelimited?"decodeDelimited":"decode"](ee)}catch(ie){return Q.emit("error",ie,B),$(ie)}return Q.emit("data",ee,B),$(null,ee)})}catch(W){Q.emit("error",W,B),setTimeout(function(){$(W)},0);return}},U.prototype.end=function(B){return this.rpcImpl&&(B||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},service$1}var hasRequiredRpc;function requireRpc(){return hasRequiredRpc||(hasRequiredRpc=1,function(V){var U=V;U.Service=requireService$1()}(rpc)),rpc}var roots,hasRequiredRoots;function requireRoots(){return hasRequiredRoots||(hasRequiredRoots=1,roots={}),roots}var hasRequiredIndexMinimal;function requireIndexMinimal(){return hasRequiredIndexMinimal||(hasRequiredIndexMinimal=1,function(V){var U=V;U.build="minimal",U.Writer=requireWriter(),U.BufferWriter=requireWriter_buffer(),U.Reader=requireReader(),U.BufferReader=requireReader_buffer(),U.util=requireMinimal(),U.rpc=requireRpc(),U.roots=requireRoots(),U.configure=j;function j(){U.util._configure(),U.Writer._configure(U.BufferWriter),U.Reader._configure(U.BufferReader)}j()}(indexMinimal)),indexMinimal}var types={},util={exports:{}},codegen_1,hasRequiredCodegen;function requireCodegen(){if(hasRequiredCodegen)return codegen_1;hasRequiredCodegen=1,codegen_1=V;function V(U,j){typeof U=="string"&&(j=U,U=void 0);var B=[];function z(G){if(typeof G!="string"){var $=H();if(V.verbose&&console.log("codegen: "+$),$="return "+$,G){for(var Q=Object.keys(G),W=new Array(Q.length+1),X=new Array(Q.length),ee=0;ee<Q.length;)W[ee]=Q[ee],X[ee]=G[Q[ee++]];return W[ee]=$,Function.apply(null,W).apply(null,X)}return Function($)()}for(var ie=new Array(arguments.length-1),ne=0;ne<ie.length;)ie[ne]=arguments[++ne];if(ne=0,G=G.replace(/%([%dfijs])/g,function(se,de){var oe=ie[ne++];switch(de){case"d":case"f":return String(Number(oe));case"i":return String(Math.floor(oe));case"j":return JSON.stringify(oe);case"s":return String(oe)}return"%"}),ne!==ie.length)throw Error("parameter count mismatch");return B.push(G),z}function H(G){return"function "+(G||j||"")+"("+(U&&U.join(",")||"")+`){
  `+B.join(`
  `)+`
}`}return z.toString=H,z}return V.verbose=!1,codegen_1}var fetch_1,hasRequiredFetch;function requireFetch(){if(hasRequiredFetch)return fetch_1;hasRequiredFetch=1,fetch_1=B;var V=requireAspromise(),U=requireInquire(),j=U("fs");function B(z,H,G){return typeof H=="function"?(G=H,H={}):H||(H={}),G?!H.xhr&&j&&j.readFile?j.readFile(z,function(Q,W){return Q&&typeof XMLHttpRequest<"u"?B.xhr(z,H,G):Q?G(Q):G(null,H.binary?W:W.toString("utf8"))}):B.xhr(z,H,G):V(B,this,z,H)}return B.xhr=function(H,G,$){var Q=new XMLHttpRequest;Q.onreadystatechange=function(){if(Q.readyState===4){if(Q.status!==0&&Q.status!==200)return $(Error("status "+Q.status));if(G.binary){var X=Q.response;if(!X){X=[];for(var ee=0;ee<Q.responseText.length;++ee)X.push(Q.responseText.charCodeAt(ee)&255)}return $(null,typeof Uint8Array<"u"?new Uint8Array(X):X)}return $(null,Q.responseText)}},G.binary&&("overrideMimeType"in Q&&Q.overrideMimeType("text/plain; charset=x-user-defined"),Q.responseType="arraybuffer"),Q.open("GET",H),Q.send()},fetch_1}var path={},hasRequiredPath;function requirePath(){return hasRequiredPath||(hasRequiredPath=1,function(V){var U=V,j=U.isAbsolute=function(H){return/^(?:\/|\w+:)/.test(H)},B=U.normalize=function(H){H=H.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var G=H.split("/"),$=j(H),Q="";$&&(Q=G.shift()+"/");for(var W=0;W<G.length;)G[W]===".."?W>0&&G[W-1]!==".."?G.splice(--W,2):$?G.splice(W,1):++W:G[W]==="."?G.splice(W,1):++W;return Q+G.join("/")};U.resolve=function(H,G,$){return $||(G=B(G)),j(G)?G:($||(H=B(H)),(H=H.replace(/(?:\/|^)[^/]+$/,"")).length?B(H+"/"+G):G)}}(path)),path}var namespace,hasRequiredNamespace;function requireNamespace(){if(hasRequiredNamespace)return namespace;hasRequiredNamespace=1,namespace=Q;var V=requireObject();((Q.prototype=Object.create(V.prototype)).constructor=Q).className="Namespace";var U=requireField(),j=requireUtil(),B=requireOneof(),z,H,G;Q.fromJSON=function(ee,ie){return new Q(ee,ie.options).addJSON(ie.nested)};function $(X,ee){if(X&&X.length){for(var ie={},ne=0;ne<X.length;++ne)ie[X[ne].name]=X[ne].toJSON(ee);return ie}}Q.arrayToJSON=$,Q.isReservedId=function(ee,ie){if(ee){for(var ne=0;ne<ee.length;++ne)if(typeof ee[ne]!="string"&&ee[ne][0]<=ie&&ee[ne][1]>ie)return!0}return!1},Q.isReservedName=function(ee,ie){if(ee){for(var ne=0;ne<ee.length;++ne)if(ee[ne]===ie)return!0}return!1};function Q(X,ee){V.call(this,X,ee),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function W(X){X._nestedArray=null,X._lookupCache={};for(var ee=X;ee=ee.parent;)ee._lookupCache={};return X}return Object.defineProperty(Q.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=j.toArray(this.nested))}}),Q.prototype.toJSON=function(ee){return j.toObject(["options",this.options,"nested",$(this.nestedArray,ee)])},Q.prototype.addJSON=function(ee){var ie=this;if(ee)for(var ne=Object.keys(ee),re=0,se;re<ne.length;++re)se=ee[ne[re]],ie.add((se.fields!==void 0?z.fromJSON:se.values!==void 0?G.fromJSON:se.methods!==void 0?H.fromJSON:se.id!==void 0?U.fromJSON:Q.fromJSON)(ne[re],se));return this},Q.prototype.get=function(ee){return this.nested&&this.nested[ee]||null},Q.prototype.getEnum=function(ee){if(this.nested&&this.nested[ee]instanceof G)return this.nested[ee].values;throw Error("no such enum: "+ee)},Q.prototype.add=function(ee){if(!(ee instanceof U&&ee.extend!==void 0||ee instanceof z||ee instanceof B||ee instanceof G||ee instanceof H||ee instanceof Q))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var ie=this.get(ee.name);if(ie)if(ie instanceof Q&&ee instanceof Q&&!(ie instanceof z||ie instanceof H)){for(var ne=ie.nestedArray,re=0;re<ne.length;++re)ee.add(ne[re]);this.remove(ie),this.nested||(this.nested={}),ee.setOptions(ie.options,!0)}else throw Error("duplicate name '"+ee.name+"' in "+this)}this.nested[ee.name]=ee,this instanceof z||this instanceof H||this instanceof G||this instanceof U||ee._edition||(ee._edition=ee._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var se=this;se=se.parent;)se._needsRecursiveFeatureResolution=!0,se._needsRecursiveResolve=!0;return ee.onAdd(this),W(this)},Q.prototype.remove=function(ee){if(!(ee instanceof V))throw TypeError("object must be a ReflectionObject");if(ee.parent!==this)throw Error(ee+" is not a member of "+this);return delete this.nested[ee.name],Object.keys(this.nested).length||(this.nested=void 0),ee.onRemove(this),W(this)},Q.prototype.define=function(ee,ie){if(j.isString(ee))ee=ee.split(".");else if(!Array.isArray(ee))throw TypeError("illegal path");if(ee&&ee.length&&ee[0]==="")throw Error("path must be relative");for(var ne=this;ee.length>0;){var re=ee.shift();if(ne.nested&&ne.nested[re]){if(ne=ne.nested[re],!(ne instanceof Q))throw Error("path conflicts with non-namespace objects")}else ne.add(ne=new Q(re))}return ie&&ne.addJSON(ie),ne},Q.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var ee=this.nestedArray,ie=0;for(this.resolve();ie<ee.length;)ee[ie]instanceof Q?ee[ie++].resolveAll():ee[ie++].resolve();return this._needsRecursiveResolve=!1,this},Q.prototype._resolveFeaturesRecursive=function(ee){return this._needsRecursiveFeatureResolution?(this._needsRecursiveFeatureResolution=!1,ee=this._edition||ee,V.prototype._resolveFeaturesRecursive.call(this,ee),this.nestedArray.forEach(ie=>{ie._resolveFeaturesRecursive(ee)}),this):this},Q.prototype.lookup=function(ee,ie,ne){if(typeof ie=="boolean"?(ne=ie,ie=void 0):ie&&!Array.isArray(ie)&&(ie=[ie]),j.isString(ee)&&ee.length){if(ee===".")return this.root;ee=ee.split(".")}else if(!ee.length)return this;var re=ee.join(".");if(ee[0]==="")return this.root.lookup(ee.slice(1),ie);var se=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+re];if(se&&(!ie||ie.indexOf(se.constructor)>-1)||(se=this._lookupImpl(ee,re),se&&(!ie||ie.indexOf(se.constructor)>-1)))return se;if(ne)return null;for(var de=this;de.parent;){if(se=de.parent._lookupImpl(ee,re),se&&(!ie||ie.indexOf(se.constructor)>-1))return se;de=de.parent}return null},Q.prototype._lookupImpl=function(ee,ie){if(Object.prototype.hasOwnProperty.call(this._lookupCache,ie))return this._lookupCache[ie];var ne=this.get(ee[0]),re=null;if(ne)ee.length===1?re=ne:ne instanceof Q&&(ee=ee.slice(1),re=ne._lookupImpl(ee,ee.join(".")));else for(var se=0;se<this.nestedArray.length;++se)this._nestedArray[se]instanceof Q&&(ne=this._nestedArray[se]._lookupImpl(ee,ie))&&(re=ne);return this._lookupCache[ie]=re,re},Q.prototype.lookupType=function(ee){var ie=this.lookup(ee,[z]);if(!ie)throw Error("no such type: "+ee);return ie},Q.prototype.lookupEnum=function(ee){var ie=this.lookup(ee,[G]);if(!ie)throw Error("no such Enum '"+ee+"' in "+this);return ie},Q.prototype.lookupTypeOrEnum=function(ee){var ie=this.lookup(ee,[z,G]);if(!ie)throw Error("no such Type or Enum '"+ee+"' in "+this);return ie},Q.prototype.lookupService=function(ee){var ie=this.lookup(ee,[H]);if(!ie)throw Error("no such Service '"+ee+"' in "+this);return ie},Q._configure=function(X,ee,ie){z=X,H=ee,G=ie},namespace}var mapfield,hasRequiredMapfield;function requireMapfield(){if(hasRequiredMapfield)return mapfield;hasRequiredMapfield=1,mapfield=B;var V=requireField();((B.prototype=Object.create(V.prototype)).constructor=B).className="MapField";var U=requireTypes(),j=requireUtil();function B(z,H,G,$,Q,W){if(V.call(this,z,H,$,void 0,void 0,Q,W),!j.isString(G))throw TypeError("keyType must be a string");this.keyType=G,this.resolvedKeyType=null,this.map=!0}return B.fromJSON=function(H,G){return new B(H,G.id,G.keyType,G.type,G.options,G.comment)},B.prototype.toJSON=function(H){var G=H?!!H.keepComments:!1;return j.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",G?this.comment:void 0])},B.prototype.resolve=function(){if(this.resolved)return this;if(U.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return V.prototype.resolve.call(this)},B.d=function(H,G,$){return typeof $=="function"?$=j.decorateType($).name:$&&typeof $=="object"&&($=j.decorateEnum($).name),function(W,X){j.decorateType(W.constructor).add(new B(X,H,G,$))}},mapfield}var method,hasRequiredMethod;function requireMethod(){if(hasRequiredMethod)return method;hasRequiredMethod=1,method=j;var V=requireObject();((j.prototype=Object.create(V.prototype)).constructor=j).className="Method";var U=requireUtil();function j(B,z,H,G,$,Q,W,X,ee){if(U.isObject($)?(W=$,$=Q=void 0):U.isObject(Q)&&(W=Q,Q=void 0),!(z===void 0||U.isString(z)))throw TypeError("type must be a string");if(!U.isString(H))throw TypeError("requestType must be a string");if(!U.isString(G))throw TypeError("responseType must be a string");V.call(this,B,W),this.type=z||"rpc",this.requestType=H,this.requestStream=$?!0:void 0,this.responseType=G,this.responseStream=Q?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=X,this.parsedOptions=ee}return j.fromJSON=function(z,H){return new j(z,H.type,H.requestType,H.responseType,H.requestStream,H.responseStream,H.options,H.comment,H.parsedOptions)},j.prototype.toJSON=function(z){var H=z?!!z.keepComments:!1;return U.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",H?this.comment:void 0,"parsedOptions",this.parsedOptions])},j.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),V.prototype.resolve.call(this))},method}var service,hasRequiredService;function requireService(){if(hasRequiredService)return service;hasRequiredService=1,service=z;var V=requireNamespace();((z.prototype=Object.create(V.prototype)).constructor=z).className="Service";var U=requireMethod(),j=requireUtil(),B=requireRpc();function z(G,$){V.call(this,G,$),this.methods={},this._methodsArray=null}z.fromJSON=function($,Q){var W=new z($,Q.options);if(Q.methods)for(var X=Object.keys(Q.methods),ee=0;ee<X.length;++ee)W.add(U.fromJSON(X[ee],Q.methods[X[ee]]));return Q.nested&&W.addJSON(Q.nested),Q.edition&&(W._edition=Q.edition),W.comment=Q.comment,W._defaultEdition="proto3",W},z.prototype.toJSON=function($){var Q=V.prototype.toJSON.call(this,$),W=$?!!$.keepComments:!1;return j.toObject(["edition",this._editionToJSON(),"options",Q&&Q.options||void 0,"methods",V.arrayToJSON(this.methodsArray,$)||{},"nested",Q&&Q.nested||void 0,"comment",W?this.comment:void 0])},Object.defineProperty(z.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=j.toArray(this.methods))}});function H(G){return G._methodsArray=null,G}return z.prototype.get=function($){return this.methods[$]||V.prototype.get.call(this,$)},z.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;V.prototype.resolve.call(this);for(var $=this.methodsArray,Q=0;Q<$.length;++Q)$[Q].resolve();return this},z.prototype._resolveFeaturesRecursive=function($){return this._needsRecursiveFeatureResolution?($=this._edition||$,V.prototype._resolveFeaturesRecursive.call(this,$),this.methodsArray.forEach(Q=>{Q._resolveFeaturesRecursive($)}),this):this},z.prototype.add=function($){if(this.get($.name))throw Error("duplicate name '"+$.name+"' in "+this);return $ instanceof U?(this.methods[$.name]=$,$.parent=this,H(this)):V.prototype.add.call(this,$)},z.prototype.remove=function($){if($ instanceof U){if(this.methods[$.name]!==$)throw Error($+" is not a member of "+this);return delete this.methods[$.name],$.parent=null,H(this)}return V.prototype.remove.call(this,$)},z.prototype.create=function($,Q,W){for(var X=new B.Service($,Q,W),ee=0,ie;ee<this.methodsArray.length;++ee){var ne=j.lcFirst((ie=this._methodsArray[ee]).resolve().name).replace(/[^$\w_]/g,"");X[ne]=j.codegen(["r","c"],j.isReserved(ne)?ne+"_":ne)("return this.rpcCall(m,q,s,r,c)")({m:ie,q:ie.resolvedRequestType.ctor,s:ie.resolvedResponseType.ctor})}return X},service}var message,hasRequiredMessage;function requireMessage(){if(hasRequiredMessage)return message;hasRequiredMessage=1,message=U;var V=requireMinimal();function U(j){if(j)for(var B=Object.keys(j),z=0;z<B.length;++z)this[B[z]]=j[B[z]]}return U.create=function(B){return this.$type.create(B)},U.encode=function(B,z){return this.$type.encode(B,z)},U.encodeDelimited=function(B,z){return this.$type.encodeDelimited(B,z)},U.decode=function(B){return this.$type.decode(B)},U.decodeDelimited=function(B){return this.$type.decodeDelimited(B)},U.verify=function(B){return this.$type.verify(B)},U.fromObject=function(B){return this.$type.fromObject(B)},U.toObject=function(B,z){return this.$type.toObject(B,z)},U.prototype.toJSON=function(){return this.$type.toObject(this,V.toJSONOptions)},message}var decoder_1,hasRequiredDecoder;function requireDecoder(){if(hasRequiredDecoder)return decoder_1;hasRequiredDecoder=1,decoder_1=z;var V=require_enum(),U=requireTypes(),j=requireUtil();function B(H){return"missing required '"+H.name+"'"}function z(H){for(var G=j.codegen(["r","l","e"],H.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(H.fieldsArray.filter(function(ie){return ie.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),$=0;$<H.fieldsArray.length;++$){var Q=H._fieldsArray[$].resolve(),W=Q.resolvedType instanceof V?"int32":Q.type,X="m"+j.safeProp(Q.name);G("case %i: {",Q.id),Q.map?(G("if(%s===util.emptyObject)",X)("%s={}",X)("var c2 = r.uint32()+r.pos"),U.defaults[Q.keyType]!==void 0?G("k=%j",U.defaults[Q.keyType]):G("k=null"),U.defaults[W]!==void 0?G("value=%j",U.defaults[W]):G("value=null"),G("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",Q.keyType)("case 2:"),U.basic[W]===void 0?G("value=types[%i].decode(r,r.uint32())",$):G("value=r.%s()",W),G("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),U.long[Q.keyType]!==void 0?G('%s[typeof k==="object"?util.longToHash(k):k]=value',X):G("%s[k]=value",X)):Q.repeated?(G("if(!(%s&&%s.length))",X,X)("%s=[]",X),U.packed[W]!==void 0&&G("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",X,W)("}else"),U.basic[W]===void 0?G(Q.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",X,$):G("%s.push(r.%s())",X,W)):U.basic[W]===void 0?G(Q.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",X,$):G("%s=r.%s()",X,W),G("break")("}")}for(G("default:")("r.skipType(t&7)")("break")("}")("}"),$=0;$<H._fieldsArray.length;++$){var ee=H._fieldsArray[$];ee.required&&G("if(!m.hasOwnProperty(%j))",ee.name)("throw util.ProtocolError(%j,{instance:m})",B(ee))}return G("return m")}return decoder_1}var verifier_1,hasRequiredVerifier;function requireVerifier(){if(hasRequiredVerifier)return verifier_1;hasRequiredVerifier=1,verifier_1=H;var V=require_enum(),U=requireUtil();function j(G,$){return G.name+": "+$+(G.repeated&&$!=="array"?"[]":G.map&&$!=="object"?"{k:"+G.keyType+"}":"")+" expected"}function B(G,$,Q,W){if($.resolvedType)if($.resolvedType instanceof V){G("switch(%s){",W)("default:")("return%j",j($,"enum value"));for(var X=Object.keys($.resolvedType.values),ee=0;ee<X.length;++ee)G("case %i:",$.resolvedType.values[X[ee]]);G("break")("}")}else G("{")("var e=types[%i].verify(%s);",Q,W)("if(e)")("return%j+e",$.name+".")("}");else switch($.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":G("if(!util.isInteger(%s))",W)("return%j",j($,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":G("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",W,W,W,W)("return%j",j($,"integer|Long"));break;case"float":case"double":G('if(typeof %s!=="number")',W)("return%j",j($,"number"));break;case"bool":G('if(typeof %s!=="boolean")',W)("return%j",j($,"boolean"));break;case"string":G("if(!util.isString(%s))",W)("return%j",j($,"string"));break;case"bytes":G('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',W,W,W)("return%j",j($,"buffer"));break}return G}function z(G,$,Q){switch($.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":G("if(!util.key32Re.test(%s))",Q)("return%j",j($,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":G("if(!util.key64Re.test(%s))",Q)("return%j",j($,"integer|Long key"));break;case"bool":G("if(!util.key2Re.test(%s))",Q)("return%j",j($,"boolean key"));break}return G}function H(G){var $=U.codegen(["m"],G.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),Q=G.oneofsArray,W={};Q.length&&$("var p={}");for(var X=0;X<G.fieldsArray.length;++X){var ee=G._fieldsArray[X].resolve(),ie="m"+U.safeProp(ee.name);if(ee.optional&&$("if(%s!=null&&m.hasOwnProperty(%j)){",ie,ee.name),ee.map)$("if(!util.isObject(%s))",ie)("return%j",j(ee,"object"))("var k=Object.keys(%s)",ie)("for(var i=0;i<k.length;++i){"),z($,ee,"k[i]"),B($,ee,X,ie+"[k[i]]")("}");else if(ee.repeated)$("if(!Array.isArray(%s))",ie)("return%j",j(ee,"array"))("for(var i=0;i<%s.length;++i){",ie),B($,ee,X,ie+"[i]")("}");else{if(ee.partOf){var ne=U.safeProp(ee.partOf.name);W[ee.partOf.name]===1&&$("if(p%s===1)",ne)("return%j",ee.partOf.name+": multiple values"),W[ee.partOf.name]=1,$("p%s=1",ne)}B($,ee,X,ie)}ee.optional&&$("}")}return $("return null")}return verifier_1}var converter={},hasRequiredConverter;function requireConverter(){return hasRequiredConverter||(hasRequiredConverter=1,function(V){var U=V,j=require_enum(),B=requireUtil();function z(G,$,Q,W){var X=!1;if($.resolvedType)if($.resolvedType instanceof j){G("switch(d%s){",W);for(var ee=$.resolvedType.values,ie=Object.keys(ee),ne=0;ne<ie.length;++ne)ee[ie[ne]]===$.typeDefault&&!X&&(G("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',W,W,W),$.repeated||G("break"),X=!0),G("case%j:",ie[ne])("case %i:",ee[ie[ne]])("m%s=%j",W,ee[ie[ne]])("break");G("}")}else G('if(typeof d%s!=="object")',W)("throw TypeError(%j)",$.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",W,Q,W);else{var re=!1;switch($.type){case"double":case"float":G("m%s=Number(d%s)",W,W);break;case"uint32":case"fixed32":G("m%s=d%s>>>0",W,W);break;case"int32":case"sint32":case"sfixed32":G("m%s=d%s|0",W,W);break;case"uint64":re=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":G("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",W,W,re)('else if(typeof d%s==="string")',W)("m%s=parseInt(d%s,10)",W,W)('else if(typeof d%s==="number")',W)("m%s=d%s",W,W)('else if(typeof d%s==="object")',W)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",W,W,W,re?"true":"");break;case"bytes":G('if(typeof d%s==="string")',W)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",W,W,W)("else if(d%s.length >= 0)",W)("m%s=d%s",W,W);break;case"string":G("m%s=String(d%s)",W,W);break;case"bool":G("m%s=Boolean(d%s)",W,W);break}}return G}U.fromObject=function($){var Q=$.fieldsArray,W=B.codegen(["d"],$.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!Q.length)return W("return new this.ctor");W("var m=new this.ctor");for(var X=0;X<Q.length;++X){var ee=Q[X].resolve(),ie=B.safeProp(ee.name);ee.map?(W("if(d%s){",ie)('if(typeof d%s!=="object")',ie)("throw TypeError(%j)",ee.fullName+": object expected")("m%s={}",ie)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",ie),z(W,ee,X,ie+"[ks[i]]")("}")("}")):ee.repeated?(W("if(d%s){",ie)("if(!Array.isArray(d%s))",ie)("throw TypeError(%j)",ee.fullName+": array expected")("m%s=[]",ie)("for(var i=0;i<d%s.length;++i){",ie),z(W,ee,X,ie+"[i]")("}")("}")):(ee.resolvedType instanceof j||W("if(d%s!=null){",ie),z(W,ee,X,ie),ee.resolvedType instanceof j||W("}"))}return W("return m")};function H(G,$,Q,W){if($.resolvedType)$.resolvedType instanceof j?G("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",W,Q,W,W,Q,W,W):G("d%s=types[%i].toObject(m%s,o)",W,Q,W);else{var X=!1;switch($.type){case"double":case"float":G("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",W,W,W,W);break;case"uint64":X=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":G('if(typeof m%s==="number")',W)("d%s=o.longs===String?String(m%s):m%s",W,W,W)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",W,W,W,W,X?"true":"",W);break;case"bytes":G("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",W,W,W,W,W);break;default:G("d%s=m%s",W,W);break}}return G}U.toObject=function($){var Q=$.fieldsArray.slice().sort(B.compareFieldsById);if(!Q.length)return B.codegen()("return {}");for(var W=B.codegen(["m","o"],$.name+"$toObject")("if(!o)")("o={}")("var d={}"),X=[],ee=[],ie=[],ne=0;ne<Q.length;++ne)Q[ne].partOf||(Q[ne].resolve().repeated?X:Q[ne].map?ee:ie).push(Q[ne]);if(X.length){for(W("if(o.arrays||o.defaults){"),ne=0;ne<X.length;++ne)W("d%s=[]",B.safeProp(X[ne].name));W("}")}if(ee.length){for(W("if(o.objects||o.defaults){"),ne=0;ne<ee.length;++ne)W("d%s={}",B.safeProp(ee[ne].name));W("}")}if(ie.length){for(W("if(o.defaults){"),ne=0;ne<ie.length;++ne){var re=ie[ne],se=B.safeProp(re.name);if(re.resolvedType instanceof j)W("d%s=o.enums===String?%j:%j",se,re.resolvedType.valuesById[re.typeDefault],re.typeDefault);else if(re.long)W("if(util.Long){")("var n=new util.Long(%i,%i,%j)",re.typeDefault.low,re.typeDefault.high,re.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",se)("}else")("d%s=o.longs===String?%j:%i",se,re.typeDefault.toString(),re.typeDefault.toNumber());else if(re.bytes){var de="["+Array.prototype.slice.call(re.typeDefault).join(",")+"]";W("if(o.bytes===String)d%s=%j",se,String.fromCharCode.apply(String,re.typeDefault))("else{")("d%s=%s",se,de)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",se,se)("}")}else W("d%s=%j",se,re.typeDefault)}W("}")}var oe=!1;for(ne=0;ne<Q.length;++ne){var re=Q[ne],le=$._fieldsArray.indexOf(re),se=B.safeProp(re.name);re.map?(oe||(oe=!0,W("var ks2")),W("if(m%s&&(ks2=Object.keys(m%s)).length){",se,se)("d%s={}",se)("for(var j=0;j<ks2.length;++j){"),H(W,re,le,se+"[ks2[j]]")("}")):re.repeated?(W("if(m%s&&m%s.length){",se,se)("d%s=[]",se)("for(var j=0;j<m%s.length;++j){",se),H(W,re,le,se+"[j]")("}")):(W("if(m%s!=null&&m.hasOwnProperty(%j)){",se,re.name),H(W,re,le,se),re.partOf&&W("if(o.oneofs)")("d%s=%j",B.safeProp(re.partOf.name),re.name)),W("}")}return W("return d")}}(converter)),converter}var wrappers={},hasRequiredWrappers;function requireWrappers(){return hasRequiredWrappers||(hasRequiredWrappers=1,function(V){var U=V,j=requireMessage();U[".google.protobuf.Any"]={fromObject:function(B){if(B&&B["@type"]){var z=B["@type"].substring(B["@type"].lastIndexOf("/")+1),H=this.lookup(z);if(H){var G=B["@type"].charAt(0)==="."?B["@type"].slice(1):B["@type"];return G.indexOf("/")===-1&&(G="/"+G),this.create({type_url:G,value:H.encode(H.fromObject(B)).finish()})}}return this.fromObject(B)},toObject:function(B,z){var H="type.googleapis.com/",G="",$="";if(z&&z.json&&B.type_url&&B.value){$=B.type_url.substring(B.type_url.lastIndexOf("/")+1),G=B.type_url.substring(0,B.type_url.lastIndexOf("/")+1);var Q=this.lookup($);Q&&(B=Q.decode(B.value))}if(!(B instanceof this.ctor)&&B instanceof j){var W=B.$type.toObject(B,z),X=B.$type.fullName[0]==="."?B.$type.fullName.slice(1):B.$type.fullName;return G===""&&(G=H),$=G+X,W["@type"]=$,W}return this.toObject(B,z)}}}(wrappers)),wrappers}var type,hasRequiredType;function requireType(){if(hasRequiredType)return type;hasRequiredType=1,type=se;var V=requireNamespace();((se.prototype=Object.create(V.prototype)).constructor=se).className="Type";var U=require_enum(),j=requireOneof(),B=requireField(),z=requireMapfield(),H=requireService(),G=requireMessage(),$=requireReader(),Q=requireWriter(),W=requireUtil(),X=requireEncoder(),ee=requireDecoder(),ie=requireVerifier(),ne=requireConverter(),re=requireWrappers();function se(oe,le){V.call(this,oe,le),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(se.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var oe=Object.keys(this.fields),le=0;le<oe.length;++le){var ue=this.fields[oe[le]],fe=ue.id;if(this._fieldsById[fe])throw Error("duplicate id "+fe+" in "+this);this._fieldsById[fe]=ue}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=W.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=W.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=se.generateConstructor(this)())},set:function(oe){var le=oe.prototype;le instanceof G||((oe.prototype=new G).constructor=oe,W.merge(oe.prototype,le)),oe.$type=oe.prototype.$type=this,W.merge(oe,G,!0),this._ctor=oe;for(var ue=0;ue<this.fieldsArray.length;++ue)this._fieldsArray[ue].resolve();var fe={};for(ue=0;ue<this.oneofsArray.length;++ue)fe[this._oneofsArray[ue].resolve().name]={get:W.oneOfGetter(this._oneofsArray[ue].oneof),set:W.oneOfSetter(this._oneofsArray[ue].oneof)};ue&&Object.defineProperties(oe.prototype,fe)}}}),se.generateConstructor=function(le){for(var ue=W.codegen(["p"],le.name),fe=0,he;fe<le.fieldsArray.length;++fe)(he=le._fieldsArray[fe]).map?ue("this%s={}",W.safeProp(he.name)):he.repeated&&ue("this%s=[]",W.safeProp(he.name));return ue("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function de(oe){return oe._fieldsById=oe._fieldsArray=oe._oneofsArray=null,delete oe.encode,delete oe.decode,delete oe.verify,oe}return se.fromJSON=function(le,ue){var fe=new se(le,ue.options);fe.extensions=ue.extensions,fe.reserved=ue.reserved;for(var he=Object.keys(ue.fields),ge=0;ge<he.length;++ge)fe.add((typeof ue.fields[he[ge]].keyType<"u"?z.fromJSON:B.fromJSON)(he[ge],ue.fields[he[ge]]));if(ue.oneofs)for(he=Object.keys(ue.oneofs),ge=0;ge<he.length;++ge)fe.add(j.fromJSON(he[ge],ue.oneofs[he[ge]]));if(ue.nested)for(he=Object.keys(ue.nested),ge=0;ge<he.length;++ge){var Ae=ue.nested[he[ge]];fe.add((Ae.id!==void 0?B.fromJSON:Ae.fields!==void 0?se.fromJSON:Ae.values!==void 0?U.fromJSON:Ae.methods!==void 0?H.fromJSON:V.fromJSON)(he[ge],Ae))}return ue.extensions&&ue.extensions.length&&(fe.extensions=ue.extensions),ue.reserved&&ue.reserved.length&&(fe.reserved=ue.reserved),ue.group&&(fe.group=!0),ue.comment&&(fe.comment=ue.comment),ue.edition&&(fe._edition=ue.edition),fe._defaultEdition="proto3",fe},se.prototype.toJSON=function(le){var ue=V.prototype.toJSON.call(this,le),fe=le?!!le.keepComments:!1;return W.toObject(["edition",this._editionToJSON(),"options",ue&&ue.options||void 0,"oneofs",V.arrayToJSON(this.oneofsArray,le),"fields",V.arrayToJSON(this.fieldsArray.filter(function(he){return!he.declaringField}),le)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",ue&&ue.nested||void 0,"comment",fe?this.comment:void 0])},se.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;V.prototype.resolveAll.call(this);var le=this.oneofsArray;for(fe=0;fe<le.length;)le[fe++].resolve();for(var ue=this.fieldsArray,fe=0;fe<ue.length;)ue[fe++].resolve();return this},se.prototype._resolveFeaturesRecursive=function(le){return this._needsRecursiveFeatureResolution?(le=this._edition||le,V.prototype._resolveFeaturesRecursive.call(this,le),this.oneofsArray.forEach(ue=>{ue._resolveFeatures(le)}),this.fieldsArray.forEach(ue=>{ue._resolveFeatures(le)}),this):this},se.prototype.get=function(le){return this.fields[le]||this.oneofs&&this.oneofs[le]||this.nested&&this.nested[le]||null},se.prototype.add=function(le){if(this.get(le.name))throw Error("duplicate name '"+le.name+"' in "+this);if(le instanceof B&&le.extend===void 0){if(this._fieldsById?this._fieldsById[le.id]:this.fieldsById[le.id])throw Error("duplicate id "+le.id+" in "+this);if(this.isReservedId(le.id))throw Error("id "+le.id+" is reserved in "+this);if(this.isReservedName(le.name))throw Error("name '"+le.name+"' is reserved in "+this);return le.parent&&le.parent.remove(le),this.fields[le.name]=le,le.message=this,le.onAdd(this),de(this)}return le instanceof j?(this.oneofs||(this.oneofs={}),this.oneofs[le.name]=le,le.onAdd(this),de(this)):V.prototype.add.call(this,le)},se.prototype.remove=function(le){if(le instanceof B&&le.extend===void 0){if(!this.fields||this.fields[le.name]!==le)throw Error(le+" is not a member of "+this);return delete this.fields[le.name],le.parent=null,le.onRemove(this),de(this)}if(le instanceof j){if(!this.oneofs||this.oneofs[le.name]!==le)throw Error(le+" is not a member of "+this);return delete this.oneofs[le.name],le.parent=null,le.onRemove(this),de(this)}return V.prototype.remove.call(this,le)},se.prototype.isReservedId=function(le){return V.isReservedId(this.reserved,le)},se.prototype.isReservedName=function(le){return V.isReservedName(this.reserved,le)},se.prototype.create=function(le){return new this.ctor(le)},se.prototype.setup=function(){for(var le=this.fullName,ue=[],fe=0;fe<this.fieldsArray.length;++fe)ue.push(this._fieldsArray[fe].resolve().resolvedType);this.encode=X(this)({Writer:Q,types:ue,util:W}),this.decode=ee(this)({Reader:$,types:ue,util:W}),this.verify=ie(this)({types:ue,util:W}),this.fromObject=ne.fromObject(this)({types:ue,util:W}),this.toObject=ne.toObject(this)({types:ue,util:W});var he=re[le];if(he){var ge=Object.create(this);ge.fromObject=this.fromObject,this.fromObject=he.fromObject.bind(ge),ge.toObject=this.toObject,this.toObject=he.toObject.bind(ge)}return this},se.prototype.encode=function(le,ue){return this.setup().encode(le,ue)},se.prototype.encodeDelimited=function(le,ue){return this.encode(le,ue&&ue.len?ue.fork():ue).ldelim()},se.prototype.decode=function(le,ue){return this.setup().decode(le,ue)},se.prototype.decodeDelimited=function(le){return le instanceof $||(le=$.create(le)),this.decode(le,le.uint32())},se.prototype.verify=function(le){return this.setup().verify(le)},se.prototype.fromObject=function(le){return this.setup().fromObject(le)},se.prototype.toObject=function(le,ue){return this.setup().toObject(le,ue)},se.d=function(le){return function(fe){W.decorateType(fe,le)}},type}var root,hasRequiredRoot;function requireRoot(){if(hasRequiredRoot)return root;hasRequiredRoot=1,root=Q;var V=requireNamespace();((Q.prototype=Object.create(V.prototype)).constructor=Q).className="Root";var U=requireField(),j=require_enum(),B=requireOneof(),z=requireUtil(),H,G,$;function Q(ie){V.call(this,"",ie),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}Q.fromJSON=function(ne,re){return re||(re=new Q),ne.options&&re.setOptions(ne.options),re.addJSON(ne.nested).resolveAll()},Q.prototype.resolvePath=z.path.resolve,Q.prototype.fetch=z.fetch;function W(){}Q.prototype.load=function ie(ne,re,se){typeof re=="function"&&(se=re,re=void 0);var de=this;if(!se)return z.asPromise(ie,de,ne,re);var oe=se===W;function le(Pe,xe){if(se){if(oe)throw Pe;xe&&xe.resolveAll();var Ce=se;se=null,Ce(Pe,xe)}}function ue(Pe){var xe=Pe.lastIndexOf("google/protobuf/");if(xe>-1){var Ce=Pe.substring(xe);if(Ce in $)return Ce}return null}function fe(Pe,xe){try{if(z.isString(xe)&&xe.charAt(0)==="{"&&(xe=JSON.parse(xe)),!z.isString(xe))de.setOptions(xe.options).addJSON(xe.nested);else{G.filename=Pe;var Ce=G(xe,de,re),ze,$e=0;if(Ce.imports)for(;$e<Ce.imports.length;++$e)(ze=ue(Ce.imports[$e])||de.resolvePath(Pe,Ce.imports[$e]))&&he(ze);if(Ce.weakImports)for($e=0;$e<Ce.weakImports.length;++$e)(ze=ue(Ce.weakImports[$e])||de.resolvePath(Pe,Ce.weakImports[$e]))&&he(ze,!0)}}catch(Fe){le(Fe)}!oe&&!ge&&le(null,de)}function he(Pe,xe){if(Pe=ue(Pe)||Pe,!(de.files.indexOf(Pe)>-1)){if(de.files.push(Pe),Pe in $){oe?fe(Pe,$[Pe]):(++ge,setTimeout(function(){--ge,fe(Pe,$[Pe])}));return}if(oe){var Ce;try{Ce=z.fs.readFileSync(Pe).toString("utf8")}catch(ze){xe||le(ze);return}fe(Pe,Ce)}else++ge,de.fetch(Pe,function(ze,$e){if(--ge,!!se){if(ze){xe?ge||le(null,de):le(ze);return}fe(Pe,$e)}})}}var ge=0;z.isString(ne)&&(ne=[ne]);for(var Ae=0,_e;Ae<ne.length;++Ae)(_e=de.resolvePath("",ne[Ae]))&&he(_e);return oe?(de.resolveAll(),de):(ge||le(null,de),de)},Q.prototype.loadSync=function(ne,re){if(!z.isNode)throw Error("not supported");return this.load(ne,re,W)},Q.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(ne){return"'extend "+ne.extend+"' in "+ne.parent.fullName}).join(", "));return V.prototype.resolveAll.call(this)};var X=/^[A-Z]/;function ee(ie,ne){var re=ne.parent.lookup(ne.extend);if(re){var se=new U(ne.fullName,ne.id,ne.type,ne.rule,void 0,ne.options);return re.get(se.name)||(se.declaringField=ne,ne.extensionField=se,re.add(se)),!0}return!1}return Q.prototype._handleAdd=function(ne){if(ne instanceof U)ne.extend!==void 0&&!ne.extensionField&&(ee(this,ne)||this.deferred.push(ne));else if(ne instanceof j)X.test(ne.name)&&(ne.parent[ne.name]=ne.values);else if(!(ne instanceof B)){if(ne instanceof H)for(var re=0;re<this.deferred.length;)ee(this,this.deferred[re])?this.deferred.splice(re,1):++re;for(var se=0;se<ne.nestedArray.length;++se)this._handleAdd(ne._nestedArray[se]);X.test(ne.name)&&(ne.parent[ne.name]=ne)}(ne instanceof H||ne instanceof j||ne instanceof U)&&(this._fullyQualifiedObjects[ne.fullName]=ne)},Q.prototype._handleRemove=function(ne){if(ne instanceof U){if(ne.extend!==void 0)if(ne.extensionField)ne.extensionField.parent.remove(ne.extensionField),ne.extensionField=null;else{var re=this.deferred.indexOf(ne);re>-1&&this.deferred.splice(re,1)}}else if(ne instanceof j)X.test(ne.name)&&delete ne.parent[ne.name];else if(ne instanceof V){for(var se=0;se<ne.nestedArray.length;++se)this._handleRemove(ne._nestedArray[se]);X.test(ne.name)&&delete ne.parent[ne.name]}delete this._fullyQualifiedObjects[ne.fullName]},Q._configure=function(ie,ne,re){H=ie,G=ne,$=re},root}var hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util.exports;hasRequiredUtil=1;var V=util.exports=requireMinimal(),U=requireRoots(),j,B;V.codegen=requireCodegen(),V.fetch=requireFetch(),V.path=requirePath(),V.fs=V.inquire("fs"),V.toArray=function(W){if(W){for(var X=Object.keys(W),ee=new Array(X.length),ie=0;ie<X.length;)ee[ie]=W[X[ie++]];return ee}return[]},V.toObject=function(W){for(var X={},ee=0;ee<W.length;){var ie=W[ee++],ne=W[ee++];ne!==void 0&&(X[ie]=ne)}return X};var z=/\\/g,H=/"/g;V.isReserved=function(W){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(W)},V.safeProp=function(W){return!/^[$\w_]+$/.test(W)||V.isReserved(W)?'["'+W.replace(z,"\\\\").replace(H,'\\"')+'"]':"."+W},V.ucFirst=function(W){return W.charAt(0).toUpperCase()+W.substring(1)};var G=/_([a-z])/g;V.camelCase=function(W){return W.substring(0,1)+W.substring(1).replace(G,function(X,ee){return ee.toUpperCase()})},V.compareFieldsById=function(W,X){return W.id-X.id},V.decorateType=function(W,X){if(W.$type)return X&&W.$type.name!==X&&(V.decorateRoot.remove(W.$type),W.$type.name=X,V.decorateRoot.add(W.$type)),W.$type;j||(j=requireType());var ee=new j(X||W.name);return V.decorateRoot.add(ee),ee.ctor=W,Object.defineProperty(W,"$type",{value:ee,enumerable:!1}),Object.defineProperty(W.prototype,"$type",{value:ee,enumerable:!1}),ee};var $=0;return V.decorateEnum=function(W){if(W.$type)return W.$type;B||(B=require_enum());var X=new B("Enum"+$++,W);return V.decorateRoot.add(X),Object.defineProperty(W,"$type",{value:X,enumerable:!1}),X},V.setProperty=function(W,X,ee,ie){function ne(re,se,de){var oe=se.shift();if(oe==="__proto__"||oe==="prototype")return re;if(se.length>0)re[oe]=ne(re[oe]||{},se,de);else{var le=re[oe];if(le&&ie)return re;le&&(de=[].concat(le).concat(de)),re[oe]=de}return re}if(typeof W!="object")throw TypeError("dst must be an object");if(!X)throw TypeError("path must be specified");return X=X.split("."),ne(W,X,ee)},Object.defineProperty(V,"decorateRoot",{get:function(){return U.decorated||(U.decorated=new(requireRoot()))}}),util.exports}var hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,function(V){var U=V,j=requireUtil(),B=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function z(H,G){var $=0,Q={};for(G|=0;$<H.length;)Q[B[$+G]]=H[$++];return Q}U.basic=z([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),U.defaults=z([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",j.emptyArray,null]),U.long=z([0,0,0,1,1],7),U.mapKey=z([0,0,0,5,5,0,0,0,1,1,0,2],2),U.packed=z([1,5,0,0,0,5,5,0,0,0,1,1,0])}(types)),types}var field,hasRequiredField;function requireField(){if(hasRequiredField)return field;hasRequiredField=1,field=G;var V=requireObject();((G.prototype=Object.create(V.prototype)).constructor=G).className="Field";var U=require_enum(),j=requireTypes(),B=requireUtil(),z,H=/^required|optional|repeated$/;G.fromJSON=function(Q,W){var X=new G(Q,W.id,W.type,W.rule,W.extend,W.options,W.comment);return W.edition&&(X._edition=W.edition),X._defaultEdition="proto3",X};function G($,Q,W,X,ee,ie,ne){if(B.isObject(X)?(ne=ee,ie=X,X=ee=void 0):B.isObject(ee)&&(ne=ie,ie=ee,ee=void 0),V.call(this,$,ie),!B.isInteger(Q)||Q<0)throw TypeError("id must be a non-negative integer");if(!B.isString(W))throw TypeError("type must be a string");if(X!==void 0&&!H.test(X=X.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(ee!==void 0&&!B.isString(ee))throw TypeError("extend must be a string");X==="proto3_optional"&&(X="optional"),this.rule=X&&X!=="optional"?X:void 0,this.type=W,this.id=Q,this.extend=ee||void 0,this.repeated=X==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=B.Long?j.long[W]!==void 0:!1,this.bytes=W==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=ne}return Object.defineProperty(G.prototype,"required",{get:function(){return this._features.field_presence==="LEGACY_REQUIRED"}}),Object.defineProperty(G.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(G.prototype,"delimited",{get:function(){return this.resolvedType instanceof z&&this._features.message_encoding==="DELIMITED"}}),Object.defineProperty(G.prototype,"packed",{get:function(){return this._features.repeated_field_encoding==="PACKED"}}),Object.defineProperty(G.prototype,"hasPresence",{get:function(){return this.repeated||this.map?!1:this.partOf||this.declaringField||this.extensionField||this._features.field_presence!=="IMPLICIT"}}),G.prototype.setOption=function(Q,W,X){return V.prototype.setOption.call(this,Q,W,X)},G.prototype.toJSON=function(Q){var W=Q?!!Q.keepComments:!1;return B.toObject(["edition",this._editionToJSON(),"rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",W?this.comment:void 0])},G.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=j.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof z?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof U&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof U)&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=B.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var Q;B.base64.test(this.typeDefault)?B.base64.decode(this.typeDefault,Q=B.newBuffer(B.base64.length(this.typeDefault)),0):B.utf8.write(this.typeDefault,Q=B.newBuffer(B.utf8.length(this.typeDefault)),0),this.typeDefault=Q}return this.map?this.defaultValue=B.emptyObject:this.repeated?this.defaultValue=B.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof z&&(this.parent.ctor.prototype[this.name]=this.defaultValue),V.prototype.resolve.call(this)},G.prototype._inferLegacyProtoFeatures=function(Q){if(Q!=="proto2"&&Q!=="proto3")return{};var W={};if(this.rule==="required"&&(W.field_presence="LEGACY_REQUIRED"),this.parent&&j.defaults[this.type]===void 0){var X=this.parent.get(this.type.split(".").pop());X&&X instanceof z&&X.group&&(W.message_encoding="DELIMITED")}return this.getOption("packed")===!0?W.repeated_field_encoding="PACKED":this.getOption("packed")===!1&&(W.repeated_field_encoding="EXPANDED"),W},G.prototype._resolveFeatures=function(Q){return V.prototype._resolveFeatures.call(this,this._edition||Q)},G.d=function(Q,W,X,ee){return typeof W=="function"?W=B.decorateType(W).name:W&&typeof W=="object"&&(W=B.decorateEnum(W).name),function(ne,re){B.decorateType(ne.constructor).add(new G(re,Q,W,X,{default:ee}))}},G._configure=function(Q){z=Q},field}var oneof,hasRequiredOneof;function requireOneof(){if(hasRequiredOneof)return oneof;hasRequiredOneof=1,oneof=B;var V=requireObject();((B.prototype=Object.create(V.prototype)).constructor=B).className="OneOf";var U=requireField(),j=requireUtil();function B(H,G,$,Q){if(Array.isArray(G)||($=G,G=void 0),V.call(this,H,$),!(G===void 0||Array.isArray(G)))throw TypeError("fieldNames must be an Array");this.oneof=G||[],this.fieldsArray=[],this.comment=Q}B.fromJSON=function(G,$){return new B(G,$.oneof,$.options,$.comment)},B.prototype.toJSON=function(G){var $=G?!!G.keepComments:!1;return j.toObject(["options",this.options,"oneof",this.oneof,"comment",$?this.comment:void 0])};function z(H){if(H.parent)for(var G=0;G<H.fieldsArray.length;++G)H.fieldsArray[G].parent||H.parent.add(H.fieldsArray[G])}return B.prototype.add=function(G){if(!(G instanceof U))throw TypeError("field must be a Field");return G.parent&&G.parent!==this.parent&&G.parent.remove(G),this.oneof.push(G.name),this.fieldsArray.push(G),G.partOf=this,z(this),this},B.prototype.remove=function(G){if(!(G instanceof U))throw TypeError("field must be a Field");var $=this.fieldsArray.indexOf(G);if($<0)throw Error(G+" is not a member of "+this);return this.fieldsArray.splice($,1),$=this.oneof.indexOf(G.name),$>-1&&this.oneof.splice($,1),G.partOf=null,this},B.prototype.onAdd=function(G){V.prototype.onAdd.call(this,G);for(var $=this,Q=0;Q<this.oneof.length;++Q){var W=G.get(this.oneof[Q]);W&&!W.partOf&&(W.partOf=$,$.fieldsArray.push(W))}z(this)},B.prototype.onRemove=function(G){for(var $=0,Q;$<this.fieldsArray.length;++$)(Q=this.fieldsArray[$]).parent&&Q.parent.remove(Q);V.prototype.onRemove.call(this,G)},Object.defineProperty(B.prototype,"isProto3Optional",{get:function(){if(this.fieldsArray==null||this.fieldsArray.length!==1)return!1;var H=this.fieldsArray[0];return H.options!=null&&H.options.proto3_optional===!0}}),B.d=function(){for(var G=new Array(arguments.length),$=0;$<arguments.length;)G[$]=arguments[$++];return function(W,X){j.decorateType(W.constructor).add(new B(X,G)),Object.defineProperty(W,X,{get:j.oneOfGetter(G),set:j.oneOfSetter(G)})}},oneof}var object,hasRequiredObject;function requireObject(){if(hasRequiredObject)return object;hasRequiredObject=1,object=G,G.className="ReflectionObject";const V=requireOneof();var U=requireUtil(),j,B={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},z={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},H={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function G($,Q){if(!U.isString($))throw TypeError("name must be a string");if(Q&&!U.isObject(Q))throw TypeError("options must be an object");this.options=Q,this.parsedOptions=null,this.name=$,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}return Object.defineProperties(G.prototype,{root:{get:function(){for(var $=this;$.parent!==null;)$=$.parent;return $}},fullName:{get:function(){for(var $=[this.name],Q=this.parent;Q;)$.unshift(Q.name),Q=Q.parent;return $.join(".")}}}),G.prototype.toJSON=function(){throw Error()},G.prototype.onAdd=function(Q){this.parent&&this.parent!==Q&&this.parent.remove(this),this.parent=Q,this.resolved=!1;var W=Q.root;W instanceof j&&W._handleAdd(this)},G.prototype.onRemove=function(Q){var W=Q.root;W instanceof j&&W._handleRemove(this),this.parent=null,this.resolved=!1},G.prototype.resolve=function(){return this.resolved?this:(this.root instanceof j&&(this.resolved=!0),this)},G.prototype._resolveFeaturesRecursive=function(Q){return this._resolveFeatures(this._edition||Q)},G.prototype._resolveFeatures=function(Q){if(!this._featuresResolved){var W={};if(!Q)throw new Error("Unknown edition for "+this.fullName);var X=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(Q));if(this._edition){if(Q==="proto2")W=Object.assign({},z);else if(Q==="proto3")W=Object.assign({},H);else if(Q==="2023")W=Object.assign({},B);else throw new Error("Unknown edition: "+Q);this._features=Object.assign(W,X||{}),this._featuresResolved=!0;return}if(this.partOf instanceof V){var ee=Object.assign({},this.partOf._features);this._features=Object.assign(ee,X||{})}else if(!this.declaringField)if(this.parent){var ie=Object.assign({},this.parent._features);this._features=Object.assign(ie,X||{})}else throw new Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},G.prototype._inferLegacyProtoFeatures=function(){return{}},G.prototype.getOption=function(Q){if(this.options)return this.options[Q]},G.prototype.setOption=function(Q,W,X){return this.options||(this.options={}),/^features\./.test(Q)?U.setProperty(this.options,Q,W,X):(!X||this.options[Q]===void 0)&&(this.getOption(Q)!==W&&(this.resolved=!1),this.options[Q]=W),this},G.prototype.setParsedOption=function(Q,W,X){this.parsedOptions||(this.parsedOptions=[]);var ee=this.parsedOptions;if(X){var ie=ee.find(function(se){return Object.prototype.hasOwnProperty.call(se,Q)});if(ie){var ne=ie[Q];U.setProperty(ne,X,W)}else ie={},ie[Q]=U.setProperty({},X,W),ee.push(ie)}else{var re={};re[Q]=W,ee.push(re)}return this},G.prototype.setOptions=function(Q,W){if(Q)for(var X=Object.keys(Q),ee=0;ee<X.length;++ee)this.setOption(X[ee],Q[X[ee]],W);return this},G.prototype.toString=function(){var Q=this.constructor.className,W=this.fullName;return W.length?Q+" "+W:Q},G.prototype._editionToJSON=function(){if(!(!this._edition||this._edition==="proto3"))return this._edition},G._configure=function($){j=$},object}var _enum,hasRequired_enum;function require_enum(){if(hasRequired_enum)return _enum;hasRequired_enum=1,_enum=B;var V=requireObject();((B.prototype=Object.create(V.prototype)).constructor=B).className="Enum";var U=requireNamespace(),j=requireUtil();function B(z,H,G,$,Q,W){if(V.call(this,z,G),H&&typeof H!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=$,this.comments=Q||{},this.valuesOptions=W,this._valuesFeatures={},this.reserved=void 0,H)for(var X=Object.keys(H),ee=0;ee<X.length;++ee)typeof H[X[ee]]=="number"&&(this.valuesById[this.values[X[ee]]=H[X[ee]]]=X[ee])}return B.prototype._resolveFeatures=function(H){return H=this._edition||H,V.prototype._resolveFeatures.call(this,H),Object.keys(this.values).forEach(G=>{var $=Object.assign({},this._features);this._valuesFeatures[G]=Object.assign($,this.valuesOptions&&this.valuesOptions[G]&&this.valuesOptions[G].features)}),this},B.fromJSON=function(H,G){var $=new B(H,G.values,G.options,G.comment,G.comments);return $.reserved=G.reserved,G.edition&&($._edition=G.edition),$._defaultEdition="proto3",$},B.prototype.toJSON=function(H){var G=H?!!H.keepComments:!1;return j.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",G?this.comment:void 0,"comments",G?this.comments:void 0])},B.prototype.add=function(H,G,$,Q){if(!j.isString(H))throw TypeError("name must be a string");if(!j.isInteger(G))throw TypeError("id must be an integer");if(this.values[H]!==void 0)throw Error("duplicate name '"+H+"' in "+this);if(this.isReservedId(G))throw Error("id "+G+" is reserved in "+this);if(this.isReservedName(H))throw Error("name '"+H+"' is reserved in "+this);if(this.valuesById[G]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+G+" in "+this);this.values[H]=G}else this.valuesById[this.values[H]=G]=H;return Q&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[H]=Q||null),this.comments[H]=$||null,this},B.prototype.remove=function(H){if(!j.isString(H))throw TypeError("name must be a string");var G=this.values[H];if(G==null)throw Error("name '"+H+"' does not exist in "+this);return delete this.valuesById[G],delete this.values[H],delete this.comments[H],this.valuesOptions&&delete this.valuesOptions[H],this},B.prototype.isReservedId=function(H){return U.isReservedId(this.reserved,H)},B.prototype.isReservedName=function(H){return U.isReservedName(this.reserved,H)},_enum}var encoder_1,hasRequiredEncoder;function requireEncoder(){if(hasRequiredEncoder)return encoder_1;hasRequiredEncoder=1,encoder_1=z;var V=require_enum(),U=requireTypes(),j=requireUtil();function B(H,G,$,Q){return G.delimited?H("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",$,Q,(G.id<<3|3)>>>0,(G.id<<3|4)>>>0):H("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",$,Q,(G.id<<3|2)>>>0)}function z(H){for(var G=j.codegen(["m","w"],H.name+"$encode")("if(!w)")("w=Writer.create()"),$,Q,W=H.fieldsArray.slice().sort(j.compareFieldsById),$=0;$<W.length;++$){var X=W[$].resolve(),ee=H._fieldsArray.indexOf(X),ie=X.resolvedType instanceof V?"int32":X.type,ne=U.basic[ie];Q="m"+j.safeProp(X.name),X.map?(G("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",Q,X.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",Q)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(X.id<<3|2)>>>0,8|U.mapKey[X.keyType],X.keyType),ne===void 0?G("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",ee,Q):G(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|ne,ie,Q),G("}")("}")):X.repeated?(G("if(%s!=null&&%s.length){",Q,Q),X.packed&&U.packed[ie]!==void 0?G("w.uint32(%i).fork()",(X.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",Q)("w.%s(%s[i])",ie,Q)("w.ldelim()"):(G("for(var i=0;i<%s.length;++i)",Q),ne===void 0?B(G,X,ee,Q+"[i]"):G("w.uint32(%i).%s(%s[i])",(X.id<<3|ne)>>>0,ie,Q)),G("}")):(X.optional&&G("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",Q,X.name),ne===void 0?B(G,X,ee,Q):G("w.uint32(%i).%s(%s)",(X.id<<3|ne)>>>0,ie,Q))}return G("return w")}return encoder_1}var hasRequiredIndexLight;function requireIndexLight(){if(hasRequiredIndexLight)return indexLight.exports;hasRequiredIndexLight=1;var V=indexLight.exports=requireIndexMinimal();V.build="light";function U(B,z,H){return typeof z=="function"?(H=z,z=new V.Root):z||(z=new V.Root),z.load(B,H)}V.load=U;function j(B,z){return z||(z=new V.Root),z.loadSync(B)}return V.loadSync=j,V.encoder=requireEncoder(),V.decoder=requireDecoder(),V.verifier=requireVerifier(),V.converter=requireConverter(),V.ReflectionObject=requireObject(),V.Namespace=requireNamespace(),V.Root=requireRoot(),V.Enum=require_enum(),V.Type=requireType(),V.Field=requireField(),V.OneOf=requireOneof(),V.MapField=requireMapfield(),V.Service=requireService(),V.Method=requireMethod(),V.Message=requireMessage(),V.wrappers=requireWrappers(),V.types=requireTypes(),V.util=requireUtil(),V.ReflectionObject._configure(V.Root),V.Namespace._configure(V.Type,V.Service,V.Enum),V.Root._configure(V.Type),V.Field._configure(V.Type),indexLight.exports}var tokenize_1,hasRequiredTokenize;function requireTokenize(){if(hasRequiredTokenize)return tokenize_1;hasRequiredTokenize=1,tokenize_1=X;var V=/[\s{}=;:[\],'"()<>]/g,U=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,j=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,B=/^ *[*/]+ */,z=/^\s*\*?\/*/,H=/\n/g,G=/\s/,$=/\\(.?)/g,Q={0:"\0",r:"\r",n:`
`,t:"	"};function W(ee){return ee.replace($,function(ie,ne){switch(ne){case"\\":case"":return ne;default:return Q[ne]||""}})}X.unescape=W;function X(ee,ie){ee=ee.toString();var ne=0,re=ee.length,se=1,de=0,oe={},le=[],ue=null;function fe(qe){return Error("illegal "+qe+" (line "+se+")")}function he(){var qe=ue==="'"?j:U;qe.lastIndex=ne-1;var be=qe.exec(ee);if(!be)throw fe("string");return ne=qe.lastIndex,Ce(ue),ue=null,W(be[1])}function ge(qe){return ee.charAt(qe)}function Ae(qe,be,Re){var Be={type:ee.charAt(qe++),lineEmpty:!1,leading:Re},We;ie?We=2:We=3;var pe=qe-We,we;do if(--pe<0||(we=ee.charAt(pe))===`
`){Be.lineEmpty=!0;break}while(we===" "||we==="	");for(var je=ee.substring(qe,be).split(H),Ue=0;Ue<je.length;++Ue)je[Ue]=je[Ue].replace(ie?z:B,"").trim();Be.text=je.join(`
`).trim(),oe[se]=Be,de=se}function _e(qe){var be=Pe(qe),Re=ee.substring(qe,be),Be=/^\s*\/\//.test(Re);return Be}function Pe(qe){for(var be=qe;be<re&&ge(be)!==`
`;)be++;return be}function xe(){if(le.length>0)return le.shift();if(ue)return he();var qe,be,Re,Be,We,pe=ne===0;do{if(ne===re)return null;for(qe=!1;G.test(Re=ge(ne));)if(Re===`
`&&(pe=!0,++se),++ne===re)return null;if(ge(ne)==="/"){if(++ne===re)throw fe("comment");if(ge(ne)==="/")if(ie){if(Be=ne,We=!1,_e(ne-1)){We=!0;do if(ne=Pe(ne),ne===re||(ne++,!pe))break;while(_e(ne))}else ne=Math.min(re,Pe(ne)+1);We&&(Ae(Be,ne,pe),pe=!0),se++,qe=!0}else{for(We=ge(Be=ne+1)==="/";ge(++ne)!==`
`;)if(ne===re)return null;++ne,We&&(Ae(Be,ne-1,pe),pe=!0),++se,qe=!0}else if((Re=ge(ne))==="*"){Be=ne+1,We=ie||ge(Be)==="*";do{if(Re===`
`&&++se,++ne===re)throw fe("comment");be=Re,Re=ge(ne)}while(be!=="*"||Re!=="/");++ne,We&&(Ae(Be,ne-2,pe),pe=!0),qe=!0}else return"/"}}while(qe);var we=ne;V.lastIndex=0;var je=V.test(ge(we++));if(!je)for(;we<re&&!V.test(ge(we));)++we;var Ue=ee.substring(ne,ne=we);return(Ue==='"'||Ue==="'")&&(ue=Ue),Ue}function Ce(qe){le.push(qe)}function ze(){if(!le.length){var qe=xe();if(qe===null)return null;Ce(qe)}return le[0]}function $e(qe,be){var Re=ze(),Be=Re===qe;if(Be)return xe(),!0;if(!be)throw fe("token '"+Re+"', '"+qe+"' expected");return!1}function Fe(qe){var be=null,Re;return qe===void 0?(Re=oe[se-1],delete oe[se-1],Re&&(ie||Re.type==="*"||Re.lineEmpty)&&(be=Re.leading?Re.text:null)):(de<qe&&ze(),Re=oe[qe],delete oe[qe],Re&&!Re.lineEmpty&&(ie||Re.type==="/")&&(be=Re.leading?null:Re.text)),be}return Object.defineProperty({next:xe,peek:ze,push:Ce,skip:$e,cmnt:Fe},"line",{get:function(){return se}})}return tokenize_1}var parse_1,hasRequiredParse;function requireParse(){if(hasRequiredParse)return parse_1;hasRequiredParse=1,parse_1=he,he.filename=null,he.defaults={keepCase:!1};var V=requireTokenize(),U=requireRoot(),j=requireType(),B=requireField(),z=requireMapfield(),H=requireOneof(),G=require_enum(),$=requireService(),Q=requireMethod(),W=requireObject(),X=requireTypes(),ee=requireUtil(),ie=/^[1-9][0-9]*$/,ne=/^-?[1-9][0-9]*$/,re=/^0[x][0-9a-fA-F]+$/,se=/^-?0[x][0-9a-fA-F]+$/,de=/^0[0-7]+$/,oe=/^-?0[0-7]+$/,le=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,ue=/^[a-zA-Z_][a-zA-Z_0-9]*$/,fe=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function he(ge,Ae,_e){Ae instanceof U||(_e=Ae,Ae=new U),_e||(_e=he.defaults);var Pe=_e.preferTrailingComment||!1,xe=V(ge,_e.alternateCommentMode||!1),Ce=xe.next,ze=xe.push,$e=xe.peek,Fe=xe.skip,qe=xe.cmnt,be=!0,Re,Be,We,pe="proto2",we=Ae,je=[],Ue={},Ge=_e.keepCase?function(Ne){return Ne}:ee.camelCase;function He(){je.forEach(Ne=>{Ne._edition=pe,Object.keys(Ue).forEach(Me=>{Ne.getOption(Me)===void 0&&Ne.setOption(Me,Ue[Me],!0)})})}function De(Ne,Me,Ve){var Ke=he.filename;return Ve||(he.filename=null),Error("illegal "+(Me||"token")+" '"+Ne+"' ("+(Ke?Ke+", ":"")+"line "+xe.line+")")}function lt(){var Ne=[],Me;do{if((Me=Ce())!=='"'&&Me!=="'")throw De(Me);Ne.push(Ce()),Fe(Me),Me=$e()}while(Me==='"'||Me==="'");return Ne.join("")}function ut(Ne){var Me=Ce();switch(Me){case"'":case'"':return ze(Me),lt();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return tt(Me,!0)}catch{if(fe.test(Me))return Me;throw De(Me,"value")}}function Je(Ne,Me){var Ve,Ke;do if(Me&&((Ve=$e())==='"'||Ve==="'")){var Qe=lt();if(Ne.push(Qe),pe>=2023)throw De(Qe,"id")}else try{Ne.push([Ke=St(Ce()),Fe("to",!0)?St(Ce()):Ke])}catch(yt){if(Me&&fe.test(Ve)&&pe>=2023)Ne.push(Ve);else throw yt}while(Fe(",",!0));var nt={options:void 0};nt.setOption=function(yt,Dt){this.options===void 0&&(this.options={}),this.options[yt]=Dt},Et(nt,function(Dt){if(Dt==="option")ii(nt,Dt),Fe(";");else throw De(Dt)},function(){It(nt)})}function tt(Ne,Me){var Ve=1;switch(Ne.charAt(0)==="-"&&(Ve=-1,Ne=Ne.substring(1)),Ne){case"inf":case"INF":case"Inf":return Ve*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(ie.test(Ne))return Ve*parseInt(Ne,10);if(re.test(Ne))return Ve*parseInt(Ne,16);if(de.test(Ne))return Ve*parseInt(Ne,8);if(le.test(Ne))return Ve*parseFloat(Ne);throw De(Ne,"number",Me)}function St(Ne,Me){switch(Ne){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!Me&&Ne.charAt(0)==="-")throw De(Ne,"id");if(ne.test(Ne))return parseInt(Ne,10);if(se.test(Ne))return parseInt(Ne,16);if(oe.test(Ne))return parseInt(Ne,8);throw De(Ne,"id")}function ti(){if(Re!==void 0)throw De("package");if(Re=Ce(),!fe.test(Re))throw De(Re,"name");we=we.define(Re),Fe(";")}function $t(){var Ne=$e(),Me;switch(Ne){case"weak":Me=We||(We=[]),Ce();break;case"public":Ce();default:Me=Be||(Be=[]);break}Ne=lt(),Fe(";"),Me.push(Ne)}function br(){if(Fe("="),pe=lt(),pe<2023)throw De(pe,"syntax");Fe(";")}function ws(){if(Fe("="),pe=lt(),!["2023"].includes(pe))throw De(pe,"edition");Fe(";")}function Tr(Ne,Me){switch(Me){case"option":return ii(Ne,Me),Fe(";"),!0;case"message":return ga(Ne,Me),!0;case"enum":return Sr(Ne,Me),!0;case"service":return Ds(Ne,Me),!0;case"extend":return Ms(Ne,Me),!0}return!1}function Et(Ne,Me,Ve){var Ke=xe.line;if(Ne&&(typeof Ne.comment!="string"&&(Ne.comment=qe()),Ne.filename=he.filename),Fe("{",!0)){for(var Qe;(Qe=Ce())!=="}";)Me(Qe);Fe(";",!0)}else Ve&&Ve(),Fe(";"),Ne&&(typeof Ne.comment!="string"||Pe)&&(Ne.comment=qe(Ke)||Ne.comment)}function ga(Ne,Me){if(!ue.test(Me=Ce()))throw De(Me,"type name");var Ve=new j(Me);Et(Ve,function(Qe){if(!Tr(Ve,Qe))switch(Qe){case"map":Dn(Ve);break;case"required":if(pe!=="proto2")throw De(Qe);case"repeated":Qt(Ve,Qe);break;case"optional":if(pe==="proto3")Qt(Ve,"proto3_optional");else{if(pe!=="proto2")throw De(Qe);Qt(Ve,"optional")}break;case"oneof":As(Ve,Qe);break;case"extensions":Je(Ve.extensions||(Ve.extensions=[]));break;case"reserved":Je(Ve.reserved||(Ve.reserved=[]),!0);break;default:if(pe==="proto2"||!fe.test(Qe))throw De(Qe);ze(Qe),Qt(Ve,"optional");break}}),Ne.add(Ve),Ne===we&&je.push(Ve)}function Qt(Ne,Me,Ve){var Ke=Ce();if(Ke==="group"){va(Ne,Me);return}for(;Ke.endsWith(".")||$e().startsWith(".");)Ke+=Ce();if(!fe.test(Ke))throw De(Ke,"type");var Qe=Ce();if(!ue.test(Qe))throw De(Qe,"name");Qe=Ge(Qe),Fe("=");var nt=new B(Qe,St(Ce()),Ke,Me,Ve);if(Et(nt,function(wt){if(wt==="option")ii(nt,wt),Fe(";");else throw De(wt)},function(){It(nt)}),Me==="proto3_optional"){var yt=new H("_"+Qe);nt.setOption("proto3_optional",!0),yt.add(nt),Ne.add(yt)}else Ne.add(nt);Ne===we&&je.push(nt)}function va(Ne,Me){if(pe>=2023)throw De("group");var Ve=Ce();if(!ue.test(Ve))throw De(Ve,"name");var Ke=ee.lcFirst(Ve);Ve===Ke&&(Ve=ee.ucFirst(Ve)),Fe("=");var Qe=St(Ce()),nt=new j(Ve);nt.group=!0;var yt=new B(Ke,Qe,Ve,Me);yt.filename=he.filename,Et(nt,function(wt){switch(wt){case"option":ii(nt,wt),Fe(";");break;case"required":case"repeated":Qt(nt,wt);break;case"optional":pe==="proto3"?Qt(nt,"proto3_optional"):Qt(nt,"optional");break;case"message":ga(nt,wt);break;case"enum":Sr(nt,wt);break;case"reserved":Je(nt.reserved||(nt.reserved=[]),!0);break;default:throw De(wt)}}),Ne.add(nt).add(yt)}function Dn(Ne){Fe("<");var Me=Ce();if(X.mapKey[Me]===void 0)throw De(Me,"type");Fe(",");var Ve=Ce();if(!fe.test(Ve))throw De(Ve,"type");Fe(">");var Ke=Ce();if(!ue.test(Ke))throw De(Ke,"name");Fe("=");var Qe=new z(Ge(Ke),St(Ce()),Me,Ve);Et(Qe,function(yt){if(yt==="option")ii(Qe,yt),Fe(";");else throw De(yt)},function(){It(Qe)}),Ne.add(Qe)}function As(Ne,Me){if(!ue.test(Me=Ce()))throw De(Me,"name");var Ve=new H(Ge(Me));Et(Ve,function(Qe){Qe==="option"?(ii(Ve,Qe),Fe(";")):(ze(Qe),Qt(Ve,"optional"))}),Ne.add(Ve)}function Sr(Ne,Me){if(!ue.test(Me=Ce()))throw De(Me,"name");var Ve=new G(Me);Et(Ve,function(Qe){switch(Qe){case"option":ii(Ve,Qe),Fe(";");break;case"reserved":Je(Ve.reserved||(Ve.reserved=[]),!0),Ve.reserved===void 0&&(Ve.reserved=[]);break;default:Ps(Ve,Qe)}}),Ne.add(Ve),Ne===we&&je.push(Ve)}function Ps(Ne,Me){if(!ue.test(Me))throw De(Me,"name");Fe("=");var Ve=St(Ce(),!0),Ke={options:void 0};Ke.getOption=function(Qe){return this.options[Qe]},Ke.setOption=function(Qe,nt){W.prototype.setOption.call(Ke,Qe,nt)},Ke.setParsedOption=function(){},Et(Ke,function(nt){if(nt==="option")ii(Ke,nt),Fe(";");else throw De(nt)},function(){It(Ke)}),Ne.add(Me,Ve,Ke.comment,Ke.parsedOptions||Ke.options)}function ii(Ne,Me){var Ve,Ke,Qe=!0;for(Me==="option"&&(Me=Ce());Me!=="=";){if(Me==="("){var nt=Ce();Fe(")"),Me="("+nt+")"}if(Qe){if(Qe=!1,Me.includes(".")&&!Me.includes("(")){var yt=Me.split(".");Ve=yt[0]+".",Me=yt[1];continue}Ve=Me}else Ke=Ke?Ke+=Me:Me;Me=Ce()}var Dt=Ke?Ve.concat(Ke):Ve,wt=zi(Ne,Dt);Ke=Ke&&Ke[0]==="."?Ke.slice(1):Ke,Ve=Ve&&Ve[Ve.length-1]==="."?Ve.slice(0,-1):Ve,Ci(Ne,Ve,wt,Ke)}function zi(Ne,Me){if(Fe("{",!0)){for(var Ve={};!Fe("}",!0);){if(!ue.test(_t=Ce()))throw De(_t,"name");if(_t===null)throw De(_t,"end of input");var Ke,Qe=_t;if(Fe(":",!0),$e()==="{")Ke=zi(Ne,Me+"."+_t);else if($e()==="["){Ke=[];var nt;if(Fe("[",!0)){do nt=ut(),Ke.push(nt);while(Fe(",",!0));Fe("]"),typeof nt<"u"&&qt(Ne,Me+"."+_t,nt)}}else Ke=ut(),qt(Ne,Me+"."+_t,Ke);var yt=Ve[Qe];yt&&(Ke=[].concat(yt).concat(Ke)),Ve[Qe]=Ke,Fe(",",!0),Fe(";",!0)}return Ve}var Dt=ut();return qt(Ne,Me,Dt),Dt}function qt(Ne,Me,Ve){if(we===Ne&&/^features\./.test(Me)){Ue[Me]=Ve;return}Ne.setOption&&Ne.setOption(Me,Ve)}function Ci(Ne,Me,Ve,Ke){Ne.setParsedOption&&Ne.setParsedOption(Me,Ve,Ke)}function It(Ne){if(Fe("[",!0)){do ii(Ne,"option");while(Fe(",",!0));Fe("]")}return Ne}function Ds(Ne,Me){if(!ue.test(Me=Ce()))throw De(Me,"service name");var Ve=new $(Me);Et(Ve,function(Qe){if(!Tr(Ve,Qe))if(Qe==="rpc")Os(Ve,Qe);else throw De(Qe)}),Ne.add(Ve),Ne===we&&je.push(Ve)}function Os(Ne,Me){var Ve=qe(),Ke=Me;if(!ue.test(Me=Ce()))throw De(Me,"name");var Qe=Me,nt,yt,Dt,wt;if(Fe("("),Fe("stream",!0)&&(yt=!0),!fe.test(Me=Ce())||(nt=Me,Fe(")"),Fe("returns"),Fe("("),Fe("stream",!0)&&(wt=!0),!fe.test(Me=Ce())))throw De(Me);Dt=Me,Fe(")");var On=new Q(Qe,Ke,nt,Dt,yt,wt);On.comment=Ve,Et(On,function(Mn){if(Mn==="option")ii(On,Mn),Fe(";");else throw De(Mn)}),Ne.add(On)}function Ms(Ne,Me){if(!fe.test(Me=Ce()))throw De(Me,"reference");var Ve=Me;Et(null,function(Qe){switch(Qe){case"required":case"repeated":Qt(Ne,Qe,Ve);break;case"optional":pe==="proto3"?Qt(Ne,"proto3_optional",Ve):Qt(Ne,"optional",Ve);break;default:if(pe==="proto2"||!fe.test(Qe))throw De(Qe);ze(Qe),Qt(Ne,"optional",Ve);break}})}for(var _t;(_t=Ce())!==null;)switch(_t){case"package":if(!be)throw De(_t);ti();break;case"import":if(!be)throw De(_t);$t();break;case"syntax":if(!be)throw De(_t);br();break;case"edition":if(!be)throw De(_t);ws();break;case"option":ii(we,_t),Fe(";",!0);break;default:if(Tr(we,_t)){be=!1;continue}throw De(_t)}return He(),he.filename=null,{package:Re,imports:Be,weakImports:We,root:Ae}}return parse_1}var common_1,hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common_1;hasRequiredCommon=1,common_1=U;var V=/\/|\./;function U(B,z){V.test(B)||(B="google/protobuf/"+B+".proto",z={nested:{google:{nested:{protobuf:{nested:z}}}}}),U[B]=z}U("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var j;return U("duration",{Duration:j={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),U("timestamp",{Timestamp:j}),U("empty",{Empty:{fields:{}}}),U("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),U("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),U("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),U.get=function(z){return U[z]||null},common_1}var hasRequiredSrc;function requireSrc(){if(hasRequiredSrc)return src.exports;hasRequiredSrc=1;var V=src.exports=requireIndexLight();return V.build="full",V.tokenize=requireTokenize(),V.parse=requireParse(),V.common=requireCommon(),V.Root._configure(V.Type,V.parse,V.common),src.exports}var protobufjs,hasRequiredProtobufjs;function requireProtobufjs(){return hasRequiredProtobufjs||(hasRequiredProtobufjs=1,protobufjs=requireSrc()),protobufjs}var protobufjsExports=requireProtobufjs();const protobuf=getDefaultExportFromCjs$1(protobufjsExports);var extendStatics=function(V,U){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,B){j.__proto__=B}||function(j,B){for(var z in B)Object.prototype.hasOwnProperty.call(B,z)&&(j[z]=B[z])},extendStatics(V,U)};function __extends(V,U){if(typeof U!="function"&&U!==null)throw new TypeError("Class extends value "+String(U)+" is not a constructor or null");extendStatics(V,U);function j(){this.constructor=V}V.prototype=U===null?Object.create(U):(j.prototype=U.prototype,new j)}var __assign=function(){return __assign=Object.assign||function(U){for(var j,B=1,z=arguments.length;B<z;B++){j=arguments[B];for(var H in j)Object.prototype.hasOwnProperty.call(j,H)&&(U[H]=j[H])}return U},__assign.apply(this,arguments)};function __awaiter(V,U,j,B){function z(H){return H instanceof j?H:new j(function(G){G(H)})}return new(j||(j=Promise))(function(H,G){function $(X){try{W(B.next(X))}catch(ee){G(ee)}}function Q(X){try{W(B.throw(X))}catch(ee){G(ee)}}function W(X){X.done?H(X.value):z(X.value).then($,Q)}W((B=B.apply(V,U||[])).next())})}function __generator(V,U){var j={label:0,sent:function(){if(H[0]&1)throw H[1];return H[1]},trys:[],ops:[]},B,z,H,G;return G={next:$(0),throw:$(1),return:$(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function $(W){return function(X){return Q([W,X])}}function Q(W){if(B)throw new TypeError("Generator is already executing.");for(;G&&(G=0,W[0]&&(j=0)),j;)try{if(B=1,z&&(H=W[0]&2?z.return:W[0]?z.throw||((H=z.return)&&H.call(z),0):z.next)&&!(H=H.call(z,W[1])).done)return H;switch(z=0,H&&(W=[W[0]&2,H.value]),W[0]){case 0:case 1:H=W;break;case 4:return j.label++,{value:W[1],done:!1};case 5:j.label++,z=W[1],W=[0];continue;case 7:W=j.ops.pop(),j.trys.pop();continue;default:if(H=j.trys,!(H=H.length>0&&H[H.length-1])&&(W[0]===6||W[0]===2)){j=0;continue}if(W[0]===3&&(!H||W[1]>H[0]&&W[1]<H[3])){j.label=W[1];break}if(W[0]===6&&j.label<H[1]){j.label=H[1],H=W;break}if(H&&j.label<H[2]){j.label=H[2],j.ops.push(W);break}H[2]&&j.ops.pop(),j.trys.pop();continue}W=U.call(V,j)}catch(X){W=[6,X],z=0}finally{B=H=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}}typeof SuppressedError=="function"&&SuppressedError;var options={syntax:"proto3"},nested={pipecat:{nested:{TextFrame:{fields:{id:{type:"uint64",id:1},name:{type:"string",id:2},text:{type:"string",id:3}}},AudioRawFrame:{fields:{id:{type:"uint64",id:1},name:{type:"string",id:2},audio:{type:"bytes",id:3},sampleRate:{type:"uint32",id:4},numChannels:{type:"uint32",id:5}}},TranscriptionFrame:{fields:{id:{type:"uint64",id:1},name:{type:"string",id:2},text:{type:"string",id:3},userId:{type:"string",id:4},timestamp:{type:"string",id:5}}},Frame:{oneofs:{frame:{oneof:["text","audio","transcription"]}},fields:{text:{type:"TextFrame",id:1},audio:{type:"AudioRawFrame",id:2},transcription:{type:"TranscriptionFrame",id:3}}}}}},jsonDescriptor={options,nested},ConnectionQuality;(function(V){V.UNKNOWN="UNKNOWN",V.GOOD="GOOD",V.BAD="BAD"})(ConnectionQuality||(ConnectionQuality={}));var AbstractConnectionQualityIndicator=function(){function V(U){this._connectionQuality=ConnectionQuality.UNKNOWN,this.onConnectionQualityChanged=U}return Object.defineProperty(V.prototype,"connectionQuality",{get:function(){return this._connectionQuality},enumerable:!1,configurable:!0}),V.prototype.handleStatsChanged=function(){var U=this.calculateConnectionQuality();U!==this._connectionQuality&&(this._connectionQuality=U,this.onConnectionQualityChanged(U))},V.prototype.start=function(U){this.stop(!0),this._start(U)},V.prototype.stop=function(U){U===void 0&&(U=!1),this._stop(),this._connectionQuality=ConnectionQuality.UNKNOWN,U||this.onConnectionQualityChanged(ConnectionQuality.UNKNOWN)},V}();function QualityIndicatorMixer(){for(var V=[],U=0;U<arguments.length;U++)V[U]=arguments[U];var j=function(B){__extends(z,B);function z(H){var G=B.call(this,H)||this;return G.childTrackers=V.map(function($){var Q=$.getParams,W=$.TrackerClass;return{tracker:new W(function(){return G.handleStatsChanged()}),getParams:Q}}),G}return z.prototype.calculateConnectionQuality=function(){var H=this.childTrackers.map(function(G){var $=G.tracker;return $.connectionQuality});return H.some(function(G){return G===ConnectionQuality.BAD})?ConnectionQuality.BAD:H.every(function(G){return G===ConnectionQuality.UNKNOWN})?ConnectionQuality.UNKNOWN:ConnectionQuality.GOOD},z.prototype._start=function(H){this.childTrackers.forEach(function(G){var $=G.tracker,Q=G.getParams;return $.start(Q(H))})},z.prototype._stop=function(){this.childTrackers.forEach(function(H){var G=H.tracker;return G.stop(!0)})},z}(AbstractConnectionQualityIndicator);return j}var LiveKitConnectionQualityIndicator=function(V){__extends(U,V);function U(){var j=V!==null&&V.apply(this,arguments)||this;return j.room=null,j.liveKitConnectionQuality=ConnectionQuality$2.Unknown,j.liveKitConnectionState=null,j.handleConnectionQualityChanged=function(B){j.liveKitConnectionQuality=B,j.handleStatsChanged()},j.handleConnectionStateChanged=function(B){j.liveKitConnectionState=B,j.handleStatsChanged()},j}return U.prototype._start=function(j){this.room=j,this.room.localParticipant.on(ParticipantEvent.ConnectionQualityChanged,this.handleConnectionQualityChanged),this.room.on(RoomEvent.ConnectionStateChanged,this.handleConnectionStateChanged)},U.prototype._stop=function(){this.room&&(this.room.localParticipant.off(RoomEvent.ConnectionQualityChanged,this.handleConnectionQualityChanged),this.room.off(RoomEvent.ConnectionStateChanged,this.handleConnectionStateChanged))},U.prototype.calculateConnectionQuality=function(){return[ConnectionQuality$2.Lost,ConnectionQuality$2.Poor].includes(this.liveKitConnectionQuality)||this.liveKitConnectionState&&[ConnectionState.Disconnected,ConnectionState.Reconnecting,ConnectionState.SignalReconnecting].includes(this.liveKitConnectionState)?ConnectionQuality.BAD:ConnectionQuality.GOOD},U}(AbstractConnectionQualityIndicator),t,e,s,n;function r(){}function o(){o.init.call(this)}function i(V){return V._maxListeners===void 0?o.defaultMaxListeners:V._maxListeners}function a(V,U,j){if(U)V.call(j);else for(var B=V.length,z=m(V,B),H=0;H<B;++H)z[H].call(j)}function c(V,U,j,B){if(U)V.call(j,B);else for(var z=V.length,H=m(V,z),G=0;G<z;++G)H[G].call(j,B)}function d(V,U,j,B,z){if(U)V.call(j,B,z);else for(var H=V.length,G=m(V,H),$=0;$<H;++$)G[$].call(j,B,z)}function u(V,U,j,B,z,H){if(U)V.call(j,B,z,H);else for(var G=V.length,$=m(V,G),Q=0;Q<G;++Q)$[Q].call(j,B,z,H)}function h(V,U,j,B){if(U)V.apply(j,B);else for(var z=V.length,H=m(V,z),G=0;G<z;++G)H[G].apply(j,B)}function l(V,U,j,B){var z,H,G,$;if(typeof j!="function")throw new TypeError('"listener" argument must be a function');if((H=V._events)?(H.newListener&&(V.emit("newListener",U,j.listener?j.listener:j),H=V._events),G=H[U]):(H=V._events=new r,V._eventsCount=0),G){if(typeof G=="function"?G=H[U]=B?[j,G]:[G,j]:B?G.unshift(j):G.push(j),!G.warned&&(z=i(V))&&z>0&&G.length>z){G.warned=!0;var Q=new Error("Possible EventEmitter memory leak detected. "+G.length+" "+U+" listeners added. Use emitter.setMaxListeners() to increase limit");Q.name="MaxListenersExceededWarning",Q.emitter=V,Q.type=U,Q.count=G.length,$=Q,typeof console.warn=="function"?console.warn($):console.log($)}}else G=H[U]=j,++V._eventsCount;return V}function p(V,U,j){var B=!1;function z(){V.removeListener(U,z),B||(B=!0,j.apply(V,arguments))}return z.listener=j,z}function f(V){var U=this._events;if(U){var j=U[V];if(typeof j=="function")return 1;if(j)return j.length}return 0}function m(V,U){for(var j=new Array(U);U--;)j[U]=V[U];return j}r.prototype=Object.create(null),o.EventEmitter=o,o.usingDomains=!1,o.prototype.domain=void 0,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.init=function(){this.domain=null,o.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new r,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(V){if(typeof V!="number"||V<0||isNaN(V))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=V,this},o.prototype.getMaxListeners=function(){return i(this)},o.prototype.emit=function(V){var U,j,B,z,H,G,$,Q=V==="error";if(G=this._events)Q=Q&&G.error==null;else if(!Q)return!1;if($=this.domain,Q){if(U=arguments[1],!$){if(U instanceof Error)throw U;var W=new Error('Uncaught, unspecified "error" event. ('+U+")");throw W.context=U,W}return U||(U=new Error('Uncaught, unspecified "error" event')),U.domainEmitter=this,U.domain=$,U.domainThrown=!1,$.emit("error",U),!1}if(!(j=G[V]))return!1;var X=typeof j=="function";switch(B=arguments.length){case 1:a(j,X,this);break;case 2:c(j,X,this,arguments[1]);break;case 3:d(j,X,this,arguments[1],arguments[2]);break;case 4:u(j,X,this,arguments[1],arguments[2],arguments[3]);break;default:for(z=new Array(B-1),H=1;H<B;H++)z[H-1]=arguments[H];h(j,X,this,z)}return!0},o.prototype.addListener=function(V,U){return l(this,V,U,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(V,U){return l(this,V,U,!0)},o.prototype.once=function(V,U){if(typeof U!="function")throw new TypeError('"listener" argument must be a function');return this.on(V,p(this,V,U)),this},o.prototype.prependOnceListener=function(V,U){if(typeof U!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(V,p(this,V,U)),this},o.prototype.removeListener=function(V,U){var j,B,z,H,G;if(typeof U!="function")throw new TypeError('"listener" argument must be a function');if(!(B=this._events))return this;if(!(j=B[V]))return this;if(j===U||j.listener&&j.listener===U)--this._eventsCount==0?this._events=new r:(delete B[V],B.removeListener&&this.emit("removeListener",V,j.listener||U));else if(typeof j!="function"){for(z=-1,H=j.length;H-- >0;)if(j[H]===U||j[H].listener&&j[H].listener===U){G=j[H].listener,z=H;break}if(z<0)return this;if(j.length===1){if(j[0]=void 0,--this._eventsCount==0)return this._events=new r,this;delete B[V]}else(function($,Q){for(var W=Q,X=W+1,ee=$.length;X<ee;W+=1,X+=1)$[W]=$[X];$.pop()})(j,z);B.removeListener&&this.emit("removeListener",V,G||U)}return this},o.prototype.off=function(V,U){return this.removeListener(V,U)},o.prototype.removeAllListeners=function(V){var U,j;if(!(j=this._events))return this;if(!j.removeListener)return arguments.length===0?(this._events=new r,this._eventsCount=0):j[V]&&(--this._eventsCount==0?this._events=new r:delete j[V]),this;if(arguments.length===0){for(var B,z=Object.keys(j),H=0;H<z.length;++H)(B=z[H])!=="removeListener"&&this.removeAllListeners(B);return this.removeAllListeners("removeListener"),this._events=new r,this._eventsCount=0,this}if(typeof(U=j[V])=="function")this.removeListener(V,U);else if(U)do this.removeListener(V,U[U.length-1]);while(U[0]);return this},o.prototype.listeners=function(V){var U,j=this._events;return j&&(U=j[V])?typeof U=="function"?[U.listener||U]:function(B){for(var z=new Array(B.length),H=0;H<z.length;++H)z[H]=B[H].listener||B[H];return z}(U):[]},o.listenerCount=function(V,U){return typeof V.listenerCount=="function"?V.listenerCount(U):f.call(V,U)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class g extends o{}(function(V){V.Issue="issue",V.NetworkScoresUpdated="network-scores-updated",V.StatsParsingFinished="stats-parsing-finished"})(t||(t={})),function(V){V.Network="network",V.CPU="cpu",V.Server="server",V.Stream="stream"}(e||(e={})),function(V){V.OutboundNetworkQuality="outbound-network-quality",V.InboundNetworkQuality="inbound-network-quality",V.OutboundNetworkMediaLatency="outbound-network-media-latency",V.InboundNetworkMediaLatency="inbound-network-media-latency",V.NetworkMediaSyncFailure="network-media-sync-failure",V.OutboundNetworkThroughput="outbound-network-throughput",V.InboundNetworkThroughput="inbound-network-throughput",V.EncoderCPUThrottling="encoder-cpu-throttling",V.DecoderCPUThrottling="decoder-cpu-throttling",V.ServerIssue="server-issue",V.UnknownVideoDecoderIssue="unknown-video-decoder",V.LowInboundMOS="low-inbound-mean-opinion-score",V.LowOutboundMOS="low-outbound-mean-opinion-score",V.FrozenVideoTrack="frozen-video-track",V.MissingVideoStreamData="missing-video-stream-data",V.MissingAudioStreamData="missing-audio-stream-data"}(s||(s={})),function(V){V[V.BAD=2.1]="BAD",V[V.POOR=2.6]="POOR",V[V.FAIR=3.1]="FAIR",V[V.GOOD=3.8]="GOOD",V[V.EXCELLENT=4.3]="EXCELLENT"}(n||(n={}));class S extends o{static STATS_REPORT_READY_EVENT="stats-report-ready";static STATS_REPORTS_PARSED="stats-reports-parsed";isStopped=!1;reportTimer;getStatsInterval;compositeStatsParser;constructor(U){super(),this.compositeStatsParser=U.compositeStatsParser,this.getStatsInterval=U.getStatsInterval??1e4}get isRunning(){return!!this.reportTimer&&!this.isStopped}startReporting(){if(this.reportTimer)return;const U=()=>setTimeout(()=>{this.isStopped?this.reportTimer=void 0:this.parseReports().finally(()=>{this.reportTimer=U()})},this.getStatsInterval);this.isStopped=!1,this.reportTimer=U()}stopReporting(){this.isStopped=!0,this.reportTimer&&(clearTimeout(this.reportTimer),this.reportTimer=void 0)}async parseReports(){const U=Date.now(),j=await this.compositeStatsParser.parse(),B=Date.now()-U;this.emit(S.STATS_REPORTS_PARSED,{timeTaken:B,reportItems:j}),j.forEach(z=>{this.emit(S.STATS_REPORT_READY_EVENT,z)})}}const v=(()=>{const V=new Map;return U=>{const{taskId:j,delayMs:B,maxJitterMs:z,callback:H}=U,G=Math.ceil(Math.random()*(z||0)),$=V.get(j);$&&clearTimeout($);const Q=setTimeout(()=>{H(),V.delete(j)},B+G);V.set(j,Q)}})();class k{#e={};calculate(U){const{connection:{id:j}}=U,{mos:B,stats:z}=this.calculateOutboundScore(U)||{},{mos:H,stats:G}=this.calculateInboundScore(U)||{};return this.#e[j]=U,v({taskId:j,delayMs:35e3,callback:()=>delete this.#e[j]}),{outbound:B,inbound:H,connectionId:j,statsSamples:{inboundStatsSample:G,outboundStatsSample:z}}}calculateOutboundScore(U){const j=[...U.remote?.audio.inbound||[],...U.remote?.video.inbound||[]];if(!j.length)return;const B=this.#e[U.connection.id];if(!B)return;const z=[...B.remote?.audio.inbound||[],...B.remote?.video.inbound||[]],{packetsSent:H}=U.connection,G=B.connection.packetsSent,$=j.reduce((re,se)=>{const de=z.find(oe=>oe.ssrc===se.ssrc);return{sumJitter:re.sumJitter+se.jitter,packetsLost:re.packetsLost+se.packetsLost,lastPacketsLost:re.lastPacketsLost+(de?.packetsLost||0)}},{sumJitter:0,packetsLost:0,lastPacketsLost:0}),Q=1e3*U.connection.currentRoundTripTime||0,{sumJitter:W}=$,X=W/j.length,ee=H-G,ie=$.packetsLost-$.lastPacketsLost,ne=ee&&ie?Math.round(100*ie/(ee+ie)):0;return{mos:this.calculateMOS({avgJitter:X,rtt:Q,packetsLoss:ne}),stats:{avgJitter:X,rtt:Q,packetsLoss:ne}}}calculateInboundScore(U){const j=[...U.audio?.inbound,...U.video?.inbound];if(!j.length)return;const B=this.#e[U.connection.id];if(!B)return;const z=[...B.video?.inbound,...B.audio?.inbound],{packetsReceived:H}=U.connection,G=B.connection.packetsReceived,$=j.reduce((re,se)=>{const de=z.find(oe=>oe.ssrc===se.ssrc);return{sumJitter:re.sumJitter+se.jitter,packetsLost:re.packetsLost+se.packetsLost,lastPacketsLost:re.lastPacketsLost+(de?.packetsLost||0)}},{sumJitter:0,packetsLost:0,lastPacketsLost:0}),Q=1e3*U.connection.currentRoundTripTime||0,{sumJitter:W}=$,X=W/j.length,ee=H-G,ie=$.packetsLost-$.lastPacketsLost,ne=ee&&ie?Math.round(100*ie/(ee+ie)):0;return{mos:this.calculateMOS({avgJitter:X,rtt:Q,packetsLoss:ne}),stats:{avgJitter:X,rtt:Q,packetsLoss:ne}}}calculateMOS({avgJitter:U,rtt:j,packetsLoss:B}){const z=j+2*U+10;let H=z<160?93.2-z/40:93.2-z/120-10;return H-=2.5*B,1+.035*H+7e-6*H*(H-60)*(100-H)}}class y{#e=new Map;#t;#i;constructor(U={}){this.#t=U.statsCleanupTtlMs??35e3,this.#i=U.maxParsedStatsStorageSize??5}detect(U,j){const B={...U,networkScores:{...j,statsSamples:j?.statsSamples||{}}},z=this.performDetection(B);return this.setLastProcessedStats(U.connection.id,B),this.performPrevStatsCleanup({connectionId:U.connection.id}),z}performPrevStatsCleanup(U){const{connectionId:j,cleanupCallback:B}=U;this.#e.has(j)&&v({taskId:j,delayMs:this.#t,callback:()=>{this.deleteLastProcessedStats(j),typeof B=="function"&&B()}})}setLastProcessedStats(U,j){if(!U||j.connection.id!==U)return;const B=this.#e.get(U)??[];B.push(j),B.length>this.#i&&B.shift(),this.#e.set(U,B)}getLastProcessedStats(U){const j=this.#e.get(U);return j?.[j.length-1]}getAllLastProcessedStats(U){return this.#e.get(U)??[]}deleteLastProcessedStats(U){this.#e.delete(U)}}class w extends y{#e;constructor(U={}){super(U),this.#e=U.availableOutgoingBitrateThreshold??1e5}performDetection(U){const j=[],{availableOutgoingBitrate:B}=U.connection;if(B===void 0)return j;const z=U.audio.outbound.reduce(($,Q)=>$+Q.targetBitrate,0),H=U.video.outbound.reduce(($,Q)=>$+Q.bitrate,0);if(!z&&!H)return j;const G={availableOutgoingBitrate:B,videoStreamsTotalBitrate:H,audioStreamsTotalTargetBitrate:z};return(z>B||H>0&&B<this.#e)&&j.push({statsSample:G,type:e.Network,reason:s.OutboundNetworkThroughput}),j}}class b extends y{#e;#t;#i;#n;constructor(U={}){super(),this.#e=U.highPacketLossThresholdPct??5,this.#t=U.highJitterThreshold??200,this.#i=U.highJitterBufferDelayThresholdMs??500,this.#n=U.highRttThresholdMs??250}performDetection(U){return this.processData(U)}processData(U){const j=[],B=[...U.audio?.inbound,...U.video?.inbound];if(!B.length)return j;const z=this.getLastProcessedStats(U.connection.id);if(!z)return j;const H=[...z.video?.inbound,...z.audio?.inbound],{packetsReceived:G}=U.connection,$=z.connection.packetsReceived,Q=B.reduce((Pe,xe)=>{const Ce=H.find(Re=>Re.ssrc===xe.ssrc),ze=Ce?.jitterBufferDelay||0,$e=Ce?.jitterBufferEmittedCount||0,Fe=xe.jitterBufferDelay-ze,qe=xe.jitterBufferEmittedCount-$e,be=Fe&&qe?1e3*Fe/qe:0;return{sumJitter:Pe.sumJitter+xe.jitter,sumJitterBufferDelayMs:Pe.sumJitterBufferDelayMs+be,packetsLost:Pe.packetsLost+xe.packetsLost,lastPacketsLost:Pe.lastPacketsLost+(Ce?.packetsLost||0)}},{sumJitter:0,sumJitterBufferDelayMs:0,packetsLost:0,lastPacketsLost:0}),W=1e3*U.connection.currentRoundTripTime||0,{sumJitter:X,sumJitterBufferDelayMs:ee}=Q,ie=X/B.length,ne=ee/B.length,re=G-$,se=Q.packetsLost-Q.lastPacketsLost,de=re&&se?Math.round(100*se/(re+se)):0,oe=de>this.#e,le=ie>=this.#t,ue=W>=this.#n,fe=ne>this.#i,he=ue&&!le&&!oe,ge=oe&&le,Ae=le&&fe,_e={rtt:W,packetLossPct:de,avgJitter:ie,avgJitterBufferDelay:ne};return(le||oe)&&j.push({statsSample:_e,type:e.Network,reason:s.InboundNetworkQuality,iceCandidate:U.connection.local.id}),he&&j.push({statsSample:_e,type:e.Server,reason:s.ServerIssue,iceCandidate:U.connection.remote.id}),ge&&j.push({statsSample:_e,type:e.Network,reason:s.InboundNetworkMediaLatency,iceCandidate:U.connection.local.id}),Ae&&j.push({statsSample:_e,type:e.Network,reason:s.NetworkMediaSyncFailure,iceCandidate:U.connection.local.id}),j}}class P extends y{#e;constructor(U={}){super(),this.#e=U.correctedSamplesThresholdPct??5}performDetection(U){return this.processData(U)}processData(U){const j=U.audio.inbound,B=[],z=this.getLastProcessedStats(U.connection.id)?.audio.inbound;return z&&j.forEach(H=>{const G=z.find(ne=>ne.ssrc===H.ssrc);if(!G)return;const $=H.track.insertedSamplesForDeceleration+H.track.removedSamplesForAcceleration,Q=G.track.insertedSamplesForDeceleration+G.track.removedSamplesForAcceleration;if($===Q)return;const W=H.track.totalSamplesReceived-G.track.totalSamplesReceived,X=$-Q,ee=Math.round(100*X/W),ie={correctedSamplesPct:ee};ee>this.#e&&B.push({statsSample:ie,type:e.Network,reason:s.NetworkMediaSyncFailure,ssrc:H.ssrc})}),B}}class T extends y{#e;#t;constructor(U={}){super(),this.#e=U.highPacketLossThresholdPct??5,this.#t=U.highJitterThreshold??200}performDetection(U){return this.processData(U)}processData(U){const j=[],B=[...U.remote?.audio.inbound||[],...U.remote?.video.inbound||[]];if(!B.length)return j;const z=this.getLastProcessedStats(U.connection.id);if(!z)return j;const H=[...z.remote?.audio.inbound||[],...z.remote?.video.inbound||[]],{packetsSent:G}=U.connection,$=z.connection.packetsSent,Q=B.reduce((ue,fe)=>{const he=H.find(ge=>ge.ssrc===fe.ssrc);return{sumJitter:ue.sumJitter+fe.jitter,packetsLost:ue.packetsLost+fe.packetsLost,lastPacketsLost:ue.lastPacketsLost+(he?.packetsLost||0)}},{sumJitter:0,packetsLost:0,lastPacketsLost:0}),W=1e3*U.connection.currentRoundTripTime||0,{sumJitter:X}=Q,ee=X/B.length,ie=G-$,ne=Q.packetsLost-Q.lastPacketsLost,re=ie&&ne?Math.round(100*ne/(ie+ne)):0,se=re>this.#e,de=ee>=this.#t,oe=!se&&de||de||se,le={rtt:W,avgJitter:ee,packetLossPct:re};return se&&de&&j.push({statsSample:le,type:e.Network,reason:s.OutboundNetworkMediaLatency,iceCandidate:U.connection.local.id}),oe&&j.push({statsSample:le,type:e.Network,reason:s.OutboundNetworkQuality,iceCandidate:U.connection.local.id}),j}}class L extends y{performDetection(U){return this.processData(U)}processData(U){const j=U.video.outbound.filter(H=>H.qualityLimitationReason!=="none"),B=[],z=this.getLastProcessedStats(U.connection.id)?.video.outbound;return z&&j.forEach(H=>{const G=z.find(Q=>Q.ssrc===H.ssrc);if(!G)return;const $={qualityLimitationReason:H.qualityLimitationReason};H.framesSent>G.framesSent||(H.qualityLimitationReason==="cpu"&&B.push({statsSample:$,type:e.CPU,reason:s.EncoderCPUThrottling,ssrc:H.ssrc}),H.qualityLimitationReason==="bandwidth"&&B.push({statsSample:$,type:e.Network,reason:s.OutboundNetworkThroughput,ssrc:H.ssrc}))}),B}}class D extends y{UNKNOWN_DECODER="unknown";#e={};performDetection(U){return this.processData(U)}performPrevStatsCleanup(U){const{connectionId:j,cleanupCallback:B}=U;super.performPrevStatsCleanup({...U,cleanupCallback:()=>{delete this.#e[j],typeof B=="function"&&B()}})}processData(U){const j=[],{id:B}=U.connection,z=this.getLastProcessedStats(B)?.video.inbound;return U.video.inbound.forEach(H=>{const{decoderImplementation:G,ssrc:$}=H;if(z?.find(W=>W.ssrc===$))if(G===this.UNKNOWN_DECODER){if(!this.hadLastDecoderWithIssue(B,$)){this.setLastDecoderWithIssue(B,$,this.UNKNOWN_DECODER);const W={mimeType:H.mimeType,decoderImplementation:G};j.push({ssrc:$,statsSample:W,type:e.Stream,reason:s.UnknownVideoDecoderIssue,trackIdentifier:H.track.trackIdentifier})}}else this.setLastDecoderWithIssue(B,$,void 0)}),j}setLastDecoderWithIssue(U,j,B){const z=this.#e[U]??{};B===void 0?delete z[j]:z[j]=B,this.#e[U]=z}hadLastDecoderWithIssue(U,j){const B=this.#e[U];return(B&&B[j])===this.UNKNOWN_DECODER}}const C=V=>V.reduce((U,j)=>U+j,0)/V.length,R=(V,U,j=30)=>{const B=[];for(let z=1;z<U.length-1;z+=1){const H=U[z]?.video?.inbound.find(W=>W.ssrc===V);if(!H)continue;const G=U[z-1]?.video?.inbound?.find(W=>W.ssrc===V);if(!H||!G)continue;const $=H.timestamp-G.timestamp,Q=H.framesDecoded-G.framesDecoded;if(Q>0){const W=$/Q;B.push(W)}}return B.length<=1?!1:(z=>{const H=((G,$)=>$.reduce((Q,W)=>Q+(W-G)**2,0)/$.length)(C(z),z);return Math.sqrt(H)})(B)>j},M=(V,U)=>{for(let j=1;j<U.length;j+=1){const B=U[j].video.inbound.find($=>$.ssrc===V);if(!B)continue;const z=U[j-1].video.inbound.find($=>$.ssrc===V),H=B.frameWidth!==z?.frameWidth,G=B.frameHeight!==z?.frameHeight;if(H||G)return!0}return!1};class I extends y{#e;#t;#i;constructor(U={}){super(),this.#e=U.avgFreezeDurationThresholdMs??1e3,this.#t=U.frozenDurationThresholdPct??30,this.#i=U.minMosQuality??n.BAD}performDetection(U){const j=U.networkScores.inbound;return j!==void 0&&j<=this.#i?[]:this.processData(U)}processData(U){const j=[],B=this.getAllLastProcessedStats(U.connection.id);if(B.length===0)return[];const z=U.video.inbound.map(H=>{const G=B[B.length-1].video.inbound.find(ee=>ee.ssrc===H.ssrc);if(!G||M(H.ssrc,[B[B.length-1],U])||R(H.ssrc,B))return;const $=H.freezeCount-(G.freezeCount??0),Q=1e3*(H.totalFreezesDuration-(G.totalFreezesDuration??0)),W=$>0?Q/$:0,X=Q/(H.timestamp-G.timestamp)*100;return X>this.#t||W>this.#e?{ssrc:H.ssrc,avgFreezeDurationMs:W,frozenDurationPct:X}:void 0}).filter(H=>H!==void 0);return z.length>0&&(j.push({type:e.Stream,reason:s.FrozenVideoTrack,statsSample:{ssrcs:z.map(H=>H.ssrc)}}),this.deleteLastProcessedStats(U.connection.id)),j}}class E extends y{#e;#t;#i;constructor(U={}){super(U),this.#e=U.volatilityThreshold??8,this.#t=U.affectedStreamsPercentThreshold??30,this.#i=U.minMosQuality??n.BAD}performDetection(U){return[...this.getAllLastProcessedStats(U.connection.id),U].find(j=>j.networkScores.inbound!==void 0&&j.networkScores.inbound<=this.#i)?[]:this.processData(U)}processData(U){const j=[],B=[...this.getAllLastProcessedStats(U.connection.id),U],z=U.video.inbound.map(G=>{if(B.length<5||M(G.ssrc,B))return;const $=[];for(let W=0;W<B.length-1;W+=1){const X=B[W].video.inbound.find(ee=>ee.ssrc===G.ssrc);X?.framesPerSecond!==void 0&&$.push(X.framesPerSecond)}if($.length<5||R(G.ssrc,B))return;const Q=(W=>{if(W.length===0)throw new Error("Cannot calculate volatility for empty array");const X=C(W);return W.reduce((ee,ie)=>ee+Math.abs(ie-X),0)/W.length*100/X})($);return Q>this.#e?{ssrc:G.ssrc,allFps:$,volatility:Q}:void 0}).filter(G=>!!G);if(z.length===0)return j;const H=z.length/(U.video.inbound.length/100);return H>this.#t&&(j.push({type:e.CPU,reason:s.DecoderCPUThrottling,statsSample:{affectedStreamsPercent:H,throtthedStreams:z}}),this.deleteLastProcessedStats(U.connection.id)),j}}const N=V=>V.iceConnectionState==="closed"||V.connectionState==="closed",_=(V,U,j)=>8*((B,z,H)=>{if(!z)return 0;const G=B[H],$=z[H];if(G==null||$==null)return 0;const Q=Math.floor(B.timestamp)-Math.floor(z.timestamp);return Q===0?0:(Number(G)-Number($))/Q*1e3})(V,U,j);class A{connections=[];statsParser;constructor(U){this.statsParser=U.statsParser}listConnections(){return[...this.connections]}addPeerConnection(U){this.connections.push({id:U.id??String(Date.now()+Math.random().toString(32)),pc:U.pc})}removePeerConnection(U){const j=this.connections.findIndex(({pc:B})=>B===U.pc);j>=0&&this.removeConnectionsByIndexes([j])}async parse(){const U=[],j=this.connections.map(async(B,z)=>{if(!N(B.pc))return this.statsParser.parse(B);U.unshift(z)});return U.length&&this.removeConnectionsByIndexes(U),(await Promise.all(j)).filter(B=>B!==void 0)}removeConnectionsByIndexes(U){U.forEach(j=>{this.connections.splice(j,1)})}}class O{prevStats=new Map;allowedReportTypes=new Set(["candidate-pair","inbound-rtp","outbound-rtp","remote-outbound-rtp","remote-inbound-rtp","track","transport"]);ignoreSSRCList;logger;constructor(U){this.ignoreSSRCList=U.ignoreSSRCList??[],this.logger=U.logger}get previouslyParsedStatsConnectionsIds(){return[...this.prevStats.keys()]}async parse(U){if(!N(U.pc))return this.getConnectionStats(U);this.logger.debug("Skip stats parsing. Connection is closed.",{connection:U})}async getConnectionStats(U){const{pc:j,id:B}=U;try{const z=Date.now(),H=j.getReceivers().filter(W=>W.track?.enabled),G=j.getSenders().filter(W=>W.track?.enabled),$=await Promise.all(H.map(W=>W.getStats())),Q=await Promise.all(G.map(W=>W.getStats()));return{id:B,stats:this.mapReportsStats([...$,...Q],U),timeTaken:Date.now()-z}}catch(z){return void this.logger.error("Failed to get stats for PC",{id:B,pc:j,error:z})}}mapReportsStats(U,j){const B={audio:{inbound:[],outbound:[]},video:{inbound:[],outbound:[]},connection:{},remote:{video:{inbound:[],outbound:[]},audio:{inbound:[],outbound:[]}}};U.forEach(G=>{G.forEach($=>{this.allowedReportTypes.has($.type)&&this.updateMappedStatsWithReportItemData($,B,G)})});const{id:z}=j,H=this.prevStats.get(z);return H&&this.propagateStatsWithRateValues(B,H.stats),this.prevStats.set(z,{stats:B,ts:Date.now()}),v({taskId:z,delayMs:35e3,callback:()=>this.prevStats.delete(z)}),B}updateMappedStatsWithReportItemData(U,j,B){const z=U.type;if(z==="candidate-pair"&&U.state==="succeeded"&&U.nominated)return void(j.connection=this.prepareConnectionStats(U,B));const H=this.getMediaType(U);if(!H)return;const G=U.ssrc;if(!G||!this.ignoreSSRCList.includes(G))if(z!=="outbound-rtp")if(z!=="inbound-rtp")z!=="remote-outbound-rtp"?z==="remote-inbound-rtp"&&(this.mapConnectionStatsIfNecessary(j,U,B),j.remote[H].inbound.push({...U})):j.remote[H].outbound.push({...U});else{const $=B.get(U.trackId)||B.get(U.mediaSourceId)||{};this.mapConnectionStatsIfNecessary(j,U,B);const Q={...U,track:{...$}};j[H].inbound.push(Q)}else{const $=B.get(U.trackId)||B.get(U.mediaSourceId)||{},Q={...U,track:{...$}};j[H].outbound.push(Q)}}getMediaType(U){const j=U.mediaType||U.kind;if(!["audio","video"].includes(j)){const{id:B}=U;return B?String(B).includes("Video")?"video":String(B).includes("Audio")?"audio":void 0:void 0}return j}propagateStatsWithRateValues(U,j){U.audio.inbound.forEach(B=>{const z=j.audio.inbound.find(({id:H})=>H===B.id);B.bitrate=_(B,z,"bytesReceived"),B.packetRate=_(B,z,"packetsReceived")}),U.audio.outbound.forEach(B=>{const z=j.audio.outbound.find(({id:H})=>H===B.id);B.bitrate=_(B,z,"bytesSent"),B.packetRate=_(B,z,"packetsSent")}),U.video.inbound.forEach(B=>{const z=j.video.inbound.find(({id:H})=>H===B.id);B.bitrate=_(B,z,"bytesReceived"),B.packetRate=_(B,z,"packetsReceived")}),U.video.outbound.forEach(B=>{const z=j.video.outbound.find(({id:H})=>H===B.id);B.bitrate=_(B,z,"bytesSent"),B.packetRate=_(B,z,"packetsSent")})}mapConnectionStatsIfNecessary(U,j,B){if(U.connection.id||!j.transportId)return;const z=B.get(j.transportId);if(z&&z.selectedCandidatePairId){const H=B.get(z.selectedCandidatePairId);U.connection=this.prepareConnectionStats(H,B)}}prepareConnectionStats(U,j){if(!U||!j)return{};const B={...U};if(B.remoteCandidateId){const z=j.get(B.remoteCandidateId);B.remote={...z}}if(B.localCandidateId){const z=j.get(B.localCandidateId);B.local={...z}}return B}}class J extends y{#e=new Map;#t;#i;constructor(U={}){super(),this.#t=U.timeoutMs??15e3,this.#i=U.steps??3}performDetection(U){return this.processData(U)}processData(U){const j=[],B=[...this.getAllLastProcessedStats(U.connection.id),U];if(B.length<this.#i)return j;const z=B.slice(-this.#i),H=z.map($=>$.video.inbound),G=z.map($=>$.audio.inbound);return j.push(...this.detectMissingData(G,e.Stream,s.MissingAudioStreamData)),j.push(...this.detectMissingData(H,e.Stream,s.MissingVideoStreamData)),new Set(this.#e.keys()).forEach($=>{const Q=this.#e.get($);Q&&Date.now()-Q>this.#t&&this.removeMarkedIssue($)}),j}detectMissingData(U,j,B){const z=[],H=U.pop(),G=J.mapStatsByTrackId(U);return H.forEach($=>{const Q=$.track.trackIdentifier,W=G.get(Q);if(!Array.isArray(W)||W.length===0||$.track.detached||$.track.ended)return;if(!J.isAllBytesReceivedDidntChange($.bytesReceived,W))return void this.removeMarkedIssue(Q);if(!this.markIssue(Q))return;const X={bytesReceived:$.bytesReceived};z.push({type:j,reason:B,statsSample:X,trackIdentifier:Q})}),z}static mapStatsByTrackId(U){const j=new Map;return U.forEach(B=>{B.forEach(z=>{const H=j.get(z.track.trackIdentifier)||[];H.push(z),j.set(z.track.trackIdentifier,H)})}),j}static isAllBytesReceivedDidntChange(U,j){for(let B=0;B<j.length;B+=1)if(j[B].bytesReceived!==U)return!1;return!0}markIssue(U){const j=Date.now(),B=this.#e.get(U);return(!B||j-B>this.#t)&&(this.#e.set(U,j),!0)}removeMarkedIssue(U){this.#e.delete(U)}}class x{eventEmitter;#e=!1;detectors=[];networkScoresCalculator;statsReporter;compositeStatsParser;logger;autoAddPeerConnections;constructor(U){this.logger=U.logger??{debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},this.eventEmitter=U.issueEmitter??new g,U.onIssues&&this.eventEmitter.on(t.Issue,U.onIssues),U.onNetworkScoresUpdated&&this.eventEmitter.on(t.NetworkScoresUpdated,U.onNetworkScoresUpdated),this.detectors=U.detectors??[new L,new b,new T,new P,new w,new D,new I,new E,new J],this.networkScoresCalculator=U.networkScoresCalculator??new k,this.compositeStatsParser=U.compositeStatsParser??new A({statsParser:new O({ignoreSSRCList:U.ignoreSSRCList,logger:this.logger})}),this.statsReporter=U.statsReporter??new S({compositeStatsParser:this.compositeStatsParser,getStatsInterval:U.getStatsInterval??5e3}),window.wid=this,this.autoAddPeerConnections=U.autoAddPeerConnections??!0,this.autoAddPeerConnections&&this.wrapRTCPeerConnection(),this.statsReporter.on(S.STATS_REPORT_READY_EVENT,j=>{const B=this.calculateNetworkScores(j.stats);this.detectIssues({data:j.stats},B)}),this.statsReporter.on(S.STATS_REPORTS_PARSED,j=>{const B={timeTaken:j.timeTaken,ts:Date.now()};U.onStats&&U.onStats(j.reportItems),this.eventEmitter.emit(t.StatsParsingFinished,B)})}watchNewPeerConnections(){if(!this.autoAddPeerConnections)throw new Error("Auto add peer connections was disabled in the constructor.");this.#e?this.logger.warn("WebRTCIssueDetector is already started. Skip processing"):(this.logger.info("Start watching peer connections"),this.#e=!0,this.statsReporter.startReporting())}stopWatchingNewPeerConnections(){this.#e?(this.logger.info("Stop watching peer connections"),this.#e=!1,this.statsReporter.stopReporting()):this.logger.warn("WebRTCIssueDetector is already stopped. Skip processing")}handleNewPeerConnection(U,j){this.#e||!this.autoAddPeerConnections?(this.#e||this.autoAddPeerConnections!==!1||(this.logger.info("Starting stats reporting for new peer connection"),this.#e=!0,this.statsReporter.startReporting()),this.logger.debug("Handling new peer connection",U),this.compositeStatsParser.addPeerConnection({pc:U,id:j})):this.logger.debug("Skip handling new peer connection. Detector is not running",U)}emitIssues(U){this.eventEmitter.emit(t.Issue,U)}detectIssues({data:U},j){const B=this.detectors.reduce((z,H)=>[...z,...H.detect(U,j)],[]);B.length>0&&this.emitIssues(B)}calculateNetworkScores(U){const j=this.networkScoresCalculator.calculate(U);return this.eventEmitter.emit(t.NetworkScoresUpdated,j),j}wrapRTCPeerConnection(){if(!window.RTCPeerConnection)return void this.logger.warn("No RTCPeerConnection found in browser window. Skipping");const U=window.RTCPeerConnection,j=z=>this.handleNewPeerConnection(z);function B(z){const H=new U(z);return j(H),H}B.prototype=U.prototype,window.RTCPeerConnection=B}}var WebRTCConnectionQualityIndicator=function(V){__extends(U,V);function U(){var j=V!==null&&V.apply(this,arguments)||this;return j.issueDetector=null,j.mosScores=null,j}return U.prototype._start=function(j){var B=this;this.issueDetector=new x({autoAddPeerConnections:!1,getStatsInterval:3e3,onNetworkScoresUpdated:function(z){B.mosScores=z,B.handleStatsChanged()}}),this.issueDetector.handleNewPeerConnection(j)},U.prototype._stop=function(){this.issueDetector&&(this.issueDetector.stopWatchingNewPeerConnections(),this.issueDetector=null),this.mosScores=null},U.prototype.calculateConnectionQuality=function(){return!this.mosScores||this.mosScores.inbound&&this.mosScores.outbound?ConnectionQuality.UNKNOWN:this.mosScores.inbound&&this.mosScores.inbound<3||this.mosScores.outbound&&this.mosScores.outbound<3?ConnectionQuality.BAD:ConnectionQuality.GOOD},U}(AbstractConnectionQualityIndicator),VoiceChatState;(function(V){V.INACTIVE="inactive",V.STARTING="starting",V.ACTIVE="started",V.STOPPING="stopping"})(VoiceChatState||(VoiceChatState={}));var AbstractVoiceChat=function(){function V(){}return V}(),AbstractVoiceChatImplementation=function(V){__extends(U,V);function U(){var j=V!==null&&V.apply(this,arguments)||this;return j._isMuted=!0,j.state=VoiceChatState.INACTIVE,j}return Object.defineProperty(U.prototype,"isMuted",{get:function(){return this._isMuted},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"isVoiceChatting",{get:function(){return this.state!==VoiceChatState.INACTIVE},enumerable:!1,configurable:!0}),U.prototype.startVoiceChat=function(j){return __awaiter(this,void 0,void 0,function(){var B;return __generator(this,function(z){switch(z.label){case 0:return this.state===VoiceChatState.INACTIVE?[3,2]:[4,this.stopVoiceChat()];case 1:z.sent(),z.label=2;case 2:return z.trys.push([2,4,,6]),this.state=VoiceChatState.STARTING,[4,this._startVoiceChat(j)];case 3:return z.sent(),this.state=VoiceChatState.ACTIVE,[3,6];case 4:return B=z.sent(),[4,this.stopVoiceChat()];case 5:throw z.sent(),B;case 6:return[2]}})})},U.prototype.stopVoiceChat=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(j){switch(j.label){case 0:return this.state===VoiceChatState.INACTIVE?[2]:(this.state=VoiceChatState.STOPPING,[4,this._stopVoiceChat()]);case 1:return j.sent(),this._isMuted=!0,this.state=VoiceChatState.INACTIVE,[2]}})})},U.prototype._mute=function(){},U.prototype._unmute=function(){},U.prototype.mute=function(){this.isVoiceChatting&&(this._mute(),this._isMuted=!0)},U.prototype.unmute=function(){this.isVoiceChatting&&(this._unmute(),this._isMuted=!1)},U}(AbstractVoiceChat);function sleep(V){return new Promise(function(U){return setTimeout(U,V)})}function convertFloat32ToS16PCM(V){for(var U=new Int16Array(V.length),j=0;j<V.length;j++){var B=Math.max(-1,Math.min(1,V[j]));U[j]=B<0?B*32768:B*32767}return U}var LivekitVoiceChat=function(V){__extends(U,V);function U(){var j=V!==null&&V.apply(this,arguments)||this;return j.room=null,j.track=null,j}return U.prototype._startVoiceChat=function(j){return __awaiter(this,void 0,void 0,function(){var B,z;return __generator(this,function(H){switch(H.label){case 0:return this.room=j.room,B=this,[4,createLocalAudioTrack({echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0})];case 1:return B.track=H.sent(),[4,this.room.localParticipant.publishTrack(this.track)];case 2:return H.sent(),!((z=j.config)===null||z===void 0)&&z.defaultMuted?this.mute():this.unmute(),[4,sleep(4e3)];case 3:return H.sent(),[2]}})})},U.prototype._stopVoiceChat=function(){return __awaiter(this,void 0,void 0,function(){var j;return __generator(this,function(B){return!((j=this.room)===null||j===void 0)&&j.localParticipant&&this.room.localParticipant.getTrackPublications().forEach(function(z){z.track&&z.track.kind===Track.Kind.Audio&&z.track.stop()}),this.track&&(this.track.stop(),this.track=null),[2]})})},U.prototype._mute=function(){this.track&&!this.track.isMuted&&this.track.mute()},U.prototype._unmute=function(){this.track&&this.track.isMuted&&this.track.unmute()},U}(AbstractVoiceChatImplementation),WebSocketVoiceChat=function(V){__extends(U,V);function U(){var j=V!==null&&V.apply(this,arguments)||this;return j.audioContext=null,j.webSocket=null,j.scriptProcessor=null,j.mediaStreamAudioSource=null,j.mediaDevicesStream=null,j.audioRawFrame=null,j}return U.prototype._startVoiceChat=function(j){return __awaiter(this,void 0,void 0,function(){var B,z=this,H,G,$,Q;return __generator(this,function(W){switch(W.label){case 0:if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Cannot start voice chat without media devices");return this.webSocket=j.webSocket,this.audioRawFrame=j.audioRawFrame,this.audioContext=new window.AudioContext({latencyHint:"interactive",sampleRate:16e3}),!((H=j.config)===null||H===void 0)&&H.defaultMuted||this.unmute(),[4,navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0}})];case 1:return B=W.sent(),this.mediaDevicesStream=B,this.mediaStreamAudioSource=(G=this.audioContext)===null||G===void 0?void 0:G.createMediaStreamSource(B),this.scriptProcessor=($=this.audioContext)===null||$===void 0?void 0:$.createScriptProcessor(512,1,1),this.mediaStreamAudioSource.connect(this.scriptProcessor),this.scriptProcessor.connect((Q=this.audioContext)===null||Q===void 0?void 0:Q.destination),this.scriptProcessor.onaudioprocess=function(X){var ee;if(!(!z.webSocket||!z.audioRawFrame)){var ie;z.isMuted?ie=new Float32Array(512):ie=X.inputBuffer.getChannelData(0);var ne=convertFloat32ToS16PCM(ie),re=new Uint8Array(ne.buffer),se=z.audioRawFrame.create({audio:{audio:Array.from(re),sampleRate:16e3,numChannels:1}}),de=new Uint8Array(z.audioRawFrame.encode(se).finish());(ee=z.webSocket)===null||ee===void 0||ee.send(de)}},[4,sleep(2e3)];case 2:return W.sent(),[2]}})})},U.prototype._stopVoiceChat=function(){return __awaiter(this,void 0,void 0,function(){var j,B;return __generator(this,function(z){return this.audioContext&&(this.audioContext=null),this.scriptProcessor&&(this.scriptProcessor.disconnect(),this.scriptProcessor=null),this.mediaStreamAudioSource&&(this.mediaStreamAudioSource.disconnect(),this.mediaStreamAudioSource=null),this.mediaDevicesStream&&((B=(j=this.mediaDevicesStream)===null||j===void 0?void 0:j.getTracks())===null||B===void 0||B.forEach(function(H){return H.stop()}),this.mediaDevicesStream=null),[2]})})},U}(AbstractVoiceChatImplementation),VoiceChatTransport;(function(V){V.LIVEKIT="livekit",V.WEBSOCKET="websocket"})(VoiceChatTransport||(VoiceChatTransport={}));var VoiceChatFactory=function(V){__extends(U,V);function U(j){var B=j.voiceChatInstance,z=j.initialConfig,H=V.call(this)||this;return H.initialConfig=z,H.voiceChat=B,H}return Object.defineProperty(U.prototype,"isMuted",{get:function(){return this.voiceChat.isMuted},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"isVoiceChatting",{get:function(){return this.voiceChat.isVoiceChatting},enumerable:!1,configurable:!0}),U.prototype.startVoiceChat=function(j){return __awaiter(this,arguments,void 0,function(B){var z=B.config;return __generator(this,function(H){switch(H.label){case 0:return[4,this.voiceChat.startVoiceChat(__assign(__assign({},this.initialConfig),{config:z}))];case 1:return H.sent(),[2]}})})},U.prototype.stopVoiceChat=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(j){switch(j.label){case 0:return[4,this.voiceChat.stopVoiceChat()];case 1:return j.sent(),[2]}})})},U.prototype.mute=function(){this.voiceChat.mute()},U.prototype.unmute=function(){this.voiceChat.unmute()},U.createLiveKitVoiceChat=function(j){return new this({voiceChatInstance:new LivekitVoiceChat,initialConfig:j})},U.createWebSocketVoiceChat=function(j){return new this({voiceChatInstance:new WebSocketVoiceChat,initialConfig:j})},U}(AbstractVoiceChat),AvatarQuality;(function(V){V.Low="low",V.Medium="medium",V.High="high"})(AvatarQuality||(AvatarQuality={}));var VoiceEmotion;(function(V){V.EXCITED="excited",V.SERIOUS="serious",V.FRIENDLY="friendly",V.SOOTHING="soothing",V.BROADCASTER="broadcaster"})(VoiceEmotion||(VoiceEmotion={}));var ElevenLabsModel;(function(V){V.eleven_flash_v2_5="eleven_flash_v2_5",V.eleven_multilingual_v2="eleven_multilingual_v2"})(ElevenLabsModel||(ElevenLabsModel={}));var STTProvider;(function(V){V.DEEPGRAM="deepgram",V.GLADIA="gladia"})(STTProvider||(STTProvider={}));var TaskType;(function(V){V.TALK="talk",V.REPEAT="repeat"})(TaskType||(TaskType={}));var TaskMode;(function(V){V.SYNC="sync",V.ASYNC="async"})(TaskMode||(TaskMode={}));var StreamingEvents;(function(V){V.AVATAR_START_TALKING="avatar_start_talking",V.AVATAR_STOP_TALKING="avatar_stop_talking",V.AVATAR_TALKING_MESSAGE="avatar_talking_message",V.AVATAR_END_MESSAGE="avatar_end_message",V.USER_TALKING_MESSAGE="user_talking_message",V.USER_END_MESSAGE="user_end_message",V.USER_START="user_start",V.USER_STOP="user_stop",V.USER_SILENCE="user_silence",V.STREAM_READY="stream_ready",V.STREAM_DISCONNECTED="stream_disconnected",V.CONNECTION_QUALITY_CHANGED="connection_quality_changed"})(StreamingEvents||(StreamingEvents={}));var APIError=function(V){__extends(U,V);function U(j,B,z){var H=V.call(this,j)||this;return H.name="APIError",H.status=B,H.responseText=z,H}return U}(Error),ConnectionQualityIndicatorClass=QualityIndicatorMixer({TrackerClass:LiveKitConnectionQualityIndicator,getParams:function(V){return V}},{TrackerClass:WebRTCConnectionQualityIndicator,getParams:function(V){var U;return((U=V.engine.pcManager)===null||U===void 0?void 0:U.subscriber)._pc}}),StreamingAvatar=function(){function V(U){var j=U.token,B=U.basePath,z=B===void 0?"https://api.heygen.com":B,H=this;this.room=null,this.mediaStream=null,this.eventTarget=new EventTarget,this.webSocket=null,this.sessionId=null,this.voiceChat=null,this.isLiveKitTransport=!1,this.token=j,this.basePath=z,this.connectionQualityIndicator=new ConnectionQualityIndicatorClass(function(G){return H.emit(StreamingEvents.CONNECTION_QUALITY_CHANGED,G)})}return Object.defineProperty(V.prototype,"connectionQuality",{get:function(){return this.connectionQualityIndicator.connectionQuality},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"isInputAudioMuted",{get:function(){var U,j;return(j=(U=this.voiceChat)===null||U===void 0?void 0:U.isMuted)!==null&&j!==void 0?j:!0},enumerable:!1,configurable:!0}),V.prototype.muteInputAudio=function(){var U;(U=this.voiceChat)===null||U===void 0||U.mute()},V.prototype.unmuteInputAudio=function(){var U;(U=this.voiceChat)===null||U===void 0||U.unmute()},V.prototype.createStartAvatar=function(U){return __awaiter(this,void 0,void 0,function(){var j;return __generator(this,function(B){switch(B.label){case 0:return[4,this.newSession(U)];case 1:return j=B.sent(),[2,this.startAvatar(U,j)]}})})},V.prototype.startAvatar=function(U,j){return __awaiter(this,void 0,void 0,function(){var B,z,H=this;return __generator(this,function(G){switch(G.label){case 0:this.sessionId=j.session_id,this.isLiveKitTransport=U.voiceChatTransport===VoiceChatTransport.LIVEKIT,B=new Room({adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:VideoPresets.h720.resolution}}),this.room=B,this.mediaStream=null,B.on(RoomEvent.DataReceived,function($){var Q=null;try{var W=new TextDecoder().decode($);Q=JSON.parse(W)}catch(X){console.error(X)}Q&&H.emit(Q.type,Q)}),z=new MediaStream,B.on(RoomEvent.TrackSubscribed,function($){if($.kind==="video"||$.kind==="audio"){z.addTrack($.mediaStreamTrack);var Q=z.getVideoTracks().length>0,W=z.getAudioTracks().length>0;Q&&W&&!H.mediaStream&&(H.mediaStream=z,H.emit(StreamingEvents.STREAM_READY,H.mediaStream))}}),B.on(RoomEvent.TrackUnsubscribed,function($){var Q=$.mediaStreamTrack;Q&&z.removeTrack(Q)}),B.on(RoomEvent.Disconnected,function($){H.emit(StreamingEvents.STREAM_DISCONNECTED,$)}),G.label=1;case 1:return G.trys.push([1,3,,4]),[4,B.prepareConnection(j.url,j.access_token)];case 2:return G.sent(),[3,4];case 3:return G.sent(),[3,4];case 4:return[4,this.startSession()];case 5:return G.sent(),[4,B.connect(j.url,j.access_token)];case 6:return G.sent(),[4,this.connectWebSocket({useSilencePrompt:!!U.useSilencePrompt})];case 7:return G.sent(),this.initVoiceChat(U.voiceChatTransport||VoiceChatTransport.WEBSOCKET),this.connectionQualityIndicator.start(B),[2,j]}})})},V.prototype.startVoiceChat=function(){return __awaiter(this,arguments,void 0,function(U){var j,B=U===void 0?{}:U,z=B.isInputAudioMuted;return __generator(this,function(H){switch(H.label){case 0:return[4,(j=this.voiceChat)===null||j===void 0?void 0:j.startVoiceChat({config:{defaultMuted:z}})];case 1:return H.sent(),[2]}})})},V.prototype.closeVoiceChat=function(){return __awaiter(this,void 0,void 0,function(){var U;return __generator(this,function(j){switch(j.label){case 0:return[4,(U=this.voiceChat)===null||U===void 0?void 0:U.stopVoiceChat()];case 1:return j.sent(),[2]}})})},V.prototype.newSession=function(U){return __awaiter(this,void 0,void 0,function(){var j,B,z,H,G;return __generator(this,function($){return[2,this.request("/v1/streaming.new",{avatar_name:U.avatarName,quality:U.quality,knowledge_base_id:U.knowledgeId,knowledge_base:U.knowledgeBase,voice:{voice_id:(j=U.voice)===null||j===void 0?void 0:j.voiceId,rate:(B=U.voice)===null||B===void 0?void 0:B.rate,emotion:(z=U.voice)===null||z===void 0?void 0:z.emotion,elevenlabs_settings:__assign(__assign({},(H=U?.voice)===null||H===void 0?void 0:H.elevenlabsSettings),{model_id:(G=U.voice)===null||G===void 0?void 0:G.model})},language:U.language,version:"v2",video_encoding:"H264",source:"sdk",disable_idle_timeout:U.disableIdleTimeout,stt_settings:U.sttSettings,ia_is_livekit_transport:U.voiceChatTransport===VoiceChatTransport.LIVEKIT,silence_response:U.useSilencePrompt,activity_idle_timeout:U.activityIdleTimeout})]})})},V.prototype.startSession=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(U){return[2,this.request("/v1/streaming.start",{session_id:this.sessionId})]})})},V.prototype.speak=function(U){return __awaiter(this,void 0,void 0,function(){var j,B;return __generator(this,function(z){if(j=U.taskType||U.task_type||TaskType.TALK,B=U.taskMode||TaskMode.ASYNC,j===TaskType.TALK&&B===TaskMode.ASYNC){if(this.isLiveKitTransport&&this.room)return this.sendLivekitMessage(U.text),[2];if(!this.isLiveKitTransport&&this.webSocket&&this.audioRawFrame)return this.sendWebsocketMessage(U.text),[2]}return[2,this.request("/v1/streaming.task",{text:U.text,session_id:this.sessionId,task_mode:U.taskMode,task_type:U.taskType})]})})},V.prototype.startListening=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(U){return[2,this.request("/v1/streaming.start_listening",{session_id:this.sessionId})]})})},V.prototype.stopListening=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(U){return[2,this.request("/v1/streaming.stop_listening",{session_id:this.sessionId})]})})},V.prototype.interrupt=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(U){return[2,this.request("/v1/streaming.interrupt",{session_id:this.sessionId})]})})},V.prototype.stopAvatar=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(U){return this.closeVoiceChat(),this.connectionQualityIndicator.stop(),this.voiceChat=null,this.webSocket&&(this.webSocket.close(),this.webSocket=null),[2,this.request("/v1/streaming.stop",{session_id:this.sessionId})]})})},V.prototype.keepAlive=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(U){return[2,this.request("/v1/streaming.keep_alive",{session_id:this.sessionId})]})})},V.prototype.on=function(U,j){return this.eventTarget.addEventListener(U,j),this},V.prototype.off=function(U,j){return this.eventTarget.removeEventListener(U,j),this},V.prototype.sendLivekitMessage=function(U){return __awaiter(this,void 0,void 0,function(){var j;return __generator(this,function(B){return this.room?(j=new TextEncoder().encode(JSON.stringify(U)),this.room.localParticipant.publishData(j,{reliable:!0}),[2]):[2]})})},V.prototype.sendWebsocketMessage=function(U){return __awaiter(this,void 0,void 0,function(){var j,B,z,H;return __generator(this,function(G){return!this.webSocket||!this.audioRawFrame?[2]:(j=(z=this.audioRawFrame)===null||z===void 0?void 0:z.create({text:{text:U}}),B=new Uint8Array((H=this.audioRawFrame)===null||H===void 0?void 0:H.encode(j).finish()),this.webSocket.send(B),[2])})})},V.prototype.initVoiceChat=function(U){if(U===VoiceChatTransport.WEBSOCKET){if(this.loadAudioRawFrame(),!this.audioRawFrame||!this.webSocket)return;this.voiceChat=VoiceChatFactory.createWebSocketVoiceChat({webSocket:this.webSocket,audioRawFrame:this.audioRawFrame})}else{if(!this.room)return;this.voiceChat=VoiceChatFactory.createLiveKitVoiceChat({room:this.room})}},V.prototype.request=function(U,j,B){return __awaiter(this,void 0,void 0,function(){var z,H,G,$;return __generator(this,function(Q){switch(Q.label){case 0:return Q.trys.push([0,5,,6]),[4,fetch(this.getRequestUrl(U),{method:"POST",headers:{Authorization:"Bearer ".concat(this.token),"Content-Type":"application/json"},body:JSON.stringify(j)})];case 1:return z=Q.sent(),z.ok?[3,3]:[4,z.text()];case 2:throw H=Q.sent(),new APIError("API request failed with status ".concat(z.status),z.status,H);case 3:return[4,z.json()];case 4:return G=Q.sent(),[2,G.data];case 5:throw $=Q.sent(),$;case 6:return[2]}})})},V.prototype.emit=function(U,j){var B=new CustomEvent(U,{detail:j});this.eventTarget.dispatchEvent(B)},V.prototype.getRequestUrl=function(U){return"".concat(this.basePath).concat(U)},V.prototype.connectWebSocket=function(U){return __awaiter(this,void 0,void 0,function(){var j,B=this;return __generator(this,function(z){return j="wss://".concat(new URL(this.basePath).hostname,"/v1/ws/streaming.chat?session_id=").concat(this.sessionId,"&session_token=").concat(this.token).concat(this.isLiveKitTransport?"&arch_version=v2":"","&silence_response=").concat(U.useSilencePrompt),this.webSocket=new WebSocket(j),this.webSocket.addEventListener("message",function(H){var G=null;try{G=JSON.parse(H.data)}catch($){console.error($);return}G&&B.emit(G.event_type,G)}),this.webSocket.addEventListener("close",function(H){B.webSocket=null}),[2,new Promise(function(H,G){var $,Q;($=B.webSocket)===null||$===void 0||$.addEventListener("error",function(W){B.webSocket=null,G(W)}),(Q=B.webSocket)===null||Q===void 0||Q.addEventListener("open",function(){H(!0)})})]})})},V.prototype.loadAudioRawFrame=function(){return __awaiter(this,void 0,void 0,function(){var U;return __generator(this,function(j){return this.audioRawFrame||(U=protobuf.Root.fromJSON(jsonDescriptor),this.audioRawFrame=U?.lookupType("pipecat.Frame")),[2]})})},V}();const generateUserFingerprint=V=>{const U=[V.userAgent,V.language,V.timezone,V.screenResolution,V.colorDepth,V.pixelRatio,V.platform,V.cookieEnabled,V.doNotTrack,V.hardwareConcurrency,V.deviceMemory,V.connectionType,V.customUserId].filter(Boolean).join("|");let j=0;for(let B=0;B<U.length;B++){const z=U.charCodeAt(B);j=(j<<5)-j+z,j=j&j}return Math.abs(j).toString(36)},collectUserInfo=V=>{const U=navigator;return{userAgent:navigator.userAgent,language:navigator.language||"en-US",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,screenResolution:`${screen.width}x${screen.height}`,colorDepth:screen.colorDepth,pixelRatio:window.devicePixelRatio||1,platform:navigator.platform,cookieEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack,hardwareConcurrency:U.hardwareConcurrency||0,deviceMemory:U.deviceMemory||0,connectionType:U.connection?.effectiveType,customUserId:V}},getUserFingerprint=()=>{const V=localStorage.getItem("chatUserFingerprint");if(V)return V;const U=collectUserInfo(),j=generateUserFingerprint(U);return localStorage.setItem("chatUserFingerprint",j),j},getSessionId=()=>{const V=sessionStorage.getItem("chatSessionId");if(V)return V;const U=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return sessionStorage.setItem("chatSessionId",U),U},clearOldClientKeys=V=>{try{const U=sessionStorage.getItem("chatSession");if(U)try{const j=JSON.parse(U);j.clientKey&&j.clientKey!==V&&(sessionStorage.removeItem("chatSession"),console.log("Cleared session from different client key"))}catch{console.warn("Invalid session data, clearing"),sessionStorage.removeItem("chatSession")}}catch(U){console.error("Error clearing old client keys:",U)}},startConversation=async(V,U,j)=>{try{clearOldClientKeys(V);const B=collectUserInfo(j),z=getUserFingerprint(),H=getSessionId(),G=getUserEmail();G&&(B.email=G);const $=await fetch(`${U}/api/conversation/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientKey:V,userInfo:B,customUserId:j})});if(!$.ok)throw new Error("Failed to start conversation");const Q=await $.json(),W={sessionId:Q.sessionId||H,fingerprint:Q.fingerprint||z,userInfo:B,isActive:!0};return sessionStorage.setItem("chatSession",JSON.stringify({...W,clientKey:V})),console.log("Conversation started:",W),W}catch(B){console.error("Error starting conversation:",B);const z=collectUserInfo(j),H=getUserFingerprint(),$={sessionId:getSessionId(),fingerprint:H,userInfo:z,isActive:!0};return sessionStorage.setItem("chatSession",JSON.stringify({...$,clientKey:V})),$}},getOrStartConversation=async(V,U,j)=>{clearOldClientKeys(V);const B=sessionStorage.getItem("chatSession");if(B)try{const z=JSON.parse(B);if(z.isActive&&z.clientKey===V){const H=getUserEmail();return H&&!z.userInfo.email&&(z.userInfo.email=H,sessionStorage.setItem("chatSession",JSON.stringify(z))),console.log("Using existing conversation session:",z),z}else sessionStorage.removeItem("chatSession"),console.log("Cleared session from different client key")}catch{console.warn("Invalid session data, starting new conversation"),sessionStorage.removeItem("chatSession")}return startConversation(V,U,j)},addMessageToConversation=async(V,U,j,B,z)=>{try{await fetch(`${U}/api/conversation/${j}/message`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:B,content:z,clientKey:V})})}catch(H){console.error("Error adding message to conversation:",H)}},getUserEmail=()=>localStorage.getItem("userEmail"),hasUserEmail=()=>!!getUserEmail(),VideoAgent=({isVideoMode:V,setIsVideoMode:U,theme:j,isMinimized:B,setIsMinimized:z,prompt:H,clientKey:G,apiUrl:$,sessionId:Q})=>{const[W,X]=reactExports.useState(!1),[ee,ie]=reactExports.useState(!1),[ne,re]=reactExports.useState(!0),[se,de]=reactExports.useState(!0),[oe,le]=reactExports.useState("excellent"),[ue,fe]=reactExports.useState(!1),[he,ge]=reactExports.useState(!1),[Ae,_e]=reactExports.useState(null),[Pe,xe]=reactExports.useState(!1),[Ce,ze]=reactExports.useState(null),$e=reactExports.useRef(null),Fe=reactExports.useRef(null),qe=reactExports.useRef(null),be=reactExports.useRef(null);reactExports.useEffect(()=>{V?Re():Ue()},[V]),reactExports.useEffect(()=>(le("excellent"),he&&Ue(),()=>{Ue()}),[]);const Re=reactExports.useCallback(async()=>{try{X(!0),_e(null);const He=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280,max:1920},height:{ideal:720,max:1080},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});qe.current=He,$e.current&&($e.current.srcObject=He),ge(!0),setTimeout(()=>{ie(!0),X(!1),Ge()},2e3)}catch(He){console.error("Permission error:",He),_e("Camera and microphone access required for video calls"),X(!1)}},[]),Be=()=>{if(qe.current){const He=qe.current.getVideoTracks()[0];He&&(He.enabled=!ne,re(!ne))}},We=async()=>{if(qe.current&&be.current){const He=qe.current.getAudioTracks()[0];if(He)if(se){He.enabled=!1;try{await be.current.closeVoiceChat()}catch{}de(!1)}else{He.enabled=!0;try{await be.current.startVoiceChat()}catch{}de(!0)}}},pe=()=>{Ue(),U(!1)},we=async()=>{const He=await fetch(`${$}/api/video/token`);if(!He.ok){const lt=await He.json();throw new Error(`Failed to fetch access token: ${lt}`)}return(await He.json()).data.token},je=async()=>{try{if(be.current){try{await be.current.closeVoiceChat()}catch{}try{await be.current.stopAvatar()}catch{}be.current=null}ie(!1),X(!1),ge(!1),xe(!1),ze(null),de(!1),re(!1),_e(null)}catch(He){console.log(He)}},Ue=reactExports.useCallback(()=>{!qe.current&&!be.current||(je(),qe.current&&(qe.current.getTracks().forEach(He=>He.stop()),qe.current=null),ie(!1),X(!1),ge(!1),xe(!1),ze(null))},[]),Ge=reactExports.useCallback(async()=>{try{const He=await we();if(!He){alert("Unable to Start Session,please try again");return}const De=new StreamingAvatar({token:He});be.current=De,De.on(StreamingEvents.USER_START,()=>{console.log("User started")}),De.on(StreamingEvents.USER_STOP,()=>{console.log("User stopped")}),De.on(StreamingEvents.USER_TALKING_MESSAGE,async tt=>{console.log("User message:",tt.detail.message),G&&$&&Q&&tt.detail.message&&addMessageToConversation(G,$,Q,"user",tt.detail.message)}),De.on(StreamingEvents.AVATAR_START_TALKING,()=>{console.log("Agent started")}),De.on(StreamingEvents.AVATAR_STOP_TALKING,()=>{console.log("Agent stopped")});let lt="";De.on(StreamingEvents.AVATAR_TALKING_MESSAGE,async tt=>{if(console.log("Agent message:",tt.detail.message),lt+=tt.detail.message+" ",tt.detail.message.match(/[.!?]$/))try{const St=[],ti=lt.trim().split(" ");for(let $t=0;$t<ti.length;$t+=20)St.push(ti.slice($t,$t+20).join(" "));console.log(St),G&&$&&Q&&lt&&addMessageToConversation(G,$,Q,"assistant",lt),lt=""}catch(St){console.error("Error processing message:",St)}}),De.on(StreamingEvents.STREAM_DISCONNECTED,()=>{console.log("Stream disconnected"),Ue(),z(!0)}),De.on(StreamingEvents.STREAM_READY,tt=>{console.log("Stream is ready"),console.log(tt),console.log(tt.detail),tt.detail&&(ze(tt.detail),xe(!0))}),await De.createStartAvatar({quality:AvatarQuality.High,avatarName:"Ann_Therapist_public",disableIdleTimeout:!1,knowledgeBase:H,language:"en",voice:{voiceId:"330290724a1b470fb63153f34d4c0183",rate:1,emotion:VoiceEmotion.SOOTHING}})||alert("Unable to Start Session,please try again");const Je={text:"Hello! I am your CoTutor, here to guide you on your learning journey.Feel free to start the conversation!",task_type:TaskType.REPEAT};if(De.speak(Je),qe.current){const tt=qe.current.getAudioTracks()[0];tt&&(tt.enabled=se)}se?await De.startVoiceChat():await De.closeVoiceChat()}catch(He){console.log(He),console.error("Error initializing avatar session:",He)}},[]);return reactExports.useEffect(()=>{Fe.current&&Ce&&(Fe.current.srcObject=Ce,Fe.current.play().catch(He=>{console.error("Error playing AI video:",He)}))},[Ce]),V?jsxRuntimeExports.jsx(AnimatePresence,{children:jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{type:"spring",stiffness:300,damping:30},style:{position:"fixed",top:ue?"0":"30%",right:ue?"0":"5%",transform:ue?"none":"translate(-50%, -50%)",width:ue?"100vw":B?"320px":"480px",height:ue?"100vh":B?"240px":"360px",backgroundColor:"#000",borderRadius:ue?"0":j.borderRadius,overflow:"hidden",boxShadow:ue?"none":"0 25px 50px -12px rgba(0, 0, 0, 0.5)",zIndex:1e3,border:ue?"none":`2px solid ${j.primaryColor}`},children:[jsxRuntimeExports.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[Pe?jsxRuntimeExports.jsx("video",{ref:Fe,autoPlay:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):jsxRuntimeExports.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"#1a1a1a",display:"flex",alignItems:"center",justifyContent:"center"},children:ee?jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},style:{width:"100%",height:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[jsxRuntimeExports.jsx(motion.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},style:{width:"90px",height:"90px",borderRadius:"50%",backgroundColor:j.primaryColor,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"20px",boxShadow:"0 0 40px rgba(255, 255, 255, 0.3)"},children:jsxRuntimeExports.jsx("img",{src:j.companyLogo,alt:"AI Assistant",style:{width:"70px",height:"70px",borderRadius:"50%",objectFit:"cover"}})}),jsxRuntimeExports.jsx(motion.div,{animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},style:{color:"white",fontSize:"18px",fontWeight:"600",textAlign:"center"},children:"AI Assistant Active"}),jsxRuntimeExports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginTop:"16px"},children:[...Array(5)].map((He,De)=>jsxRuntimeExports.jsx(motion.div,{animate:{height:[8,20,8],backgroundColor:["#ffffff80","#ffffff","#ffffff80"]},transition:{duration:1,repeat:1/0,delay:De*.1},style:{width:"3px",height:"8px",backgroundColor:"#ffffff80",borderRadius:"2px"}},De))})]}):W?jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},style:{display:"flex",flexDirection:"column",alignItems:"center",color:"white",gap:"16px"},children:[jsxRuntimeExports.jsx(LoaderCircle,{size:32,style:{animation:"spin 1s linear infinite"}}),jsxRuntimeExports.jsx("p",{style:{margin:0,fontSize:"16px"},children:"Connecting to AI Assistant..."})]}):jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},style:{display:"flex",flexDirection:"column",alignItems:"center",color:"white",gap:"16px",textAlign:"center",padding:"20px"},children:[jsxRuntimeExports.jsx(VideoOff,{size:48,style:{opacity:.5}}),Ae?jsxRuntimeExports.jsx("p",{style:{margin:0,fontSize:"14px",color:"#ff6b6b"},children:Ae}):jsxRuntimeExports.jsx("p",{style:{margin:0,fontSize:"14px"},children:"AI Assistant video call ready"})]})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},style:{position:"absolute",top:"16px",right:"16px",width:B?"80px":"120px",height:B?"60px":"90px",borderRadius:"12px",overflow:"hidden",border:`2px solid ${j.primaryColor}`,backgroundColor:"#000"},children:[jsxRuntimeExports.jsx("video",{ref:$e,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}}),!ne&&jsxRuntimeExports.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"#1a1a1a",display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsx(VideoOff,{size:24,color:"white"})})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0},animate:{opacity:1},style:{position:"absolute",top:"16px",left:"16px",display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:"20px",backdropFilter:"blur(10px)"},children:[oe==="excellent"&&jsxRuntimeExports.jsx(Wifi,{size:16,color:"#10b981"}),oe==="good"&&jsxRuntimeExports.jsx(Wifi,{size:16,color:"#f59e0b"}),oe==="poor"&&jsxRuntimeExports.jsx(WifiOff,{size:16,color:"#ef4444"}),jsxRuntimeExports.jsx("span",{style:{fontSize:"12px",color:"white",fontWeight:"500"},children:oe})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},style:{position:"absolute",width:"100%",bottom:"16px",left:"40%",transform:"translateX(-50%)",display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"50px",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:Be,style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:ne?j.primaryColor:"#ef4444",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"white",transition:"all 0.2s ease",padding:"12px"},children:ne?jsxRuntimeExports.jsx(Video,{}):jsxRuntimeExports.jsx(VideoOff,{})}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:We,style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:se?j.primaryColor:"#ef4444",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"white",transition:"all 0.2s ease",padding:"12px"},children:se?jsxRuntimeExports.jsx(Mic,{size:20}):jsxRuntimeExports.jsx(MicOff,{size:20})}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>fe(!ue),style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.1)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"white",transition:"all 0.2s ease",padding:"12px"},children:ue?jsxRuntimeExports.jsx(Minimize2,{size:20}):jsxRuntimeExports.jsx(Maximize2,{size:20})}),jsxRuntimeExports.jsx(motion.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:pe,style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:"#ef4444",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"white",transition:"all 0.2s ease",padding:"12px"},children:jsxRuntimeExports.jsx(PhoneOff,{size:20})})]})]}),jsxRuntimeExports.jsx("style",{children:`
            @keyframes spin {
              from { transform: rotate(0deg); }
              to { transform: rotate(360deg); }
            }
          `})]})}):null},TOKEN_API="https://chat-bot-backend-1-28ro.onrender.com/api/voice/token",VoiceAgent=({setMessages:V,shouldStartCall:U,setShouldStartCall:j,setGenerating:B,prompt:z,clientKey:H,apiUrl:G,sessionId:$,theme:Q})=>{const W=reactExports.useRef(null),X=reactExports.useRef(null),ee=reactExports.useRef(null),ie=reactExports.useRef(null),ne=reactExports.useRef(null),re=reactExports.useRef(null),se=reactExports.useRef(""),[de,oe]=reactExports.useState(!1),[le,ue]=reactExports.useState(!1);reactExports.useEffect(()=>{const xe=document.createElement("style");return xe.innerHTML=`
      @keyframes voice-pulse {
        0%, 100% { transform: scaleY(0.3); opacity: 0.3; }
        50%      { transform: scaleY(1);   opacity: 1;   }
      }
    `,document.head.appendChild(xe),()=>{document.head.removeChild(xe)}},[]);const fe=async()=>{B(!1),oe(!1),j(!1),X.current&&(X.current.getSenders().forEach(xe=>xe.track?.stop()),X.current.close(),X.current=null),W.current?.readyState==="open"&&W.current.close(),ee.current&&(ee.current.getTracks().forEach(xe=>xe.stop()),ee.current=null),ie.current&&(ie.current.pause(),ie.current.currentTime=0,ie.current.srcObject=null),re.current&&(re.current.disconnect(),re.current=null),await ne.current?.close(),ne.current=null,ue(!1)},he=async()=>{try{B(!0);const xe=await fetch(TOKEN_API,{method:"GET"}),{client_secret:Ce}=await xe.json(),ze=Ce.value,$e=new RTCPeerConnection;X.current=$e,ee.current=await navigator.mediaDevices.getUserMedia({audio:!0});const[Fe]=ee.current.getTracks();$e.addTrack(Fe);const qe=$e.createDataChannel("oai-events");W.current=qe,qe.onopen=()=>{const We={type:"session.update",session:{instructions:`Speak in a warm, clear and strong Indian accent. Keep conversation friendly and educational.


+${z}`,input_audio_transcription:{model:"whisper-1"}}};qe.send(JSON.stringify(We))},qe.onmessage=We=>{const pe=JSON.parse(We.data),{type:we,transcript:je,text:Ue,delta:Ge}=pe;if(we==="conversation.item.input_audio_transcription.completed"){const He=je||Ue;if(He){const De={id:Date.now().toString(),content:He,sender:"user",timestamp:new Date};V(De),H&&G&&$&&addMessageToConversation(H,G,$,"user",He)}}if(we==="response.audio_transcript.delta"&&(se.current+=Ge),we==="response.audio_transcript.done"){const He=se.current.trim();if(He){const De={id:(Date.now()+1).toString(),content:He,sender:"bot",timestamp:new Date};V(De),H&&G&&$&&addMessageToConversation(H,G,$,"assistant",He)}se.current=""}},$e.ontrack=We=>{const pe=We.streams[0];if(ie.current){ie.current.srcObject=pe,ie.current.volume=1;const De=ie.current.play();De!==void 0&&De.catch(lt=>{console.error("Audio playback error:",lt),ne.current?.state==="suspended"&&ne.current.resume()})}const we=new AudioContext;ne.current=we;const je=we.createMediaStreamSource(pe);re.current=je;const Ue=we.createAnalyser();Ue.fftSize=512,je.connect(Ue);const Ge=new Uint8Array(Ue.frequencyBinCount),He=setInterval(()=>{Ue.getByteFrequencyData(Ge);const De=Ge.reduce((lt,ut)=>lt+ut,0)/Ge.length;oe(De>10)},300);pe.getTracks().forEach(De=>De.addEventListener("ended",()=>{clearInterval(He),oe(!1)}))};const be=await $e.createOffer();await $e.setLocalDescription(be);const Be={type:"answer",sdp:await(await fetch("https://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview-2024-12-17",{method:"POST",body:be.sdp,headers:{Authorization:`Bearer ${ze}`,"Content-Type":"application/sdp"}})).text()};await $e.setRemoteDescription(Be),ue(!0),B(!1)}catch(xe){console.error("Start call error:",xe),B(!1),fe()}};reactExports.useEffect(()=>(U&&!le&&he(),!U&&le&&fe(),()=>{fe()}),[U]);const ge={border:"none",borderRadius:"50%",padding:"5px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s",backgroundColor:le?"red":Q.primaryColor,opacity:le?"0.75":"1"},Ae={height:"1.5rem",width:"1.5rem",color:"#ffffff"},_e={display:"flex",alignItems:"flex-end",gap:"0.25rem",height:"1.5rem"},Pe={width:"3px",height:"100%",backgroundColor:"#FFFFFF",borderRadius:"2px",animation:"voice-pulse 1s infinite ease-in-out"};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>le?fe():j(!0),style:ge,children:le&&de?jsxRuntimeExports.jsx("div",{style:_e,children:[0,1,2,3].map(xe=>jsxRuntimeExports.jsx("div",{style:{...Pe,animationDelay:`${xe*.15}s`}},xe))}):jsxRuntimeExports.jsx(Mic,{style:Ae})}),jsxRuntimeExports.jsx("audio",{ref:ie,autoPlay:!0,playsInline:!0,controls:!1,style:{display:"none"}})]})},EmailCollector=({onEmailCollected:V,theme:U})=>{const[j,B]=reactExports.useState(""),[z,H]=reactExports.useState(!0),[G,$]=reactExports.useState(!1),Q=ie=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ie),W=ie=>{localStorage.setItem("userEmail",ie)},X=ie=>{const ne=ie.target.value;B(ne),H(!0)},ee=ie=>{if(ie.preventDefault(),!Q(j)){H(!1);return}W(j),$(!0),V(j)};return G?jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},style:{padding:"20px",textAlign:"center",color:U.textColor},children:[jsxRuntimeExports.jsx(Check,{size:24,color:U.primaryColor,style:{marginBottom:"8px"}}),jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",fontWeight:"500"},children:"Email saved successfully!"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px"},children:"You can now start chatting"})]}):jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{padding:"20px",borderBottom:`1px solid ${U.primaryColor}20`,maxWidth:"100%"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",color:U.textColor},children:[jsxRuntimeExports.jsx(Mail,{size:16,color:U.primaryColor}),jsxRuntimeExports.jsx("span",{style:{fontSize:"14px",fontWeight:"500"},children:"Welcome! Please enter your email to continue"})]}),jsxRuntimeExports.jsxs("form",{onSubmit:ee,children:[jsxRuntimeExports.jsx("input",{type:"email",value:j,onChange:X,placeholder:"your.email@example.com",style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:`1px solid ${z?U.primaryColor+"20":"#ef4444"}`,backgroundColor:U.backgroundColor,color:U.textColor,fontSize:"14px",outline:"none",marginBottom:"8px",maxWidth:"100%",boxSizing:"border-box"}}),!z&&jsxRuntimeExports.jsx("div",{style:{color:"#ef4444",fontSize:"12px",marginBottom:"8px"},children:"Please enter a valid email address"}),jsxRuntimeExports.jsx("button",{type:"submit",style:{width:"100%",padding:"12px 16px",borderRadius:"8px",backgroundColor:U.primaryColor,color:"white",border:"none",fontSize:"14px",fontWeight:"500",cursor:"pointer"},children:"Continue"})]}),jsxRuntimeExports.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"8px",textAlign:"center",color:U.textColor},children:"We'll use this to save your conversation history"})]})},defaultTheme={primaryColor:"#1d4ed8",secondaryColor:"#3b82f6",backgroundColor:"#ffffff",headerFooterBgColor:"#f8fafc",userMessageBgColor:"#1d4ed8",aiMessageBgColor:"#f8fafc",inputContainerBgColor:"#f1f5f9",textColor:"#1f2937",borderRadius:"1rem",fontSize:"1rem",position:"bottom-right",shadowColor:"rgba(0, 0, 0, 0.1)",companyName:"ChatBot",companyLogo:"https://placehold.co/32x32",prompt:"You are a helpful AI assistant. Please provide clear and concise responses.",voiceEnabled:!0,soundEnabled:!0},loadTheme=async V=>{try{try{const j=await fetch(`https://chat-bot-backend-1-28ro.onrender.com/api/client/${V}/theme`);if(j.ok){const B=await j.json();return{...defaultTheme,...B}}}catch(U){console.warn("Failed to load theme from backend:",U)}return defaultTheme}catch(U){return console.error("Error loading theme:",U),defaultTheme}};function App({clientKey:V="c3a94b703193354cdd5f647a8dc35f79",customUserId:U}){const j="https://chat-bot-backend-1-28ro.onrender.com",[B,z]=reactExports.useState(null),[H,G]=reactExports.useState([]),[$,Q]=reactExports.useState(""),[W,X]=reactExports.useState(!1),[ee,ie]=reactExports.useState(!1),[ne,re]=reactExports.useState(!1),[se,de]=reactExports.useState(!0),[oe,le]=reactExports.useState(!0),[ue,fe]=reactExports.useState(0),[he,ge]=reactExports.useState(null),[Ae,_e]=reactExports.useState(!1),[Pe,xe]=reactExports.useState(!1),[Ce,ze]=reactExports.useState("chat"),[$e,Fe]=reactExports.useState(!0),qe=reactExports.useRef(null),be=reactExports.useRef(null),Re=reactExports.useRef(null);reactExports.useEffect(()=>{(async()=>{try{const tt=await loadTheme(V);if(z(tt),!hasUserEmail())console.log("No email found, showing email collector",$e),Fe(!0);else{const St=await getOrStartConversation(V,j,U);ge(St.sessionId),console.log("App initialized:",{clientKey:V,sessionId:St.sessionId,fingerprint:St.fingerprint,theme:tt})}}catch(tt){console.error("Failed to initialize app:",tt),de(!1)}})()},[V,U]),reactExports.useEffect(()=>{ee&&!ne&&qe.current&&Ce==="chat"&&qe.current.scrollIntoView({behavior:"smooth"})},[H,ee,ne,W,Ce]),reactExports.useEffect(()=>{ee&&!ne&&Re.current&&Ce==="chat"&&setTimeout(()=>Re.current?.focus(),100)},[ee,ne,Ce]),reactExports.useEffect(()=>{ee&&!ne&&Re.current&&setTimeout(()=>Re.current?.focus(),100)},[ee,ne]),reactExports.useEffect(()=>{!ee&&H.length>0&&H[H.length-1].sender==="bot"&&fe(tt=>tt+1)},[H,ee]);const Be=async Je=>{Fe(!1);try{const tt=await getOrStartConversation(V,j,U);ge(tt.sessionId)}catch(tt){console.error("Failed to start conversation after email collection:",tt)}},We=async()=>{if(!$.trim()||!he)return;const Je={id:Date.now().toString(),content:$,sender:"user",timestamp:new Date};G(tt=>[...tt,Je]),Q(""),X(!0);try{await addMessageToConversation(V,j,he,"user",Je.content);const tt=await fetch(`${j}/api/chat/${V}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...H,Je].map($t=>({role:$t.sender==="user"?"user":"assistant",content:$t.content})),sessionId:he,prompt:B?.prompt})});if(!tt.ok)throw new Error("Failed to get response");const St=await tt.json(),ti={id:(Date.now()+1).toString(),content:St.response||"I'm sorry, I couldn't process your request.",sender:"bot",timestamp:new Date};G($t=>[...$t,ti]),await addMessageToConversation(V,j,he,"assistant",ti.content),oe&&pe(),de(!0)}catch(tt){console.error("Chat error:",tt),de(!1);const St={id:(Date.now()+1).toString(),content:"Sorry, there was an error. Please try again.",sender:"bot",timestamp:new Date};G(ti=>[...ti,St])}finally{X(!1),setTimeout(()=>{Re.current&&Re.current.focus()},100)}},pe=()=>{be.current&&be.current.play().catch(()=>{})},we=Je=>{Je.key==="Enter"&&!Je.shiftKey&&(Je.preventDefault(),We())},je=()=>{ie(!ee),ee?(ze("chat"),xe(!1),_e(!1)):(fe(0),re(!1),ze("chat"))},Ue=Je=>{ze(Je),Je==="video"?(xe(!0),_e(!1)):Je==="voice"?(_e(!0),xe(!1)):(xe(!1),_e(!1))},Ge=()=>{G([])},He=Je=>new Date(Je).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),De=()=>{if(!B)return{position:"fixed",bottom:"16px",right:"16px",zIndex:50,display:"flex",flexDirection:"column",alignItems:"flex-end"};const{position:Je}=B,tt={position:"fixed",zIndex:50,display:"flex"};switch(Je){case"bottom-right":return{...tt,bottom:"16px",right:"16px",flexDirection:"column",alignItems:"flex-end"};case"bottom-left":return{...tt,bottom:"16px",left:"16px",flexDirection:"column",alignItems:"flex-start"};case"top-right":return{...tt,top:"16px",right:"16px",flexDirection:"column-reverse",alignItems:"flex-end"};case"top-left":return{...tt,top:"16px",left:"16px",flexDirection:"column-reverse",alignItems:"flex-start"};default:return{...tt,bottom:"16px",right:"16px",flexDirection:"column",alignItems:"flex-end"}}},lt=()=>{if(!B)return{marginTop:"16px"};const{position:Je}=B;return Je.startsWith("top")?{marginBottom:"16px"}:{marginTop:"16px"}},ut=()=>jsxRuntimeExports.jsxs("div",{style:{display:"inline-flex",alignItems:"center"},children:[[0,1,2].map(Je=>jsxRuntimeExports.jsx("span",{style:{height:"6px",width:"6px",backgroundColor:"currentColor",borderRadius:"50%",display:"inline-block",margin:"0 1px",opacity:.4,animation:"typing 1.4s infinite ease-in-out",animationDelay:Je===0?"-0.32s":Je===1?"-0.16s":"0s"}},Je)),jsxRuntimeExports.jsx("style",{children:`
          @keyframes typing {
            0%, 80%, 100% {
              transform: scale(0.8);
              opacity: 0.4;
            }
            40% {
              transform: scale(1);
              opacity: 1;
            }
          }
        `})]});return B?jsxRuntimeExports.jsxs("div",{style:{fontFamily:"system-ui, -apple-system, sans-serif"},children:[jsxRuntimeExports.jsx("style",{children:`
          :root { --chat-primary: ${B.primaryColor}; }
          .chat-messages { scrollbar-width: thin; scrollbar-color: var(--chat-primary) transparent; }
          .chat-messages::-webkit-scrollbar { width: 0px; height: 5px; }
          .chat-messages::-webkit-scrollbar-track { background: transparent !important; }
          .chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--chat-primary);
            background-image: linear-gradient(#030712, #111827, #030712);
            border-radius: 100px;
          }
        `}),jsxRuntimeExports.jsx("audio",{ref:be,autoPlay:!0,src:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSR+zPLNeSsFJnzH7+KSQQATN7rt5pyOHw5Cgt/tzVorBzl+x+zfkzoEL3TE89uEQA4AAAAAaGVhZA=="}),jsxRuntimeExports.jsxs("div",{style:De(),children:[jsxRuntimeExports.jsxs(motion.button,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:je,style:{position:"relative",background:`linear-gradient(135deg, ${B.primaryColor}, ${B.secondaryColor})`,borderRadius:"50%",boxShadow:`0 8px 32px ${B.shadowColor}`,border:"none",cursor:"pointer",width:"64px",height:"64px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",overflow:"hidden",transition:"all 0.3s ease"},"aria-label":ee?"Close chat":"Open chat",children:[jsxRuntimeExports.jsx(motion.div,{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05))",borderRadius:"50%",backdropFilter:"blur(10px)"},animate:{opacity:ee?0:[.2,.6,.2]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),jsxRuntimeExports.jsx(motion.div,{style:{position:"absolute",inset:0,border:"2px solid rgba(255,255,255,0.3)",borderRadius:"50%"},animate:{scale:ee?1:[1,1.5,1],opacity:ee?1:[.8,0,.8]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),jsxRuntimeExports.jsx(AnimatePresence,{mode:"wait",children:ee?jsxRuntimeExports.jsxs(motion.div,{initial:{rotate:-90,scale:0},animate:{rotate:0,scale:1},exit:{rotate:90,scale:0},transition:{duration:.3,type:"spring"},children:[Ce==="chat"&&jsxRuntimeExports.jsx(MessageCircle,{size:28}),Ce==="voice"&&jsxRuntimeExports.jsx(Phone,{size:28}),Ce==="video"&&jsxRuntimeExports.jsx(Video,{size:28})]},"close"):jsxRuntimeExports.jsxs(motion.div,{initial:{rotate:90,scale:0},animate:{rotate:0,scale:1},exit:{rotate:-90,scale:0},transition:{duration:.3,type:"spring"},style:{position:"relative",padding:"10px"},children:[Ce==="chat"&&jsxRuntimeExports.jsx(MessageCircle,{size:28}),Ce==="voice"&&jsxRuntimeExports.jsx(Phone,{size:28}),Ce==="video"&&jsxRuntimeExports.jsx(Video,{size:28}),ue>0&&jsxRuntimeExports.jsx(motion.div,{initial:{scale:0},animate:{scale:1},style:{position:"absolute",top:"-4px",right:"-4px",width:"24px",height:"24px",background:"linear-gradient(135deg, #ef4444, #dc2626)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold",color:"white",boxShadow:"0 2px 8px rgba(239, 68, 68, 0.5)"},children:ue>9?"9+":ue})]},"chat")})]}),Pe?jsxRuntimeExports.jsx(VideoAgent,{isVideoMode:Pe,setIsVideoMode:xe,theme:B,isMinimized:ne,setIsMinimized:re,prompt:B.prompt,clientKey:V,apiUrl:j,sessionId:he||void 0}):jsxRuntimeExports.jsx(AnimatePresence,{children:ee&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,scale:.8,y:B.position.startsWith("top")?-20:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:B.position.startsWith("top")?-20:20},transition:{type:"spring",stiffness:300,damping:30},style:{background:`linear-gradient(135deg, ${B.backgroundColor}, ${B.backgroundColor}f0)`,backdropFilter:"blur(20px)",borderRadius:B.borderRadius,width:"min(420px, 90vw)",height:ne?"80px":"min(700px, 85vh)",maxHeight:ne?"80px":"700px",border:`1px solid ${B.primaryColor}30`,display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.1)",overflow:"hidden",...lt()},children:[jsxRuntimeExports.jsxs(motion.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px",borderBottom:`1px solid ${B.primaryColor}15`,background:`linear-gradient(135deg, ${B.headerFooterBgColor}, ${B.headerFooterBgColor}f0)`,backdropFilter:"blur(20px)",borderTopLeftRadius:B.borderRadius,borderTopRightRadius:B.borderRadius,position:"sticky",top:0,zIndex:2},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[B.companyLogo!="https://placehold.co/32x32"?jsxRuntimeExports.jsx("img",{src:B.companyLogo,alt:"Company Logo",style:{width:"32px",height:"32px"}}):jsxRuntimeExports.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:B.primaryColor,display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsx(Bot,{size:16,color:"white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:B.textColor},children:B.companyName}),jsxRuntimeExports.jsx("div",{style:{fontSize:"12px",color:B.textColor+"80",display:"flex",alignItems:"center",gap:"4px"},children:se?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Wifi,{size:12}),"Online"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(WifiOff,{size:12}),"Offline"]})})]})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx("button",{onClick:()=>le(!oe),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"50%",color:oe?B.primaryColor:B.textColor+"60"},children:oe?jsxRuntimeExports.jsx(Volume2,{size:20}):jsxRuntimeExports.jsx(VolumeX,{size:20})}),H.length>0&&jsxRuntimeExports.jsx("button",{onClick:Ge,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"50%",color:B.textColor+"60"},title:"Clear messages",children:jsxRuntimeExports.jsx(Trash2,{size:20})}),jsxRuntimeExports.jsx("button",{onClick:Je=>{Je.stopPropagation(),re(!ne)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",borderRadius:"4px",color:B.textColor+"60"},children:ne?jsxRuntimeExports.jsx(Maximize2,{size:16}):jsxRuntimeExports.jsx(Minimize2,{size:16})})]})]}),$e&&jsxRuntimeExports.jsx(EmailCollector,{onEmailCollected:Be,theme:B}),jsxRuntimeExports.jsx(motion.div,{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"4px",fontSize:"12px",opacity:.8,color:B.textColor,position:"sticky",top:60,zIndex:2,padding:"4px 0"},children:!$e&&jsxRuntimeExports.jsxs("div",{style:{display:"flex",backgroundColor:"S{theme.primaryColor}15",alignItems:"center",justifyContent:"space-around",borderRadius:"12px",padding:"4px",width:"100%",marginRight:"8px"},children:[jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>Ue("chat"),style:{padding:"8px 12px",borderRadius:"8px",backgroundColor:Ce==="chat"?B.primaryColor:"transparent",color:Ce==="chat"?"white":B.textColor,border:"none",cursor:"pointer",fontSize:"12px",fontWeight:"600",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"4px"},title:"Chat Mode",children:[jsxRuntimeExports.jsx(MessageCircle,{size:14}),"Chat"]}),B.voiceEnabled&&jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>Ue("voice"),style:{padding:"8px 12px",borderRadius:"8px",backgroundColor:Ce==="voice"?B.primaryColor:"transparent",color:Ce==="voice"?"white":B.textColor,border:"none",cursor:"pointer",fontSize:"12px",fontWeight:"600",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"4px"},title:"Voice Mode",children:[jsxRuntimeExports.jsx(Phone,{size:14}),"Voice"]}),B.videoEnabled&&jsxRuntimeExports.jsxs(motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>Ue("video"),style:{padding:"8px 12px",borderRadius:"8px",backgroundColor:Ce==="video"?B.primaryColor:"transparent",color:Ce==="video"?"white":B.textColor,border:"none",cursor:"pointer",fontSize:"12px",fontWeight:"600",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"4px"},title:"Video Mode",children:[jsxRuntimeExports.jsx(Video,{size:14}),"Video"]})]})}),!ne&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[Ce==="chat"&&jsxRuntimeExports.jsx("div",{className:"chat-messages",style:{flex:1,minHeight:0,overflowY:"auto",padding:"24px",backgroundColor:B.backgroundColor,maxHeight:"none"},children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[jsxRuntimeExports.jsxs(AnimatePresence,{children:[H.length===0&&jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{textAlign:"center",padding:"40px 0"},children:[jsxRuntimeExports.jsxs(motion.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},style:{width:"60px",height:"60px",margin:"0 auto 24px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:`linear-gradient(135deg, ${B.primaryColor}20, ${B.secondaryColor}20)`,color:B.primaryColor,position:"relative",overflow:"hidden"},children:[jsxRuntimeExports.jsx(Bot,{size:40}),jsxRuntimeExports.jsx(motion.div,{animate:{rotate:[0,360]},transition:{duration:8,repeat:1/0,ease:"linear"},style:{position:"absolute",inset:"-10px",border:`2px solid ${B.primaryColor}30`,borderTop:`2px solid ${B.primaryColor}`,borderRadius:"50%"}})]}),jsxRuntimeExports.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:B.textColor,margin:"0 0 8px 0"},children:"AI Assistant Ready"}),jsxRuntimeExports.jsx("p",{style:{fontSize:"14px",opacity:.7,color:B.textColor,margin:0,lineHeight:1.5},children:"Start a conversation with our intelligent AI assistant. Ask questions, get help, or just chat!"})]}),H.map((Je,tt)=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.3,delay:tt*.05},style:{display:"flex",justifyContent:Je.sender==="user"?"flex-end":"flex-start"},children:jsxRuntimeExports.jsxs("div",{style:{maxWidth:"80%",padding:"12px 16px",borderRadius:"18px",backgroundColor:Je.sender==="user"?B.userMessageBgColor:B.aiMessageBgColor,color:Je.sender==="user"?"white":B.textColor,fontSize:B.fontSize,position:"relative"},children:[jsxRuntimeExports.jsxs("div",{style:{marginBottom:"4px",display:"flex",alignItems:"center"},children:[Je.sender==="user"?jsxRuntimeExports.jsx(User,{size:20,style:{marginRight:"8px",color:"black",backgroundColor:B.headerFooterBgColor,padding:"5px",borderRadius:"50%"}}):jsxRuntimeExports.jsx(Bot,{size:20,style:{marginRight:"8px",color:"black",backgroundColor:B.primaryColor,padding:"5px",borderRadius:"50%"}}),Je.sender==="user"?"You":B.companyName]}),jsxRuntimeExports.jsx("div",{children:Je.content}),jsxRuntimeExports.jsx("div",{style:{fontSize:"11px",opacity:.7,marginTop:"4px"},children:He(Je.timestamp)})]})},Je.id))]}),W&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{display:"flex",alignItems:"center",gap:"12px"},children:jsxRuntimeExports.jsx("div",{style:{padding:"12px 16px",borderRadius:"18px",backgroundColor:B.aiMessageBgColor,color:B.textColor,fontSize:B.fontSize},children:jsxRuntimeExports.jsx(ut,{})})}),jsxRuntimeExports.jsx("div",{ref:qe})]})}),Ce==="voice"&&jsxRuntimeExports.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:B.backgroundColor,padding:"40px"},children:jsxRuntimeExports.jsxs("div",{style:{textAlign:"center"},children:[jsxRuntimeExports.jsxs(motion.div,{animate:{scale:[1,1.1,1],opacity:[.8,1,.8]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},style:{width:"100px",height:"100px",margin:"0 auto 24px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:`linear-gradient(135deg, ${B.primaryColor}20, ${B.secondaryColor}20)`,color:B.primaryColor,position:"relative"},children:[jsxRuntimeExports.jsx(VoiceAgent,{messages:H,setMessages:Je=>G(tt=>[...tt,Je]),shouldStartCall:Ae,setShouldStartCall:_e,setGenerating:X,prompt:B.prompt||"",clientKey:V,apiUrl:j,sessionId:he||void 0,theme:B}),jsxRuntimeExports.jsx(motion.div,{animate:{scale:[1,1.5,1],opacity:[.5,0,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},style:{position:"absolute",inset:0,border:`2px solid ${B.primaryColor}`,borderRadius:"50%"}})]}),jsxRuntimeExports.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:B.textColor,margin:"0 0 16px 0"},children:"Voice Assistant"}),jsxRuntimeExports.jsx("p",{style:{fontSize:"14px",opacity:.7,color:B.textColor,margin:"0 0 24px 0"},children:"Click the microphone to start voice conversation"})]})})]}),Ce==="chat"&&!$e&&jsxRuntimeExports.jsx(motion.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},style:{backgroundColor:B.inputContainerBgColor,padding:"16px",borderTop:`1px solid ${B.primaryColor}20`},children:jsxRuntimeExports.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:jsxRuntimeExports.jsxs("div",{style:{position:"relative",flex:1,display:"flex",alignItems:"center"},children:[jsxRuntimeExports.jsx("input",{ref:Re,type:"text",value:$,onChange:Je=>Q(Je.target.value),onKeyPress:we,placeholder:"Type your message...",disabled:W,style:{width:"100%",padding:"12px 16px",paddingRight:"120px",borderRadius:"24px",border:`1px solid ${B.primaryColor}20`,backgroundColor:B.backgroundColor,color:B.textColor,fontSize:B.fontSize,outline:"none"}}),jsxRuntimeExports.jsx("div",{style:{position:"absolute",right:"8px",display:"flex",alignItems:"center",gap:"4px",border:"none"},children:jsxRuntimeExports.jsx("button",{onClick:We,disabled:!$.trim()||W,style:{backgroundColor:$.trim()&&!W?B.primaryColor:B.primaryColor+"70",border:"none",cursor:$.trim()&&!W?"pointer":"not-allowed",padding:"8px",borderRadius:"50%",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:W?jsxRuntimeExports.jsx(LoaderCircle,{size:16,style:{animation:"spin 1s linear infinite"}}):jsxRuntimeExports.jsx(Send,{size:16})})})]})})}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},style:{padding:"8px 16px",textAlign:"center",borderTop:`1px solid ${B.primaryColor}15`,backgroundColor:B.headerFooterBgColor,borderBottomLeftRadius:B.borderRadius,borderBottomRightRadius:B.borderRadius},children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"12px",opacity:.75,color:B.textColor},children:[B.companyLogo!="https://placehold.co/32x32"?jsxRuntimeExports.jsx("img",{src:B.companyLogo,alt:"Company Logo",style:{width:"32px",height:"32px"}}):jsxRuntimeExports.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:B.primaryColor,display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsx(Bot,{size:16,color:"white"})}),jsxRuntimeExports.jsxs("span",{children:["Powered by ",B.companyName]})]})})]})})]}),jsxRuntimeExports.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `})]}):jsxRuntimeExports.jsx("div",{style:{position:"fixed",bottom:"16px",right:"16px",zIndex:50},children:jsxRuntimeExports.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",border:"2px solid rgba(255, 255, 255, 0.2)"},children:jsxRuntimeExports.jsx(motion.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:jsxRuntimeExports.jsx(Sparkles,{size:28,color:"white"})})})})}window.ChatBotWidget={mount:(V,U)=>{const j=clientExports.createRoot(V);return j.render(jsxRuntimeExports.jsx(App,{clientKey:U.clientKey,customUserId:U.customUserId})),{destroy:()=>{j.unmount(),V.parentNode&&V.parentNode.removeChild(V)}}},mountLegacy:(V="body",U="123456789")=>{const j=document.createElement("div");j.id="chat-bot-widget-root",document.querySelector(V)?.appendChild(j),clientExports.createRoot(j).render(jsxRuntimeExports.jsx(App,{clientKey:U}))}}})();
